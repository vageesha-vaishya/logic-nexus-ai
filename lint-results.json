[{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/scripts/seedComposerData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/GlobalErrorBoundary.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[731,734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[731,734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Component, ErrorInfo, ReactNode } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { AlertTriangle } from 'lucide-react';\nimport * as Sentry from \"@sentry/react\";\n\ninterface Props {\n  children: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n}\n\nexport class GlobalErrorBoundary extends Component<Props, State> {\n  public state: State = {\n    hasError: false,\n    error: null\n  };\n\n  public static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error('Uncaught error:', error, errorInfo);\n    Sentry.captureException(error, { extra: errorInfo as any });\n  }\n\n  private handleReload = () => {\n    window.location.reload();\n  };\n\n  public render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n          <div className=\"max-w-md w-full space-y-6 text-center\">\n            <div className=\"flex justify-center\">\n              <div className=\"h-24 w-24 rounded-full bg-destructive/10 flex items-center justify-center\">\n                <AlertTriangle className=\"h-12 w-12 text-destructive\" />\n              </div>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <h1 className=\"text-2xl font-bold tracking-tight\">Something went wrong</h1>\n              <p className=\"text-muted-foreground\">\n                An unexpected error occurred. We've been notified and are working to fix it.\n              </p>\n            </div>\n\n            {this.state.error && process.env.NODE_ENV === 'development' && (\n              <div className=\"text-left p-4 bg-muted rounded-lg overflow-auto max-h-48 text-xs font-mono\">\n                {this.state.error.toString()}\n              </div>\n            )}\n\n            <div className=\"flex justify-center gap-4\">\n              <Button onClick={() => window.history.back()} variant=\"outline\">\n                Go Back\n              </Button>\n              <Button onClick={this.handleReload}>\n                Reload Application\n              </Button>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/admin/FranchiseForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1408,1411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1408,1411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1659,1662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1659,1662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1714,1717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1714,1717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4024,4027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4024,4027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useEffect, useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCRM } from '@/hooks/useCRM';\n\nconst franchiseSchema = z.object({\n  name: z.string().min(2, 'Name must be at least 2 characters'),\n  code: z.string().min(2, 'Code must be at least 2 characters'),\n  tenant_id: z.string().min(1, 'Tenant is required'),\n  manager_id: z.string().optional(),\n  is_active: z.boolean().default(true),\n  address: z.string().optional(),\n});\n\ntype FranchiseFormValues = z.infer<typeof franchiseSchema>;\n\ninterface FranchiseFormProps {\n  franchise?: any;\n  onSuccess?: () => void;\n}\n\nexport function FranchiseForm({ franchise, onSuccess }: FranchiseFormProps) {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { context } = useCRM();\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [managers, setManagers] = useState<any[]>([]);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingData, setPendingData] = useState<FranchiseFormValues | null>(null);\n\n  const form = useForm<FranchiseFormValues>({\n    resolver: zodResolver(franchiseSchema),\n    defaultValues: {\n      name: franchise?.name || '',\n      code: franchise?.code || '',\n      tenant_id: franchise?.tenant_id || context.tenantId || '',\n      manager_id: franchise?.manager_id || '',\n      is_active: franchise?.is_active ?? true,\n      address: franchise?.address ? JSON.stringify(franchise.address, null, 2) : '',\n    },\n  });\n\n  useEffect(() => {\n    fetchTenants();\n    fetchManagers();\n  }, []);\n\n  const fetchTenants = async () => {\n    const { data } = await supabase.from('tenants').select('id, name').eq('is_active', true);\n    setTenants(data || []);\n  };\n\n  const fetchManagers = async () => {\n    const { data } = await supabase.from('profiles').select('id, first_name, last_name, email');\n    setManagers(data || []);\n  };\n\n  const handleFormSubmit = (values: FranchiseFormValues) => {\n    setPendingData(values);\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirm = async () => {\n    if (!pendingData) return;\n    setShowConfirmDialog(false);\n    \n    await onSubmit(pendingData);\n    setPendingData(null);\n  };\n\n  const onSubmit = async (values: FranchiseFormValues) => {\n    try {\n      const data = {\n        name: values.name,\n        code: values.code,\n        tenant_id: values.tenant_id,\n        manager_id: values.manager_id || null,\n        is_active: values.is_active,\n        address: values.address ? JSON.parse(values.address) : null,\n      };\n\n      if (franchise) {\n        const { error } = await supabase\n          .from('franchises')\n          .update(data)\n          .eq('id', franchise.id);\n\n        if (error) throw error;\n\n        toast({\n          title: 'Success',\n          description: 'Franchise updated successfully',\n        });\n        onSuccess?.();\n      } else {\n        const { error } = await supabase\n          .from('franchises')\n          .insert([data]);\n\n        if (error) throw error;\n\n        toast({\n          title: 'Success',\n          description: 'Franchise created successfully',\n        });\n        navigate('/dashboard/franchises');\n      }\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    }\n  };\n\n  return (\n    <>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleFormSubmit)} className=\"space-y-6\">\n        <FormField\n          control={form.control}\n          name=\"name\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Name *</FormLabel>\n              <FormControl>\n                <Input placeholder=\"Downtown Branch\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"code\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Code *</FormLabel>\n              <FormControl>\n                <Input placeholder=\"DT-001\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"tenant_id\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Tenant *</FormLabel>\n              <Select onValueChange={field.onChange} value={field.value}>\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select tenant\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  {tenants.map((tenant) => (\n                    <SelectItem key={tenant.id} value={tenant.id}>\n                      {tenant.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"manager_id\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Manager</FormLabel>\n              <Select onValueChange={field.onChange} value={field.value}>\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select manager\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  {managers.map((manager) => (\n                    <SelectItem key={manager.id} value={manager.id}>\n                      {manager.first_name} {manager.last_name} ({manager.email})\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"address\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Address (JSON)</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder='{\"street\": \"123 Main St\", \"city\": \"New York\", \"state\": \"NY\", \"zip\": \"10001\"}' \n                  className=\"font-mono\"\n                  rows={4}\n                  {...field} \n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"is_active\"\n          render={({ field }) => (\n            <FormItem className=\"flex items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel>Active Status</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Enable or disable this franchise\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex gap-4\">\n          <Button type=\"submit\" className=\"flex-1\">\n            {franchise ? 'Update' : 'Create'} Franchise\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => navigate('/dashboard/franchises')}\n          >\n            Cancel\n          </Button>\n        </div>\n        </form>\n      </Form>\n\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Confirm {franchise ? 'Update' : 'Create'}</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to {franchise ? 'update' : 'create'} this franchise?\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirm}>Confirm</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/admin/TenantForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1357,1360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1357,1360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3453,3456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3453,3456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\n\nconst tenantSchema = z.object({\n  name: z.string().min(2, 'Name must be at least 2 characters'),\n  slug: z.string().min(2, 'Slug must be at least 2 characters').regex(/^[a-z0-9-]+$/, 'Slug must be lowercase alphanumeric with hyphens'),\n  domain: z.string().optional(),\n  logo_url: z.string().url().optional().or(z.literal('')),\n  subscription_tier: z.string().optional(),\n  is_active: z.boolean().default(true),\n  settings: z.string().optional(),\n});\n\ntype TenantFormValues = z.infer<typeof tenantSchema>;\n\ninterface TenantFormProps {\n  tenant?: any;\n  onSuccess?: () => void;\n}\n\nexport function TenantForm({ tenant, onSuccess }: TenantFormProps) {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingData, setPendingData] = useState<TenantFormValues | null>(null);\n\n  const form = useForm<TenantFormValues>({\n    resolver: zodResolver(tenantSchema),\n    defaultValues: {\n      name: tenant?.name || '',\n      slug: tenant?.slug || '',\n      domain: tenant?.domain || '',\n      logo_url: tenant?.logo_url || '',\n      subscription_tier: tenant?.subscription_tier || '',\n      is_active: tenant?.is_active ?? true,\n      settings: tenant?.settings ? JSON.stringify(tenant.settings, null, 2) : '',\n    },\n  });\n\n  const handleFormSubmit = (values: TenantFormValues) => {\n    setPendingData(values);\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirm = async () => {\n    if (!pendingData) return;\n    setShowConfirmDialog(false);\n    \n    await onSubmit(pendingData);\n    setPendingData(null);\n  };\n\n  const onSubmit = async (values: TenantFormValues) => {\n    try {\n      const data = {\n        name: values.name,\n        slug: values.slug,\n        domain: values.domain || null,\n        logo_url: values.logo_url || null,\n        subscription_tier: values.subscription_tier || null,\n        is_active: values.is_active,\n        settings: values.settings ? JSON.parse(values.settings) : null,\n      };\n\n      if (tenant) {\n        const { error } = await supabase\n          .from('tenants')\n          .update(data)\n          .eq('id', tenant.id);\n\n        if (error) throw error;\n\n        toast({\n          title: 'Success',\n          description: 'Tenant updated successfully',\n        });\n        onSuccess?.();\n      } else {\n        const { error } = await supabase\n          .from('tenants')\n          .insert([data]);\n\n        if (error) throw error;\n\n        toast({\n          title: 'Success',\n          description: 'Tenant created successfully',\n        });\n        navigate('/dashboard/tenants');\n      }\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    }\n  };\n\n  return (\n    <>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleFormSubmit)} className=\"space-y-6\">\n        <FormField\n          control={form.control}\n          name=\"name\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Name *</FormLabel>\n              <FormControl>\n                <Input placeholder=\"Acme Corporation\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"slug\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Slug *</FormLabel>\n              <FormControl>\n                <Input placeholder=\"acme-corp\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"domain\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Domain</FormLabel>\n              <FormControl>\n                <Input placeholder=\"acme.com\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"logo_url\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Logo URL</FormLabel>\n              <FormControl>\n                <Input placeholder=\"https://example.com/logo.png\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"subscription_tier\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Subscription Tier</FormLabel>\n              <FormControl>\n                <Input placeholder=\"Enterprise\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"settings\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Settings (JSON)</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder='{\"key\": \"value\"}' \n                  className=\"font-mono\"\n                  rows={4}\n                  {...field} \n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"is_active\"\n          render={({ field }) => (\n            <FormItem className=\"flex items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel>Active Status</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Enable or disable this tenant\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex gap-4\">\n          <Button type=\"submit\" className=\"flex-1\">\n            {tenant ? 'Update' : 'Create'} Tenant\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => navigate('/dashboard/tenants')}\n          >\n            Cancel\n          </Button>\n        </div>\n        </form>\n      </Form>\n\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Confirm {tenant ? 'Update' : 'Create'}</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to {tenant ? 'update' : 'create'} this tenant?\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirm}>Confirm</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/admin/UserForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1707,1710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1707,1710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2091,2094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2091,2094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2150,2153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2150,2153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTenants'. Either include it or remove the dependency array.","line":69,"column":6,"nodeType":"ArrayExpression","endLine":69,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTenants]","fix":{"range":[3040,3042],"text":"[fetchTenants]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFranchises'. Either include it or remove the dependency array.","line":75,"column":6,"nodeType":"ArrayExpression","endLine":75,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFranchises, selectedTenantId]","fix":{"range":[3146,3164],"text":"[fetchFranchises, selectedTenantId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3543,3546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3543,3546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4088,4091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4088,4091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7021,7024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7021,7024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Switch } from '@/components/ui/switch';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCRM } from '@/hooks/useCRM';\n\nconst userSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(6, 'Password must be at least 6 characters').optional(),\n  first_name: z.string().min(2, 'First name must be at least 2 characters'),\n  last_name: z.string().min(2, 'Last name must be at least 2 characters'),\n  phone: z.string().optional(),\n  avatar_url: z.string().url().optional().or(z.literal('')),\n  is_active: z.boolean().default(true),\n  must_change_password: z.boolean().default(false),\n  email_verified: z.boolean().default(true),\n  role: z.enum(['platform_admin', 'tenant_admin', 'franchise_admin', 'user']),\n  tenant_id: z.string().optional(),\n  franchise_id: z.string().optional(),\n});\n\ntype UserFormValues = z.infer<typeof userSchema>;\n\ninterface UserFormProps {\n  user?: any;\n  onSuccess?: () => void;\n}\n\nexport function UserForm({ user, onSuccess }: UserFormProps) {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { context } = useCRM();\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingData, setPendingData] = useState<UserFormValues | null>(null);\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [franchises, setFranchises] = useState<any[]>([]);\n  const [selectedRole, setSelectedRole] = useState<string>(user?.user_roles?.[0]?.role || '');\n  const [selectedTenantId, setSelectedTenantId] = useState<string>(user?.user_roles?.[0]?.tenant_id || '');\n\n  const form = useForm<UserFormValues>({\n    resolver: zodResolver(userSchema),\n    defaultValues: {\n      email: user?.email || '',\n      password: '',\n      first_name: user?.first_name || '',\n      last_name: user?.last_name || '',\n      phone: user?.phone || '',\n      avatar_url: user?.avatar_url || '',\n      is_active: user?.is_active ?? true,\n      must_change_password: user?.must_change_password ?? false,\n      email_verified: true,\n      role: user?.user_roles?.[0]?.role || 'user',\n      tenant_id: user?.user_roles?.[0]?.tenant_id || '',\n      franchise_id: user?.user_roles?.[0]?.franchise_id || '',\n    },\n  });\n\n  useEffect(() => {\n    fetchTenants();\n  }, []);\n\n  useEffect(() => {\n    if (selectedTenantId) {\n      fetchFranchises(selectedTenantId);\n    }\n  }, [selectedTenantId]);\n\n  const fetchTenants = async () => {\n    try {\n      let query = supabase.from('tenants').select('*').eq('is_active', true);\n      \n      if (context.isTenantAdmin && context.tenantId) {\n        query = query.eq('id', context.tenantId);\n      }\n      \n      const { data, error } = await query;\n      if (error) throw error;\n      setTenants(data || []);\n    } catch (error: any) {\n      console.error('Error fetching tenants:', error);\n    }\n  };\n\n  const fetchFranchises = async (tenantId: string) => {\n    try {\n      let query = supabase\n        .from('franchises')\n        .select('*')\n        .eq('tenant_id', tenantId)\n        .eq('is_active', true);\n      \n      if (context.isFranchiseAdmin && context.franchiseId) {\n        query = query.eq('id', context.franchiseId);\n      }\n      \n      const { data, error } = await query;\n      if (error) throw error;\n      setFranchises(data || []);\n    } catch (error: any) {\n      console.error('Error fetching franchises:', error);\n    }\n  };\n\n  const handleFormSubmit = (values: UserFormValues) => {\n    setPendingData(values);\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirm = async () => {\n    if (!pendingData) return;\n    setShowConfirmDialog(false);\n    \n    await onSubmit(pendingData);\n    setPendingData(null);\n  };\n\n  const onSubmit = async (values: UserFormValues) => {\n    try {\n      if (user) {\n        // Update profile\n        const { error: profileError } = await supabase\n          .from('profiles')\n          .update({\n            first_name: values.first_name,\n            last_name: values.last_name,\n            phone: values.phone,\n            avatar_url: values.avatar_url,\n            is_active: values.is_active,\n            must_change_password: values.must_change_password,\n          })\n          .eq('id', user.id);\n\n        if (profileError) throw profileError;\n\n        // Update role if changed\n        const { error: roleError } = await supabase\n          .from('user_roles')\n          .update({\n            role: values.role,\n            tenant_id: values.tenant_id || null,\n            franchise_id: values.franchise_id || null,\n          })\n          .eq('user_id', user.id);\n\n        if (roleError) throw roleError;\n\n        toast({\n          title: 'Success',\n          description: 'User updated successfully',\n        });\n        onSuccess?.();\n      } else {\n        // Create new user via edge function\n        if (!values.password) {\n          throw new Error('Password is required for new users');\n        }\n\n        const { data, error } = await supabase.functions.invoke('create-user', {\n          body: {\n            email: values.email,\n            password: values.password,\n            first_name: values.first_name,\n            last_name: values.last_name,\n            phone: values.phone,\n            avatar_url: values.avatar_url,\n            is_active: values.is_active,\n            must_change_password: values.must_change_password,\n            email_verified: values.email_verified,\n            role: values.role,\n            tenant_id: values.tenant_id || null,\n            franchise_id: values.franchise_id || null,\n          },\n        });\n\n        if (error) throw error;\n        if (data?.error) throw new Error(data.error);\n\n        const messages = [];\n        if (values.must_change_password) {\n          messages.push('They will need to change their password on first login.');\n        }\n        if (!values.email_verified) {\n          messages.push('They must verify their email before logging in.');\n        } else {\n          messages.push('Email verification bypassed - they can log in immediately.');\n        }\n\n        toast({\n          title: 'Success',\n          description: `User created successfully. ${messages.join(' ')}`,\n        });\n        \n        navigate('/dashboard/users');\n      }\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    }\n  };\n\n  return (\n    <>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleFormSubmit)} className=\"space-y-6\">\n        <FormField\n          control={form.control}\n          name=\"email\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Email *</FormLabel>\n              <FormControl>\n                <Input placeholder=\"user@example.com\" {...field} disabled={!!user} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {!user && (\n          <FormField\n            control={form.control}\n            name=\"password\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Temporary Password *</FormLabel>\n                <FormControl>\n                  <Input type=\"password\" placeholder=\"Min 6 characters\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"first_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>First Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"John\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"last_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Last Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Doe\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"phone\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Phone</FormLabel>\n              <FormControl>\n                <Input placeholder=\"+1 (555) 123-4567\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"avatar_url\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Avatar URL</FormLabel>\n              <FormControl>\n                <Input placeholder=\"https://example.com/avatar.jpg\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"is_active\"\n          render={({ field }) => (\n            <FormItem className=\"flex items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel>Active Status</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Enable or disable this user\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"must_change_password\"\n          render={({ field }) => (\n            <FormItem className=\"flex items-center justify-between rounded-lg border p-4\">\n              <div className=\"space-y-0.5\">\n                <FormLabel>Must Change Password</FormLabel>\n                <div className=\"text-sm text-muted-foreground\">\n                  Require password change on next login\n                </div>\n              </div>\n              <FormControl>\n                <Switch\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        {!user && (\n          <FormField\n            control={form.control}\n            name=\"email_verified\"\n            render={({ field }) => (\n              <FormItem className=\"flex items-center justify-between rounded-lg border p-4\">\n                <div className=\"space-y-0.5\">\n                  <FormLabel>Override Email Verification</FormLabel>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Skip email verification - user can log in immediately\n                  </div>\n                </div>\n                <FormControl>\n                  <Switch\n                    checked={field.value}\n                    onCheckedChange={field.onChange}\n                  />\n                </FormControl>\n              </FormItem>\n            )}\n          />\n        )}\n\n        <FormField\n          control={form.control}\n          name=\"role\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Role *</FormLabel>\n              <Select \n                onValueChange={(value) => {\n                  field.onChange(value);\n                  setSelectedRole(value);\n                }} \n                defaultValue={field.value}\n                disabled={!context.isPlatformAdmin && field.value === 'platform_admin'}\n              >\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a role\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  {context.isPlatformAdmin && (\n                    <SelectItem value=\"platform_admin\">Platform Admin</SelectItem>\n                  )}\n                  <SelectItem value=\"tenant_admin\">Tenant Admin</SelectItem>\n                  <SelectItem value=\"franchise_admin\">Franchise Admin</SelectItem>\n                  <SelectItem value=\"user\">User</SelectItem>\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {(selectedRole === 'tenant_admin' || selectedRole === 'franchise_admin' || selectedRole === 'user') && (\n          <FormField\n            control={form.control}\n            name=\"tenant_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Tenant *</FormLabel>\n                <Select \n                  onValueChange={(value) => {\n                    field.onChange(value);\n                    setSelectedTenantId(value);\n                  }} \n                  defaultValue={field.value}\n                >\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select a tenant\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {tenants.map((tenant) => (\n                      <SelectItem key={tenant.id} value={tenant.id}>\n                        {tenant.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        {(selectedRole === 'franchise_admin' || selectedRole === 'user') && selectedTenantId && (\n          <FormField\n            control={form.control}\n            name=\"franchise_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Franchise *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select a franchise\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {franchises.map((franchise) => (\n                      <SelectItem key={franchise.id} value={franchise.id}>\n                        {franchise.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        <div className=\"flex gap-4\">\n          <Button type=\"submit\" className=\"flex-1\">\n            {user ? 'Update' : 'Create'} User\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => navigate('/dashboard/users')}\n          >\n            Cancel\n          </Button>\n        </div>\n        </form>\n      </Form>\n\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Confirm {user ? 'Update' : 'Creation'}</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to {user ? 'update' : 'create'} this user?\n              {!user && ' The user will be required to change their password on first login.'}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirm}>Confirm</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/aes-hts-code-manager.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCodes'. Either include it or remove the dependency array.","line":102,"column":6,"nodeType":"ArrayExpression","endLine":102,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadCodes]","fix":{"range":[3666,3668],"text":"[loadCodes]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/analytics/PipelineAnalytics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/AssignmentAnalytics.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[472,475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[472,475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAnalytics'. Either include it or remove the dependency array.","line":19,"column":6,"nodeType":"ArrayExpression","endLine":19,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAnalytics]","fix":{"range":[635,637],"text":"[fetchAnalytics]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2333,2336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2333,2336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { BarChart3, TrendingUp, Users, Clock } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nexport function AssignmentAnalytics() {\n  const { supabase, context } = useCRM();\n  const [analytics, setAnalytics] = useState({\n    totalAssignments: 0,\n    avgAssignmentTime: 0,\n    topAssignees: [] as any[],\n    methodDistribution: {} as Record<string, number>,\n  });\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchAnalytics();\n  }, []);\n\n  const fetchAnalytics = async () => {\n    try {\n      // Get assignment history\n      let query = supabase\n        .from('lead_assignment_history')\n        .select('*');\n\n      if (context.tenantId) query = query.eq('tenant_id', context.tenantId);\n\n      const { data: history, error } = await query;\n      if (error) throw error;\n\n      // Calculate metrics\n      const totalAssignments = history?.length || 0;\n\n      // Method distribution\n      const methodDist: Record<string, number> = {};\n      history?.forEach((item) => {\n        methodDist[item.assignment_method] = (methodDist[item.assignment_method] || 0) + 1;\n      });\n\n      // Fetch profiles for top assignees\n      const assigneeCounts: Record<string, number> = {};\n      history?.forEach((item) => {\n        const key = item.assigned_to;\n        assigneeCounts[key] = (assigneeCounts[key] || 0) + 1;\n      });\n\n      const topUserIds = Object.entries(assigneeCounts)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 5)\n        .map(([userId]) => userId);\n\n      const { data: profilesData } = await supabase\n        .from('profiles')\n        .select('id, first_name, last_name')\n        .in('id', topUserIds);\n\n      const profilesMap = new Map(profilesData?.map(p => [p.id, p]));\n\n      const topAssignees = topUserIds.map(userId => {\n        const profile = profilesMap.get(userId);\n        return {\n          count: assigneeCounts[userId],\n          name: profile ? `${profile.first_name} ${profile.last_name}` : 'Unknown',\n        };\n      });\n\n      setAnalytics({\n        totalAssignments,\n        avgAssignmentTime: 0,\n        topAssignees,\n        methodDistribution: methodDist,\n      });\n    } catch (error: any) {\n      toast.error('Failed to load analytics');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-12\">Loading analytics...</div>;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h3 className=\"text-lg font-medium\">Assignment Analytics</h3>\n        <p className=\"text-sm text-muted-foreground\">\n          Insights and metrics on lead assignment performance\n        </p>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Assignments</CardTitle>\n            <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{analytics.totalAssignments}</div>\n            <p className=\"text-xs text-muted-foreground\">All time</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Avg. Assignment Time</CardTitle>\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {analytics.avgAssignmentTime > 0 ? `${analytics.avgAssignmentTime}m` : 'N/A'}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Minutes</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active Users</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{analytics.topAssignees.length}</div>\n            <p className=\"text-xs text-muted-foreground\">Receiving assignments</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Performance</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">98%</div>\n            <p className=\"text-xs text-muted-foreground\">Success rate</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Top Assignees</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {analytics.topAssignees.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No data available</p>\n            ) : (\n              <div className=\"space-y-3\">\n                {analytics.topAssignees.map((assignee, index) => (\n                  <div key={index} className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium\">{assignee.name || 'Unknown'}</span>\n                    <span className=\"text-sm text-muted-foreground\">{assignee.count} leads</span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Assignment Methods</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {Object.keys(analytics.methodDistribution).length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No data available</p>\n            ) : (\n              <div className=\"space-y-3\">\n                {Object.entries(analytics.methodDistribution).map(([method, count]) => (\n                  <div key={method} className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium capitalize\">\n                      {method.replace('_', ' ')}\n                    </span>\n                    <span className=\"text-sm text-muted-foreground\">{count}</span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/AssignmentHistory.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[478,481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[478,481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchHistory'. Either include it or remove the dependency array.","line":18,"column":6,"nodeType":"ArrayExpression","endLine":18,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchHistory]","fix":{"range":[638,640],"text":"[fetchHistory]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2131,2134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2131,2134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { ArrowRight, Search } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\n\nexport function AssignmentHistory() {\n  const { supabase, context } = useCRM();\n  const [history, setHistory] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n\n  useEffect(() => {\n    fetchHistory();\n  }, []);\n\n  const fetchHistory = async () => {\n    try {\n      let query = supabase\n        .from('lead_assignment_history')\n        .select('*')\n        .order('assigned_at', { ascending: false })\n        .limit(100);\n\n      if (context.tenantId) query = query.eq('tenant_id', context.tenantId);\n\n      const { data: historyData, error } = await query;\n      if (error) throw error;\n\n      // Fetch related data separately\n      if (historyData && historyData.length > 0) {\n        const leadIds = historyData.map(h => h.lead_id).filter(Boolean);\n        const userIds = [...new Set([\n          ...historyData.map(h => h.assigned_to),\n          ...historyData.map(h => h.assigned_from).filter(Boolean)\n        ])];\n\n        const [{ data: leadsData }, { data: profilesData }] = await Promise.all([\n          supabase.from('leads').select('id, first_name, last_name, company').in('id', leadIds),\n          supabase.from('profiles').select('id, first_name, last_name').in('id', userIds)\n        ]);\n\n        const leadsMap = new Map(leadsData?.map(l => [l.id, l]));\n        const profilesMap = new Map(profilesData?.map(p => [p.id, p]));\n\n        const enrichedData = historyData.map(item => ({\n          ...item,\n          leads: leadsMap.get(item.lead_id),\n          assigned_to_profile: profilesMap.get(item.assigned_to),\n          assigned_from_profile: item.assigned_from ? profilesMap.get(item.assigned_from) : null\n        }));\n\n        setHistory(enrichedData);\n      }\n    } catch (error: any) {\n      toast.error('Failed to load history');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredHistory = history.filter((item) => {\n    const searchLower = searchQuery.toLowerCase();\n    return (\n      item.leads?.first_name?.toLowerCase().includes(searchLower) ||\n      item.leads?.last_name?.toLowerCase().includes(searchLower) ||\n      item.leads?.company?.toLowerCase().includes(searchLower) ||\n      item.assigned_to_profile?.first_name?.toLowerCase().includes(searchLower) ||\n      item.assigned_to_profile?.last_name?.toLowerCase().includes(searchLower)\n    );\n  });\n\n  const getMethodColor = (method: string) => {\n    const colors: Record<string, string> = {\n      manual: 'bg-blue-500/10 text-blue-500',\n      round_robin: 'bg-purple-500/10 text-purple-500',\n      rule_based: 'bg-green-500/10 text-green-500',\n      territory: 'bg-yellow-500/10 text-yellow-500',\n    };\n    return colors[method] || 'bg-gray-500/10 text-gray-500';\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-12\">Loading history...</div>;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <h3 className=\"text-lg font-medium\">Assignment History</h3>\n        <p className=\"text-sm text-muted-foreground\">\n          Track all lead assignment changes and history\n        </p>\n      </div>\n\n      <div className=\"relative\">\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search by lead or user...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          className=\"pl-10\"\n        />\n      </div>\n\n      {filteredHistory.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground\">\n              {searchQuery ? 'No matching assignments found' : 'No assignment history'}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-3\">\n          {filteredHistory.map((item) => (\n            <Card key={item.id}>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-4 flex-1\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <h4 className=\"font-semibold\">\n                          {item.leads?.first_name} {item.leads?.last_name}\n                        </h4>\n                        {item.leads?.company && (\n                          <span className=\"text-sm text-muted-foreground\">\n                             {item.leads.company}\n                          </span>\n                        )}\n                      </div>\n                      \n                      <div className=\"flex items-center gap-2 text-sm\">\n                        {item.assigned_from_profile && (\n                          <>\n                            <span className=\"text-muted-foreground\">\n                              {item.assigned_from_profile.first_name}{' '}\n                              {item.assigned_from_profile.last_name}\n                            </span>\n                            <ArrowRight className=\"h-3 w-3 text-muted-foreground\" />\n                          </>\n                        )}\n                        <span className=\"font-medium\">\n                          {item.assigned_to_profile?.first_name}{' '}\n                          {item.assigned_to_profile?.last_name}\n                        </span>\n                      </div>\n\n                      {item.reason && (\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          {item.reason}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"flex flex-col items-end gap-2\">\n                      <Badge className={getMethodColor(item.assignment_method)}>\n                        {item.assignment_method.replace('_', ' ')}\n                      </Badge>\n                      <span className=\"text-xs text-muted-foreground\">\n                        {format(new Date(item.assigned_at), 'MMM d, yyyy HH:mm')}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/AssignmentQueue.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[563,566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[563,566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchQueue'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchQueue]","fix":{"range":[667,669],"text":"[fetchQueue]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1144,1147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1144,1147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1644,1647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1644,1647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3750,3753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3750,3753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { RefreshCw, AlertCircle, CheckCircle, Clock } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\n\ninterface Props {\n  onUpdate?: () => void;\n}\n\nexport function AssignmentQueue({ onUpdate }: Props) {\n  const { supabase, context } = useCRM();\n  const [queue, setQueue] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchQueue();\n  }, []);\n\n  const fetchQueue = async () => {\n    try {\n      let query = supabase\n        .from('lead_assignment_queue')\n        .select('*, leads(first_name, last_name, company)')\n        .order('priority', { ascending: false })\n        .order('created_at', { ascending: true });\n\n      if (context.tenantId) query = query.eq('tenant_id', context.tenantId);\n\n      const { data, error } = await query;\n      if (error) throw error;\n      setQueue(data || []);\n    } catch (error: any) {\n      toast.error('Failed to load queue');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRetry = async (queueId: string) => {\n    try {\n      const { error } = await supabase\n        .from('lead_assignment_queue')\n        .update({ status: 'pending', error_message: null })\n        .eq('id', queueId);\n\n      if (error) throw error;\n      toast.success('Queued for retry');\n      fetchQueue();\n      onUpdate?.();\n    } catch (error: any) {\n      toast.error('Failed to retry');\n      console.error('Error:', error);\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return <Clock className=\"h-4 w-4\" />;\n      case 'processing':\n        return <RefreshCw className=\"h-4 w-4 animate-spin\" />;\n      case 'assigned':\n        return <CheckCircle className=\"h-4 w-4\" />;\n      case 'failed':\n        return <AlertCircle className=\"h-4 w-4\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return 'secondary';\n      case 'processing':\n        return 'default';\n      case 'assigned':\n        return 'default';\n      case 'failed':\n        return 'destructive';\n      default:\n        return 'secondary';\n    }\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-12\">Loading queue...</div>;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h3 className=\"text-lg font-medium\">Assignment Queue</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            View and manage pending lead assignments\n          </p>\n        </div>\n        <Button onClick={fetchQueue} variant=\"outline\" size=\"sm\">\n          <RefreshCw className=\"mr-2 h-4 w-4\" />\n          Refresh\n        </Button>\n      </div>\n\n      {queue.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground\">No items in queue</p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-3\">\n          {queue.map((item) => (\n            <Card key={item.id}>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-4 flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      {getStatusIcon(item.status)}\n                      <Badge variant={getStatusColor(item.status) as any}>\n                        {item.status}\n                      </Badge>\n                    </div>\n\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-semibold\">\n                        {item.leads?.first_name} {item.leads?.last_name}\n                      </h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {item.leads?.company || 'No company'}\n                      </p>\n                      {item.error_message && (\n                        <p className=\"text-sm text-destructive mt-1\">\n                          Error: {item.error_message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"text-sm text-muted-foreground text-right\">\n                      <p>Priority: {item.priority}</p>\n                      <p>Created: {format(new Date(item.created_at), 'MMM d, HH:mm')}</p>\n                      {item.retry_count > 0 && <p>Retries: {item.retry_count}</p>}\n                    </div>\n                  </div>\n\n                  {item.status === 'failed' && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleRetry(item.id)}\n                    >\n                      <RefreshCw className=\"h-4 w-4 mr-1\" />\n                      Retry\n                    </Button>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/AssignmentRuleForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1003,1006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1003,1006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1208,1211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1208,1211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1269,1272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1269,1272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchTerritories' and 'fetchUsers'. Either include them or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTerritories, fetchUsers]","fix":{"range":[1741,1743],"text":"[fetchTerritories, fetchUsers]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2283,2286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2283,2286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2875,2878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2875,2878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3598,3601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3598,3601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nconst ruleSchema = z.object({\n  rule_name: z.string().min(1, 'Rule name is required'),\n  assignment_type: z.enum(['round_robin', 'load_balance', 'territory', 'specific_user']),\n  priority: z.number().min(0),\n  assigned_to: z.string().optional(),\n  territory_id: z.string().optional(),\n  max_leads_per_user: z.number().min(1).optional(),\n  criteria: z.record(z.any()).optional(),\n});\n\ntype RuleFormData = z.infer<typeof ruleSchema>;\n\ninterface Props {\n  rule?: any;\n  onSave: () => void;\n  onCancel: () => void;\n}\n\nexport function AssignmentRuleForm({ rule, onSave, onCancel }: Props) {\n  const { supabase, context } = useCRM();\n  const [users, setUsers] = useState<any[]>([]);\n  const [territories, setTerritories] = useState<any[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  const { register, handleSubmit, watch, setValue, formState: { errors } } = useForm<RuleFormData>({\n    resolver: zodResolver(ruleSchema),\n    defaultValues: rule || {\n      rule_name: '',\n      assignment_type: 'round_robin',\n      priority: 0,\n      max_leads_per_user: 50,\n    },\n  });\n\n  const assignmentType = watch('assignment_type');\n\n  useEffect(() => {\n    fetchUsers();\n    fetchTerritories();\n  }, []);\n\n  const fetchUsers = async () => {\n    const { data } = await supabase.from('profiles').select('id, first_name, last_name, email');\n    setUsers(data || []);\n  };\n\n  const fetchTerritories = async () => {\n    let query = supabase.from('territories').select('*').eq('is_active', true);\n    if (context.tenantId) query = query.eq('tenant_id', context.tenantId);\n    const { data } = await query;\n    setTerritories(data || []);\n  };\n\n  const onSubmit = async (data: RuleFormData) => {\n    setLoading(true);\n    try {\n      const payload: any = {\n        ...data,\n        tenant_id: context.tenantId,\n        is_active: true,\n        criteria: data.criteria || {},\n      };\n\n      if (rule?.id) {\n        const { error } = await supabase\n          .from('lead_assignment_rules')\n          .update(payload)\n          .eq('id', rule.id);\n        if (error) throw error;\n      } else {\n        const { error } = await supabase\n          .from('lead_assignment_rules')\n          .insert(payload);\n        if (error) throw error;\n      }\n\n      toast.success(rule ? 'Rule updated' : 'Rule created');\n      onSave();\n    } catch (error: any) {\n      toast.error('Failed to save rule');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"rule_name\">Rule Name</Label>\n        <Input id=\"rule_name\" {...register('rule_name')} />\n        {errors.rule_name && (\n          <p className=\"text-sm text-destructive\">{errors.rule_name.message}</p>\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"assignment_type\">Assignment Type</Label>\n        <Select\n          value={assignmentType}\n          onValueChange={(value) => setValue('assignment_type', value as any)}\n        >\n          <SelectTrigger>\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"round_robin\">Round Robin</SelectItem>\n            <SelectItem value=\"load_balance\">Load Balance</SelectItem>\n            <SelectItem value=\"territory\">Territory Based</SelectItem>\n            <SelectItem value=\"specific_user\">Specific User</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {assignmentType === 'specific_user' && (\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"assigned_to\">Assign To User</Label>\n          <Select\n            value={watch('assigned_to') || ''}\n            onValueChange={(value) => setValue('assigned_to', value)}\n          >\n            <SelectTrigger>\n              <SelectValue placeholder=\"Select user\" />\n            </SelectTrigger>\n            <SelectContent>\n              {users.map((user) => (\n                <SelectItem key={user.id} value={user.id}>\n                  {user.first_name} {user.last_name} ({user.email})\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      )}\n\n      {assignmentType === 'territory' && (\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"territory_id\">Territory</Label>\n          <Select\n            value={watch('territory_id') || ''}\n            onValueChange={(value) => setValue('territory_id', value)}\n          >\n            <SelectTrigger>\n              <SelectValue placeholder=\"Select territory\" />\n            </SelectTrigger>\n            <SelectContent>\n              {territories.map((territory) => (\n                <SelectItem key={territory.id} value={territory.id}>\n                  {territory.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      )}\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"priority\">Priority</Label>\n        <Input\n          id=\"priority\"\n          type=\"number\"\n          {...register('priority', { valueAsNumber: true })}\n        />\n        <p className=\"text-xs text-muted-foreground\">\n          Higher priority rules are evaluated first\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"max_leads_per_user\">Max Leads Per User</Label>\n        <Input\n          id=\"max_leads_per_user\"\n          type=\"number\"\n          {...register('max_leads_per_user', { valueAsNumber: true })}\n        />\n      </div>\n\n      <div className=\"flex gap-2 justify-end\">\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\n          Cancel\n        </Button>\n        <Button type=\"submit\" disabled={loading}>\n          {loading ? 'Saving...' : rule ? 'Update' : 'Create'}\n        </Button>\n      </div>\n    </form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/AssignmentRules.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[773,776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[773,776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRules'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRules]","fix":{"range":[1310,1312],"text":"[fetchRules]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1716,1719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1716,1719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2218,2221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2218,2221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2704,2707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2704,2707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3299,3302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3299,3302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { Plus, Edit, Trash2, ArrowUp, ArrowDown } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport { AssignmentRuleForm } from './AssignmentRuleForm';\n\ninterface AssignmentRule {\n  id: string;\n  rule_name: string;\n  assignment_type: string;\n  priority: number;\n  is_active: boolean;\n  criteria: any;\n  assigned_to: string | null;\n  territory_id: string | null;\n  max_leads_per_user: number | null;\n}\n\ninterface Props {\n  onUpdate?: () => void;\n}\n\nexport function AssignmentRules({ onUpdate }: Props) {\n  const { supabase, context } = useCRM();\n  const [rules, setRules] = useState<AssignmentRule[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedRule, setSelectedRule] = useState<AssignmentRule | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  useEffect(() => {\n    fetchRules();\n  }, []);\n\n  const fetchRules = async () => {\n    try {\n      let query = supabase\n        .from('lead_assignment_rules')\n        .select('*')\n        .order('priority', { ascending: false });\n\n      if (context.tenantId) {\n        query = query.eq('tenant_id', context.tenantId);\n      }\n\n      const { data, error } = await query;\n      if (error) throw error;\n      setRules(data || []);\n    } catch (error: any) {\n      toast.error('Failed to load rules');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleToggleActive = async (ruleId: string, isActive: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('lead_assignment_rules')\n        .update({ is_active: !isActive })\n        .eq('id', ruleId);\n\n      if (error) throw error;\n      toast.success('Rule updated');\n      fetchRules();\n      onUpdate?.();\n    } catch (error: any) {\n      toast.error('Failed to update rule');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleDelete = async (ruleId: string) => {\n    if (!confirm('Are you sure you want to delete this rule?')) return;\n\n    try {\n      const { error } = await supabase\n        .from('lead_assignment_rules')\n        .delete()\n        .eq('id', ruleId);\n\n      if (error) throw error;\n      toast.success('Rule deleted');\n      fetchRules();\n      onUpdate?.();\n    } catch (error: any) {\n      toast.error('Failed to delete rule');\n      console.error('Error:', error);\n    }\n  };\n\n  const handlePriorityChange = async (ruleId: string, direction: 'up' | 'down') => {\n    const rule = rules.find(r => r.id === ruleId);\n    if (!rule) return;\n\n    const newPriority = direction === 'up' ? rule.priority + 1 : rule.priority - 1;\n\n    try {\n      const { error } = await supabase\n        .from('lead_assignment_rules')\n        .update({ priority: newPriority })\n        .eq('id', ruleId);\n\n      if (error) throw error;\n      fetchRules();\n      onUpdate?.();\n    } catch (error: any) {\n      toast.error('Failed to update priority');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleSave = () => {\n    setDialogOpen(false);\n    setSelectedRule(null);\n    fetchRules();\n    onUpdate?.();\n  };\n\n  const getAssignmentTypeLabel = (type: string) => {\n    const labels: Record<string, string> = {\n      round_robin: 'Round Robin',\n      load_balance: 'Load Balance',\n      territory: 'Territory Based',\n      specific_user: 'Specific User',\n    };\n    return labels[type] || type;\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-12\">Loading rules...</div>;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h3 className=\"text-lg font-medium\">Assignment Rules</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            Configure automated lead assignment workflows\n          </p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={() => setSelectedRule(null)}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New Rule\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {selectedRule ? 'Edit Assignment Rule' : 'Create Assignment Rule'}\n              </DialogTitle>\n              <DialogDescription>\n                Define how leads should be automatically assigned to users\n              </DialogDescription>\n            </DialogHeader>\n            <AssignmentRuleForm\n              rule={selectedRule}\n              onSave={handleSave}\n              onCancel={() => {\n                setDialogOpen(false);\n                setSelectedRule(null);\n              }}\n            />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {rules.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground mb-4\">No assignment rules configured</p>\n            <Button onClick={() => setDialogOpen(true)}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Create First Rule\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-3\">\n          {rules.map((rule) => (\n            <Card key={rule.id}>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-4 flex-1\">\n                    <div className=\"flex flex-col gap-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handlePriorityChange(rule.id, 'up')}\n                      >\n                        <ArrowUp className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handlePriorityChange(rule.id, 'down')}\n                      >\n                        <ArrowDown className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <h4 className=\"font-semibold\">{rule.rule_name}</h4>\n                        <Badge variant={rule.is_active ? 'default' : 'secondary'}>\n                          {rule.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                        <Badge variant=\"outline\">\n                          {getAssignmentTypeLabel(rule.assignment_type)}\n                        </Badge>\n                        <Badge variant=\"outline\">Priority: {rule.priority}</Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {rule.criteria && Object.keys(rule.criteria).length > 0\n                          ? `Criteria: ${Object.entries(rule.criteria)\n                              .map(([k, v]) => `${k}=${v}`)\n                              .join(', ')}`\n                          : 'No criteria defined'}\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      checked={rule.is_active}\n                      onCheckedChange={() => handleToggleActive(rule.id, rule.is_active)}\n                    />\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => {\n                        setSelectedRule(rule);\n                        setDialogOpen(true);\n                      }}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleDelete(rule.id)}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/ManualAssignment.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[633,636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[633,636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchUsers'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUsers]","fix":{"range":[838,840],"text":"[fetchUsers]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1782,1785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1782,1785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4101,4104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4101,4104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6433,6436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6433,6436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6564,6567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6564,6567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ninterface Props {\n  leadId: string;\n  currentOwnerId?: string | null;\n  onAssigned?: () => void;\n}\n\nexport function ManualAssignment({ leadId, currentOwnerId, onAssigned }: Props) {\n  const { supabase, context } = useCRM();\n  const [users, setUsers] = useState<any[]>([]);\n  const [selectedUser, setSelectedUser] = useState('');\n  const [reason, setReason] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    fetchUsers();\n  }, []);\n\n  const fetchUsers = async () => {\n    try {\n      // Get all active profiles\n      const { data: allProfiles } = await supabase\n        .from('profiles')\n        .select('id, first_name, last_name, email')\n        .eq('is_active', true);\n\n      if (!allProfiles) return;\n\n      // Get user capacity data\n      let capacityQuery = supabase\n        .from('user_capacity')\n        .select('user_id, is_available, current_leads, max_leads');\n\n      if (context.tenantId) capacityQuery = capacityQuery.eq('tenant_id', context.tenantId);\n\n      const { data: capacities } = await capacityQuery;\n\n      // Filter to available users with capacity\n      const availableUsers = allProfiles.filter(profile => {\n        const capacity = capacities?.find(c => c.user_id === profile.id);\n        return !capacity || (capacity.is_available && capacity.current_leads < capacity.max_leads);\n      });\n\n      setUsers(availableUsers);\n    } catch (error: any) {\n      toast.error('Failed to load users');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleAssign = async () => {\n    if (!selectedUser) {\n      toast.error('Please select a user');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Get lead details first\n      const { data: lead } = await supabase\n        .from('leads')\n        .select('id, tenant_id, franchise_id, first_name, last_name, company, email, phone, status')\n        .eq('id', leadId)\n        .single();\n\n      if (!lead) throw new Error('Lead not found');\n\n      // Update lead owner\n      const { error: updateError } = await supabase\n        .from('leads')\n        .update({ owner_id: selectedUser })\n        .eq('id', leadId);\n\n      if (updateError) throw updateError;\n\n      // Record assignment history\n      const { error: historyError } = await supabase\n        .from('lead_assignment_history')\n        .insert({\n          lead_id: leadId,\n          assigned_from: currentOwnerId,\n          assigned_to: selectedUser,\n          assignment_method: 'manual',\n          reason: reason || 'Manual assignment',\n          assigned_by: context.userId,\n          tenant_id: lead.tenant_id,\n          franchise_id: lead.franchise_id,\n        });\n\n      if (historyError) throw historyError;\n\n      // Update capacities\n      if (currentOwnerId) {\n        await supabase.rpc('decrement_user_lead_count', {\n          p_user_id: currentOwnerId,\n          p_tenant_id: lead.tenant_id,\n        });\n      }\n\n      await supabase.rpc('increment_user_lead_count', {\n        p_user_id: selectedUser,\n        p_tenant_id: lead.tenant_id,\n      });\n\n      // Auto-link existing unlinked tasks assigned to the new owner within the same scope (best-effort)\n      try {\n        let linkQuery = supabase\n          .from('activities')\n          .update({ lead_id: leadId })\n          .eq('assigned_to', selectedUser)\n          .is('lead_id', null)\n          .eq('activity_type', 'task')\n          .eq('tenant_id', lead.tenant_id);\n\n        if (lead.franchise_id) {\n          linkQuery = linkQuery.eq('franchise_id', lead.franchise_id);\n        }\n\n        const { error: linkErr } = await linkQuery;\n        if (linkErr) {\n          console.warn('Auto-link tasks skipped:', linkErr.message || linkErr);\n        }\n      } catch (linkErr: any) {\n        console.warn('Auto-link tasks skipped:', linkErr?.message || linkErr);\n      }\n\n      // Send email notification to the assignee (best-effort)\n      try {\n        const { data: assignee, error: assigneeErr } = await supabase\n          .from('profiles')\n          .select('id, email, first_name, last_name')\n          .eq('id', selectedUser)\n          .single();\n\n        if (!assigneeErr && assignee?.email) {\n          // Choose active email account\n          let emailQuery = supabase\n            .from('email_accounts')\n            .select('id, email_address, is_primary')\n            .eq('is_active', true)\n            .limit(1);\n\n          if (lead.franchise_id) {\n            emailQuery = emailQuery.eq('franchise_id', lead.franchise_id);\n          } else if (lead.tenant_id) {\n            emailQuery = emailQuery.eq('tenant_id', lead.tenant_id);\n          }\n\n          const { data: emailAccount } = await emailQuery.single();\n\n          if (emailAccount?.id) {\n            const subject = `New Lead Assigned: ${lead.first_name} ${lead.last_name}`;\n            const baseUrl = import.meta.env.VITE_APP_BASE_URL || window.location.origin;\n            const displayName = [assignee.first_name, assignee.last_name].filter(Boolean).join(' ');\n            const bodyHtml = `\n              <p>Hi ${displayName},</p>\n              <p>You have been assigned a new lead:</p>\n              <ul>\n                <li><strong>Name:</strong> ${lead.first_name} ${lead.last_name}</li>\n                ${lead.company ? `<li><strong>Company:</strong> ${lead.company}</li>` : ''}\n                ${lead.email ? `<li><strong>Email:</strong> ${lead.email}</li>` : ''}\n                ${lead.phone ? `<li><strong>Phone:</strong> ${lead.phone}</li>` : ''}\n                <li><strong>Status:</strong> ${lead.status}</li>\n              </ul>\n              <p><a href=\"${baseUrl}/dashboard/leads/${lead.id}\">View Lead</a></p>\n            `;\n\n            await supabase.functions.invoke('send-email', {\n              body: {\n                accountId: emailAccount.id,\n                to: [assignee.email],\n                cc: [],\n                subject,\n                body: bodyHtml,\n              },\n            });\n          }\n        }\n      } catch (notifyErr) {\n        console.warn('Assignment email skipped:', (notifyErr as any)?.message || notifyErr);\n      }\n\n      toast.success('Lead assigned successfully');\n      onAssigned?.();\n    } catch (error: any) {\n      toast.error('Failed to assign lead');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"user\">Assign To</Label>\n        <Select value={selectedUser} onValueChange={setSelectedUser}>\n          <SelectTrigger>\n            <SelectValue placeholder=\"Select user\" />\n          </SelectTrigger>\n          <SelectContent>\n            {users.map((user) => (\n              <SelectItem key={user.id} value={user.id}>\n                {user.first_name} {user.last_name} ({user.email})\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"reason\">Reason (Optional)</Label>\n        <Textarea\n          id=\"reason\"\n          placeholder=\"Why are you assigning this lead?\"\n          value={reason}\n          onChange={(e) => setReason(e.target.value)}\n          rows={3}\n        />\n      </div>\n\n      <Button onClick={handleAssign} disabled={loading || !selectedUser} className=\"w-full\">\n        {loading ? 'Assigning...' : 'Assign Lead'}\n      </Button>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/TerritoryManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[797,800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[797,800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[973,976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[973,976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTerritories'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTerritories]","fix":{"range":[1142,1144],"text":"[fetchTerritories]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1801,1804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1801,1804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2616,2619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2616,2619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3055,3058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3055,3058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Plus, Edit, Trash2, MapPin } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\n\nexport function TerritoryManagement() {\n  const { supabase, context } = useCRM();\n  const [territories, setTerritories] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [selectedTerritory, setSelectedTerritory] = useState<any>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    is_active: true,\n  });\n\n  useEffect(() => {\n    fetchTerritories();\n  }, []);\n\n  useEffect(() => {\n    if (selectedTerritory) {\n      setFormData({\n        name: selectedTerritory.name,\n        description: selectedTerritory.description || '',\n        is_active: selectedTerritory.is_active,\n      });\n    } else {\n      setFormData({ name: '', description: '', is_active: true });\n    }\n  }, [selectedTerritory]);\n\n  const fetchTerritories = async () => {\n    try {\n      let query = supabase.from('territories').select('*');\n      if (context.tenantId) query = query.eq('tenant_id', context.tenantId);\n\n      const { data, error } = await query;\n      if (error) throw error;\n      setTerritories(data || []);\n    } catch (error: any) {\n      toast.error('Failed to load territories');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      const payload = {\n        ...formData,\n        tenant_id: context.tenantId,\n      };\n\n      if (selectedTerritory) {\n        const { error } = await supabase\n          .from('territories')\n          .update(payload)\n          .eq('id', selectedTerritory.id);\n        if (error) throw error;\n      } else {\n        const { error } = await supabase.from('territories').insert(payload);\n        if (error) throw error;\n      }\n\n      toast.success(selectedTerritory ? 'Territory updated' : 'Territory created');\n      setDialogOpen(false);\n      setSelectedTerritory(null);\n      fetchTerritories();\n    } catch (error: any) {\n      toast.error('Failed to save territory');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Are you sure you want to delete this territory?')) return;\n\n    try {\n      const { error } = await supabase.from('territories').delete().eq('id', id);\n      if (error) throw error;\n      toast.success('Territory deleted');\n      fetchTerritories();\n    } catch (error: any) {\n      toast.error('Failed to delete territory');\n      console.error('Error:', error);\n    }\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-12\">Loading territories...</div>;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h3 className=\"text-lg font-medium\">Territories</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            Define geographic or business territories for lead assignment\n          </p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={() => setSelectedTerritory(null)}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New Territory\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {selectedTerritory ? 'Edit Territory' : 'Create Territory'}\n              </DialogTitle>\n              <DialogDescription>\n                Configure territory details and boundaries\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\">Territory Name</Label>\n                <Input\n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">Description</Label>\n                <Textarea\n                  id=\"description\"\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"is_active\">Active</Label>\n                <Switch\n                  id=\"is_active\"\n                  checked={formData.is_active}\n                  onCheckedChange={(checked) => setFormData({ ...formData, is_active: checked })}\n                />\n              </div>\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button onClick={handleSave}>Save</Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {territories.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground mb-4\">No territories configured</p>\n            <Button onClick={() => setDialogOpen(true)}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Create First Territory\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {territories.map((territory) => (\n            <Card key={territory.id}>\n              <CardContent className=\"pt-6\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <MapPin className=\"h-5 w-5 text-primary\" />\n                      <h4 className=\"font-semibold\">{territory.name}</h4>\n                    </div>\n                    <Badge variant={territory.is_active ? 'default' : 'secondary'}>\n                      {territory.is_active ? 'Active' : 'Inactive'}\n                    </Badge>\n                  </div>\n                  {territory.description && (\n                    <p className=\"text-sm text-muted-foreground\">{territory.description}</p>\n                  )}\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setSelectedTerritory(territory);\n                        setDialogOpen(true);\n                      }}\n                    >\n                      <Edit className=\"h-4 w-4 mr-1\" />\n                      Edit\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleDelete(territory.id)}\n                    >\n                      <Trash2 className=\"h-4 w-4 mr-1\" />\n                      Delete\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/assignment/UserCapacity.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1181,1184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1181,1184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCapacities'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCapacities]","fix":{"range":[1290,1292],"text":"[fetchCapacities]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2225,2228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2225,2228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2259,2262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2259,2262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2779,2782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2779,2782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3275,3278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3275,3278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Switch } from '@/components/ui/switch';\nimport { Users, Edit } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\n\ninterface UserCapacityData {\n  id: string;\n  user_id: string;\n  max_leads: number;\n  current_leads: number;\n  is_available: boolean;\n  profiles: {\n    first_name: string;\n    last_name: string;\n    email: string;\n  };\n}\n\nexport function UserCapacity() {\n  const { supabase, context } = useCRM();\n  const [capacities, setCapacities] = useState<UserCapacityData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [selectedCapacity, setSelectedCapacity] = useState<any>(null);\n  const [maxLeads, setMaxLeads] = useState(50);\n\n  useEffect(() => {\n    fetchCapacities();\n  }, []);\n\n  const fetchCapacities = async () => {\n    try {\n      let query = supabase\n        .from('user_capacity')\n        .select('*');\n\n      if (context.tenantId) query = query.eq('tenant_id', context.tenantId);\n\n      const { data: capacityData, error } = await query;\n      if (error) throw error;\n\n      // Fetch profiles separately\n      if (capacityData && capacityData.length > 0) {\n        const userIds = capacityData.map(c => c.user_id);\n        const { data: profilesData } = await supabase\n          .from('profiles')\n          .select('id, first_name, last_name, email')\n          .in('id', userIds);\n\n        const profilesMap = new Map(profilesData?.map(p => [p.id, p]));\n        \n        const enrichedData = capacityData.map(capacity => ({\n          ...capacity,\n          profiles: profilesMap.get(capacity.user_id) || { first_name: '', last_name: '', email: '' }\n        }));\n\n        setCapacities(enrichedData as any);\n      }\n    } catch (error: any) {\n      toast.error('Failed to load user capacities');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleToggleAvailability = async (capacityId: string, isAvailable: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('user_capacity')\n        .update({ is_available: !isAvailable })\n        .eq('id', capacityId);\n\n      if (error) throw error;\n      toast.success('Availability updated');\n      fetchCapacities();\n    } catch (error: any) {\n      toast.error('Failed to update availability');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleUpdateMaxLeads = async () => {\n    if (!selectedCapacity) return;\n\n    try {\n      const { error } = await supabase\n        .from('user_capacity')\n        .update({ max_leads: maxLeads })\n        .eq('id', selectedCapacity.id);\n\n      if (error) throw error;\n      toast.success('Capacity updated');\n      setDialogOpen(false);\n      fetchCapacities();\n    } catch (error: any) {\n      toast.error('Failed to update capacity');\n      console.error('Error:', error);\n    }\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-12\">Loading user capacities...</div>;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <h3 className=\"text-lg font-medium\">User Capacity</h3>\n        <p className=\"text-sm text-muted-foreground\">\n          Manage lead assignment capacity and availability for each user\n        </p>\n      </div>\n\n      {capacities.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground\">\n              No user capacities configured. Capacities are created automatically when users are assigned leads.\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {capacities.map((capacity) => {\n            const utilizationPercent = (capacity.current_leads / capacity.max_leads) * 100;\n            \n            return (\n              <Card key={capacity.id}>\n                <CardContent className=\"pt-6\">\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Users className=\"h-5 w-5 text-primary\" />\n                        <div>\n                          <h4 className=\"font-semibold\">\n                            {capacity.profiles.first_name} {capacity.profiles.last_name}\n                          </h4>\n                          <p className=\"text-xs text-muted-foreground\">{capacity.profiles.email}</p>\n                        </div>\n                      </div>\n                      <Badge variant={capacity.is_available ? 'default' : 'secondary'}>\n                        {capacity.is_available ? 'Available' : 'Unavailable'}\n                      </Badge>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-muted-foreground\">Lead Capacity</span>\n                        <span className=\"font-medium\">\n                          {capacity.current_leads} / {capacity.max_leads}\n                        </span>\n                      </div>\n                      <Progress value={utilizationPercent} />\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      <div className=\"flex items-center gap-2 flex-1\">\n                        <Label className=\"text-xs\">Available</Label>\n                        <Switch\n                          checked={capacity.is_available}\n                          onCheckedChange={() =>\n                            handleToggleAvailability(capacity.id, capacity.is_available)\n                          }\n                        />\n                      </div>\n                      <Dialog\n                        open={dialogOpen && selectedCapacity?.id === capacity.id}\n                        onOpenChange={(open) => {\n                          setDialogOpen(open);\n                          if (open) {\n                            setSelectedCapacity(capacity);\n                            setMaxLeads(capacity.max_leads);\n                          }\n                        }}\n                      >\n                        <DialogTrigger asChild>\n                          <Button variant=\"outline\" size=\"sm\">\n                            <Edit className=\"h-4 w-4 mr-1\" />\n                            Edit\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                          <DialogHeader>\n                            <DialogTitle>Update Capacity</DialogTitle>\n                            <DialogDescription>\n                              Set maximum lead capacity for {capacity.profiles.first_name}\n                            </DialogDescription>\n                          </DialogHeader>\n                          <div className=\"space-y-4\">\n                            <div className=\"space-y-2\">\n                              <Label htmlFor=\"max_leads\">Maximum Leads</Label>\n                              <Input\n                                id=\"max_leads\"\n                                type=\"number\"\n                                value={maxLeads}\n                                onChange={(e) => setMaxLeads(parseInt(e.target.value))}\n                              />\n                            </div>\n                            <div className=\"flex gap-2 justify-end\">\n                              <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>\n                                Cancel\n                              </Button>\n                              <Button onClick={handleUpdateMaxLeads}>Save</Button>\n                            </div>\n                          </div>\n                        </DialogContent>\n                      </Dialog>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/auth/ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/auth/RoleGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/branding/Logo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/branding/ShieldLogo.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1681,1684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1681,1684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Truck } from 'lucide-react';\n\ntype ShieldLogoProps = {\n  showWordmark?: boolean;\n  size?: number; // pixel size of the mark square\n  className?: string;\n  wordmarkClassName?: string;\n  // Controls stroke style and background tile\n  variant?: 'golden' | 'golden-subtle' | 'monochrome';\n  tile?: 'navy' | 'primary' | 'none';\n  hoverGlow?: boolean;\n  glowStrength?: 'subtle' | 'strong';\n};\n\n// Shield badge logo: navy tile with golden shield boundary and truck icon.\n// Uses CSS variables for brand gold tones to match provided screenshot.\nconst ShieldLogo: React.FC<ShieldLogoProps> = ({ showWordmark = false, size = 40, className, wordmarkClassName, variant = 'golden', tile = 'navy', hoverGlow = true, glowStrength = 'subtle' }) => {\n  const svgSize = Math.round(size * 0.78);\n  const truckSize = Math.round(size * 0.46);\n  const isMono = variant === 'monochrome';\n  const strokeWidth = variant === 'golden-subtle' ? 2 : 3;\n  const glowColorVar = isMono ? 'var(--foreground)' : 'var(--brand-gold)';\n  const bgImage = tile === 'navy' ? 'var(--gradient-hero)' : tile === 'primary' ? 'var(--gradient-primary)' : 'none';\n\n  return (\n    <div className={`flex items-center gap-2 ${className || ''}`}>\n      <div\n        aria-label=\"SOS Logistic Pro Shield Logo\"\n        role=\"img\"\n        className=\"shield-logo group relative rounded-lg shadow-sm flex items-center justify-center border border-border\"\n        style={{\n          width: size,\n          height: size,\n          backgroundImage: bgImage,\n          boxShadow: '0 6px 14px hsl(222 47% 11% / 0.35)',\n          // Pass glow color to CSS animation via variable\n          ['--glow-color' as any]: glowColorVar,\n        }}\n      >\n        {/* Golden shield boundary */}\n        <svg\n          width={svgSize}\n          height={svgSize}\n          viewBox=\"0 0 64 64\"\n          fill=\"none\"\n          className=\"absolute\"\n          style={{ left: '50%', top: '50%', transform: 'translate(-50%, -50%)' }}\n        >\n          {!isMono && (\n            <defs>\n              <linearGradient id=\"goldStroke\" x1=\"0\" y1=\"0\" x2=\"64\" y2=\"64\" gradientUnits=\"userSpaceOnUse\">\n                <stop offset=\"0%\" stopColor=\"hsl(var(--brand-gold-light))\" />\n                <stop offset=\"40%\" stopColor=\"hsl(var(--brand-gold))\" />\n                <stop offset=\"100%\" stopColor=\"hsl(var(--brand-gold-dark))\" />\n              </linearGradient>\n            </defs>\n          )}\n          {/* Shield path */}\n          <path\n            d=\"M32 6 L52 16 V28 C52 44 42 52 32 58 C22 52 12 44 12 28 V16 Z\"\n            stroke={isMono ? 'hsl(var(--foreground))' : 'url(#goldStroke)'}\n            strokeWidth={strokeWidth}\n            strokeLinejoin=\"round\"\n            strokeLinecap=\"round\"\n            fill=\"none\"\n            className={hoverGlow ? (glowStrength === 'strong' ? 'glow-stroke--strong' : 'glow-stroke--subtle') : ''}\n            style={{ filter: isMono ? undefined : 'drop-shadow(0 2px 2px hsl(var(--brand-gold-dark) / 0.4))' }}\n          />\n        </svg>\n\n        {/* Truck glyph inside the shield */}\n        <Truck\n          style={{\n            width: truckSize,\n            height: truckSize,\n            color: isMono ? 'hsl(var(--foreground))' : 'hsl(var(--brand-gold))',\n            filter: isMono ? undefined : 'drop-shadow(0 1px 1px hsl(var(--brand-gold-dark) / 0.6))',\n            left: '50%',\n            top: '50%',\n            transform: 'translate(-50%, -45%)',\n            position: 'absolute',\n          }}\n        />\n      </div>\n\n      {showWordmark && (\n        <div className={wordmarkClassName || 'leading-tight'}>\n          <div className=\"font-semibold text-card-foreground\">SOS Logistic Pro</div>\n          <div className=\"text-xs text-muted-foreground\">Enterprise</div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ShieldLogo;","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/AccountForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1998,2001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1998,2001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2057,2060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2057,2060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2124,2127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2124,2127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadFranchises', 'loadParentAccounts', and 'loadTenants'. Either include them or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [context, loadFranchises, loadParentAccounts, loadTenants]","fix":{"range":[3268,3277],"text":"[context, loadFranchises, loadParentAccounts, loadTenants]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { Loader2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\n\nconst accountSchema = z.object({\n  name: z.string().min(1, 'Account name is required').max(200, 'Name too long'),\n  account_type: z.enum(['prospect', 'customer', 'partner', 'vendor']),\n  status: z.enum(['active', 'inactive', 'pending']),\n  industry: z.string().optional(),\n  website: z.string().url('Invalid URL').optional().or(z.literal('')),\n  phone: z.string().optional(),\n  email: z.string().email('Invalid email').optional().or(z.literal('')),\n  annual_revenue: z.string().optional(),\n  employee_count: z.string().optional(),\n  description: z.string().optional(),\n  tenant_id: z.string().optional(),\n  franchise_id: z.string().optional(),\n  parent_account_id: z.string().optional(),\n});\n\ntype AccountFormData = z.infer<typeof accountSchema>;\n\ninterface AccountFormProps {\n  initialData?: Partial<AccountFormData> & { id?: string };\n  onSubmit: (data: AccountFormData) => Promise<void>;\n  onCancel: () => void;\n}\n\nexport function AccountForm({ initialData, onSubmit, onCancel }: AccountFormProps) {\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingData, setPendingData] = useState<AccountFormData | null>(null);\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [franchises, setFranchises] = useState<any[]>([]);\n  const [parentAccounts, setParentAccounts] = useState<any[]>([]);\n  const { supabase, context } = useCRM();\n  \n  const form = useForm<AccountFormData>({\n    resolver: zodResolver(accountSchema),\n    defaultValues: {\n      name: initialData?.name || '',\n      account_type: initialData?.account_type || 'prospect',\n      status: initialData?.status || 'active',\n      industry: initialData?.industry || '',\n      website: initialData?.website ?? '',\n      phone: initialData?.phone ?? '',\n      email: initialData?.email ?? '',\n      annual_revenue: initialData?.annual_revenue != null ? String(initialData?.annual_revenue) : '',\n      employee_count: initialData?.employee_count != null ? String(initialData?.employee_count) : '',\n      description: initialData?.description || '',\n      tenant_id: initialData?.tenant_id ?? undefined,\n      franchise_id: initialData?.franchise_id ?? undefined,\n      parent_account_id: initialData?.parent_account_id ?? 'none',\n    },\n  });\n\n  const { isSubmitting } = form.formState;\n\n  useEffect(() => {\n    if (context.isPlatformAdmin) {\n      loadTenants();\n    } else if (context.isTenantAdmin) {\n      loadFranchises();\n    }\n    loadParentAccounts();\n  }, [context]);\n\n  const loadTenants = async () => {\n    const { data } = await supabase\n      .from('tenants')\n      .select('id, name')\n      .eq('is_active', true)\n      .order('name');\n    \n    if (data) setTenants(data);\n  };\n\n  const loadFranchises = async () => {\n    if (!context.tenantId) return;\n    \n    const { data } = await supabase\n      .from('franchises')\n      .select('id, name')\n      .eq('tenant_id', context.tenantId)\n      .eq('is_active', true)\n      .order('name');\n    \n    if (data) setFranchises(data);\n  };\n\n  const loadParentAccounts = async () => {\n    let query = supabase\n      .from('accounts')\n      .select('id, name')\n      .eq('status', 'active')\n      .order('name');\n\n    // Filter by tenant/franchise based on user role\n    if (context.franchiseId) {\n      query = query.eq('franchise_id', context.franchiseId);\n    } else if (context.tenantId) {\n      query = query.eq('tenant_id', context.tenantId);\n    }\n\n    // Exclude current account when editing\n    if (initialData?.id) {\n      query = query.neq('id', initialData.id);\n    }\n\n    const { data } = await query;\n    if (data) setParentAccounts(data);\n  };\n\n  const handleFormSubmit = (data: AccountFormData) => {\n    setPendingData(data);\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirm = async () => {\n    if (pendingData) {\n      setShowConfirmDialog(false);\n      await onSubmit(pendingData);\n      setPendingData(null);\n    }\n  };\n\n  return (\n    <>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleFormSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"name\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Account Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Acme Corporation\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"account_type\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Type *</FormLabel>\n                <Select onValueChange={field.onChange} value={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select type\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"prospect\">Prospect</SelectItem>\n                    <SelectItem value=\"customer\">Customer</SelectItem>\n                    <SelectItem value=\"partner\">Partner</SelectItem>\n                    <SelectItem value=\"vendor\">Vendor</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"status\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Status *</FormLabel>\n                <Select onValueChange={field.onChange} value={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select status\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"active\">Active</SelectItem>\n                    <SelectItem value=\"inactive\">Inactive</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {context.isPlatformAdmin && (\n            <FormField\n              control={form.control}\n              name=\"tenant_id\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Tenant *</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select tenant\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {tenants.map((tenant) => (\n                        <SelectItem key={tenant.id} value={tenant.id}>\n                          {tenant.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n\n          {(context.isPlatformAdmin || context.isTenantAdmin) && franchises.length > 0 && (\n            <FormField\n              control={form.control}\n              name=\"franchise_id\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Franchise (Optional)</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select franchise\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {franchises.map((franchise) => (\n                        <SelectItem key={franchise.id} value={franchise.id}>\n                          {franchise.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n\n          <FormField\n            control={form.control}\n            name=\"parent_account_id\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Parent Account (Optional)</FormLabel>\n                <Select onValueChange={field.onChange} value={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"None (Top-level account)\" />\n                    </SelectTrigger>\n                  </FormControl>\n                <SelectContent>\n                    <SelectItem value=\"none\">None (Top-level account)</SelectItem>\n                    {parentAccounts.map((account) => (\n                      <SelectItem key={account.id} value={account.id}>\n                        {account.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"industry\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Industry</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Technology\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"website\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Website</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"https://example.com\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"phone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Phone</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"+1 (555) 123-4567\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Email</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"contact@example.com\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"annual_revenue\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Annual Revenue</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"1000000\" type=\"number\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"employee_count\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Employee Count</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"50\" type=\"number\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"description\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Description</FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Additional notes about this account...\"\n                    className=\"min-h-[100px]\"\n                    {...field}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"flex justify-end gap-3\">\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel} disabled={isSubmitting}>\n            Cancel\n          </Button>\n          <Button type=\"submit\" disabled={isSubmitting}>\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            {initialData?.id ? 'Update Account' : 'Create Account'}\n          </Button>\n        </div>\n        </form>\n      </Form>\n\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Confirm {initialData?.id ? 'Update' : 'Create'}</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to {initialData?.id ? 'update' : 'create'} this account?\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirm}>Confirm</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/AccountSelectDialogList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[672,675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[672,675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[925,928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[925,928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1430,1433],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1430,1433],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1647,1650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1647,1650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Table, TableBody, TableCell, TableHeader, TableRow } from '@/components/ui/table';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype AccountSelectDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelect: (account: any) => void;\n};\n\nexport default function AccountSelectDialogList({ open, onOpenChange, onSelect }: AccountSelectDialogProps) {\n  const { supabase } = useCRM();\n  const [loading, setLoading] = useState(false);\n  const [accounts, setAccounts] = useState<any[]>([]);\n\n  const [nameQuery, setNameQuery] = useState('');\n  const [emailQuery, setEmailQuery] = useState('');\n  const [phoneQuery, setPhoneQuery] = useState('');\n  const [industryQuery, setIndustryQuery] = useState('');\n  const [statusAdv, setStatusAdv] = useState<string>('any');\n  const [sort, setSort] = useState<string>('name_asc');\n\n  useEffect(() => {\n    if (!open) return;\n    const fetch = async () => {\n      setLoading(true);\n      try {\n        const { data, error } = await (supabase as any)\n          .from('accounts')\n          .select('*')\n          .order('created_at', { ascending: false })\n          .limit(200);\n        if (error) throw error;\n        setAccounts(data || []);\n      } catch (err: any) {\n        console.error('Load accounts failed:', err);\n        toast.error('Failed to load accounts');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetch();\n  }, [open, supabase]);\n\n  const filtered = useMemo(() => {\n    const res = accounts.filter((a) => {\n      const nameOk = nameQuery ? (a.name || '').toLowerCase().includes(nameQuery.toLowerCase()) : true;\n      const emailOk = emailQuery ? (a.email || '').toLowerCase().includes(emailQuery.toLowerCase()) : true;\n      const phoneOk = phoneQuery ? (a.phone || '').toLowerCase().includes(phoneQuery.toLowerCase()) : true;\n      const industryOk = industryQuery ? (a.industry || '').toLowerCase().includes(industryQuery.toLowerCase()) : true;\n      const statusOk = statusAdv && statusAdv !== 'any' ? a.status === statusAdv : true;\n      return nameOk && emailOk && phoneOk && industryOk && statusOk;\n    });\n    res.sort((a, b) => {\n      const dir = sort.endsWith('_desc') ? -1 : 1;\n      if (sort.startsWith('name')) return ((a.name || '').localeCompare(b.name || '')) * dir;\n      if (sort.startsWith('created')) return ((new Date(a.created_at).getTime() || 0) - (new Date(b.created_at).getTime() || 0)) * dir;\n      return 0;\n    });\n    return res;\n  }, [accounts, nameQuery, emailQuery, phoneQuery, industryQuery, statusAdv, sort]);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl\">\n        <DialogHeader>\n          <DialogTitle>Select Account</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-3\">\n          <div className=\"grid gap-3 md:grid-cols-3 lg:grid-cols-4\">\n            <div className=\"space-y-2\">\n              <Label>Name</Label>\n              <Input placeholder=\"Account name\" value={nameQuery} onChange={(e) => setNameQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Email</Label>\n              <Input placeholder=\"Email\" value={emailQuery} onChange={(e) => setEmailQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Phone</Label>\n              <Input placeholder=\"Phone\" value={phoneQuery} onChange={(e) => setPhoneQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Industry</Label>\n              <Input placeholder=\"Industry\" value={industryQuery} onChange={(e) => setIndustryQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Status</Label>\n              <Select value={statusAdv} onValueChange={setStatusAdv}>\n                <SelectTrigger><SelectValue placeholder=\"Any\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"any\">Any</SelectItem>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Sort</Label>\n              <Select value={sort} onValueChange={setSort}>\n                <SelectTrigger><SelectValue placeholder=\"Sort\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"name_asc\">Name AZ</SelectItem>\n                  <SelectItem value=\"name_desc\">Name ZA</SelectItem>\n                  <SelectItem value=\"created_desc\">Newest first</SelectItem>\n                  <SelectItem value=\"created_asc\">Oldest first</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {loading ? (\n            <div className=\"text-center text-muted-foreground py-8\">Loading accounts</div>\n          ) : filtered.length === 0 ? (\n            <div className=\"text-center text-muted-foreground py-8\">No accounts found</div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableCell className=\"font-medium\">Name</TableCell>\n                    <TableCell className=\"font-medium\">Email</TableCell>\n                    <TableCell className=\"font-medium\">Phone</TableCell>\n                    <TableCell className=\"font-medium\">Action</TableCell>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filtered.map((a) => (\n                    <TableRow key={a.id} className=\"hover:bg-muted/50\">\n                      <TableCell className=\"font-medium\">{a.name}</TableCell>\n                      <TableCell>{a.email || '-'}</TableCell>\n                      <TableCell>{a.phone || '-'}</TableCell>\n                      <TableCell>\n                        <Button size=\"sm\" onClick={() => { onSelect(a); onOpenChange(false); }}>Select</Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/ActivityComposer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2211,2214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2211,2214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2266,2269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2266,2269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2315,2318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2315,2318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4646,4649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4646,4649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5921,5924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5921,5924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":287,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10664,10667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10664,10667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":413,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":413,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15293,15296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15293,15296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAssignableUsers, AssignableUser } from '@/hooks/useAssignableUsers';\nimport { toast } from 'sonner';\nimport { Loader2, AlertCircle } from 'lucide-react';\n\ntype RelatedContext = {\n  account_id?: string | null;\n  contact_id?: string | null;\n  lead_id?: string | null;\n};\n\ninterface ActivityComposerProps {\n  defaultTab?: 'task' | 'event' | 'call' | 'email' | 'note';\n  related?: RelatedContext;\n  onCreated?: (id: string) => void;\n}\n\nconst baseSchema = z.object({\n  subject: z.string().min(1, 'Subject is required').max(200),\n  description: z.string().optional(),\n  due_date: z.string().optional(),\n  account_id: z.string().optional(),\n  contact_id: z.string().optional(),\n  lead_id: z.string().optional(),\n});\n\nconst callSchema = baseSchema.extend({\n  create_follow_up: z.boolean().optional(),\n  follow_up_due_date: z.string().optional(),\n});\n\nconst emailSchema = baseSchema.extend({\n  email_body: z.string().optional(),\n});\n\nexport function ActivityComposer({ defaultTab = 'task', related, onCreated }: ActivityComposerProps) {\n  const { supabase, context } = useCRM();\n  const { fetchAssignableUsers, formatLabel } = useAssignableUsers();\n  const [assignedTo, setAssignedTo] = useState<string | null>(context?.userId ?? null);\n  const [assignableUsers, setAssignableUsers] = useState<AssignableUser[]>([]);\n  const [assignSearch, setAssignSearch] = useState<string>('');\n  const [accounts, setAccounts] = useState<any[]>([]);\n  const [contacts, setContacts] = useState<any[]>([]);\n  const [leads, setLeads] = useState<any[]>([]);\n  const [activeTab, setActiveTab] = useState(defaultTab);\n  const [showHelp, setShowHelp] = useState(false);\n\n  const commonDefaults = useMemo(\n    () => ({\n      subject: '',\n      description: '',\n      due_date: '',\n      account_id: related?.account_id || '',\n      contact_id: related?.contact_id || '',\n      lead_id: related?.lead_id || '',\n    }),\n    [related]\n  );\n\n  const taskForm = useForm<z.infer<typeof baseSchema>>({\n    resolver: zodResolver(baseSchema),\n    defaultValues: commonDefaults,\n  });\n  const eventForm = useForm<z.infer<typeof baseSchema>>({\n    resolver: zodResolver(baseSchema),\n    defaultValues: commonDefaults,\n  });\n  const callForm = useForm<z.infer<typeof callSchema>>({\n    resolver: zodResolver(callSchema),\n    defaultValues: { ...commonDefaults, create_follow_up: false, follow_up_due_date: '' },\n  });\n  const emailForm = useForm<z.infer<typeof emailSchema>>({\n    resolver: zodResolver(emailSchema),\n    defaultValues: { ...commonDefaults, email_body: '' },\n  });\n  const noteForm = useForm<z.infer<typeof baseSchema>>({\n    resolver: zodResolver(baseSchema),\n    defaultValues: commonDefaults,\n  });\n  useEffect(() => {\n    let active = true;\n    (async () => {\n      const { data } = await fetchAssignableUsers({ search: assignSearch, limit: 25 });\n      if (active) setAssignableUsers((data ?? []) as AssignableUser[]);\n    })();\n    return () => {\n      active = false;\n    };\n  }, [fetchAssignableUsers, assignSearch]);\n\n  useEffect(() => {\n    const tipKey = 'activityComposerHelpShown';\n    const hasSeen = typeof window !== 'undefined' ? localStorage.getItem(tipKey) : '1';\n    if (!hasSeen) setShowHelp(true);\n  }, []);\n\n  useEffect(() => {\n    const fetchRelated = async () => {\n      const [accountsRes, contactsRes, leadsRes] = await Promise.all([\n        supabase.from('accounts').select('id, name').order('name'),\n        supabase.from('contacts').select('id, first_name, last_name').order('first_name'),\n        supabase.from('leads').select('id, first_name, last_name').order('first_name'),\n      ]);\n      if (accountsRes.data) setAccounts(accountsRes.data);\n      if (contactsRes.data) setContacts(contactsRes.data);\n      if (leadsRes.data) setLeads(leadsRes.data);\n    };\n    fetchRelated();\n  }, [supabase]);\n\n  const getTenantAndFranchise = async (data: any) => {\n    let tenantId = context.tenantId;\n    let franchiseId = context.franchiseId;\n\n    if (!tenantId) {\n      if (data.lead_id && data.lead_id !== 'none') {\n        const { data: lead } = await supabase\n          .from('leads')\n          .select('tenant_id, franchise_id')\n          .eq('id', data.lead_id)\n          .single();\n        if (lead) {\n          tenantId = lead.tenant_id;\n          franchiseId = lead.franchise_id;\n        }\n      } else if (data.account_id && data.account_id !== 'none') {\n        const { data: account } = await supabase\n          .from('accounts')\n          .select('tenant_id, franchise_id')\n          .eq('id', data.account_id)\n          .single();\n        if (account) {\n          tenantId = account.tenant_id;\n          franchiseId = account.franchise_id;\n        }\n      } else if (data.contact_id && data.contact_id !== 'none') {\n        const { data: contact } = await supabase\n          .from('contacts')\n          .select('tenant_id, franchise_id')\n          .eq('id', data.contact_id)\n          .single();\n        if (contact) {\n          tenantId = contact.tenant_id;\n          franchiseId = contact.franchise_id;\n        }\n      }\n    }\n    return { tenantId, franchiseId };\n  };\n\n  const insertActivity = async (payload: any) => {\n    const { data, error } = await supabase\n      .from('activities')\n      .insert(payload)\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  };\n\n  const onCreateTask = async (values: z.infer<typeof baseSchema>) => {\n    const { tenantId, franchiseId } = await getTenantAndFranchise(values);\n    if (!tenantId) {\n      toast.error('Please select a related lead, account, or contact');\n      return;\n    }\n    const created = await insertActivity({\n      activity_type: 'task',\n      status: 'planned',\n      priority: 'medium',\n      subject: values.subject,\n      description: values.description || null,\n      due_date: values.due_date || null,\n      tenant_id: tenantId,\n      franchise_id: franchiseId,\n      account_id: values.account_id === 'none' ? null : (values.account_id || null),\n      contact_id: values.contact_id === 'none' ? null : (values.contact_id || null),\n      lead_id: values.lead_id === 'none' ? null : (values.lead_id || null),\n      assigned_to: assignedTo ?? context.userId ?? null,\n    });\n    toast.success('Task created');\n    onCreated?.(created.id);\n  };\n\n  const onCreateEvent = async (values: z.infer<typeof baseSchema>) => {\n    const { tenantId, franchiseId } = await getTenantAndFranchise(values);\n    if (!tenantId) {\n      toast.error('Please select a related lead, account, or contact');\n      return;\n    }\n    const created = await insertActivity({\n      activity_type: 'meeting',\n      status: 'planned',\n      priority: 'medium',\n      subject: values.subject,\n      description: values.description || null,\n      due_date: values.due_date || null,\n      tenant_id: tenantId,\n      franchise_id: franchiseId,\n      account_id: values.account_id === 'none' ? null : (values.account_id || null),\n      contact_id: values.contact_id === 'none' ? null : (values.contact_id || null),\n      lead_id: values.lead_id === 'none' ? null : (values.lead_id || null),\n      assigned_to: assignedTo ?? context.userId ?? null,\n    });\n    toast.success('Event created');\n    onCreated?.(created.id);\n  };\n\n  const onLogCall = async (values: z.infer<typeof callSchema>) => {\n    const { tenantId, franchiseId } = await getTenantAndFranchise(values);\n    if (!tenantId) {\n      toast.error('Please select a related lead, account, or contact');\n      return;\n    }\n    const call = await insertActivity({\n      activity_type: 'call',\n      status: 'planned',\n      priority: 'medium',\n      subject: values.subject,\n      description: values.description || null,\n      due_date: null,\n      completed_at: null,\n      tenant_id: tenantId,\n      franchise_id: franchiseId,\n      account_id: values.account_id === 'none' ? null : (values.account_id || null),\n      contact_id: values.contact_id === 'none' ? null : (values.contact_id || null),\n      lead_id: values.lead_id === 'none' ? null : (values.lead_id || null),\n      assigned_to: assignedTo ?? context.userId ?? null,\n    });\n    if (values.create_follow_up && values.follow_up_due_date) {\n      await insertActivity({\n        activity_type: 'task',\n        status: 'planned',\n        priority: 'medium',\n        subject: `Follow-up: ${values.subject}`,\n        description: values.description || null,\n        due_date: values.follow_up_due_date,\n        tenant_id: tenantId,\n        franchise_id: franchiseId,\n        account_id: values.account_id === 'none' ? null : (values.account_id || null),\n        contact_id: values.contact_id === 'none' ? null : (values.contact_id || null),\n        lead_id: values.lead_id === 'none' ? null : (values.lead_id || null),\n        assigned_to: assignedTo ?? context.userId ?? null,\n      });\n    }\n    toast.success('Call logged');\n    onCreated?.(call.id);\n  };\n\n  const onLogEmail = async (values: z.infer<typeof emailSchema>) => {\n    const { tenantId, franchiseId } = await getTenantAndFranchise(values);\n    if (!tenantId) {\n      toast.error('Please select a related lead, account, or contact');\n      return;\n    }\n    const created = await insertActivity({\n      activity_type: 'email',\n      status: 'planned',\n      priority: 'medium',\n      subject: values.subject,\n      description: values.email_body || values.description || null,\n      due_date: null,\n      completed_at: null,\n      tenant_id: tenantId,\n      franchise_id: franchiseId,\n      account_id: values.account_id === 'none' ? null : (values.account_id || null),\n      contact_id: values.contact_id === 'none' ? null : (values.contact_id || null),\n      lead_id: values.lead_id === 'none' ? null : (values.lead_id || null),\n      assigned_to: assignedTo ?? context.userId ?? null,\n    });\n    toast.success('Email logged');\n    onCreated?.(created.id);\n  };\n\n  const RelatedSelectors = ({ form }: { form: any }) => (\n    <div className=\"grid grid-cols-3 gap-4\">\n      <FormField\n        control={form.control}\n        name=\"account_id\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Related Account</FormLabel>\n            <Select onValueChange={field.onChange} defaultValue={field.value || undefined}>\n              <FormControl>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select account\" />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"none\">None</SelectItem>\n                {accounts.map((a) => (\n                  <SelectItem key={a.id} value={a.id}>{a.name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"contact_id\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Related Contact</FormLabel>\n            <Select onValueChange={field.onChange} defaultValue={field.value || undefined}>\n              <FormControl>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select contact\" />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"none\">None</SelectItem>\n                {contacts.map((c) => (\n                  <SelectItem key={c.id} value={c.id}>{c.first_name} {c.last_name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"lead_id\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Related Lead</FormLabel>\n            <Select onValueChange={field.onChange} defaultValue={field.value || undefined}>\n              <FormControl>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select lead\" />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"none\">None</SelectItem>\n                {leads.map((l) => (\n                  <SelectItem key={l.id} value={l.id}>{l.first_name} {l.last_name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n    </div>\n  );\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Activity Composer</CardTitle>\n      </CardHeader>\n      <CardContent>\n        {showHelp && (\n          <div className=\"mb-4 rounded-md border p-3 bg-muted/30 flex items-start gap-3\">\n            <AlertCircle className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n            <div className=\"flex-1\">\n              <div className=\"text-sm font-medium\">Tip: Assign activity owners</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Use the <span className=\"font-medium\">Assign To</span> field to select the owner. Platform admins can search globally; other roles see scoped users.\n              </div>\n            </div>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => {\n                localStorage.setItem('activityComposerHelpShown', '1');\n                setShowHelp(false);\n              }}\n            >\n              Got it\n            </Button>\n          </div>\n        )}\n        <div className=\"grid grid-cols-2 gap-4 mb-4\">\n          <div>\n            <Label>Assign To</Label>\n            <div className=\"flex gap-2 mt-2\">\n              <Input\n                placeholder={context?.isPlatformAdmin ? 'Search all users' : 'Search users'}\n                value={assignSearch}\n                onChange={(e) => setAssignSearch(e.target.value)}\n              />\n              <Select onValueChange={(v) => setAssignedTo(v === 'none' ? null : v)} defaultValue={assignedTo ?? 'none'}>\n                <SelectTrigger className=\"w-[280px]\">\n                  <SelectValue placeholder=\"Select user\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"none\">Unassigned</SelectItem>\n                  {assignableUsers.map((u) => (\n                    <SelectItem key={u.id} value={u.id}>{formatLabel(u)}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n        <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as any)}>\n          <TabsList className=\"grid grid-cols-5 w-full\">\n            <TabsTrigger value=\"email\">Email</TabsTrigger>\n            <TabsTrigger value=\"call\">Log a Call</TabsTrigger>\n            <TabsTrigger value=\"task\">New Task</TabsTrigger>\n            <TabsTrigger value=\"event\">New Event</TabsTrigger>\n            <TabsTrigger value=\"note\">Note</TabsTrigger>\n          </TabsList>\n\n          {/* Email */}\n          <TabsContent value=\"email\" className=\"pt-4\">\n            <Form {...emailForm}>\n              <form onSubmit={emailForm.handleSubmit(onLogEmail)} className=\"space-y-4\">\n                <FormField\n                  control={emailForm.control}\n                  name=\"subject\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Subject *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Subject\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={emailForm.control}\n                  name=\"email_body\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Body</FormLabel>\n                      <FormControl>\n                        <Textarea rows={6} placeholder=\"Write email...\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <RelatedSelectors form={emailForm} />\n\n                <div className=\"flex justify-end\">\n                  <Button type=\"submit\">\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin hidden\" />\n                    Log Email\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </TabsContent>\n\n          {/* Call */}\n          <TabsContent value=\"call\" className=\"pt-4\">\n            <Form {...callForm}>\n              <form onSubmit={callForm.handleSubmit(onLogCall)} className=\"space-y-4\">\n                <FormField\n                  control={callForm.control}\n                  name=\"subject\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Subject *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Spoke with customer\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={callForm.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes</FormLabel>\n                      <FormControl>\n                        <Textarea rows={4} placeholder=\"Call notes...\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <RelatedSelectors form={callForm} />\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={callForm.control}\n                    name=\"create_follow_up\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Create Follow-up Task</FormLabel>\n                        <FormControl>\n                          <Select onValueChange={(v) => field.onChange(v === 'true')} defaultValue={field.value ? 'true' : 'false'}>\n                            <SelectTrigger>\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"false\">No</SelectItem>\n                              <SelectItem value=\"true\">Yes</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={callForm.control}\n                    name=\"follow_up_due_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Follow-up Due</FormLabel>\n                        <FormControl>\n                          <Input type=\"datetime-local\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"flex justify-end\">\n                  <Button type=\"submit\">Log Call</Button>\n                </div>\n              </form>\n            </Form>\n          </TabsContent>\n\n          {/* Task */}\n          <TabsContent value=\"task\" className=\"pt-4\">\n            <Form {...taskForm}>\n              <form onSubmit={taskForm.handleSubmit(onCreateTask)} className=\"space-y-4\">\n                <FormField\n                  control={taskForm.control}\n                  name=\"subject\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Subject *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Follow up with client\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={taskForm.control}\n                    name=\"due_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Due Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"datetime-local\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={taskForm.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Description</FormLabel>\n                        <FormControl>\n                          <Textarea rows={4} placeholder=\"Task details...\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <RelatedSelectors form={taskForm} />\n                <div className=\"flex justify-end\">\n                  <Button type=\"submit\">Create Task</Button>\n                </div>\n              </form>\n            </Form>\n          </TabsContent>\n\n          {/* Event */}\n          <TabsContent value=\"event\" className=\"pt-4\">\n            <Form {...eventForm}>\n              <form onSubmit={eventForm.handleSubmit(onCreateEvent)} className=\"space-y-4\">\n                <FormField\n                  control={eventForm.control}\n                  name=\"subject\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Subject *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Discovery meeting\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={eventForm.control}\n                    name=\"due_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Start</FormLabel>\n                        <FormControl>\n                          <Input type=\"datetime-local\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={eventForm.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Agenda</FormLabel>\n                        <FormControl>\n                          <Textarea rows={4} placeholder=\"Agenda...\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <RelatedSelectors form={eventForm} />\n                <div className=\"flex justify-end\">\n                  <Button type=\"submit\">Create Event</Button>\n                </div>\n              </form>\n            </Form>\n          </TabsContent>\n\n          {/* Note */}\n          <TabsContent value=\"note\" className=\"pt-4\">\n            <Form {...noteForm}>\n              <form\n                onSubmit={noteForm.handleSubmit(async (values) => {\n                  const { tenantId, franchiseId } = await getTenantAndFranchise(values);\n                  if (!tenantId) {\n                    toast.error('Please select a related lead, account, or contact');\n                    return;\n                  }\n                  const created = await insertActivity({\n                    activity_type: 'note',\n                    status: 'planned',\n                    priority: 'low',\n                    subject: values.subject,\n                    description: values.description || null,\n                    due_date: null,\n                    completed_at: null,\n                    tenant_id: tenantId,\n                    franchise_id: franchiseId,\n                    account_id: values.account_id === 'none' ? null : (values.account_id || null),\n                    contact_id: values.contact_id === 'none' ? null : (values.contact_id || null),\n                    lead_id: values.lead_id === 'none' ? null : (values.lead_id || null),\n                    assigned_to: assignedTo ?? context.userId ?? null,\n                  });\n                  toast.success('Note added');\n                  onCreated?.(created.id);\n                })}\n                className=\"space-y-4\"\n              >\n                <FormField\n                  control={noteForm.control}\n                  name=\"subject\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Title *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Note title\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={noteForm.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Note</FormLabel>\n                      <FormControl>\n                        <Textarea rows={6} placeholder=\"Write a note...\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <RelatedSelectors form={noteForm} />\n                <div className=\"flex justify-end\">\n                  <Button type=\"submit\">Add Note</Button>\n                </div>\n              </form>\n            </Form>\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/ActivityForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1680,1683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1680,1683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1735,1738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1735,1738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1784,1787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1784,1787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRelatedData'. Either include it or remove the dependency array.","line":59,"column":6,"nodeType":"ArrayExpression","endLine":59,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRelatedData]","fix":{"range":[2555,2557],"text":"[fetchRelatedData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { Loader2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\n\nconst activitySchema = z.object({\n  activity_type: z.enum(['call', 'email', 'meeting', 'task', 'note']),\n  status: z.enum(['planned', 'in_progress', 'completed', 'cancelled']),\n  priority: z.enum(['low', 'medium', 'high', 'urgent']),\n  subject: z.string().min(1, 'Subject is required').max(200),\n  description: z.string().optional(),\n  due_date: z.string().optional(),\n  account_id: z.string().optional(),\n  contact_id: z.string().optional(),\n  lead_id: z.string().optional(),\n});\n\ntype ActivityFormData = z.infer<typeof activitySchema>;\n\ninterface ActivityFormProps {\n  initialData?: Partial<ActivityFormData> & { id?: string };\n  onSubmit: (data: ActivityFormData) => Promise<void>;\n  onCancel: () => void;\n}\n\nexport function ActivityForm({ initialData, onSubmit, onCancel }: ActivityFormProps) {\n  const { supabase } = useCRM();\n  const [accounts, setAccounts] = useState<any[]>([]);\n  const [contacts, setContacts] = useState<any[]>([]);\n  const [leads, setLeads] = useState<any[]>([]);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingData, setPendingData] = useState<ActivityFormData | null>(null);\n\n  const form = useForm<ActivityFormData>({\n    resolver: zodResolver(activitySchema),\n    defaultValues: {\n      activity_type: initialData?.activity_type || 'task',\n      status: initialData?.status || 'planned',\n      priority: initialData?.priority || 'medium',\n      subject: initialData?.subject || '',\n      description: initialData?.description || '',\n      due_date: initialData?.due_date || '',\n      account_id: initialData?.account_id || '',\n      contact_id: initialData?.contact_id || '',\n      lead_id: initialData?.lead_id || '',\n    },\n  });\n\n  useEffect(() => {\n    fetchRelatedData();\n  }, []);\n\n  const fetchRelatedData = async () => {\n    const [accountsRes, contactsRes, leadsRes] = await Promise.all([\n      supabase.from('accounts').select('id, name').order('name'),\n      supabase.from('contacts').select('id, first_name, last_name').order('first_name'),\n      supabase.from('leads').select('id, first_name, last_name').order('first_name'),\n    ]);\n    \n    if (accountsRes.data) setAccounts(accountsRes.data);\n    if (contactsRes.data) setContacts(contactsRes.data);\n    if (leadsRes.data) setLeads(leadsRes.data);\n  };\n\n  const { isSubmitting } = form.formState;\n\n  const handleFormSubmit = (data: ActivityFormData) => {\n    setPendingData(data);\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirm = async () => {\n    if (pendingData) {\n      setShowConfirmDialog(false);\n      await onSubmit(pendingData);\n      setPendingData(null);\n    }\n  };\n\n  return (\n    <>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleFormSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"subject\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Subject *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Follow up with client\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"activity_type\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Type *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select type\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"call\">Call</SelectItem>\n                    <SelectItem value=\"email\">Email</SelectItem>\n                    <SelectItem value=\"meeting\">Meeting</SelectItem>\n                    <SelectItem value=\"task\">Task</SelectItem>\n                    <SelectItem value=\"note\">Note</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"status\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Status *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select status\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"planned\">Planned</SelectItem>\n                    <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                    <SelectItem value=\"completed\">Completed</SelectItem>\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"priority\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Priority *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select priority\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"low\">Low</SelectItem>\n                    <SelectItem value=\"medium\">Medium</SelectItem>\n                    <SelectItem value=\"high\">High</SelectItem>\n                    <SelectItem value=\"urgent\">Urgent</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"due_date\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Due Date</FormLabel>\n                <FormControl>\n                  <Input type=\"datetime-local\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"account_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Related Account</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select account\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"none\">None</SelectItem>\n                    {accounts.map((account) => (\n                      <SelectItem key={account.id} value={account.id}>\n                        {account.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"contact_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Related Contact</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select contact\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"none\">None</SelectItem>\n                    {contacts.map((contact) => (\n                      <SelectItem key={contact.id} value={contact.id}>\n                        {contact.first_name} {contact.last_name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"lead_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Related Lead</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select lead\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"none\">None</SelectItem>\n                    {leads.map((lead) => (\n                      <SelectItem key={lead.id} value={lead.id}>\n                        {lead.first_name} {lead.last_name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"description\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Description</FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Activity details...\"\n                    className=\"min-h-[100px]\"\n                    {...field}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"flex justify-end gap-3\">\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel} disabled={isSubmitting}>\n            Cancel\n          </Button>\n          <Button type=\"submit\" disabled={isSubmitting}>\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            {initialData?.id ? 'Update Activity' : 'Create Activity'}\n          </Button>\n        </div>\n        </form>\n      </Form>\n\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Confirm {initialData?.id ? 'Update' : 'Create'}</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to {initialData?.id ? 'update' : 'create'} this activity?\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirm}>Confirm</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/ContactForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1857,1860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1857,1860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1910,1913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1910,1913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1969,1972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1969,1972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchAccounts', 'fetchFranchises', and 'fetchTenants'. Either include them or remove the dependency array.","line":72,"column":6,"nodeType":"ArrayExpression","endLine":72,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [context, fetchAccounts, fetchFranchises, fetchTenants]","fix":{"range":[2997,3006],"text":"[context, fetchAccounts, fetchFranchises, fetchTenants]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Loader2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\n\nconst contactSchema = z.object({\n  first_name: z.string().min(1, 'First name is required').max(100),\n  last_name: z.string().min(1, 'Last name is required').max(100),\n  title: z.string().optional(),\n  email: z.string().email('Invalid email').optional().or(z.literal('')),\n  phone: z.string().optional(),\n  mobile: z.string().optional(),\n  linkedin_url: z.string().url('Invalid URL').optional().or(z.literal('')),\n  account_id: z.string().optional(),\n  is_primary: z.boolean().default(false),\n  notes: z.string().optional(),\n  tenant_id: z.string().optional(),\n  franchise_id: z.string().optional(),\n});\n\ntype ContactFormData = z.infer<typeof contactSchema>;\n\ninterface ContactFormProps {\n  initialData?: Partial<ContactFormData> & { id?: string };\n  onSubmit: (data: ContactFormData) => Promise<void>;\n  onCancel: () => void;\n}\n\nexport function ContactForm({ initialData, onSubmit, onCancel }: ContactFormProps) {\n  const { supabase, context } = useCRM();\n  const [accounts, setAccounts] = useState<any[]>([]);\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [franchises, setFranchises] = useState<any[]>([]);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingData, setPendingData] = useState<ContactFormData | null>(null);\n\n  const form = useForm<ContactFormData>({\n    resolver: zodResolver(contactSchema),\n    defaultValues: {\n      first_name: initialData?.first_name || '',\n      last_name: initialData?.last_name || '',\n      title: initialData?.title || '',\n      email: initialData?.email || '',\n      phone: initialData?.phone || '',\n      mobile: initialData?.mobile || '',\n      linkedin_url: initialData?.linkedin_url || '',\n      account_id: initialData?.account_id || '',\n      is_primary: initialData?.is_primary || false,\n      notes: initialData?.notes || '',\n      tenant_id: initialData?.tenant_id || '',\n      franchise_id: initialData?.franchise_id || '',\n    },\n  });\n\n  useEffect(() => {\n    fetchAccounts();\n    if (context.isPlatformAdmin) {\n      fetchTenants();\n    }\n    if (context.isPlatformAdmin || context.isTenantAdmin) {\n      fetchFranchises();\n    }\n  }, [context]);\n\n  const fetchAccounts = async () => {\n    const { data } = await supabase\n      .from('accounts')\n      .select('id, name')\n      .order('name');\n    if (data) setAccounts(data);\n  };\n\n  const fetchTenants = async () => {\n    const { data } = await supabase\n      .from('tenants')\n      .select('id, name')\n      .eq('is_active', true)\n      .order('name');\n    if (data) setTenants(data);\n  };\n\n  const fetchFranchises = async () => {\n    let query = supabase\n      .from('franchises')\n      .select('id, name, code')\n      .eq('is_active', true);\n    \n    if (context.isTenantAdmin && context.tenantId) {\n      query = query.eq('tenant_id', context.tenantId);\n    }\n    \n    const { data } = await query.order('name');\n    if (data) setFranchises(data);\n  };\n\n  const { isSubmitting } = form.formState;\n\n  const handleFormSubmit = (data: ContactFormData) => {\n    setPendingData(data);\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirm = async () => {\n    if (pendingData) {\n      setShowConfirmDialog(false);\n      await onSubmit(pendingData);\n      setPendingData(null);\n    }\n  };\n\n  return (\n    <>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleFormSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"first_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>First Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"John\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"last_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Last Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Doe\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"title\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Title</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Sales Manager\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"account_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Account</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select account\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"none\">None</SelectItem>\n                    {accounts.map((account) => (\n                      <SelectItem key={account.id} value={account.id}>\n                        {account.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Email</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"john.doe@example.com\" type=\"email\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"phone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Phone</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"+1 (555) 123-4567\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"mobile\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Mobile</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"+1 (555) 987-6543\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"linkedin_url\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>LinkedIn URL</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"https://linkedin.com/in/username\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"is_primary\"\n            render={({ field }) => (\n              <FormItem className=\"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4\">\n                <FormControl>\n                  <Checkbox\n                    checked={field.value}\n                    onCheckedChange={field.onChange}\n                  />\n                </FormControl>\n                <div className=\"space-y-1 leading-none\">\n                  <FormLabel>Primary Contact</FormLabel>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Mark as the main contact for this account\n                  </p>\n                </div>\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"notes\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Notes</FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Additional notes...\"\n                    className=\"min-h-[100px]\"\n                    {...field}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {context.isPlatformAdmin && (\n            <FormField\n              control={form.control}\n              name=\"tenant_id\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Tenant *</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select tenant\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {tenants.map((tenant) => (\n                        <SelectItem key={tenant.id} value={tenant.id}>\n                          {tenant.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n\n          {(context.isPlatformAdmin || context.isTenantAdmin) && franchises.length > 0 && (\n            <FormField\n              control={form.control}\n              name=\"franchise_id\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Franchise (Optional)</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select franchise\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {franchises.map((franchise) => (\n                        <SelectItem key={franchise.id} value={franchise.id}>\n                          {franchise.code} - {franchise.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n        </div>\n\n        <div className=\"flex justify-end gap-3\">\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel} disabled={isSubmitting}>\n            Cancel\n          </Button>\n          <Button type=\"submit\" disabled={isSubmitting}>\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            {initialData?.id ? 'Update Contact' : 'Create Contact'}\n          </Button>\n        </div>\n      </form>\n    </Form>\n\n    <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Confirm {initialData?.id ? 'Update' : 'Create'}</AlertDialogTitle>\n          <AlertDialogDescription>\n            Are you sure you want to {initialData?.id ? 'update' : 'create'} this contact?\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel>Cancel</AlertDialogCancel>\n          <AlertDialogAction onClick={handleConfirm}>Confirm</AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/ContactSelectDialogList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[672,675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[672,675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[925,928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[925,928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[980,983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[980,983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1523,1526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1523,1526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1790,1793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1790,1793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2068,2071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2068,2071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Table, TableBody, TableCell, TableHeader, TableRow } from '@/components/ui/table';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype ContactSelectDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelect: (contact: any) => void;\n};\n\nexport default function ContactSelectDialogList({ open, onOpenChange, onSelect }: ContactSelectDialogProps) {\n  const { supabase } = useCRM();\n  const [loading, setLoading] = useState(false);\n  const [contacts, setContacts] = useState<any[]>([]);\n  const [accounts, setAccounts] = useState<any[]>([]);\n\n  const [nameQuery, setNameQuery] = useState('');\n  const [emailQuery, setEmailQuery] = useState('');\n  const [phoneQuery, setPhoneQuery] = useState('');\n  const [accountFilter, setAccountFilter] = useState<string>('any');\n  const [statusAdv, setStatusAdv] = useState<string>('any');\n  const [sort, setSort] = useState<string>('name_asc');\n\n  useEffect(() => {\n    if (!open) return;\n    const fetch = async () => {\n      setLoading(true);\n      try {\n        const { data: contactsData, error: contactsErr } = await (supabase as any)\n          .from('contacts')\n          .select('*, accounts(*)')\n          .order('created_at', { ascending: false })\n          .limit(200);\n        if (contactsErr) throw contactsErr;\n        const { data: accountsData, error: accountsErr } = await (supabase as any)\n          .from('accounts')\n          .select('id, name')\n          .order('name', { ascending: true })\n          .limit(200);\n        if (accountsErr) throw accountsErr;\n        setContacts(contactsData || []);\n        setAccounts(accountsData || []);\n      } catch (err: any) {\n        console.error('Load contacts failed:', err);\n        toast.error('Failed to load contacts');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetch();\n  }, [open, supabase]);\n\n  const filtered = useMemo(() => {\n    const res = contacts.filter((c) => {\n      const name = `${c.first_name || ''} ${c.last_name || ''}`.trim();\n      const nameOk = nameQuery ? name.toLowerCase().includes(nameQuery.toLowerCase()) : true;\n      const emailOk = emailQuery ? (c.email || '').toLowerCase().includes(emailQuery.toLowerCase()) : true;\n      const phoneOk = phoneQuery ? (c.phone || '').toLowerCase().includes(phoneQuery.toLowerCase()) : true;\n      const accOk = accountFilter && accountFilter !== 'any' ? String(c.account_id) === accountFilter : true;\n      const statusOk = statusAdv && statusAdv !== 'any' ? c.status === statusAdv : true;\n      return nameOk && emailOk && phoneOk && accOk && statusOk;\n    });\n    res.sort((a, b) => {\n      const dir = sort.endsWith('_desc') ? -1 : 1;\n      const nameA = `${a.first_name || ''} ${a.last_name || ''}`.trim();\n      const nameB = `${b.first_name || ''} ${b.last_name || ''}`.trim();\n      if (sort.startsWith('name')) return nameA.localeCompare(nameB) * dir;\n      if (sort.startsWith('created')) return ((new Date(a.created_at).getTime() || 0) - (new Date(b.created_at).getTime() || 0)) * dir;\n      return 0;\n    });\n    return res;\n  }, [contacts, nameQuery, emailQuery, phoneQuery, accountFilter, statusAdv, sort]);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-5xl\">\n        <DialogHeader>\n          <DialogTitle>Select Contact</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-3\">\n          <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-6\">\n            <div className=\"space-y-2\">\n              <Label>Name</Label>\n              <Input placeholder=\"First/Last name\" value={nameQuery} onChange={(e) => setNameQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Email</Label>\n              <Input placeholder=\"Email\" value={emailQuery} onChange={(e) => setEmailQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Phone</Label>\n              <Input placeholder=\"Phone\" value={phoneQuery} onChange={(e) => setPhoneQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Account</Label>\n              <Select value={accountFilter} onValueChange={setAccountFilter}>\n                <SelectTrigger><SelectValue placeholder=\"Any\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"any\">Any</SelectItem>\n                  {accounts.map((a) => (\n                    <SelectItem key={a.id} value={String(a.id)}>{a.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Status</Label>\n              <Select value={statusAdv} onValueChange={setStatusAdv}>\n                <SelectTrigger><SelectValue placeholder=\"Any\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"any\">Any</SelectItem>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Sort</Label>\n              <Select value={sort} onValueChange={setSort}>\n                <SelectTrigger><SelectValue placeholder=\"Sort\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"name_asc\">Name AZ</SelectItem>\n                  <SelectItem value=\"name_desc\">Name ZA</SelectItem>\n                  <SelectItem value=\"created_desc\">Newest first</SelectItem>\n                  <SelectItem value=\"created_asc\">Oldest first</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {loading ? (\n            <div className=\"text-center text-muted-foreground py-8\">Loading contacts</div>\n          ) : filtered.length === 0 ? (\n            <div className=\"text-center text-muted-foreground py-8\">No contacts found</div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableCell className=\"font-medium\">Name</TableCell>\n                    <TableCell className=\"font-medium\">Email</TableCell>\n                    <TableCell className=\"font-medium\">Phone</TableCell>\n                    <TableCell className=\"font-medium\">Account</TableCell>\n                    <TableCell className=\"font-medium\">Action</TableCell>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filtered.map((c) => (\n                    <TableRow key={c.id} className=\"hover:bg-muted/50\">\n                      <TableCell className=\"font-medium\">{`${c.first_name || ''} ${c.last_name || ''}`.trim() || '-'}</TableCell>\n                      <TableCell>{c.email || '-'}</TableCell>\n                      <TableCell>{c.phone || '-'}</TableCell>\n                      <TableCell>{c.accounts?.name || '-'}</TableCell>\n                      <TableCell>\n                        <Button size=\"sm\" onClick={() => { onSelect(c); onOpenChange(false); }}>Select</Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/LeadActivitiesTimeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchActivities'. Either include it or remove the dependency array.","line":46,"column":6,"nodeType":"ArrayExpression","endLine":46,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchActivities, leadId]","fix":{"range":[1448,1456],"text":"[fetchActivities, leadId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1771,1774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1771,1774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3501,3504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3501,3504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\nimport { Plus, Phone, Mail, Calendar, CheckCircle2, Clock, Pencil, Trash2 } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\n\ninterface Activity {\n  id: string;\n  activity_type: string;\n  subject: string | null;\n  status: string | null;\n  priority: string | null;\n  due_date: string | null;\n  completed_at: string | null;\n  created_at: string;\n}\n\ninterface LeadActivitiesTimelineProps {\n  leadId: string;\n}\n\nexport function LeadActivitiesTimeline({ leadId }: LeadActivitiesTimelineProps) {\n  const { supabase } = useCRM();\n  const navigate = useNavigate();\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [activityToDelete, setActivityToDelete] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchActivities();\n  }, [leadId]);\n\n  const fetchActivities = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('activities')\n        .select('*')\n        .eq('lead_id', leadId)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setActivities(data || []);\n    } catch (error: any) {\n      toast.error('Failed to load activities');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getActivityIcon = (type: string) => {\n    switch (type) {\n      case 'call':\n        return <Phone className=\"h-4 w-4\" />;\n      case 'email':\n        return <Mail className=\"h-4 w-4\" />;\n      case 'meeting':\n        return <Calendar className=\"h-4 w-4\" />;\n      default:\n        return <Clock className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getStatusColor = (status: string | null) => {\n    switch (status) {\n      case 'completed':\n        return 'bg-green-500/10 text-green-500';\n      case 'in_progress':\n        return 'bg-blue-500/10 text-blue-500';\n      case 'planned':\n        return 'bg-purple-500/10 text-purple-500';\n      default:\n        return 'bg-gray-500/10 text-gray-500';\n    }\n  };\n\n  const getPriorityColor = (priority: string | null) => {\n    switch (priority) {\n      case 'high':\n        return 'bg-red-500/10 text-red-500';\n      case 'medium':\n        return 'bg-yellow-500/10 text-yellow-500';\n      case 'low':\n        return 'bg-gray-500/10 text-gray-500';\n      default:\n        return 'bg-gray-500/10 text-gray-500';\n    }\n  };\n\n  const handleDeleteClick = (activityId: string) => {\n    setActivityToDelete(activityId);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleDeleteConfirm = async () => {\n    if (!activityToDelete) return;\n\n    try {\n      const { error } = await supabase\n        .from('activities')\n        .delete()\n        .eq('id', activityToDelete);\n\n      if (error) throw error;\n\n      toast.success('Activity deleted successfully');\n      setActivities(activities.filter(a => a.id !== activityToDelete));\n    } catch (error: any) {\n      toast.error('Failed to delete activity');\n      console.error('Error:', error);\n    } finally {\n      setDeleteDialogOpen(false);\n      setActivityToDelete(null);\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"py-12 text-center\">\n          <p className=\"text-muted-foreground\">Loading activities...</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle>Activity Timeline</CardTitle>\n            <CardDescription>Track all interactions with this lead</CardDescription>\n          </div>\n          <Button size=\"sm\" onClick={() => navigate(`/dashboard/activities/new?leadId=${leadId}`)}>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Activity\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {activities.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <Clock className=\"mx-auto h-12 w-12 text-muted-foreground mb-3\" />\n            <p className=\"text-muted-foreground\">No activities recorded yet</p>\n            <Button size=\"sm\" className=\"mt-4\" onClick={() => navigate(`/dashboard/activities/new?leadId=${leadId}`)}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Log First Activity\n            </Button>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {activities.map((activity, index) => (\n              <div\n                key={activity.id}\n                className=\"relative flex gap-4 pb-4 border-b last:border-0 last:pb-0\"\n              >\n                {/* Timeline dot */}\n                <div className=\"relative\">\n                  <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary\">\n                    {getActivityIcon(activity.activity_type)}\n                  </div>\n                  {index !== activities.length - 1 && (\n                    <div className=\"absolute left-1/2 top-10 h-full w-0.5 -translate-x-1/2 bg-border\" />\n                  )}\n                </div>\n\n                {/* Activity content */}\n                <div className=\"flex-1 pt-1\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-medium text-sm\">{activity.subject}</h4>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {format(new Date(activity.created_at), 'PPp')}\n                      </p>\n                    </div>\n                    <div className=\"flex gap-2 items-start\">\n                      <Badge className={getStatusColor(activity.status)} variant=\"outline\">\n                        {activity.status ?? 'planned'}\n                      </Badge>\n                      <Badge className={getPriorityColor(activity.priority)} variant=\"outline\">\n                        {activity.priority ?? 'medium'}\n                      </Badge>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8\"\n                        onClick={() => navigate(`/dashboard/activities/${activity.id}`)}\n                      >\n                        <Pencil className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8 text-destructive hover:text-destructive\"\n                        onClick={() => handleDeleteClick(activity.id)}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                  {activity.due_date && (\n                    <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-2\">\n                      <Calendar className=\"h-3 w-3\" />\n                      Due: {format(new Date(activity.due_date), 'PP')}\n                    </div>\n                  )}\n                  {activity.completed_at && (\n                    <div className=\"flex items-center gap-1 text-xs text-green-600 mt-2\">\n                      <CheckCircle2 className=\"h-3 w-3\" />\n                      Completed: {format(new Date(activity.completed_at), 'PP')}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Activity</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this activity? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDeleteConfirm}>Delete</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/LeadConversionDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/LeadForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2649,2652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2649,2652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2708,2711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2708,2711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3518,3521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3518,3521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchFranchises' and 'fetchTenants'. Either include them or remove the dependency array.","line":87,"column":6,"nodeType":"ArrayExpression","endLine":87,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, context.isTenantAdmin, fetchFranchises, fetchTenants]","fix":{"range":[3747,3795],"text":"[context.isPlatformAdmin, context.isTenantAdmin, fetchFranchises, fetchTenants]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { Loader2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { FormSection, FormGrid } from '@/components/forms/FormLayout';\nimport { AsyncComboboxField, FileUploadField } from '@/components/forms/AdvancedFields';\nimport { Switch } from '@/components/ui/switch';\n\nconst leadSchema = z.object({\n  first_name: z.string().min(1, 'First name is required').max(100),\n  last_name: z.string().min(1, 'Last name is required').max(100),\n  company: z.string().optional(),\n  title: z.string().optional(),\n  email: z.string().email('Invalid email').optional().or(z.literal('')),\n  phone: z.string().optional(),\n  status: z.enum(['new', 'contacted', 'qualified', 'proposal', 'negotiation', 'won', 'lost']),\n  source: z.enum(['website', 'referral', 'email', 'phone', 'social', 'event', 'other']),\n  estimated_value: z.string().optional(),\n  expected_close_date: z.string().optional(),\n  description: z.string().optional(),\n  notes: z.string().optional(),\n  tenant_id: z.string().optional(),\n  franchise_id: z.string().optional(),\n  service_id: z.string().optional(),\n  attachments: z.array(z.any()).default([]),\n}).refine((data) => {\n  const hasEmail = !!(data.email && data.email.trim());\n  const hasPhone = !!(data.phone && data.phone.trim());\n  return hasEmail || hasPhone;\n}, {\n  path: ['email'],\n  message: 'Provide at least one contact: email or phone',\n});\n\ntype LeadFormData = z.infer<typeof leadSchema>;\nexport type { LeadFormData };\n\ninterface LeadFormProps {\n  initialData?: Partial<LeadFormData> & { id?: string };\n  onSubmit: (data: LeadFormData) => Promise<void>;\n  onCancel: () => void;\n}\n\nexport function LeadForm({ initialData, onSubmit, onCancel }: LeadFormProps) {\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingData, setPendingData] = useState<LeadFormData | null>(null);\n  const { supabase, context } = useCRM();\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [franchises, setFranchises] = useState<any[]>([]);\n  \n  const form = useForm<LeadFormData>({\n    resolver: zodResolver(leadSchema),\n    defaultValues: {\n      first_name: initialData?.first_name || '',\n      last_name: initialData?.last_name || '',\n      company: initialData?.company || '',\n      title: initialData?.title || '',\n      email: initialData?.email || '',\n      phone: initialData?.phone || '',\n      status: initialData?.status || 'new',\n      source: initialData?.source || 'other',\n      estimated_value: initialData?.estimated_value || '',\n      expected_close_date: initialData?.expected_close_date || '',\n      description: initialData?.description || '',\n      notes: initialData?.notes || '',\n      tenant_id: initialData?.tenant_id || '',\n      franchise_id: initialData?.franchise_id || '',\n      service_id: (initialData as any)?.custom_fields?.service_id || '',\n      attachments: [],\n    },\n  });\n\n  useEffect(() => {\n    if (context.isPlatformAdmin) {\n      fetchTenants();\n    } else if (context.isTenantAdmin) {\n      fetchFranchises();\n    }\n  }, [context.isPlatformAdmin, context.isTenantAdmin]);\n\n  const fetchTenants = async () => {\n    const { data } = await supabase.from('tenants').select('id, name').order('name');\n    if (data) setTenants(data);\n  };\n\n  const fetchFranchises = async () => {\n    if (!context.tenantId) return;\n    const { data } = await supabase\n      .from('franchises')\n      .select('id, name')\n      .eq('tenant_id', context.tenantId)\n      .order('name');\n    if (data) setFranchises(data);\n  };\n\n  const { isSubmitting } = form.formState;\n  const attachments = form.watch('attachments');\n  const [signedUrlEnabled, setSignedUrlEnabled] = useState(false);\n\n  const handleFormSubmit = (data: LeadFormData) => {\n    setPendingData(data);\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirm = async () => {\n    if (pendingData) {\n      setShowConfirmDialog(false);\n      await onSubmit(pendingData);\n      setPendingData(null);\n    }\n  };\n\n  return (\n    <>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleFormSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          {context.isPlatformAdmin && (\n            <FormField\n              control={form.control}\n              name=\"tenant_id\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Tenant *</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select tenant\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {tenants.map((tenant) => (\n                        <SelectItem key={tenant.id} value={tenant.id}>\n                          {tenant.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n\n          {context.isTenantAdmin && franchises.length > 0 && (\n            <FormField\n              control={form.control}\n              name=\"franchise_id\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Franchise</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select franchise\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {franchises.map((franchise) => (\n                        <SelectItem key={franchise.id} value={franchise.id}>\n                          {franchise.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n\n          <FormField\n            control={form.control}\n            name=\"first_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>First Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"John\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"last_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Last Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Doe\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"company\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Company</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Acme Corp\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"title\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Title</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"CEO\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Email</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"john@example.com\" type=\"email\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"phone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Phone</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"+1 (555) 123-4567\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"status\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Status *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select status\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"new\">New</SelectItem>\n                    <SelectItem value=\"contacted\">Contacted</SelectItem>\n                    <SelectItem value=\"qualified\">Qualified</SelectItem>\n                    <SelectItem value=\"proposal\">Proposal</SelectItem>\n                    <SelectItem value=\"negotiation\">Negotiation</SelectItem>\n                    <SelectItem value=\"won\">Won</SelectItem>\n                    <SelectItem value=\"lost\">Lost</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"source\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Source *</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select source\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"website\">Website</SelectItem>\n                    <SelectItem value=\"referral\">Referral</SelectItem>\n                    <SelectItem value=\"email\">Email</SelectItem>\n                    <SelectItem value=\"phone\">Phone</SelectItem>\n                    <SelectItem value=\"social\">Social Media</SelectItem>\n                    <SelectItem value=\"event\">Event</SelectItem>\n                    <SelectItem value=\"other\">Other</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <AsyncComboboxField\n            control={form.control}\n            name=\"service_id\"\n            label=\"Interested Service\"\n            placeholder=\"Search services...\"\n            className=\"col-span-2\"\n          />\n\n          <FormField\n            control={form.control}\n            name=\"estimated_value\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Estimated Value</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"10000\" type=\"number\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"expected_close_date\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Expected Close Date</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"description\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Description</FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Describe the opportunity...\"\n                    className=\"min-h-[80px]\"\n                    {...field}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"notes\"\n            render={({ field }) => (\n              <FormItem className=\"col-span-2\">\n                <FormLabel>Notes</FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Additional notes...\"\n                    className=\"min-h-[80px]\"\n                    {...field}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormSection\n          title=\"Attachments\"\n          description=\"Upload related documents (e.g., proposals, brochures)\"\n          actions={\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Switch checked={signedUrlEnabled} onCheckedChange={setSignedUrlEnabled} id=\"lead-signed-url\" />\n                <label htmlFor=\"lead-signed-url\" className=\"text-sm\">Signed URL</label>\n              </div>\n            </div>\n          }\n        >\n          <FormGrid columns={1}>\n            <FileUploadField control={form.control} name=\"attachments\" label=\"Attachments\" />\n            {attachments && Array.isArray(attachments) && attachments.length > 0 ? (\n              <div className=\"space-y-2\">\n                <p className=\"text-sm text-muted-foreground\">Selected files:</p>\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\n                  {attachments.map((f: File, idx: number) => (\n                    <li key={`${f.name}-${idx}`} className=\"flex items-center justify-between\">\n                      <span className=\"truncate\">\n                        <span className=\"font-medium\">{f.name}</span>\n                        <span className=\"text-muted-foreground\">  {f.type || 'unknown'}</span>\n                      </span>\n                      <span className=\"text-muted-foreground\">{(f.size / 1024).toFixed(1)} KB</span>\n                    </li>\n                  ))}\n                </ul>\n                {signedUrlEnabled && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    Signed URL enabled: in production, generate secure file links via Supabase Storage.\n                  </p>\n                )}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">No files selected yet</p>\n            )}\n          </FormGrid>\n        </FormSection>\n\n        <div className=\"flex justify-end gap-3\">\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel} disabled={isSubmitting}>\n            Cancel\n          </Button>\n          <Button type=\"submit\" disabled={isSubmitting}>\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            {initialData?.id ? 'Update Lead' : 'Create Lead'}\n          </Button>\n        </div>\n        </form>\n      </Form>\n\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Confirm {initialData?.id ? 'Update' : 'Create'}</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to {initialData?.id ? 'update' : 'create'} this lead?\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirm}>Confirm</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/LeadScoringCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/OpportunityForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1919,1922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1919,1922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2457,2460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2457,2460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2512,2515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2512,2515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2561,2564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2561,2564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2614,2617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2614,2617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2673,2676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2673,2676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'form'. Either include it or remove the dependency array.","line":154,"column":6,"nodeType":"ArrayExpression","endLine":154,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [selectedAccountId, contacts, form]","fix":{"range":[5926,5955],"text":"[selectedAccountId, contacts, form]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { useState, useEffect, useMemo } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useCRM } from '@/hooks/useCRM';\nimport { stageProbabilityMap, OpportunityStage } from '@/pages/dashboard/opportunities-data';\n\nconst opportunitySchema = z.object({\n  name: z.string().min(1, 'Name is required'),\n  description: z.string().optional(),\n  stage: z.enum(['prospecting', 'qualification', 'needs_analysis', 'value_proposition', 'proposal', 'negotiation', 'closed_won', 'closed_lost']),\n  amount: z.string().optional(),\n  probability: z.string().optional().refine(val => {\n    if (!val) return true;\n    const num = parseFloat(val);\n    return !isNaN(num) && num >= 0 && num <= 100;\n  }, \"Probability must be between 0 and 100\"),\n  close_date: z.string().optional(),\n  account_id: z.string().optional(),\n  contact_id: z.string().optional(),\n  lead_id: z.string().optional(),\n  // Align lead_source options with the shared enum used across Leads and Opportunities\n  lead_source: z.enum(['website', 'referral', 'email', 'phone', 'social', 'event', 'other']).optional(),\n  next_step: z.string().optional(),\n  competitors: z.string().optional(),\n  type: z.string().optional(),\n  forecast_category: z.string().optional(),\n  tenant_id: z.string().optional(),\n  franchise_id: z.string().optional(),\n});\n\ntype OpportunityFormData = z.infer<typeof opportunitySchema>;\n\ninterface OpportunityFormProps {\n  opportunity?: any;\n  onSubmit: (data: OpportunityFormData) => Promise<void>;\n  onCancel: () => void;\n}\n\nconst stageLabels = {\n  prospecting: 'Prospecting',\n  qualification: 'Qualification',\n  needs_analysis: 'Needs Analysis',\n  value_proposition: 'Value Proposition',\n  proposal: 'Proposal',\n  negotiation: 'Negotiation',\n  closed_won: 'Closed Won',\n  closed_lost: 'Closed Lost',\n};\n\nexport function OpportunityForm({ opportunity, onSubmit, onCancel }: OpportunityFormProps) {\n  const { context } = useCRM();\n  const [accounts, setAccounts] = useState<any[]>([]);\n  const [contacts, setContacts] = useState<any[]>([]);\n  const [leads, setLeads] = useState<any[]>([]);\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [franchises, setFranchises] = useState<any[]>([]);\n\n  const form = useForm<OpportunityFormData>({\n    resolver: zodResolver(opportunitySchema),\n    defaultValues: {\n      name: opportunity?.name || '',\n      description: opportunity?.description || '',\n      stage: opportunity?.stage || 'prospecting',\n      amount: opportunity?.amount?.toString() || '',\n      probability: opportunity?.probability?.toString() || '',\n      close_date: opportunity?.close_date || '',\n      account_id: opportunity?.account_id || '',\n      contact_id: opportunity?.contact_id || '',\n      lead_id: opportunity?.lead_id || '',\n      lead_source: opportunity?.lead_source || undefined,\n      next_step: opportunity?.next_step || '',\n      competitors: opportunity?.competitors || '',\n      type: opportunity?.type || '',\n      forecast_category: opportunity?.forecast_category || '',\n      tenant_id: opportunity?.tenant_id || '',\n      franchise_id: opportunity?.franchise_id || '',\n    },\n  });\n\n  useEffect(() => {\n    const fetchData = async () => {\n      // Fetch accounts\n      const { data: accountsData } = await supabase\n        .from('accounts')\n        .select('id, name')\n        .order('name');\n      if (accountsData) setAccounts(accountsData);\n\n      // Fetch contacts (include account_id for filtering)\n      const { data: contactsData } = await supabase\n        .from('contacts')\n        .select('id, first_name, last_name, account_id')\n        .order('first_name');\n      if (contactsData) setContacts(contactsData);\n\n      // Fetch leads\n      const { data: leadsData } = await supabase\n        .from('leads')\n        .select('id, first_name, last_name, company')\n        .order('first_name');\n      if (leadsData) setLeads(leadsData);\n\n      // Fetch tenants for platform admin\n      if (context.isPlatformAdmin) {\n        const { data: tenantsData } = await supabase\n          .from('tenants')\n          .select('id, name')\n          .eq('is_active', true)\n          .order('name');\n        if (tenantsData) setTenants(tenantsData);\n      }\n\n      // Fetch franchises for platform admin and tenant admin\n      if (context.isPlatformAdmin || context.isTenantAdmin) {\n        let query = supabase\n          .from('franchises')\n          .select('id, name, code')\n          .eq('is_active', true);\n        \n        if (context.isTenantAdmin && context.tenantId) {\n          query = query.eq('tenant_id', context.tenantId);\n        }\n        \n        const { data: franchisesData } = await query.order('name');\n        if (franchisesData) setFranchises(franchisesData);\n      }\n    };\n\n    fetchData();\n  }, [context]);\n\n  // Filter contacts by selected account\n  const selectedAccountId = form.watch('account_id');\n  const filteredContacts = useMemo(() => {\n    if (!selectedAccountId) return contacts;\n    return contacts.filter((c) => c.account_id === selectedAccountId);\n  }, [selectedAccountId, contacts]);\n\n  // Reset contact if it no longer matches the selected account\n  useEffect(() => {\n    const currentContactId = form.getValues('contact_id');\n    if (!currentContactId) return;\n    const current = contacts.find((c) => c.id === currentContactId);\n    if (selectedAccountId && current && current.account_id !== selectedAccountId) {\n      form.setValue('contact_id', '');\n    }\n  }, [selectedAccountId, contacts]);\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Opportunity Name *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Enter opportunity name\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"stage\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Stage</FormLabel>\n                <Select \n                  onValueChange={(val) => {\n                    field.onChange(val);\n                    if (stageProbabilityMap[val as OpportunityStage] !== undefined) {\n                       form.setValue('probability', stageProbabilityMap[val as OpportunityStage].toString());\n                    }\n                  }} \n                  defaultValue={field.value}\n                >\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select stage\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {Object.entries(stageLabels).map(([value, label]) => (\n                      <SelectItem key={value} value={value}>\n                        {label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"amount\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Amount</FormLabel>\n                <FormControl>\n                  <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"probability\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Probability (%)</FormLabel>\n                <FormControl>\n                  <Input type=\"number\" min=\"0\" max=\"100\" placeholder=\"0-100\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"close_date\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Expected Close Date</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"account_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Account</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select account\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {accounts.map((account) => (\n                      <SelectItem key={account.id} value={account.id}>\n                        {account.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"contact_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Primary Contact</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select contact\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {filteredContacts.map((contact) => (\n                      <SelectItem key={contact.id} value={contact.id}>\n                        {contact.first_name} {contact.last_name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"lead_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Related Lead</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select lead\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {leads.map((lead) => (\n                      <SelectItem key={lead.id} value={lead.id}>\n                        {lead.first_name} {lead.last_name} {lead.company ? `- ${lead.company}` : ''}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"lead_source\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Lead Source</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select lead source\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"website\">Website</SelectItem>\n                    <SelectItem value=\"phone\">Phone</SelectItem>\n                    <SelectItem value=\"email\">Email</SelectItem>\n                    <SelectItem value=\"referral\">Referral</SelectItem>\n                    <SelectItem value=\"social\">Social</SelectItem>\n                    <SelectItem value=\"event\">Event</SelectItem>\n                    <SelectItem value=\"other\">Other</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"type\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Type</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"New Business, Upsell, Renewal, etc.\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"forecast_category\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Forecast Category</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Pipeline, Best Case, Commit, etc.\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {context.isPlatformAdmin && (\n            <FormField\n              control={form.control}\n              name=\"tenant_id\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Tenant *</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select tenant\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {tenants.map((tenant) => (\n                        <SelectItem key={tenant.id} value={tenant.id}>\n                          {tenant.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n\n          {(context.isPlatformAdmin || context.isTenantAdmin) && (\n            <FormField\n              control={form.control}\n              name=\"franchise_id\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Franchise</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select franchise\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {franchises.map((franchise) => (\n                        <SelectItem key={franchise.id} value={franchise.id}>\n                          {franchise.code} - {franchise.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"description\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Description</FormLabel>\n              <FormControl>\n                <Textarea\n                  placeholder=\"Enter opportunity description\"\n                  className=\"min-h-[100px]\"\n                  {...field}\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"next_step\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Next Step</FormLabel>\n              <FormControl>\n                <Input placeholder=\"What's the next action?\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"competitors\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Competitors</FormLabel>\n              <FormControl>\n                <Textarea\n                  placeholder=\"List competing companies or solutions\"\n                  {...field}\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex justify-end gap-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\n            Cancel\n          </Button>\n          <Button type=\"submit\">Save Opportunity</Button>\n        </div>\n      </form>\n    </Form>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/OpportunityHistoryTab.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/OpportunityHistoryTab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPresets'. Either include it or remove the dependency array.","line":46,"column":6,"nodeType":"ArrayExpression","endLine":46,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadPresets]","fix":{"range":[2002,2004],"text":"[loadPresets]"}}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":109,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":109,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4087,4087],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { toast } from 'sonner';\nimport posthog from 'posthog-js';\nimport Papa from 'papaparse';\nimport * as XLSX from 'xlsx';\nimport { OpportunityHistory, stageLabels } from '@/pages/dashboard/opportunities-data';\nimport { ExportField, HistoryFilters, HistoryFilterPreset, HistoryTypeFilter, buildCsvRows, filterHistory } from './opportunityHistoryUtils';\nimport { useCRM } from '@/hooks/useCRM';\n\ntype Props = {\n  history: OpportunityHistory[];\n  onRefresh: () => void;\n};\n\nexport function OpportunityHistoryTab({ history, onRefresh }: Props) {\n  const { supabase, context } = useCRM();\n  const [filters, setFilters] = useState<HistoryFilters>({ type: 'any' });\n  const [exportOpen, setExportOpen] = useState(false);\n  const [exportFields, setExportFields] = useState<ExportField[]>([\n    'changed_at',\n    'old_stage',\n    'new_stage',\n    'old_probability',\n    'new_probability',\n    'changed_by_name',\n    'changed_by_email',\n  ]);\n  const [exportFormat, setExportFormat] = useState<'csv' | 'xlsx'>('csv');\n  const [exporting, setExporting] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [presets, setPresets] = useState<HistoryFilterPreset[]>([]);\n  const [selectedPresetId, setSelectedPresetId] = useState<string>('');\n  const [newPresetName, setNewPresetName] = useState<string>('');\n\n  useEffect(() => {\n    posthog.capture('crm.opportunity_history.view');\n    loadPresets();\n  }, []);\n\n  const filtered = useMemo(() => {\n    const res = filterHistory(history, filters);\n    return res;\n  }, [history, filters]);\n\n  const loadPresets = async () => {\n    try {\n      if (!context.userId) return;\n      const { data, error } = await supabase\n        .from('history_filter_presets')\n        .select('*')\n        .eq('user_id', context.userId)\n        .order('name', { ascending: true });\n      if (error) throw error;\n      const list: HistoryFilterPreset[] = (data || []).map((p) => ({\n        id: (p as { id: string }).id,\n        name: (p as { name: string }).name,\n        filters: ((p as { filters?: HistoryFilters }).filters) || {},\n      }));\n      setPresets(list);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to load presets', { description: message });\n    }\n  };\n\n  const savePreset = async () => {\n    try {\n      if (!newPresetName.trim()) {\n        toast.error('Preset name is required');\n        return;\n      }\n      if (!context.userId) {\n        toast.error('User not available');\n        return;\n      }\n      const payload = {\n        user_id: context.userId,\n        tenant_id: context.tenantId || null,\n        name: newPresetName.trim(),\n        filters,\n      };\n      const { error } = await supabase.from('history_filter_presets').insert(payload);\n      if (error) throw error;\n      toast.success('Preset saved');\n      posthog.capture('crm.opportunity_history.preset_save', { name: payload.name });\n      setNewPresetName('');\n      await loadPresets();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to save preset', { description: message });\n    }\n  };\n\n  const applyPreset = async (id: string) => {\n    try {\n      const preset = presets.find((p) => p.id === id);\n      if (!preset) return;\n      setFilters(preset.filters || { type: 'any' });\n      setSelectedPresetId(id);\n      posthog.capture('crm.opportunity_history.preset_apply', { name: preset.name });\n    } catch {}\n  };\n\n  const deletePreset = async (id: string) => {\n    try {\n      const { error } = await supabase.from('history_filter_presets').delete().eq('id', id);\n      if (error) throw error;\n      toast.success('Preset deleted');\n      posthog.capture('crm.opportunity_history.preset_delete');\n      if (selectedPresetId === id) setSelectedPresetId('');\n      await loadPresets();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to delete preset', { description: message });\n    }\n  };\n\n  const renamePreset = async (id: string, name: string) => {\n    try {\n      if (!name.trim()) {\n        toast.error('Name is required');\n        return;\n      }\n      const { error } = await supabase.from('history_filter_presets').update({ name: name.trim() }).eq('id', id);\n      if (error) throw error;\n      toast.success('Preset renamed');\n      await loadPresets();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to rename preset', { description: message });\n    }\n  };\n\n  const applyFilters = (next: Partial<HistoryFilters>) => {\n    const updated = { ...filters, ...next };\n    setFilters(updated);\n    posthog.capture('crm.opportunity_history.filter_apply', {\n      type: updated.type,\n      has_query: !!updated.query,\n      has_start: !!updated.startDate,\n      has_end: !!updated.endDate,\n    });\n  };\n\n  const resetFilters = () => {\n    setFilters({ type: 'any', query: '', startDate: undefined, endDate: undefined });\n    posthog.capture('crm.opportunity_history.filter_reset');\n  };\n\n  const toggleField = (f: ExportField) => {\n    setExportFields((prev) => {\n      if (prev.includes(f)) return prev.filter((x) => x !== f);\n      return [...prev, f];\n    });\n  };\n\n  const handleExport = async () => {\n    try {\n      setExporting(true);\n      setProgress(0);\n      posthog.capture('crm.opportunity_history.export_start', {\n        rows: filtered.length,\n        fields: exportFields,\n        format: exportFormat,\n      });\n      if (filtered.length > 5) {\n        const chunk = Math.max(1, Math.floor(filtered.length / 10));\n        for (let i = 0; i < filtered.length; i += chunk) {\n          const pct = Math.min(100, Math.round(((i + chunk) / filtered.length) * 100));\n          setProgress(pct);\n          await new Promise((r) => setTimeout(r, 30));\n        }\n      } else {\n        setProgress(100);\n      }\n      const rows = buildCsvRows(filtered, exportFields);\n      if (exportFormat === 'csv') {\n        const csv = Papa.unparse(rows, { quotes: true });\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `opportunity_history_${new Date().toISOString()}.csv`;\n        a.click();\n        URL.revokeObjectURL(url);\n      } else {\n        const ws = XLSX.utils.json_to_sheet(rows);\n        const wb = XLSX.utils.book_new();\n        XLSX.utils.book_append_sheet(wb, ws, 'History');\n        XLSX.writeFile(wb, `opportunity_history_${new Date().toISOString().split('T')[0]}.xlsx`);\n      }\n      posthog.capture('crm.opportunity_history.export_success', {\n        rows: filtered.length,\n        fields: exportFields,\n        format: exportFormat,\n      });\n      toast.success('Export complete');\n    } catch (e: unknown) {\n      const message = e instanceof Error ? e.message : String(e);\n      posthog.capture('crm.opportunity_history.export_failure', { error: message });\n      toast.error('Export failed', { description: message || 'Unexpected error' });\n    } finally {\n      setExporting(false);\n      setProgress(0);\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader className=\"flex items-center justify-between\">\n        <CardTitle>Stage and Probability Changes</CardTitle>\n        <div className=\"flex gap-2\">\n          <Button variant=\"outline\" onClick={onRefresh}>Refresh</Button>\n          <Button onClick={() => setExportOpen(true)}>Export CSV</Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"p-3 border rounded-md space-y-3\">\n          <p className=\"text-sm text-muted-foreground\">Presets</p>\n          <div className=\"grid gap-3 md:grid-cols-3\">\n            <div className=\"space-y-2\">\n              <Label>Saved presets</Label>\n              <Select value={selectedPresetId} onValueChange={(v) => applyPreset(v)}>\n                <SelectTrigger><SelectValue placeholder={presets.length ? 'Select preset' : 'No presets'} /></SelectTrigger>\n                <SelectContent>\n                  {presets.map((p) => (\n                    <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Preset name</Label>\n              <Input value={newPresetName} onChange={(e) => setNewPresetName(e.target.value)} placeholder=\"My favorite filters\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>&nbsp;</Label>\n              <Button onClick={savePreset}>Save current as preset</Button>\n            </div>\n          </div>\n          {presets.length > 0 && (\n            <div className=\"space-y-2\">\n              <p className=\"text-xs text-muted-foreground\">Manage presets</p>\n              <div className=\"flex flex-wrap gap-2\">\n                {presets.map((p) => (\n                  <div key={p.id} className=\"flex items-center gap-2 border rounded px-2 py-1\">\n                    <Input\n                      value={p.name}\n                      onChange={(e) => renamePreset(p.id, e.target.value)}\n                      className=\"h-8 w-40\"\n                    />\n                    <Button variant=\"destructive\" size=\"sm\" onClick={() => deletePreset(p.id)}>Delete</Button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        <div className=\"grid gap-3 md:grid-cols-4\">\n          <div className=\"space-y-2\">\n            <Label>Start date</Label>\n            <Input type=\"date\" value={filters.startDate || ''} onChange={(e) => applyFilters({ startDate: e.target.value || undefined })} />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>End date</Label>\n            <Input type=\"date\" value={filters.endDate || ''} onChange={(e) => applyFilters({ endDate: e.target.value || undefined })} />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Type</Label>\n            <Select value={(filters.type as HistoryTypeFilter) || 'any'} onValueChange={(v) => applyFilters({ type: v as HistoryTypeFilter })}>\n              <SelectTrigger><SelectValue placeholder=\"Any\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"any\">Any</SelectItem>\n                <SelectItem value=\"stage\">Stage changed</SelectItem>\n                <SelectItem value=\"probability\">Probability changed</SelectItem>\n                <SelectItem value=\"both\">Both changed</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Search</Label>\n            <Input placeholder=\"User, stage, probability\" value={filters.query || ''} onChange={(e) => applyFilters({ query: e.target.value })} />\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          {filters.startDate && <Badge variant=\"outline\">Start: {filters.startDate}</Badge>}\n          {filters.endDate && <Badge variant=\"outline\">End: {filters.endDate}</Badge>}\n          {filters.type && filters.type !== 'any' && <Badge variant=\"outline\">Type: {filters.type}</Badge>}\n          {filters.query && <Badge variant=\"outline\">Query: {filters.query}</Badge>}\n          <Button variant=\"ghost\" onClick={resetFilters}>Reset filters</Button>\n        </div>\n\n        {exportOpen && (\n          <div className=\"p-3 border rounded-md space-y-3\">\n            <p className=\"text-sm text-muted-foreground\">Export fields</p>\n            <div className=\"flex gap-2 flex-wrap\">\n              {(['changed_at','old_stage','new_stage','old_probability','new_probability','changed_by_name','changed_by_email'] as ExportField[]).map((f) => (\n                <Badge\n                  key={f}\n                  className={exportFields.includes(f) ? 'bg-primary text-primary-foreground' : 'bg-muted text-muted-foreground'}\n                  onClick={() => toggleField(f)}\n                >\n                  {f.replace(/_/g, ' ')}\n                </Badge>\n              ))}\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Format</Label>\n              <Select value={exportFormat} onValueChange={(v) => setExportFormat(v as 'csv' | 'xlsx')}>\n                <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Format\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"csv\">CSV</SelectItem>\n                  <SelectItem value=\"xlsx\">XLSX</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button onClick={handleExport} disabled={exporting || filtered.length === 0}>\n                {exporting ? 'Exporting' : `Download ${exportFormat.toUpperCase()}`}\n              </Button>\n              {exporting && <Progress value={progress} className=\"w-40\" />}\n              <Button variant=\"ghost\" onClick={() => setExportOpen(false)}>Close</Button>\n            </div>\n          </div>\n        )}\n\n        {filtered.length === 0 ? (\n          <div className=\"text-sm text-muted-foreground\">No matching records.</div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Stage</TableHead>\n                  <TableHead>Probability</TableHead>\n                  <TableHead>Changed By</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filtered.map((h) => (\n                  <TableRow key={h.id}>\n                    <TableCell>{new Date(h.changed_at).toLocaleString()}</TableCell>\n                    <TableCell>\n                      {(h.old_stage ? stageLabels[h.old_stage] : '-') + '  ' + (h.new_stage ? stageLabels[h.new_stage] : '-')}\n                    </TableCell>\n                    <TableCell>\n                      {(h.old_probability ?? '-') + '  ' + (h.new_probability ?? '-')}\n                    </TableCell>\n                    <TableCell>\n                      {h.changer ? `${h.changer.first_name} ${h.changer.last_name}` : h.changed_by || '-'}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/OpportunityItemsEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[853,856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[853,856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[871,874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[871,874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1366,1369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1366,1369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1895,1898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1895,1898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'db'. Either include it or remove the dependency array.","line":59,"column":6,"nodeType":"ArrayExpression","endLine":59,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [db, opportunityId]","fix":{"range":[2068,2083],"text":"[db, opportunityId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2498,2501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2498,2501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4035,4038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4035,4038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4152,4155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4152,4155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Plus, Trash2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype OppItem = {\n  id?: string;\n  line_number: number;\n  product_name: string;\n  description?: string;\n  quantity: number;\n  unit_price: number;\n  discount_percent?: number;\n  discount_amount?: number;\n  tax_amount?: number;\n  line_total?: number;\n};\n\nexport function OpportunityItemsEditor({ opportunityId }: { opportunityId: string }) {\n  const { supabase } = useCRM();\n  // Cast Supabase to any for new tables not present in generated types\n  const db: any = supabase as any;\n  const [items, setItems] = useState<OppItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n\n  useEffect(() => {\n    const fetchItems = async () => {\n      try {\n        const { data, error } = await db\n          .from('opportunity_items')\n          .select('*')\n          .eq('opportunity_id', opportunityId)\n          .order('line_number', { ascending: true });\n        if (error) throw error;\n        setItems((data || []).map((d: any, idx: number) => ({\n          id: d.id,\n          line_number: d.line_number ?? idx + 1,\n          product_name: d.product_name || '',\n          description: d.description || '',\n          quantity: Number(d.quantity ?? 1),\n          unit_price: Number(d.unit_price ?? 0),\n          discount_percent: Number(d.discount_percent ?? 0),\n          discount_amount: Number(d.discount_amount ?? 0),\n          tax_amount: Number(d.tax_amount ?? 0),\n          line_total: Number(d.line_total ?? 0),\n        })));\n      } catch (err: any) {\n        console.error('Failed to load opportunity items', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    if (opportunityId) fetchItems();\n  }, [opportunityId]);\n\n  const addItem = () => {\n    setItems((prev) => ([\n      ...prev,\n      { line_number: prev.length + 1, product_name: '', quantity: 1, unit_price: 0, discount_percent: 0 },\n    ]));\n  };\n\n  const removeItem = (index: number) => {\n    setItems((prev) => prev.filter((_, i) => i !== index).map((it, i) => ({ ...it, line_number: i + 1 })));\n  };\n\n  const updateItem = (index: number, field: keyof OppItem, value: any) => {\n    setItems((prev) => {\n      const next = [...prev];\n      next[index] = { ...next[index], [field]: value };\n      return next;\n    });\n  };\n\n  const totals = useMemo(() => {\n    const rows = items.map((it) => {\n      const discountPct = Number(it.discount_percent || 0);\n      const lt = Number(it.quantity || 0) * Number(it.unit_price || 0) * (1 - discountPct / 100);\n      return { ...it, line_total: lt };\n    });\n    const subtotal = rows.reduce((sum, r) => sum + (r.line_total || 0), 0);\n    const tax = rows.reduce((sum, r) => sum + Number(r.tax_amount || 0), 0);\n    const total = subtotal + tax;\n    return { rows, subtotal, tax, total };\n  }, [items]);\n\n  const handleSave = async () => {\n    try {\n      setSaving(true);\n      // Replace all items for simplicity\n      const { error: delErr } = await db\n        .from('opportunity_items')\n        .delete()\n        .eq('opportunity_id', opportunityId);\n      if (delErr) throw delErr;\n\n      const payload = totals.rows.map((r) => ({\n        opportunity_id: opportunityId,\n        line_number: r.line_number,\n        product_name: r.product_name,\n        description: r.description || null,\n        quantity: r.quantity,\n        unit_price: r.unit_price,\n        discount_percent: r.discount_percent || 0,\n        discount_amount: r.discount_amount || 0,\n        tax_amount: r.tax_amount || 0,\n        line_total: r.line_total || 0,\n      }));\n\n      if (payload.length > 0) {\n        const { error: insErr } = await db.from('opportunity_items').insert(payload as any[]);\n        if (insErr) throw insErr;\n      }\n\n      toast.success('Opportunity items saved');\n    } catch (err: any) {\n      toast.error('Failed to save items', { description: err.message });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>Opportunity Products</CardTitle>\n          <Button type=\"button\" onClick={addItem} size=\"sm\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Item\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {loading ? (\n          <div className=\"text-sm text-muted-foreground\">Loading items</div>\n        ) : items.length === 0 ? (\n          <div className=\"rounded border p-4\">\n            <p className=\"text-sm text-muted-foreground\">No items yet. Add your first product.</p>\n          </div>\n        ) : (\n          items.map((item, index) => (\n            <div key={index} className=\"border rounded-lg p-4 space-y-4\">\n              <div className=\"flex justify-between items-start\">\n                <span className=\"font-medium\">Item {index + 1}</span>\n                {items.length > 0 && (\n                  <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => removeItem(index)}>\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                )}\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label>Product Name</Label>\n                  <Input value={item.product_name} onChange={(e) => updateItem(index, 'product_name', e.target.value)} placeholder=\"Product Name\" />\n                </div>\n                <div>\n                  <Label>Description</Label>\n                  <Input value={item.description || ''} onChange={(e) => updateItem(index, 'description', e.target.value)} placeholder=\"Description\" />\n                </div>\n                <div>\n                  <Label>Quantity</Label>\n                  <Input type=\"number\" value={item.quantity} onChange={(e) => updateItem(index, 'quantity', parseFloat(e.target.value) || 0)} />\n                </div>\n                <div>\n                  <Label>Unit Price</Label>\n                  <Input type=\"number\" step=\"0.01\" value={item.unit_price} onChange={(e) => updateItem(index, 'unit_price', parseFloat(e.target.value) || 0)} />\n                </div>\n                <div>\n                  <Label>Discount %</Label>\n                  <Input type=\"number\" step=\"0.01\" value={item.discount_percent || 0} onChange={(e) => updateItem(index, 'discount_percent', parseFloat(e.target.value) || 0)} />\n                </div>\n                <div className=\"flex items-end\">\n                  <span className=\"text-sm font-medium\">Line Total: ${((item.quantity || 0) * (item.unit_price || 0) * (1 - (item.discount_percent || 0) / 100)).toFixed(2)}</span>\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n\n        <div className=\"flex items-center justify-between border-t pt-4\">\n          <div className=\"text-sm text-muted-foreground\">Subtotal: ${totals.subtotal.toFixed(2)}  Tax: ${totals.tax.toFixed(2)}</div>\n          <div className=\"font-semibold\">Total: ${totals.total.toFixed(2)}</div>\n        </div>\n\n        <div className=\"flex justify-end gap-2\">\n          <Button variant=\"outline\" disabled={saving} onClick={() => setItems([])}>Clear</Button>\n          <Button onClick={handleSave} disabled={saving}>{saving ? 'Saving' : 'Save Items'}</Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/OpportunitySelectDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[565,568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[565,568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1432,1435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1432,1435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2041,2044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2041,2044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'supabase'. Either include it or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [open, supabase]","fix":{"range":[2222,2228],"text":"[open, supabase]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype OpportunitySelectDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelect: (opportunity: any) => void;\n};\n\nconst stageLabels: Record<string, string> = {\n  prospecting: 'Prospecting',\n  qualification: 'Qualification',\n  needs_analysis: 'Needs Analysis',\n  value_proposition: 'Value Proposition',\n  proposal: 'Proposal',\n  negotiation: 'Negotiation',\n  closed_won: 'Closed Won',\n  closed_lost: 'Closed Lost',\n};\n\nconst stageColors: Record<string, string> = {\n  prospecting: 'bg-slate-500',\n  qualification: 'bg-blue-500',\n  needs_analysis: 'bg-cyan-500',\n  value_proposition: 'bg-indigo-500',\n  proposal: 'bg-purple-500',\n  negotiation: 'bg-orange-500',\n  closed_won: 'bg-green-500',\n  closed_lost: 'bg-red-500',\n};\n\nexport function OpportunitySelectDialog({ open, onOpenChange, onSelect }: OpportunitySelectDialogProps) {\n  const { supabase } = useCRM();\n  const [loading, setLoading] = useState(false);\n  const [opportunities, setOpportunities] = useState<any[]>([]);\n  const [nameQuery, setNameQuery] = useState('');\n  const [accountQuery, setAccountQuery] = useState('');\n\n  useEffect(() => {\n    if (!open) return;\n    const fetchOpportunities = async () => {\n      setLoading(true);\n      try {\n        const { data, error } = await supabase\n          .from('opportunities')\n          .select(`\n            *,\n            accounts:account_id(name),\n            contacts:contact_id(first_name, last_name)\n          `)\n          .order('created_at', { ascending: false });\n        if (error) throw error;\n        setOpportunities(data || []);\n      } catch (err: any) {\n        toast.error('Failed to load opportunities', { description: err.message });\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchOpportunities();\n  }, [open]);\n\n  const filtered = useMemo(() => {\n    return opportunities.filter((o) => {\n      const nameOk = nameQuery ? (o.name || '').toLowerCase().includes(nameQuery.toLowerCase()) : true;\n      const accOk = accountQuery ? (o.accounts?.name || '').toLowerCase().includes(accountQuery.toLowerCase()) : true;\n      return nameOk && accOk;\n    });\n  }, [opportunities, nameQuery, accountQuery]);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-3xl\">\n        <DialogHeader>\n          <DialogTitle>Select Opportunity</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-3\">\n          <div className=\"grid gap-3 md:grid-cols-2\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Search by name</label>\n              <Input placeholder=\"Opportunity name\" value={nameQuery} onChange={(e) => setNameQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Search by account</label>\n              <Input placeholder=\"Account name\" value={accountQuery} onChange={(e) => setAccountQuery(e.target.value)} />\n            </div>\n          </div>\n\n          {loading ? (\n            <div className=\"text-center text-muted-foreground py-8\">Loading opportunities</div>\n          ) : filtered.length === 0 ? (\n            <div className=\"text-center text-muted-foreground py-8\">No opportunities found</div>\n          ) : (\n            <div className=\"grid gap-3 grid-cols-2 md:grid-cols-3\">\n              {filtered.map((o) => (\n                <Card key={o.id} className=\"hover:shadow transition-shadow\">\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-base truncate flex items-center justify-between\">\n                      <span title={o.name}>{o.name}</span>\n                      {o.stage && (\n                        <Badge className={`${stageColors[o.stage] || 'bg-muted'} text-white`}>\n                          {stageLabels[o.stage] || o.stage}\n                        </Badge>\n                      )}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-sm text-muted-foreground truncate\">{o.accounts?.name || '-'}</div>\n                    <div className=\"text-xs text-muted-foreground truncate\">\n                      {o.contacts ? `${o.contacts.first_name} ${o.contacts.last_name}` : '-'}\n                    </div>\n                    <div className=\"mt-3\">\n                      <Button\n                        variant=\"default\"\n                        size=\"sm\"\n                        className=\"w-full\"\n                        onClick={() => {\n                          onSelect(o);\n                          onOpenChange(false);\n                        }}\n                      >\n                        Select\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default OpportunitySelectDialog;","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/OpportunitySelectDialogList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[727,730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[727,730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1606,1609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1606,1609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2511,2514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2511,2514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2764,2767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2764,2767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Table, TableBody, TableCell, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype OpportunitySelectDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelect: (opportunity: any) => void;\n};\n\nconst stageLabels: Record<string, string> = {\n  prospecting: 'Prospecting',\n  qualification: 'Qualification',\n  needs_analysis: 'Needs Analysis',\n  value_proposition: 'Value Proposition',\n  proposal: 'Proposal',\n  negotiation: 'Negotiation',\n  closed_won: 'Closed Won',\n  closed_lost: 'Closed Lost',\n};\n\nconst stageColors: Record<string, string> = {\n  prospecting: 'bg-slate-500',\n  qualification: 'bg-blue-500',\n  needs_analysis: 'bg-cyan-500',\n  value_proposition: 'bg-indigo-500',\n  proposal: 'bg-purple-500',\n  negotiation: 'bg-orange-500',\n  closed_won: 'bg-green-500',\n  closed_lost: 'bg-red-500',\n};\n\nexport default function OpportunitySelectDialogList({ open, onOpenChange, onSelect }: OpportunitySelectDialogProps) {\n  const { supabase } = useCRM();\n  const [loading, setLoading] = useState(false);\n  const [opportunities, setOpportunities] = useState<any[]>([]);\n\n  // Filters aligned with Opportunity form\n  const [nameQuery, setNameQuery] = useState('');\n  const [accountQuery, setAccountQuery] = useState('');\n  const [stageAdv, setStageAdv] = useState<string>('any');\n  const [amountMin, setAmountMin] = useState<string>('');\n  const [amountMax, setAmountMax] = useState<string>('');\n  const [closeStart, setCloseStart] = useState<string>('');\n  const [closeEnd, setCloseEnd] = useState<string>('');\n  const [probMin, setProbMin] = useState<string>('');\n  const [probMax, setProbMax] = useState<string>('');\n  const [leadSource, setLeadSource] = useState<string>('any');\n  const [typeQuery, setTypeQuery] = useState<string>('');\n  const [sort, setSort] = useState<string>('created_desc');\n\n  useEffect(() => {\n    if (!open) return;\n    const fetch = async () => {\n      setLoading(true);\n      try {\n        const { data, error } = await (supabase as any)\n          .from('opportunities')\n          .select('*, accounts(*), contacts(*)')\n          .order('created_at', { ascending: false })\n          .limit(200);\n        if (error) throw error;\n        setOpportunities(data || []);\n      } catch (err: any) {\n        console.error('Load opportunities failed:', err);\n        toast.error('Failed to load opportunities');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetch();\n  }, [open, supabase]);\n\n  const filtered = useMemo(() => {\n    const res = opportunities.filter((o) => {\n      const nameOk = nameQuery ? (o.name || '').toLowerCase().includes(nameQuery.toLowerCase()) : true;\n      const accOk = accountQuery ? (o.accounts?.name || '').toLowerCase().includes(accountQuery.toLowerCase()) : true;\n      const stageOk = stageAdv && stageAdv !== 'any' ? o.stage === stageAdv : true;\n      const amountNum = Number(o.amount) || 0;\n      const amountMinOk = amountMin ? amountNum >= Number(amountMin) : true;\n      const amountMaxOk = amountMax ? amountNum <= Number(amountMax) : true;\n      const closeDate = o.close_date ? new Date(o.close_date) : null;\n      const closeStartOk = closeStart && closeDate ? closeDate >= new Date(closeStart) : !closeStart || !closeDate;\n      const closeEndOk = closeEnd && closeDate ? closeDate <= new Date(closeEnd) : !closeEnd || !closeDate;\n      const probNum = Number(o.probability) || 0;\n      const probMinOk = probMin ? probNum >= Number(probMin) : true;\n      const probMaxOk = probMax ? probNum <= Number(probMax) : true;\n      const leadOk = leadSource && leadSource !== 'any' ? (o.lead_source === leadSource) : true;\n      const typeOk = typeQuery ? (o.type || '').toLowerCase().includes(typeQuery.toLowerCase()) : true;\n      return nameOk && accOk && stageOk && amountMinOk && amountMaxOk && closeStartOk && closeEndOk && probMinOk && probMaxOk && leadOk && typeOk;\n    });\n    res.sort((a, b) => {\n      const dir = sort.endsWith('_desc') ? -1 : 1;\n      if (sort.startsWith('name')) return ((a.name || '').localeCompare(b.name || '')) * dir;\n      if (sort.startsWith('amount')) return ((Number(a.amount) || 0) - (Number(b.amount) || 0)) * dir;\n      if (sort.startsWith('close')) return (((a.close_date ? new Date(a.close_date).getTime() : 0)) - ((b.close_date ? new Date(b.close_date).getTime() : 0))) * dir;\n      if (sort.startsWith('prob')) return ((Number(a.probability) || 0) - (Number(b.probability) || 0)) * dir;\n      if (sort.startsWith('created')) return (((new Date(a.created_at).getTime() || 0)) - ((new Date(b.created_at).getTime() || 0))) * dir;\n      return 0;\n    });\n    return res;\n  }, [opportunities, nameQuery, accountQuery, stageAdv, amountMin, amountMax, closeStart, closeEnd, probMin, probMax, leadSource, typeQuery, sort]);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-5xl\">\n        <DialogHeader>\n          <DialogTitle>Select Opportunity</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-3\">\n          <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-4\">\n            <div className=\"space-y-2\">\n              <Label>Name</Label>\n              <Input placeholder=\"Opportunity name\" value={nameQuery} onChange={(e) => setNameQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Account</Label>\n              <Input placeholder=\"Account name\" value={accountQuery} onChange={(e) => setAccountQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Stage</Label>\n              <Select value={stageAdv} onValueChange={setStageAdv}>\n                <SelectTrigger><SelectValue placeholder=\"Any stage\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"any\">Any</SelectItem>\n                  <SelectItem value=\"prospecting\">Prospecting</SelectItem>\n                  <SelectItem value=\"qualification\">Qualification</SelectItem>\n                  <SelectItem value=\"needs_analysis\">Needs Analysis</SelectItem>\n                  <SelectItem value=\"value_proposition\">Value Proposition</SelectItem>\n                  <SelectItem value=\"proposal\">Proposal</SelectItem>\n                  <SelectItem value=\"negotiation\">Negotiation</SelectItem>\n                  <SelectItem value=\"closed_won\">Closed Won</SelectItem>\n                  <SelectItem value=\"closed_lost\">Closed Lost</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Amount range</Label>\n              <div className=\"flex gap-2\">\n                <Input type=\"number\" placeholder=\"Min\" value={amountMin} onChange={(e) => setAmountMin(e.target.value)} />\n                <Input type=\"number\" placeholder=\"Max\" value={amountMax} onChange={(e) => setAmountMax(e.target.value)} />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Close date range</Label>\n              <div className=\"flex gap-2\">\n                <Input type=\"date\" value={closeStart} onChange={(e) => setCloseStart(e.target.value)} />\n                <Input type=\"date\" value={closeEnd} onChange={(e) => setCloseEnd(e.target.value)} />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Probability %</Label>\n              <div className=\"flex gap-2\">\n                <Input type=\"number\" placeholder=\"Min\" value={probMin} onChange={(e) => setProbMin(e.target.value)} />\n                <Input type=\"number\" placeholder=\"Max\" value={probMax} onChange={(e) => setProbMax(e.target.value)} />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Lead Source</Label>\n              <Select value={leadSource} onValueChange={setLeadSource}>\n                <SelectTrigger><SelectValue placeholder=\"Any\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"any\">Any</SelectItem>\n                  <SelectItem value=\"website\">Website</SelectItem>\n                  <SelectItem value=\"referral\">Referral</SelectItem>\n                  <SelectItem value=\"email\">Email</SelectItem>\n                  <SelectItem value=\"phone\">Phone</SelectItem>\n                  <SelectItem value=\"social\">Social</SelectItem>\n                  <SelectItem value=\"event\">Event</SelectItem>\n                  <SelectItem value=\"other\">Other</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Type</Label>\n              <Input placeholder=\"Type contains\" value={typeQuery} onChange={(e) => setTypeQuery(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Sort</Label>\n              <Select value={sort} onValueChange={setSort}>\n                <SelectTrigger><SelectValue placeholder=\"Sort\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"created_desc\">Newest first</SelectItem>\n                  <SelectItem value=\"created_asc\">Oldest first</SelectItem>\n                  <SelectItem value=\"name_asc\">Name AZ</SelectItem>\n                  <SelectItem value=\"name_desc\">Name ZA</SelectItem>\n                  <SelectItem value=\"amount_desc\">Amount highlow</SelectItem>\n                  <SelectItem value=\"amount_asc\">Amount lowhigh</SelectItem>\n                  <SelectItem value=\"close_desc\">Close date latestearliest</SelectItem>\n                  <SelectItem value=\"close_asc\">Close date earliestlatest</SelectItem>\n                  <SelectItem value=\"prob_desc\">Probability highlow</SelectItem>\n                  <SelectItem value=\"prob_asc\">Probability lowhigh</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {loading ? (\n            <div className=\"text-center text-muted-foreground py-8\">Loading opportunities</div>\n          ) : filtered.length === 0 ? (\n            <div className=\"text-center text-muted-foreground py-8\">No opportunities found</div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableCell className=\"font-medium\">Name</TableCell>\n                    <TableCell className=\"font-medium\">Account</TableCell>\n                    <TableCell className=\"font-medium\">Contact</TableCell>\n                    <TableCell className=\"font-medium\">Stage</TableCell>\n                    <TableCell className=\"font-medium\">Amount</TableCell>\n                    <TableCell className=\"font-medium\">Close Date</TableCell>\n                    <TableCell className=\"font-medium\">Probability</TableCell>\n                    <TableCell className=\"font-medium\">Action</TableCell>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filtered.map((o) => (\n                    <TableRow key={o.id} className=\"hover:bg-muted/50\">\n                      <TableCell className=\"font-medium\">{o.name}</TableCell>\n                      <TableCell>{o.accounts?.name || '-'}</TableCell>\n                      <TableCell>{o.contacts ? `${o.contacts.first_name} ${o.contacts.last_name}` : '-'}</TableCell>\n                      <TableCell>\n                        {o.stage ? (\n                          <Badge className={`${stageColors[o.stage] || 'bg-muted'} text-white`}>{stageLabels[o.stage] || o.stage}</Badge>\n                        ) : '-'}\n                      </TableCell>\n                      <TableCell>{o.amount != null ? new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(Number(o.amount) || 0) : '-'}</TableCell>\n                      <TableCell>{o.close_date ? new Date(o.close_date).toLocaleDateString() : '-'}</TableCell>\n                      <TableCell>{o.probability != null ? `${o.probability}%` : '-'}</TableCell>\n                      <TableCell>\n                        <Button size=\"sm\" onClick={() => { onSelect(o); onOpenChange(false); }}>Select</Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/opportunityHistoryUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/crm/opportunityHistoryUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/dashboard/DashboardHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/dashboard/EmailActivity.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[462,465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[462,465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Mail, Clock } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useNavigate } from \"react-router-dom\";\nimport { formatDistanceToNow } from \"date-fns\";\n\nexport const EmailActivity = () => {\n  const [emails, setEmails] = useState<any[]>([]);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    fetchRecentEmails();\n  }, []);\n\n  const fetchRecentEmails = async () => {\n    try {\n      const { data, error } = await supabase\n        .from(\"emails\")\n        .select(\"*\")\n        .eq(\"folder\", \"inbox\")\n        .order(\"received_at\", { ascending: false })\n        .limit(5);\n\n      if (error) throw error;\n      setEmails(data || []);\n    } catch (error) {\n      console.error(\"Error fetching emails:\", error);\n    }\n  };\n\n  const getEmailType = (fromEmail: string) => {\n    if (fromEmail.includes(\"gov\")) return \"customs\";\n    if (fromEmail.includes(\"carrier\")) return \"carrier\";\n    return \"customer\";\n  };\n\n  const typeColors: Record<string, string> = {\n    customs: \"bg-warning/10 text-warning\",\n    carrier: \"bg-primary/10 text-primary\",\n    customer: \"bg-accent/10 text-accent\"\n  };\n\n  return (\n    <Card className=\"p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-xl font-semibold flex items-center gap-2\">\n          <Mail className=\"w-5 h-5 text-primary\" />\n          Email Activity\n        </h3>\n        <Button \n          variant=\"ghost\" \n          size=\"sm\"\n          onClick={() => navigate(\"/dashboard/email-management\")}\n        >\n          Open Hub\n        </Button>\n      </div>\n\n      <div className=\"space-y-3\">\n        {emails.length === 0 ? (\n          <p className=\"text-sm text-muted-foreground text-center py-4\">\n            No recent emails\n          </p>\n        ) : (\n          emails.map((email) => {\n            const emailType = getEmailType(email.from_email);\n            return (\n              <div \n                key={email.id}\n                className={`p-4 rounded-lg border transition-colors hover:bg-accent/5 cursor-pointer ${\n                  !email.is_read ? 'border-primary/30 bg-primary/5' : 'border-border'\n                }`}\n                onClick={() => navigate(\"/dashboard/email-management\")}\n              >\n                <div className=\"flex items-start justify-between mb-2\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"text-sm font-medium truncate\">\n                        {email.from_name || email.from_email}\n                      </span>\n                      <Badge variant=\"outline\" className={typeColors[emailType]}>\n                        {emailType}\n                      </Badge>\n                    </div>\n                    <div className=\"text-sm font-semibold mb-1 truncate\">{email.subject}</div>\n                    <p className=\"text-xs text-muted-foreground truncate\">{email.snippet}</p>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                  <Clock className=\"w-3 h-3\" />\n                  <span>{formatDistanceToNow(new Date(email.received_at), { addSuffix: true })}</span>\n                </div>\n              </div>\n            );\n          })\n        )}\n      </div>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/dashboard/KanbanDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/dashboard/RecentShipments.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/dashboard/Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/dashboard/StatsCards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailAccountDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[862,865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[862,865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleOAuthCallbackFlow'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [handleOAuthCallbackFlow]","fix":{"range":[1961,1963],"text":"[handleOAuthCallbackFlow]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2712,2715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2712,2715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3482,3485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3482,3485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4276,4279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4276,4279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7255,7258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7255,7258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { initiateGoogleOAuth, initiateMicrosoftOAuth, handleOAuthCallback } from \"@/lib/oauth\";\n\ninterface EmailAccountDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  account?: any;\n  onSuccess: () => void;\n}\n\nexport function EmailAccountDialog({ open, onOpenChange, account, onSuccess }: EmailAccountDialogProps) {\n  const [provider, setProvider] = useState(\"gmail\");\n  const [emailAddress, setEmailAddress] = useState(\"\");\n  const [displayName, setDisplayName] = useState(\"\");\n  const [isPrimary, setIsPrimary] = useState(false);\n  const [smtpHost, setSmtpHost] = useState(\"\");\n  const [smtpPort, setSmtpPort] = useState(\"587\");\n  const [smtpUsername, setSmtpUsername] = useState(\"\");\n  const [smtpPassword, setSmtpPassword] = useState(\"\");\n  const [imapHost, setImapHost] = useState(\"\");\n  const [imapPort, setImapPort] = useState(\"993\");\n  const [imapUsername, setImapUsername] = useState(\"\");\n  const [imapPassword, setImapPassword] = useState(\"\");\n  const [saving, setSaving] = useState(false);\n  const { toast } = useToast();\n  const { context } = useCRM();\n\n  // Handle OAuth callback on component mount\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    if (urlParams.has(\"code\")) {\n      handleOAuthCallbackFlow();\n    }\n  }, []);\n\n  const handleOAuthCallbackFlow = async () => {\n    try {\n      const { code, provider } = await handleOAuthCallback();\n      \n      // Exchange code for tokens via edge function\n      const { data, error } = await supabase.functions.invoke(\"exchange-oauth-token\", {\n        body: {\n          code,\n          provider,\n          userId: context.userId,\n          emailAddress,\n          displayName,\n          isPrimary,\n        },\n      });\n\n      if (error) throw error;\n\n      toast({\n        title: \"Success\",\n        description: \"Email account connected successfully\",\n      });\n\n      // Clean up URL and close dialog\n      window.history.replaceState({}, document.title, window.location.pathname);\n      onSuccess();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleGoogleConnect = async () => {\n    if (!emailAddress) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter your email address first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // Persist hints for callback and for MSA tenant detection\n      sessionStorage.setItem(\"oauth_hint_email\", emailAddress);\n      sessionStorage.setItem(\"oauth_hint_name\", displayName || \"\");\n      sessionStorage.setItem(\"oauth_hint_is_primary\", String(isPrimary));\n      sessionStorage.removeItem(\"oauth_account_id\");\n      await initiateGoogleOAuth(context.userId);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleMicrosoftConnect = async () => {\n    if (!emailAddress) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter your email address first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // Persist hints for callback and for MSA tenant detection in authorize step\n      sessionStorage.setItem(\"oauth_hint_email\", emailAddress);\n      sessionStorage.setItem(\"oauth_hint_name\", displayName || \"\");\n      sessionStorage.setItem(\"oauth_hint_is_primary\", String(isPrimary));\n      sessionStorage.removeItem(\"oauth_account_id\");\n      await initiateMicrosoftOAuth(context.userId);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (account) {\n      setProvider(account.provider);\n      setEmailAddress(account.email_address);\n      setDisplayName(account.display_name || \"\");\n      setIsPrimary(account.is_primary);\n      setSmtpHost(account.smtp_host || \"\");\n      setSmtpPort(String(account.smtp_port || \"587\"));\n      setSmtpUsername(account.smtp_username || \"\");\n      setImapHost(account.imap_host || \"\");\n      setImapPort(String(account.imap_port || \"993\"));\n      setImapUsername(account.imap_username || \"\");\n    } else {\n      resetForm();\n    }\n  }, [account, open]);\n\n  const resetForm = () => {\n    setProvider(\"gmail\");\n    setEmailAddress(\"\");\n    setDisplayName(\"\");\n    setIsPrimary(false);\n    setSmtpHost(\"\");\n    setSmtpPort(\"587\");\n    setSmtpUsername(\"\");\n    setSmtpPassword(\"\");\n    setImapHost(\"\");\n    setImapPort(\"993\");\n    setImapUsername(\"\");\n    setImapPassword(\"\");\n  };\n\n  const handleSave = async () => {\n    if (!emailAddress) {\n      toast({\n        title: \"Error\",\n        description: \"Email address is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (provider === \"smtp_imap\" && (!smtpHost || !imapHost)) {\n      toast({\n        title: \"Error\",\n        description: \"SMTP and IMAP settings are required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const accountData = {\n        user_id: context.userId,\n        tenant_id: context.tenantId,\n        franchise_id: context.franchiseId,\n        provider,\n        email_address: emailAddress,\n        display_name: displayName,\n        is_primary: isPrimary,\n        smtp_host: provider === \"smtp_imap\" ? smtpHost : null,\n        smtp_port: provider === \"smtp_imap\" ? parseInt(smtpPort) : null,\n        smtp_username: provider === \"smtp_imap\" ? smtpUsername : null,\n        smtp_password: provider === \"smtp_imap\" && smtpPassword ? smtpPassword : undefined,\n        imap_host: provider === \"smtp_imap\" ? imapHost : null,\n        imap_port: provider === \"smtp_imap\" ? parseInt(imapPort) : null,\n        imap_username: provider === \"smtp_imap\" ? imapUsername : null,\n        imap_password: provider === \"smtp_imap\" && imapPassword ? imapPassword : undefined,\n      };\n\n      let error;\n      if (account) {\n        const { error: updateError } = await supabase\n          .from(\"email_accounts\")\n          .update(accountData)\n          .eq(\"id\", account.id);\n        error = updateError;\n      } else {\n        const { error: insertError } = await supabase\n          .from(\"email_accounts\")\n          .insert(accountData);\n        error = insertError;\n      }\n\n      if (error) throw error;\n\n      toast({\n        title: \"Success\",\n        description: account ? \"Account updated successfully\" : \"Account added successfully\",\n      });\n\n      onSuccess();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{account ? \"Edit\" : \"Add\"} Email Account</DialogTitle>\n        </DialogHeader>\n\n        <Tabs value={provider} onValueChange={setProvider}>\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"gmail\">Gmail</TabsTrigger>\n            <TabsTrigger value=\"office365\">Office 365</TabsTrigger>\n            <TabsTrigger value=\"smtp_imap\">SMTP/IMAP</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"gmail\" className=\"space-y-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              Connect your Gmail account using OAuth authentication\n            </p>\n            <div className=\"space-y-4\">\n              <div>\n                <Label>Email Address *</Label>\n                <Input\n                  type=\"email\"\n                  placeholder=\"you@gmail.com\"\n                  value={emailAddress}\n                  onChange={(e) => setEmailAddress(e.target.value)}\n                />\n              </div>\n              <div>\n                <Label>Display Name</Label>\n                <Input\n                  placeholder=\"Your Name\"\n                  value={displayName}\n                  onChange={(e) => setDisplayName(e.target.value)}\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={isPrimary} onCheckedChange={setIsPrimary} />\n                <Label>Set as primary account</Label>\n              </div>\n              <Button variant=\"outline\" className=\"w-full\" onClick={handleGoogleConnect}>\n                Connect with Google\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"office365\" className=\"space-y-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              Connect your Office 365 account using OAuth authentication\n            </p>\n            <div className=\"space-y-4\">\n              <div>\n                <Label>Email Address *</Label>\n                <Input\n                  type=\"email\"\n                  placeholder=\"you@company.com\"\n                  value={emailAddress}\n                  onChange={(e) => setEmailAddress(e.target.value)}\n                />\n              </div>\n              <div>\n                <Label>Display Name</Label>\n                <Input\n                  placeholder=\"Your Name\"\n                  value={displayName}\n                  onChange={(e) => setDisplayName(e.target.value)}\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={isPrimary} onCheckedChange={setIsPrimary} />\n                <Label>Set as primary account</Label>\n              </div>\n              <Button variant=\"outline\" className=\"w-full\" onClick={handleMicrosoftConnect}>\n                Connect with Microsoft\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"smtp_imap\" className=\"space-y-4\">\n            <div className=\"rounded-lg border border-yellow-500/50 bg-yellow-500/10 p-4 mb-4\">\n              <p className=\"text-sm text-yellow-600 dark:text-yellow-500 font-medium\">\n                 SMTP/IMAP Limitation: Direct SMTP sending is blocked in cloud environments. This configuration can only receive emails (IMAP). For full send/receive capabilities, use Gmail or Office 365 OAuth above.\n              </p>\n            </div>\n            <div className=\"space-y-4\">\n              <div>\n                <Label>Email Address *</Label>\n                <Input\n                  type=\"email\"\n                  placeholder=\"you@domain.com\"\n                  value={emailAddress}\n                  onChange={(e) => setEmailAddress(e.target.value)}\n                />\n              </div>\n              <div>\n                <Label>Display Name</Label>\n                <Input\n                  placeholder=\"Your Name\"\n                  value={displayName}\n                  onChange={(e) => setDisplayName(e.target.value)}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label>SMTP Host *</Label>\n                  <Input\n                    placeholder=\"smtp.example.com\"\n                    value={smtpHost}\n                    onChange={(e) => setSmtpHost(e.target.value)}\n                  />\n                </div>\n                <div>\n                  <Label>SMTP Port *</Label>\n                  <Input\n                    placeholder=\"587\"\n                    value={smtpPort}\n                    onChange={(e) => setSmtpPort(e.target.value)}\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label>SMTP Username *</Label>\n                <Input\n                  placeholder=\"username\"\n                  value={smtpUsername}\n                  onChange={(e) => setSmtpUsername(e.target.value)}\n                />\n              </div>\n\n              <div>\n                <Label>SMTP Password *</Label>\n                <Input\n                  type=\"password\"\n                  placeholder=\"\"\n                  value={smtpPassword}\n                  onChange={(e) => setSmtpPassword(e.target.value)}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label>IMAP Host *</Label>\n                  <Input\n                    placeholder=\"imap.example.com\"\n                    value={imapHost}\n                    onChange={(e) => setImapHost(e.target.value)}\n                  />\n                </div>\n                <div>\n                  <Label>IMAP Port *</Label>\n                  <Input\n                    placeholder=\"993\"\n                    value={imapPort}\n                    onChange={(e) => setImapPort(e.target.value)}\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label>IMAP Username *</Label>\n                <Input\n                  placeholder=\"username\"\n                  value={imapUsername}\n                  onChange={(e) => setImapUsername(e.target.value)}\n                />\n              </div>\n\n              <div>\n                <Label>IMAP Password *</Label>\n                <Input\n                  type=\"password\"\n                  placeholder=\"\"\n                  value={imapPassword}\n                  onChange={(e) => setImapPassword(e.target.value)}\n                />\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={isPrimary} onCheckedChange={setIsPrimary} />\n                <Label>Set as primary account</Label>\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n\n        <div className=\"flex justify-end gap-2 pt-4\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n            Cancel\n          </Button>\n          <Button onClick={handleSave} disabled={saving}>\n            {saving ? \"Saving...\" : \"Save Account\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailAccounts.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1420,1423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1420,1423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAccounts'. Either include it or remove the dependency array.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccounts]","fix":{"range":[1642,1644],"text":"[fetchAccounts]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2097,2100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2097,2100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2628,2631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2628,2631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2683,2686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2683,2686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2733,2736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2733,2736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3102,3105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3102,3105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3132,3135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3132,3135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3301,3304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3301,3304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4304,4307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4304,4307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Mail, Settings, RefreshCw, Trash2 } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { EmailAccountDialog } from \"./EmailAccountDialog\";\nimport { format } from \"date-fns\";\n\ninterface EmailAccount {\n  id: string;\n  provider: string;\n  email_address: string;\n  display_name: string;\n  is_primary: boolean;\n  is_active: boolean;\n  last_sync_at: string;\n  created_at: string;\n  access_token: string | null;\n  user_id: string;\n}\n\nexport function EmailAccounts() {\n  const [accounts, setAccounts] = useState<EmailAccount[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showDialog, setShowDialog] = useState(false);\n  const [selectedAccount, setSelectedAccount] = useState<EmailAccount | null>(null);\n  const { toast } = useToast();\n\n  const fetchAccounts = async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from(\"email_accounts\")\n        .select(\"*\")\n        .order(\"is_primary\", { ascending: false })\n        .order(\"created_at\", { ascending: false });\n\n      if (error) throw error;\n      setAccounts(data || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchAccounts();\n  }, []);\n\n  const handleDelete = async (accountId: string) => {\n    if (!confirm(\"Are you sure you want to delete this email account?\")) return;\n\n    try {\n      const { error } = await supabase\n        .from(\"email_accounts\")\n        .delete()\n        .eq(\"id\", accountId);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Success\",\n        description: \"Email account deleted successfully\",\n      });\n      fetchAccounts();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const syncAccount = async (accountId: string) => {\n    try {\n      const { data, error } = await supabase.functions.invoke(\"sync-emails\", {\n        body: { accountId },\n      });\n\n      // If edge function returned non-2xx, error is set\n      if (error) {\n        throw new Error(error.message);\n      }\n\n      // If function handled errors itself with success=false\n      if (data && (data as any).success === false) {\n        const msg = (data as any).error || \"Sync failed\";\n        if ((data as any).code === \"AUTH_REQUIRED\") {\n          toast({\n            title: \"Authorization Required\",\n            description: \"Please re-authorize your account using the 'Re-authorize' button below.\",\n            variant: \"destructive\",\n          });\n          fetchAccounts();\n          return;\n        }\n        throw new Error(msg);\n      }\n\n      const count = (data as any)?.syncedCount ?? (data as any)?.emailCount ?? 0;\n      toast({\n        title: \"Sync Complete\",\n        description: `Synced ${count} emails`,\n      });\n      fetchAccounts();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message ?? \"Edge function failed\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleReauthorize = async (account: EmailAccount) => {\n    try {\n      // Store hints for the callback (used when provider doesn't return profile info)\n      sessionStorage.setItem(\"oauth_hint_email\", account.email_address || \"\");\n      sessionStorage.setItem(\"oauth_hint_name\", account.display_name || \"\");\n      sessionStorage.setItem(\"oauth_hint_is_primary\", String(account.is_primary || false));\n      sessionStorage.setItem(\"oauth_account_id\", account.id);\n\n      if (account.provider === 'gmail') {\n        const { initiateGoogleOAuth } = await import('@/lib/oauth');\n        await initiateGoogleOAuth(account.user_id);\n      } else if (account.provider === 'office365') {\n        const { initiateMicrosoftOAuth } = await import('@/lib/oauth');\n        await initiateMicrosoftOAuth(account.user_id);\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getProviderBadge = (provider: string) => {\n    const colors: Record<string, string> = {\n      office365: \"bg-blue-500/10 text-blue-500\",\n      gmail: \"bg-red-500/10 text-red-500\",\n      smtp_imap: \"bg-purple-500/10 text-purple-500\",\n      other: \"bg-foreground/10 text-foreground/80\",\n    };\n    return colors[provider] || colors.other;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header Section */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className=\"space-y-1\">\n          <h2 className=\"text-2xl font-bold tracking-tight\">Connected Accounts</h2>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage and sync your email accounts across multiple providers\n          </p>\n        </div>\n        <Button onClick={() => setShowDialog(true)} size=\"lg\" className=\"gap-2\" aria-label=\"Connect Account\">\n          <Plus className=\"w-4 h-4\" />\n          Connect Account\n        </Button>\n      </div>\n\n      {loading ? (\n        <Card className=\"border-2\">\n          <CardContent className=\"flex items-center justify-center p-12\">\n            <div className=\"text-center space-y-3\">\n              <RefreshCw className=\"w-8 h-8 mx-auto animate-spin text-primary\" />\n              <p className=\"text-muted-foreground\">Loading your accounts...</p>\n            </div>\n          </CardContent>\n        </Card>\n      ) : accounts.length === 0 ? (\n        <Card className=\"border-2 border-dashed\">\n          <CardContent className=\"flex flex-col items-center justify-center p-16\">\n            <div className=\"p-4 rounded-full bg-primary/10 mb-4\">\n              <Mail className=\"w-12 h-12 text-primary\" />\n            </div>\n            <h3 className=\"text-xl font-semibold mb-2\">No Accounts Connected</h3>\n            <p className=\"text-muted-foreground text-center mb-6 max-w-md\">\n              Connect Gmail or Office 365 via OAuth for full email functionality (send & receive). SMTP/IMAP can only receive emails.\n            </p>\n            <Button onClick={() => setShowDialog(true)} size=\"lg\" className=\"gap-2\">\n              <Plus className=\"w-4 h-4\" />\n              Connect Your First Account\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          {accounts.map((account) => (\n            <Card key={account.id} className=\"border-2 hover:shadow-lg transition-shadow duration-200\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start gap-4\">\n                  <div className={`p-3 rounded-lg ${\n                    account.provider === 'gmail' ? 'bg-red-500/10' :\n                    account.provider === 'office365' ? 'bg-blue-500/10' :\n                    'bg-purple-500/10'\n                  }`}>\n                    <Mail className={`w-5 h-5 ${\n                      account.provider === 'gmail' ? 'text-red-500' :\n                      account.provider === 'office365' ? 'text-blue-500' :\n                      'text-purple-500'\n                    }`} />\n                  </div>\n                  <div className=\"flex-1 min-w-0 space-y-2\">\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <CardTitle className=\"text-lg truncate\">\n                        {account.display_name || account.email_address}\n                      </CardTitle>\n                      {account.is_primary && (\n                        <Badge className=\"bg-primary/20 text-primary hover:bg-primary/30\">\n                          Primary\n                        </Badge>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <Badge\n                        variant=\"outline\"\n                        className={`${getProviderBadge(account.provider)} border-0 font-medium`}\n                      >\n                        {account.provider.replace(\"_\", \" \").toUpperCase()}\n                      </Badge>\n                      <Badge \n                        variant=\"outline\"\n                        className={account.is_active \n                          ? \"bg-green-500/10 text-green-600 border-green-200\" \n                          : \"bg-gray-500/10 text-gray-600 border-gray-200\"\n                        }\n                      >\n                        {account.is_active ? \"Active\" : \"Inactive\"}\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground truncate\">\n                      {account.email_address}\n                    </p>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {!account.access_token && (account.provider === 'gmail' || account.provider === 'office365') && (\n                  <div className=\"bg-yellow-500/10 border border-yellow-500/30 rounded-md p-3 mb-2\">\n                    <p className=\"text-xs text-yellow-600 dark:text-yellow-500 font-medium\">\n                       Authorization Required: Click 'Re-authorize' to complete OAuth setup\n                    </p>\n                  </div>\n                )}\n                {account.last_sync_at && (\n                  <div className=\"flex items-center gap-2 text-xs text-muted-foreground bg-muted/50 rounded-md p-2\">\n                    <RefreshCw className=\"w-3 h-3\" />\n                    Last synced: {format(new Date(account.last_sync_at), \"MMM d, yyyy 'at' h:mm a\")}\n                  </div>\n                )}\n                <div className=\"flex gap-2\">\n                  {!account.access_token && (account.provider === 'gmail' || account.provider === 'office365') ? (\n                    <Button\n                      variant=\"default\"\n                      size=\"sm\"\n                      onClick={() => handleReauthorize(account)}\n                      className=\"flex-1\"\n                    >\n                      <RefreshCw className=\"w-3 h-3 mr-2\" />\n                      Re-authorize\n                    </Button>\n                  ) : (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => syncAccount(account.id)}\n                      className=\"flex-1\"\n                    >\n                      <RefreshCw className=\"w-3 h-3 mr-2\" />\n                      Sync\n                    </Button>\n                  )}\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setSelectedAccount(account);\n                      setShowDialog(true);\n                    }}\n                  >\n                    <Settings className=\"w-3 h-3\" />\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleDelete(account.id)}\n                    className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                  >\n                    <Trash2 className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      <EmailAccountDialog\n        open={showDialog}\n        onOpenChange={setShowDialog}\n        account={selectedAccount}\n        onSuccess={() => {\n          setShowDialog(false);\n          setSelectedAccount(null);\n          fetchAccounts();\n        }}\n      />\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailClientSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4801,4804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4801,4804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":170,"column":5,"severity":1,"nodeType":null,"fix":{"range":[5955,6010],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8678,8681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8678,8681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9384,9387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9384,9387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":398,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":398,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16225,16228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16225,16228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":479,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20627,20630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20627,20630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React, { useEffect, useMemo, useState } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport type { Tables, TablesInsert } from \"@/integrations/supabase/types\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { toast } from \"@/components/ui/use-toast\";\n\ntype ProviderPreset = \"gmail\" | \"office365\" | \"yahoo\" | \"zoho\" | \"custom\";\n\ninterface SMTPSettings {\n  host: string;\n  port: number;\n  username: string;\n  password: string;\n  use_tls: boolean;\n}\n\ninterface IMAPSettings {\n  host: string;\n  port: number;\n  username: string;\n  password: string;\n  use_ssl: boolean;\n}\n\ninterface EmailAccountForm {\n  display_name: string;\n  email_address: string;\n  preset: ProviderPreset;\n  smtp: SMTPSettings;\n  imap: IMAPSettings;\n  is_primary: boolean;\n}\n\ntype ClientSettings = {\n  compose_default_font?: string;\n  compose_default_size_pt?: number;\n  compose_ribbon_enabled?: boolean;\n  signature_html?: string;\n};\n\nconst PRESETS: Record<ProviderPreset, { smtp: Partial<SMTPSettings>; imap: Partial<IMAPSettings> }> = {\n  gmail: {\n    smtp: { host: \"smtp.gmail.com\", port: 587, use_tls: true },\n    imap: { host: \"imap.gmail.com\", port: 993, use_ssl: true },\n  },\n  office365: {\n    smtp: { host: \"smtp.office365.com\", port: 587, use_tls: true },\n    imap: { host: \"outlook.office365.com\", port: 993, use_ssl: true },\n  },\n  yahoo: {\n    smtp: { host: \"smtp.mail.yahoo.com\", port: 465, use_tls: true },\n    imap: { host: \"imap.mail.yahoo.com\", port: 993, use_ssl: true },\n  },\n  zoho: {\n    smtp: { host: \"smtp.zoho.com\", port: 587, use_tls: true },\n    imap: { host: \"imap.zoho.com\", port: 993, use_ssl: true },\n  },\n  custom: {\n    smtp: {},\n    imap: {},\n  },\n};\n\ntype DBEmailAccount = {\n  id: string;\n  provider: \"smtp_imap\" | \"gmail\" | \"office365\" | \"other\";\n  email_address: string;\n  display_name: string | null;\n  is_primary: boolean | null;\n  smtp_host: string | null;\n  smtp_port: number | null;\n  smtp_username: string | null;\n  smtp_password: string | null;\n  smtp_use_tls: boolean | null;\n  imap_host: string | null;\n  imap_port: number | null;\n  imap_username: string | null;\n  imap_password: string | null;\n  imap_use_ssl: boolean | null;\n};\n\nfunction emptyForm(): EmailAccountForm {\n  return {\n    display_name: \"\",\n    email_address: \"\",\n    preset: \"gmail\",\n    smtp: { host: \"\", port: 587, username: \"\", password: \"\", use_tls: true },\n    imap: { host: \"\", port: 993, username: \"\", password: \"\", use_ssl: true },\n    is_primary: false,\n  };\n}\n\nexport const EmailClientSettings: React.FC = () => {\n  const { context } = useCRM();\n  type EmailAccountRow = Tables<\"email_accounts\">;\n  const [accounts, setAccounts] = useState<EmailAccountRow[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [testingId, setTestingId] = useState<string | null>(null);\n  const [verification, setVerification] = useState<Record<string, { verified: boolean; method?: string; checkedAt?: string }>>({});\n  const [form, setForm] = useState<EmailAccountForm>(emptyForm());\n  const [targetAccountId, setTargetAccountId] = useState<string | null>(null);\n  const [clientSettings, setClientSettings] = useState<ClientSettings>({\n    compose_default_font: \"Calibri, Segoe UI, Arial, sans-serif\",\n    compose_default_size_pt: 11,\n    compose_ribbon_enabled: true,\n    signature_html: \"\",\n  });\n\n  const canEdit = useMemo(() => !!context?.tenantId || context?.isPlatformAdmin, [context]);\n\n  useEffect(() => {\n    const loadAccounts = async () => {\n      setLoading(true);\n      const query = supabase\n        .from(\"email_accounts\")\n        .select(\"*\")\n        .eq(\"is_active\", true)\n        .order(\"created_at\", { ascending: false });\n\n      const { data, error } = await query;\n      setLoading(false);\n      if (error) {\n        toast({ title: \"Failed to load email accounts\", description: error.message, variant: \"destructive\" });\n        return;\n      }\n      setAccounts((data as EmailAccountRow[]) || []);\n      // Select primary or first account for client settings editing\n      const primary = (data as EmailAccountRow[])?.find((a) => a.is_primary) || (data as EmailAccountRow[])?.[0];\n      setTargetAccountId(primary?.id || null);\n      // Load existing client settings if present\n      const existing = primary as any;\n      const existingSettings = (existing?.settings || {}) as ClientSettings;\n      setClientSettings((prev) => ({\n        compose_default_font: existingSettings.compose_default_font ?? prev.compose_default_font,\n        compose_default_size_pt: existingSettings.compose_default_size_pt ?? prev.compose_default_size_pt,\n        compose_ribbon_enabled: existingSettings.compose_ribbon_enabled ?? prev.compose_ribbon_enabled,\n        signature_html: existingSettings.signature_html ?? prev.signature_html,\n      }));\n    };\n    loadAccounts();\n  }, []);\n\n  useEffect(() => {\n    // Apply preset when changed\n    const presetValues = PRESETS[form.preset];\n    setForm((prev) => ({\n      ...prev,\n      smtp: {\n        ...prev.smtp,\n        host: presetValues.smtp.host ?? prev.smtp.host,\n        port: presetValues.smtp.port ?? prev.smtp.port,\n        use_tls: presetValues.smtp.use_tls ?? prev.smtp.use_tls,\n      },\n      imap: {\n        ...prev.imap,\n        host: presetValues.imap.host ?? prev.imap.host,\n        port: presetValues.imap.port ?? prev.imap.port,\n        use_ssl: presetValues.imap.use_ssl ?? prev.imap.use_ssl,\n      },\n    }));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [form.preset]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setSaving(true);\n\n    const { data: authData, error: userError } = await supabase.auth.getUser();\n    if (userError || !authData?.user) {\n      setSaving(false);\n      toast({ title: \"Not signed in\", description: \"Please sign in to save email settings.\", variant: \"destructive\" });\n      return;\n    }\n    const userId = authData.user.id;\n\n    const payload: TablesInsert<\"email_accounts\"> = {\n      user_id: userId,\n      provider: \"smtp_imap\",\n      email_address: form.email_address,\n      display_name: form.display_name || null,\n      is_primary: form.is_primary,\n      smtp_host: form.smtp.host,\n      smtp_port: form.smtp.port,\n      smtp_username: form.smtp.username,\n      smtp_password: form.smtp.password,\n      smtp_use_tls: form.smtp.use_tls,\n      imap_host: form.imap.host,\n      imap_port: form.imap.port,\n      imap_username: form.imap.username,\n      imap_password: form.imap.password,\n      imap_use_ssl: form.imap.use_ssl,\n      tenant_id: context?.tenantId ?? null,\n      franchise_id: context?.franchiseId ?? null,\n      is_active: true,\n      settings: { preset: form.preset },\n    };\n\n    const { error } = await supabase.from(\"email_accounts\").insert(payload);\n    setSaving(false);\n    if (error) {\n      toast({ title: \"Failed to save account\", description: error.message, variant: \"destructive\" });\n      return;\n    }\n    toast({ title: \"Email account saved\", description: \"SMTP/IMAP settings stored successfully.\" });\n    setForm(emptyForm());\n    // refresh list\n    const { data } = await supabase\n      .from(\"email_accounts\")\n      .select(\"*\")\n      .eq(\"is_active\", true)\n      .order(\"created_at\", { ascending: false });\n    setAccounts((data as EmailAccountRow[]) || []);\n  };\n\n  const sendTestEmail = async (account: EmailAccountRow) => {\n    try {\n      if (String(account.provider) === 'smtp_imap') {\n        toast({\n          title: 'SMTP/IMAP Not Supported',\n          description: 'Direct SMTP/IMAP is blocked in cloud environments. Please use Gmail or Office 365 OAuth connection from the Accounts tab for full email functionality (send & receive).',\n          variant: 'destructive',\n        });\n        return;\n      }\n      setTestingId(account.id as string);\n      const { data, error } = await supabase.functions.invoke(\"send-email\", {\n        body: {\n          accountId: account.id,\n          to: [account.email_address],\n          cc: [],\n          bcc: [],\n          subject: \"Test Email\",\n          body: \"This is a test email to verify configuration.\",\n        },\n      });\n      if (error) throw error as any;\n      const verified = Boolean(data?.verified);\n      const method = typeof data?.verificationMethod === \"string\" ? String(data?.verificationMethod) : undefined;\n      const checkedAt = typeof data?.verificationCheckedAt === \"string\" ? String(data?.verificationCheckedAt) : undefined;\n      setVerification((prev) => ({\n        ...prev,\n        [String(account.id)]: { verified, method, checkedAt },\n      }));\n      toast({\n        title: verified ? \"Test email delivered\" : \"Test email sent\",\n        description: verified\n          ? `Verified delivery to ${account.email_address}`\n          : `Sent to ${account.email_address}. Waiting for provider confirmation...`,\n      });\n    } catch (error: any) {\n      const msg = error?.message || 'Failed to send test';\n      toast({ title: \"Failed to send test\", description: msg, variant: \"destructive\" });\n    } finally {\n      setTestingId(null);\n    }\n  };\n\n  const mask = (v?: string | null) => (v ? \"\" : \"\");\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>SMTP/IMAP Email Client</CardTitle>\n          <CardDescription>Configure Gmail, Outlook, and other providers using direct SMTP/IMAP.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>Provider preset</Label>\n                <Select value={form.preset} onValueChange={(v) => setForm((f) => ({ ...f, preset: v as ProviderPreset }))}>\n                  <SelectTrigger><SelectValue placeholder=\"Select provider\" /></SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"gmail\">Gmail</SelectItem>\n                    <SelectItem value=\"office365\">Outlook (Office365)</SelectItem>\n                    <SelectItem value=\"yahoo\">Yahoo</SelectItem>\n                    <SelectItem value=\"zoho\">Zoho</SelectItem>\n                    <SelectItem value=\"custom\">Custom</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Display name</Label>\n                <Input\n                  value={form.display_name}\n                  onChange={(e) => setForm((f) => ({ ...f, display_name: e.target.value }))}\n                  placeholder=\"e.g. Sales Team\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Email address</Label>\n                <Input\n                  type=\"email\"\n                  value={form.email_address}\n                  onChange={(e) => setForm((f) => ({ ...f, email_address: e.target.value }))}\n                  placeholder=\"name@domain.com\"\n                  required\n                />\n              </div>\n\n              <div className=\"flex items-center gap-3\">\n                <Switch checked={form.is_primary} onCheckedChange={(v) => setForm((f) => ({ ...f, is_primary: v }))} />\n                <Label>Set as primary sending account</Label>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>SMTP host</Label>\n                <Input value={form.smtp.host} onChange={(e) => setForm((f) => ({ ...f, smtp: { ...f.smtp, host: e.target.value } }))} placeholder=\"smtp.example.com\" required />\n              </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-2\">\n                  <Label>SMTP port</Label>\n                  <Input type=\"number\" value={form.smtp.port} onChange={(e) => setForm((f) => ({ ...f, smtp: { ...f.smtp, port: Number(e.target.value) } }))} />\n                </div>\n                <div className=\"flex items-center gap-3 pt-6\">\n                  <Switch checked={form.smtp.use_tls} onCheckedChange={(v) => setForm((f) => ({ ...f, smtp: { ...f.smtp, use_tls: v } }))} />\n                  <Label>Use TLS</Label>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-2\">\n                  <Label>SMTP username</Label>\n                  <Input value={form.smtp.username} onChange={(e) => setForm((f) => ({ ...f, smtp: { ...f.smtp, username: e.target.value } }))} />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>SMTP password</Label>\n                  <Input type=\"password\" value={form.smtp.password} onChange={(e) => setForm((f) => ({ ...f, smtp: { ...f.smtp, password: e.target.value } }))} />\n                </div>\n              </div>\n\n              <Separator className=\"my-4\" />\n\n              <div className=\"space-y-2\">\n                <Label>IMAP host</Label>\n                <Input value={form.imap.host} onChange={(e) => setForm((f) => ({ ...f, imap: { ...f.imap, host: e.target.value } }))} placeholder=\"imap.example.com\" required />\n              </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-2\">\n                  <Label>IMAP port</Label>\n                  <Input type=\"number\" value={form.imap.port} onChange={(e) => setForm((f) => ({ ...f, imap: { ...f.imap, port: Number(e.target.value) } }))} />\n                </div>\n                <div className=\"flex items-center gap-3 pt-6\">\n                  <Switch checked={form.imap.use_ssl} onCheckedChange={(v) => setForm((f) => ({ ...f, imap: { ...f.imap, use_ssl: v } }))} />\n                  <Label>Use SSL</Label>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-2\">\n                  <Label>IMAP username</Label>\n                  <Input value={form.imap.username} onChange={(e) => setForm((f) => ({ ...f, imap: { ...f.imap, username: e.target.value } }))} />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>IMAP password</Label>\n                  <Input type=\"password\" value={form.imap.password} onChange={(e) => setForm((f) => ({ ...f, imap: { ...f.imap, password: e.target.value } }))} />\n                </div>\n              </div>\n\n              <div className=\"flex gap-3 pt-2\">\n                <Button type=\"submit\" disabled={!canEdit || saving}>{saving ? \"Saving...\" : \"Save Settings\"}</Button>\n                <Button type=\"button\" variant=\"secondary\" onClick={() => setForm(emptyForm())}>Reset</Button>\n              </div>\n              {!canEdit && (\n                <p className=\"text-sm text-muted-foreground\">You need a tenant or platform admin role to edit settings.</p>\n              )}\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Outlook Client Defaults</CardTitle>\n          <CardDescription>Set default compose font, size, ribbon, and signature.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {accounts.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">Add or connect an account to configure client defaults.</p>\n          ) : (\n            <>\n              <div className=\"space-y-2\">\n                <Label>Apply to Account</Label>\n                <Select value={targetAccountId ?? \"\"} onValueChange={(v) => {\n                  setTargetAccountId(v);\n                  const acc = accounts.find((a) => a.id === v) as any;\n                  const s = (acc?.settings || {}) as ClientSettings;\n                  setClientSettings({\n                    compose_default_font: s.compose_default_font ?? \"Calibri, Segoe UI, Arial, sans-serif\",\n                    compose_default_size_pt: s.compose_default_size_pt ?? 11,\n                    compose_ribbon_enabled: s.compose_ribbon_enabled ?? true,\n                    signature_html: s.signature_html ?? \"\",\n                  });\n                }}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select account\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {accounts.map((a) => (\n                      <SelectItem key={a.id} value={a.id as string}>\n                        {(a.display_name || a.email_address) + (a.is_primary ? \" (Primary)\" : \"\")}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>Default Font</Label>\n                  <Select value={clientSettings.compose_default_font || \"Calibri, Segoe UI, Arial, sans-serif\"} onValueChange={(v) => setClientSettings((s) => ({ ...s, compose_default_font: v }))}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select font\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Calibri, Segoe UI, Arial, sans-serif\">Calibri</SelectItem>\n                      <SelectItem value=\"Segoe UI, Calibri, Arial, sans-serif\">Segoe UI</SelectItem>\n                      <SelectItem value=\"Arial, Helvetica, sans-serif\">Arial</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Default Size (pt)</Label>\n                  <Select value={String(clientSettings.compose_default_size_pt ?? 11)} onValueChange={(v) => setClientSettings((s) => ({ ...s, compose_default_size_pt: Number(v) }))}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select size\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"10\">10</SelectItem>\n                      <SelectItem value=\"11\">11</SelectItem>\n                      <SelectItem value=\"12\">12</SelectItem>\n                      <SelectItem value=\"14\">14</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-3\">\n                <Switch checked={clientSettings.compose_ribbon_enabled ?? true} onCheckedChange={(v) => setClientSettings((s) => ({ ...s, compose_ribbon_enabled: v }))} />\n                <Label>Enable Outlook-style compose ribbon</Label>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Default Signature (HTML allowed)</Label>\n                <Textarea value={clientSettings.signature_html || \"\"} onChange={(e) => setClientSettings((s) => ({ ...s, signature_html: e.target.value }))} placeholder=\"Enter signature HTML or plain text\" rows={4} />\n              </div>\n\n              <div>\n                <Button\n                  disabled={!targetAccountId}\n                  onClick={async () => {\n                    if (!targetAccountId) return;\n                    try {\n                      const { error } = await supabase\n                        .from(\"email_accounts\")\n                        .update({ settings: clientSettings })\n                        .eq(\"id\", targetAccountId);\n                      if (error) throw error;\n                      toast({ title: \"Client defaults saved\", description: \"Outlook-style settings applied to selected account.\" });\n                      // Refresh accounts to reflect settings\n                      const { data } = await supabase\n                        .from(\"email_accounts\")\n                        .select(\"*\")\n                        .eq(\"is_active\", true)\n                        .order(\"created_at\", { ascending: false });\n                      setAccounts((data as EmailAccountRow[]) || []);\n                    } catch (err: any) {\n                      toast({ title: \"Failed to save defaults\", description: err.message, variant: \"destructive\" });\n                    }\n                  }}\n                >\n                  Save Client Defaults\n                </Button>\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Configured Accounts</CardTitle>\n          <CardDescription>Active SMTP/IMAP accounts available for sending and syncing.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {loading ? (\n            <p className=\"text-sm text-muted-foreground\">Loading accounts...</p>\n          ) : accounts.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">No SMTP/IMAP accounts configured yet.</p>\n          ) : (\n            <div className=\"space-y-3\">\n              {accounts.map((a) => (\n                <div key={a.id} className=\"rounded border px-3 py-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">{a.display_name || a.email_address}</p>\n                      <p className=\"text-sm text-muted-foreground\">{a.email_address}  {a.provider}</p>\n                    </div>\n                    <div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        disabled={testingId === (a.id as string)}\n                        onClick={() => sendTestEmail(a)}\n                      >\n                        {testingId === (a.id as string) ? \"Sending...\" : \"Send Test Email\"}\n                      </Button>\n                    </div>\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 text-sm\">\n                  <div>\n                    <span className=\"font-medium\">SMTP</span>\n                    <div className=\"text-muted-foreground\">{a.smtp_host}:{a.smtp_port}  TLS {String(a.smtp_use_tls)}</div>\n                    <div className=\"text-muted-foreground\">{a.smtp_username} / {mask(a.smtp_password)}</div>\n                  </div>\n                  <div>\n                    <span className=\"font-medium\">IMAP</span>\n                    <div className=\"text-muted-foreground\">{a.imap_host}:{a.imap_port}  SSL {String(a.imap_use_ssl)}</div>\n                    <div className=\"text-muted-foreground\">{a.imap_username} / {mask(a.imap_password)}</div>\n                  </div>\n                </div>\n                {verification[String(a.id)] && (\n                  <div className=\"mt-2 rounded bg-muted p-2 text-sm\">\n                    <div className=\"font-medium\">Verification Details</div>\n                    <div className=\"text-muted-foreground\">\n                      Method: {verification[String(a.id)].method || \"\"}\n                    </div>\n                    <div className=\"text-muted-foreground\">\n                      Checked: {verification[String(a.id)].checkedAt ? new Date(verification[String(a.id)].checkedAt!).toLocaleString() : \"\"}\n                    </div>\n                    <div className={verification[String(a.id)].verified ? \"text-green-600\" : \"text-amber-600\"}>\n                      Status: {verification[String(a.id)].verified ? \"Delivered (verified)\" : \"Sent (not yet verified)\"}\n                    </div>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default EmailClientSettings;","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailComposeDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1053,1056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1053,1056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'body', 'editorHtml', 'editorRef', and 'fetchAccounts'. Either include them or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [body, editorHtml, editorRef, fetchAccounts, open, replyTo]","fix":{"range":[2439,2454],"text":"[body, editorHtml, editorRef, fetchAccounts, open, replyTo]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2653,2656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2653,2656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":88,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":88,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3659,3659],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'body', 'editorHtml', and 'editorRef'. Either include them or remove the dependency array.","line":89,"column":6,"nodeType":"ArrayExpression","endLine":89,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [selectedAccount, accounts, editorRef, editorHtml, body]","fix":{"range":[3666,3693],"text":"[selectedAccount, accounts, editorRef, editorHtml, body]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4065,4068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4065,4068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4235,4238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4235,4238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5383,5386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5383,5386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":149,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":149,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5603,5603],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5827,5830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5827,5830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":183,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":183,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6243,6243],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\n// import { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Send, Paperclip, X, Bold, Italic, Underline, List, ListOrdered, AlignLeft, AlignCenter, AlignRight, Link as LinkIcon, Eraser } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCRM } from \"@/hooks/useCRM\";\n\ninterface EmailComposeDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  replyTo?: {\n    to: string;\n    subject: string;\n    body?: string;\n  };\n}\n\nexport function EmailComposeDialog({ open, onOpenChange, replyTo }: EmailComposeDialogProps) {\n  const [accounts, setAccounts] = useState<any[]>([]);\n  const [selectedAccount, setSelectedAccount] = useState(\"\");\n  const [to, setTo] = useState(replyTo?.to || \"\");\n  const [cc, setCc] = useState(\"\");\n  const [subject, setSubject] = useState(replyTo?.subject || \"\");\n  const [body, setBody] = useState(replyTo?.body || \"\");\n  const [editorHtml, setEditorHtml] = useState<string>(\"\");\n  const editorRef = { current: null as HTMLDivElement | null };\n  const [sending, setSending] = useState(false);\n  const { toast } = useToast();\n  const { context } = useCRM();\n  const [composeDefaults, setComposeDefaults] = useState<{ font?: string; sizePt?: number; ribbon?: boolean; signatureHtml?: string }>({\n    font: \"Calibri, Segoe UI, Arial, sans-serif\",\n    sizePt: 11,\n    ribbon: true,\n    signatureHtml: \"\",\n  });\n\n  useEffect(() => {\n    if (open) {\n      fetchAccounts();\n      if (replyTo) {\n        setTo(replyTo.to);\n        setSubject(replyTo.subject.startsWith(\"Re:\") ? replyTo.subject : `Re: ${replyTo.subject}`);\n        if (replyTo.body) {\n          setBody(`\\n\\n--- Original Message ---\\n${replyTo.body}`);\n          setEditorHtml(plainToHtml(`\\n\\n--- Original Message ---\\n${replyTo.body}`));\n        }\n      }\n      // Initialize editor content\n      setTimeout(() => {\n        if (editorRef.current) {\n          editorRef.current.innerHTML = editorHtml || plainToHtml(body || \"\");\n        }\n      }, 0);\n    }\n  }, [open, replyTo]);\n\n  useEffect(() => {\n    // Apply compose defaults when account changes\n    try {\n      const acc = accounts.find((a) => a.id === selectedAccount);\n      const settings = (acc?.settings || {}) as any;\n      const nextDefaults = {\n        font: settings.compose_default_font || \"Calibri, Segoe UI, Arial, sans-serif\",\n        sizePt: settings.compose_default_size_pt || 11,\n        ribbon: settings.compose_ribbon_enabled !== false,\n        signatureHtml: settings.signature_html || \"\",\n      };\n      setComposeDefaults(nextDefaults);\n      // Apply styles to editor\n      if (editorRef.current) {\n        editorRef.current.style.fontFamily = nextDefaults.font as string;\n        editorRef.current.style.fontSize = `${nextDefaults.sizePt}pt`;\n        // Initialize with signature if empty\n        const current = editorRef.current.innerHTML?.trim();\n        if (!current) {\n          const baseHtml = editorHtml || plainToHtml(body || \"\");\n          editorRef.current.innerHTML = nextDefaults.signatureHtml\n            ? `${baseHtml}${baseHtml ? '<br><br>' : ''}${nextDefaults.signatureHtml}`\n            : baseHtml;\n          setEditorHtml(editorRef.current.innerHTML);\n        }\n      }\n    } catch {}\n  }, [selectedAccount, accounts]);\n\n  const fetchAccounts = async () => {\n    try {\n      const { data, error } = await supabase\n        .from(\"email_accounts\")\n        .select(\"*\")\n        .eq(\"is_active\", true)\n        .order(\"is_primary\", { ascending: false });\n\n      if (error) throw error;\n      setAccounts(data || []);\n      if (data && data.length > 0) {\n        const connected = data.find((a: any) => (a.provider === \"gmail\" ? (a.access_token || a.refresh_token) : true));\n        setSelectedAccount((connected || data[0])?.id || \"\");\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleSend = async () => {\n    if (!selectedAccount || !to || !subject) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSending(true);\n    try {\n      const selected = accounts.find((a) => a.id === selectedAccount);\n      if (selected?.provider === \"gmail\" && !selected?.access_token && !selected?.refresh_token) {\n        throw new Error(\"Selected Gmail account is not connected. Please connect it in Accounts.\");\n      }\n\n      // Call edge function to send email\n      const { data, error } = await supabase.functions.invoke(\"send-email\", {\n        body: {\n          accountId: selectedAccount,\n          to: to.split(\",\").map(e => e.trim()),\n          cc: cc ? cc.split(\",\").map(e => e.trim()) : [],\n          subject,\n          body: editorHtml || plainToHtml(body),\n        },\n      });\n\n      if (error) {\n        let description = error.message;\n        const ctx = (error as any)?.context;\n        if (ctx) {\n          try {\n            const parsed = typeof ctx === 'string' ? JSON.parse(ctx) : ctx;\n            description = parsed?.error || parsed?.message || description;\n          } catch {}\n        }\n        throw new Error(description);\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Email sent successfully\",\n      });\n\n      onOpenChange(false);\n      resetForm();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const resetForm = () => {\n    setTo(\"\");\n    setCc(\"\");\n    setSubject(\"\");\n    setBody(\"\");\n    setEditorHtml(\"\");\n  };\n\n  const exec = (cmd: string, val?: string) => {\n    try {\n      document.execCommand(cmd, false, val);\n    } catch {}\n  };\n\n  const applyLink = () => {\n    const url = prompt(\"Enter URL:\");\n    if (url) exec(\"createLink\", url);\n  };\n\n  const clearFormatting = () => {\n    exec(\"removeFormat\");\n  };\n\n  const plainToHtml = (text: string) => {\n    const esc = (s: string) => s.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n    return esc(text).replace(/\\n/g, \"<br>\");\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto font-outlook\">\n        <DialogHeader>\n          <DialogTitle>Compose Email</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          <div>\n            <Label>From</Label>\n            <Select value={selectedAccount} onValueChange={setSelectedAccount}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select email account\" />\n              </SelectTrigger>\n              <SelectContent>\n                {accounts.map((account) => (\n                  <SelectItem key={account.id} value={account.id}>\n                    {account.display_name || account.email_address}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label>To *</Label>\n            <Input\n              placeholder=\"recipient@example.com (comma separated for multiple)\"\n              value={to}\n              onChange={(e) => setTo(e.target.value)}\n            />\n          </div>\n\n          <div>\n            <Label>CC</Label>\n            <Input\n              placeholder=\"cc@example.com (comma separated for multiple)\"\n              value={cc}\n              onChange={(e) => setCc(e.target.value)}\n            />\n          </div>\n\n          <div>\n            <Label>Subject *</Label>\n            <Input\n              placeholder=\"Email subject\"\n              value={subject}\n              onChange={(e) => setSubject(e.target.value)}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label>Message</Label>\n            {composeDefaults.ribbon && (\n            <div className=\"flex flex-wrap items-center gap-1\">\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"bold\")}> <Bold className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"italic\")}> <Italic className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"underline\")}> <Underline className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"insertUnorderedList\")}> <List className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"insertOrderedList\")}> <ListOrdered className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"justifyLeft\")}> <AlignLeft className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"justifyCenter\")}> <AlignCenter className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => exec(\"justifyRight\")}> <AlignRight className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={applyLink}> <LinkIcon className=\"w-4 h-4\" /> </Button>\n              <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={clearFormatting}> <Eraser className=\"w-4 h-4\" /> </Button>\n            </div>\n            )}\n            <div\n              ref={(el) => { editorRef.current = el; }}\n              contentEditable\n              className=\"min-h-[200px] border rounded-md p-3 font-outlook focus:outline-none\"\n              onInput={(e) => setEditorHtml((e.target as HTMLDivElement).innerHTML)}\n              style={{ whiteSpace: \"pre-wrap\" }}\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between pt-4\">\n            <Button variant=\"outline\" size=\"sm\">\n              <Paperclip className=\"w-4 h-4 mr-2\" />\n              Attach File\n            </Button>\n\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n                Cancel\n              </Button>\n              <Button onClick={handleSend} disabled={sending}>\n                <Send className=\"w-4 h-4 mr-2\" />\n                {sending ? \"Sending...\" : \"Send\"}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailDetailDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[729,732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[729,732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5885,5888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5885,5888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Reply, Forward, Archive, Trash2, Star, Paperclip, MoreHorizontal, ChevronUp, Maximize2, Minimize2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useState } from \"react\";\nimport { EmailComposeDialog } from \"./EmailComposeDialog\";\n\ninterface Email {\n  id: string;\n  subject: string;\n  from_email: string;\n  from_name: string;\n  body_text?: string;\n  body_html?: string;\n  received_at: string;\n  is_starred: boolean;\n  has_attachments: boolean;\n  attachments?: any[];\n  labels?: string[];\n}\n\ninterface EmailDetailDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  email: Email;\n  onRefresh: () => void;\n}\n\nexport function EmailDetailDialog({ open, onOpenChange, email, onRefresh }: EmailDetailDialogProps) {\n  const [showReply, setShowReply] = useState(false);\n  const [showFullBody, setShowFullBody] = useState(false);\n  const [showFullDetails, setShowFullDetails] = useState(false);\n  const [expanded, setExpanded] = useState(false);\n  const clampStyle = showFullBody\n    ? {}\n    : {\n        display: \"-webkit-box\",\n        WebkitLineClamp: 3,\n        WebkitBoxOrient: \"vertical\" as const,\n        overflow: \"hidden\",\n      };\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent\n          className={`${expanded ? \"max-w-[95vw] max-h-[95vh]\" : \"max-w-4xl max-h-[85vh]\"} overflow-auto min-w-[320px] min-h-[320px] font-outlook`}\n          style={{ resize: \"both\" }}\n        >\n          <DialogHeader>\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <DialogTitle className=\"text-2xl mb-2 break-words overflow-x-hidden\">{email.subject}</DialogTitle>\n                <div className=\"flex items-center gap-2 flex-wrap text-sm text-muted-foreground\">\n                  <span className=\"font-medium\">{email.from_name || email.from_email}</span>\n                  <span></span>\n                  <span>{format(new Date(email.received_at), \"MMM d, yyyy 'at' h:mm a\")}</span>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setExpanded((v) => !v)} title={expanded ? \"Reduce view size\" : \"Enlarge view area\"}>\n                  {expanded ? <Minimize2 className=\"w-4 h-4\" /> : <Maximize2 className=\"w-4 h-4\" />}\n                </Button>\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Star className={`w-4 h-4 ${email.is_starred ? \"fill-warning text-warning\" : \"\"}`} />\n                </Button>\n              </div>\n            </div>\n          </DialogHeader>\n\n          <Separator />\n\n          {email.labels && email.labels.length > 0 && (\n            <div className={showFullDetails ? \"flex gap-2 flex-wrap\" : \"relative max-h-12 overflow-hidden\"}>\n              <div className=\"flex gap-2 flex-wrap\">\n                {email.labels.map((label, idx) => (\n                  <Badge key={idx} variant=\"outline\">\n                    {label}\n                  </Badge>\n                ))}\n              </div>\n              {!showFullDetails && (\n                <div className=\"absolute inset-x-0 bottom-0 h-8 bg-gradient-to-t from-background to-transparent\" />\n              )}\n            </div>\n          )}\n\n          {email.labels && email.labels.length > 6 && (\n            <div className=\"mt-2 flex justify-end\">\n              {showFullDetails ? (\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullDetails(false)}>\n                  <ChevronUp className=\"w-4 h-4\" />\n                </Button>\n              ) : (\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullDetails(true)}>\n                  <MoreHorizontal className=\"w-4 h-4\" />\n                </Button>\n              )}\n            </div>\n          )}\n\n          <div className={showFullBody ? \"email-content prose prose-sm max-w-none break-words overflow-x-hidden\" : \"email-content prose prose-sm max-w-none break-words overflow-x-hidden relative\"}>\n            {email.body_html ? (\n              <div style={clampStyle} dangerouslySetInnerHTML={{ __html: email.body_html }} />\n            ) : showFullBody ? (\n              <pre className=\"whitespace-pre-wrap font-sans break-words overflow-x-hidden\">{email.body_text}</pre>\n            ) : (\n              <div className=\"font-sans\" style={{ whiteSpace: \"pre-wrap\", ...clampStyle }}>\n                {email.body_text}\n              </div>\n            )}\n            {!showFullBody && (\n              <div className=\"absolute inset-x-0 bottom-0 h-8 bg-gradient-to-t from-background to-transparent\" />\n            )}\n          </div>\n\n          <div className=\"mt-2 flex justify-end\">\n            {showFullBody ? (\n              <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullBody(false)}>\n                <ChevronUp className=\"w-4 h-4\" />\n              </Button>\n            ) : (\n              <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullBody(true)}>\n                <MoreHorizontal className=\"w-4 h-4\" />\n              </Button>\n            )}\n          </div>\n\n          {email.has_attachments && email.attachments && email.attachments.length > 0 && (\n            <>\n              <Separator />\n              <div className=\"space-y-2\">\n                <h4 className=\"font-semibold text-sm flex items-center gap-2\">\n                  <Paperclip className=\"w-4 h-4\" />\n                  Attachments ({email.attachments.length})\n                </h4>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {email.attachments.map((attachment: any, idx: number) => (\n                    <div key={idx} className=\"flex items-center gap-2 p-2 border rounded-lg\">\n                      <Paperclip className=\"w-4 h-4 text-muted-foreground\" />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate\">{attachment.name}</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {(attachment.size / 1024).toFixed(1)} KB\n                        </p>\n                      </div>\n                      <Button variant=\"ghost\" size=\"sm\">Download</Button>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </>\n          )}\n\n          <Separator />\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex gap-2\">\n              <Button onClick={() => setShowReply(true)}>\n                <Reply className=\"w-4 h-4 mr-2\" />\n                Reply\n              </Button>\n              <Button variant=\"outline\">\n                <Forward className=\"w-4 h-4 mr-2\" />\n                Forward\n              </Button>\n            </div>\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" size=\"sm\">\n                <Archive className=\"w-4 h-4 mr-2\" />\n                Archive\n              </Button>\n              <Button variant=\"outline\" size=\"sm\">\n                <Trash2 className=\"w-4 h-4 mr-2\" />\n                Delete\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <EmailComposeDialog\n        open={showReply}\n        onOpenChange={setShowReply}\n        replyTo={{\n          to: email.from_email,\n          subject: email.subject,\n          body: email.body_text,\n        }}\n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailDetailView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[616,619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[616,619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4722,4725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4722,4725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Reply, Forward, Archive, Trash2, Star, Paperclip, MoreHorizontal, ChevronUp } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useState } from \"react\";\nimport { EmailComposeDialog } from \"./EmailComposeDialog\";\n\ninterface Email {\n  id: string;\n  subject: string;\n  from_email: string;\n  from_name: string;\n  body_text?: string;\n  body_html?: string;\n  received_at: string;\n  is_starred: boolean;\n  has_attachments: boolean;\n  attachments?: any[];\n  labels?: string[];\n}\n\ninterface EmailDetailViewProps {\n  email: Email;\n}\n\nexport function EmailDetailView({ email }: EmailDetailViewProps) {\n  const [showReply, setShowReply] = useState(false);\n  const [showFullBody, setShowFullBody] = useState(false);\n  const [showFullDetails, setShowFullDetails] = useState(false);\n\n  const clampStyle = showFullBody\n    ? {}\n    : {\n        display: \"-webkit-box\",\n        WebkitLineClamp: 3,\n        WebkitBoxOrient: \"vertical\" as const,\n        overflow: \"hidden\",\n      };\n\n  return (\n    <div className=\"h-full w-full overflow-auto p-4\">\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex-1\">\n          <h2 className=\"text-2xl mb-2 break-words overflow-x-hidden\">{email.subject}</h2>\n          <div className=\"flex items-center gap-2 flex-wrap text-sm text-muted-foreground\">\n            <span className=\"font-medium\">{email.from_name || email.from_email}</span>\n            <span></span>\n            <span>{format(new Date(email.received_at), \"MMM d, yyyy 'at' h:mm a\")}</span>\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button variant=\"ghost\" size=\"sm\">\n            <Star className={`w-4 h-4 ${email.is_starred ? \"fill-warning text-warning\" : \"\"}`} />\n          </Button>\n        </div>\n      </div>\n\n      <Separator className=\"my-3\" />\n\n      {email.labels && email.labels.length > 0 && (\n        <div className={showFullDetails ? \"flex gap-2 flex-wrap\" : \"relative max-h-12 overflow-hidden\"}>\n          <div className=\"flex gap-2 flex-wrap\">\n            {email.labels.map((label, idx) => (\n              <Badge key={idx} variant=\"outline\">\n                {label}\n              </Badge>\n            ))}\n          </div>\n          {!showFullDetails && (\n            <div className=\"absolute inset-x-0 bottom-0 h-8 bg-gradient-to-t from-background to-transparent\" />\n          )}\n        </div>\n      )}\n\n      {email.labels && email.labels.length > 6 && (\n        <div className=\"mt-2 flex justify-end\">\n          {showFullDetails ? (\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullDetails(false)}>\n              <ChevronUp className=\"w-4 h-4\" />\n            </Button>\n          ) : (\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullDetails(true)}>\n              <MoreHorizontal className=\"w-4 h-4\" />\n            </Button>\n          )}\n        </div>\n      )}\n\n      <div className={showFullBody ? \"email-content prose prose-sm max-w-none break-words overflow-x-hidden\" : \"email-content prose prose-sm max-w-none break-words overflow-x-hidden relative\"}>\n        {email.body_html ? (\n          <div style={clampStyle} dangerouslySetInnerHTML={{ __html: email.body_html }} />\n        ) : showFullBody ? (\n          <pre className=\"whitespace-pre-wrap font-sans break-words overflow-x-hidden\">{email.body_text}</pre>\n        ) : (\n          <div className=\"font-sans\" style={{ whiteSpace: \"pre-wrap\", ...clampStyle }}>\n            {email.body_text}\n          </div>\n        )}\n        {!showFullBody && (\n          <div className=\"absolute inset-x-0 bottom-0 h-8 bg-gradient-to-t from-background to-transparent\" />\n        )}\n      </div>\n\n      <div className=\"mt-2 flex justify-end\">\n        {showFullBody ? (\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullBody(false)}>\n            <ChevronUp className=\"w-4 h-4\" />\n          </Button>\n        ) : (\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowFullBody(true)}>\n            <MoreHorizontal className=\"w-4 h-4\" />\n          </Button>\n        )}\n      </div>\n\n      {email.has_attachments && email.attachments && email.attachments.length > 0 && (\n        <>\n          <Separator className=\"my-3\" />\n          <div className=\"space-y-2\">\n            <h4 className=\"font-semibold text-sm flex items-center gap-2\">\n              <Paperclip className=\"w-4 h-4\" />\n              Attachments ({email.attachments.length})\n            </h4>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {email.attachments.map((attachment: any, idx: number) => (\n                <div key={idx} className=\"flex items-center gap-2 p-2 border rounded-lg\">\n                  <Paperclip className=\"w-4 h-4 text-muted-foreground\" />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium truncate\">{attachment.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {(attachment.size / 1024).toFixed(1)} KB\n                    </p>\n                  </div>\n                  <Button variant=\"ghost\" size=\"sm\">Download</Button>\n                </div>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n\n      <Separator className=\"my-3\" />\n\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex gap-2\">\n          <Button onClick={() => setShowReply(true)}>\n            <Reply className=\"w-4 h-4 mr-2\" />\n            Reply\n          </Button>\n          <Button variant=\"outline\">\n            <Forward className=\"w-4 h-4 mr-2\" />\n            Forward\n          </Button>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button variant=\"outline\" size=\"sm\">\n            <Archive className=\"w-4 h-4 mr-2\" />\n            Archive\n          </Button>\n          <Button variant=\"outline\" size=\"sm\">\n            <Trash2 className=\"w-4 h-4 mr-2\" />\n            Delete\n          </Button>\n        </div>\n      </div>\n\n      <EmailComposeDialog\n        open={showReply}\n        onOpenChange={setShowReply}\n        replyTo={{\n          to: email.from_email,\n          subject: email.subject,\n          body: email.body_text,\n        }}\n      />\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailFilters.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[486,489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[486,489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[878,881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[878,881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFilters'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFilters]","fix":{"range":[1099,1101],"text":"[fetchFilters]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1401,1404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1401,1404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Filter, Edit, Trash2, ToggleLeft, ToggleRight } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport function EmailFilters() {\n  const [filters, setFilters] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  const fetchFilters = async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from(\"email_filters\")\n        .select(\"*\")\n        .order(\"priority\", { ascending: false });\n\n      if (error) throw error;\n      setFilters(data || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchFilters();\n  }, []);\n\n  const toggleFilter = async (filterId: string, isActive: boolean) => {\n    try {\n      const { error } = await supabase\n        .from(\"email_filters\")\n        .update({ is_active: !isActive })\n        .eq(\"id\", filterId);\n\n      if (error) throw error;\n      fetchFilters();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Email Filters</h2>\n          <p className=\"text-muted-foreground\">\n            Automatically organize and manage your emails\n          </p>\n        </div>\n        <Button>\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Create Filter\n        </Button>\n      </div>\n\n      {loading ? (\n        <Card>\n          <CardContent className=\"p-8 text-center text-muted-foreground\">\n            Loading filters...\n          </CardContent>\n        </Card>\n      ) : filters.length === 0 ? (\n        <Card>\n          <CardContent className=\"p-8 text-center\">\n            <Filter className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50\" />\n            <p className=\"text-muted-foreground mb-4\">No email filters configured</p>\n            <Button>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Create Your First Filter\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4\">\n          {filters.map((filter) => (\n            <Card key={filter.id}>\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <CardTitle className=\"text-lg\">{filter.name}</CardTitle>\n                      <Badge variant={filter.is_active ? \"default\" : \"secondary\"}>\n                        {filter.is_active ? \"Active\" : \"Inactive\"}\n                      </Badge>\n                      <Badge variant=\"outline\">Priority: {filter.priority}</Badge>\n                    </div>\n                    {filter.description && (\n                      <p className=\"text-sm text-muted-foreground\">{filter.description}</p>\n                    )}\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => toggleFilter(filter.id, filter.is_active)}\n                    >\n                      {filter.is_active ? (\n                        <ToggleRight className=\"w-4 h-4\" />\n                      ) : (\n                        <ToggleLeft className=\"w-4 h-4\" />\n                      )}\n                    </Button>\n                    <Button variant=\"outline\" size=\"sm\">\n                      <Edit className=\"w-4 h-4\" />\n                    </Button>\n                    <Button variant=\"outline\" size=\"sm\">\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailInbox.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1277,1280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1277,1280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1858,1861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1858,1861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'syncEmails'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [selectedAccountId, syncEmails]","fix":{"range":[2519,2538],"text":"[selectedAccountId, syncEmails]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3346,3349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3346,3349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4575,4578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4575,4578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEmails'. Either include it or remove the dependency array.","line":124,"column":6,"nodeType":"ArrayExpression","endLine":124,"endColumn":80,"suggestions":[{"desc":"Update the dependencies array to be: [selectedFolder, searchQuery, selectedAccountId, sortField, sortDirection, fetchEmails]","fix":{"range":[4795,4869],"text":"[selectedFolder, searchQuery, selectedAccountId, sortField, sortDirection, fetchEmails]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5327,5330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5327,5330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5433,5436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5433,5436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAccounts'. Either include it or remove the dependency array.","line":147,"column":6,"nodeType":"ArrayExpression","endLine":147,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccounts]","fix":{"range":[5583,5585],"text":"[fetchAccounts]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5847,5850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5847,5850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6269,6272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6269,6272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6772,6775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6772,6775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7589,7592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7589,7592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7752,7755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7752,7755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":244,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8215,8218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8215,8218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9639,9642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9639,9642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10308,10311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10308,10311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":381,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":381,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13792,13795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13792,13795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":477,"column":131,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":134,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19542,19545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19542,19545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from \"react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { \n  Mail, Search, RefreshCw, Star, Archive, Trash2, \n  Plus, Reply, Forward, MoreVertical, Paperclip, Flag, Circle, ArrowUpDown\n} from \"lucide-react\";\nimport { DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuRadioGroup, DropdownMenuRadioItem, DropdownMenuLabel } from \"@/components/ui/dropdown-menu\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { EmailComposeDialog } from \"./EmailComposeDialog\";\nimport { EmailDetailDialog } from \"./EmailDetailDialog\";\nimport { format } from \"date-fns\";\n\ninterface Email {\n  id: string;\n  subject: string;\n  from_email: string;\n  from_name: string;\n  snippet: string;\n  received_at: string;\n  is_read: boolean;\n  is_starred: boolean;\n  has_attachments: boolean;\n  folder: string;\n  labels: any;\n  priority?: string;\n  importance?: string;\n}\n\nexport function EmailInbox() {\n  const [emails, setEmails] = useState<Email[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedFolder, setSelectedFolder] = useState(\"inbox\");\n  const [selectedEmail, setSelectedEmail] = useState<Email | null>(null);\n  const [showCompose, setShowCompose] = useState(false);\n  const [showDetail, setShowDetail] = useState(false);\n  const [syncing, setSyncing] = useState(false);\n  const [accounts, setAccounts] = useState<any[]>([]);\n  const [selectedAccountId, setSelectedAccountId] = useState<string | null>(null);\n  const [sortField, setSortField] = useState<\"received_at\" | \"from_email\" | \"subject\" | \"priority\">(\"received_at\");\n  const [sortDirection, setSortDirection] = useState<\"asc\" | \"desc\">(\"desc\");\n  const { toast } = useToast();\n  const { roles } = useAuth();\n\n  const autoSyncedRef = useRef<Record<string, boolean>>({});\n\n  useEffect(() => {\n    if (selectedAccountId && !autoSyncedRef.current[selectedAccountId]) {\n      autoSyncedRef.current[selectedAccountId] = true;\n      // Trigger a one-time auto sync when an account is selected\n      syncEmails();\n    }\n  }, [selectedAccountId]);\n\n  const getTenantId = () => {\n    const tenantAdmin = roles.find((r) => r.role === \"tenant_admin\" && r.tenant_id);\n    return tenantAdmin?.tenant_id || roles.find((r) => r.tenant_id)?.tenant_id || null;\n  };\n \n  const fetchEmails = async () => {\n    try {\n      setLoading(true);\n\n      const looksLikeEmail = /@/.test(searchQuery.trim());\n      const tenantId = getTenantId();\n\n      if (searchQuery && looksLikeEmail) {\n        const direction = selectedFolder === \"inbox\" ? \"inbound\" : selectedFolder === \"sent\" ? \"outbound\" : undefined;\n        const { data, error } = await supabase.functions.invoke(\"search-emails\", {\n          body: { email: searchQuery.trim(), tenantId, accountId: selectedAccountId || undefined, direction, page: 1, pageSize: 50 },\n        });\n        if (error) throw error as any;\n        const results = (data?.data as Email[]) || [];\n        // Apply client-side sorting for search results\n        const sorted = [...results].sort((a, b) => {\n          const dir = sortDirection === \"asc\" ? 1 : -1;\n          if (sortField === \"received_at\") {\n            return (new Date(a.received_at).getTime() - new Date(b.received_at).getTime()) * dir;\n          }\n          const av = (a[sortField] || \"\").toString().toLowerCase();\n          const bv = (b[sortField] || \"\").toString().toLowerCase();\n          return av.localeCompare(bv) * dir;\n        });\n        setEmails(sorted);\n      } else {\n        let query = supabase\n          .from(\"emails\")\n          .select(\"*\")\n          .eq(\"folder\", selectedFolder)\n          .order(sortField, { ascending: sortDirection === \"asc\" })\n          .limit(50);\n\n        if (selectedAccountId) {\n          query = query.eq(\"account_id\", selectedAccountId);\n        }\n        if (searchQuery) {\n          query = query.or(`subject.ilike.%${searchQuery}%,from_email.ilike.%${searchQuery}%,snippet.ilike.%${searchQuery}%`);\n        }\n\n        const { data, error } = await query;\n        if (error) throw error;\n        setEmails(data || []);\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchEmails();\n  }, [selectedFolder, searchQuery, selectedAccountId, sortField, sortDirection]);\n\n  const fetchAccounts = async () => {\n    try {\n      const { data, error } = await supabase\n        .from(\"email_accounts\")\n        .select(\"id, email_address, provider, is_primary\")\n        .eq(\"is_active\", true)\n        .order(\"is_primary\", { ascending: false })\n        .order(\"created_at\", { ascending: false });\n      if (error) throw error;\n      setAccounts(data || []);\n      if (data && data.length > 0) {\n        const primary = data.find((a: any) => a.is_primary);\n        setSelectedAccountId((primary || data[0]).id);\n      }\n    } catch (error: any) {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    }\n  };\n\n  useEffect(() => {\n    fetchAccounts();\n  }, []);\n\n  const markAsRead = async (emailId: string) => {\n    try {\n      const { error } = await supabase\n        .from(\"emails\")\n        .update({ is_read: true })\n        .eq(\"id\", emailId);\n\n      if (error) throw error;\n      fetchEmails();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const toggleStar = async (emailId: string, isStarred: boolean) => {\n    try {\n      const { error } = await supabase\n        .from(\"emails\")\n        .update({ is_starred: !isStarred })\n        .eq(\"id\", emailId);\n\n      if (error) throw error;\n      fetchEmails();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const moveToFolder = async (emailId: string, folder: string) => {\n    try {\n      const { error } = await supabase\n        .from(\"emails\")\n        .update({ folder })\n        .eq(\"id\", emailId);\n\n      if (error) throw error;\n      toast({\n        title: \"Success\",\n        description: `Email moved to ${folder}`,\n      });\n      fetchEmails();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const syncEmails = async () => {\n    try {\n      setSyncing(true);\n      const { data: authData, error: authErr } = await supabase.auth.getUser();\n      if (authErr) throw authErr;\n      const userId = authData.user?.id;\n      if (!userId) throw new Error(\"Not authenticated\");\n      const accountId = selectedAccountId as string | null;\n      if (!accountId) {\n        toast({ title: \"Select a mailbox\", description: \"Please choose a mailbox from the selector before syncing.\", variant: \"destructive\" });\n        return;\n      }\n      const { data, error } = await supabase.functions.invoke(\"sync-emails\", {\n        body: { accountId },\n      });\n      if (error) throw error as any;\n      toast({\n        title: \"Synced\",\n        description: data?.message || \"Email sync complete.\",\n      });\n      await fetchEmails();\n    } catch (error: any) {\n      toast({ title: \"Sync failed\", description: error.message, variant: \"destructive\" });\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const syncAllMailboxes = async () => {\n    try {\n      setSyncing(true);\n      const tenantId = getTenantId();\n\n      if (tenantId) {\n        const { data, error } = await supabase.functions.invoke(\"sync-all-mailboxes\", {\n          body: { tenantId, limit: 100 },\n        });\n        if (error) throw error as any;\n        toast({ title: \"Sync triggered\", description: `Processed ${data?.accountsProcessed || 0} accounts` });\n        await fetchEmails();\n        return;\n      }\n\n      // Fallback: sync all active accounts for current user when no tenant role is set\n      const { data: authData, error: authErr } = await supabase.auth.getUser();\n      if (authErr) throw authErr;\n      const userId = authData.user?.id;\n      if (!userId) throw new Error(\"Not authenticated\");\n\n      const { data: userAccounts, error: accErr } = await supabase\n        .from(\"email_accounts\")\n        .select(\"id\")\n        .eq(\"user_id\", userId)\n        .eq(\"is_active\", true);\n      if (accErr) throw accErr;\n      if (!userAccounts || userAccounts.length === 0) {\n        toast({ title: \"No accounts\", description: \"Add an email account first.\", variant: \"destructive\" });\n        return;\n      }\n\n      let totalSynced = 0;\n      for (const acc of userAccounts) {\n        const { data, error } = await supabase.functions.invoke(\"sync-emails\", {\n          body: { accountId: acc.id },\n        });\n        if (error) {\n          console.error(\"Sync error for account\", acc.id, error);\n          continue;\n        }\n        totalSynced += data?.syncedCount || 0;\n      }\n\n      toast({ title: \"Sync complete\", description: `Processed ${userAccounts.length} accounts. Total emails: ${totalSynced}` });\n      await fetchEmails();\n    } catch (error: any) {\n      toast({ title: \"Sync all failed\", description: error.message, variant: \"destructive\" });\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const handleEmailClick = (email: Email) => {\n    setSelectedEmail(email);\n    setShowDetail(true);\n    if (!email.is_read) {\n      markAsRead(email.id);\n    }\n  };\n\n  const updateEmailPriority = async (emailId: string, priority: string) => {\n    try {\n      const { error } = await supabase\n        .from(\"emails\")\n        .update({ priority })\n        .eq(\"id\", emailId);\n      if (error) throw error;\n      setEmails((prev) => prev.map((e) => (e.id === emailId ? { ...e, priority } : e)));\n    } catch (error: any) {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    }\n  };\n\n  const clampText = (text: string, maxChars: number) => {\n    const t = text || \"\";\n    if (t.length <= maxChars) return t;\n    return t.slice(0, Math.max(0, maxChars - 1)) + \"\";\n  };\n\n  return (\n    <div className=\"space-y-6 font-outlook\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <h2 className=\"text-lg font-semibold\">Email Inbox</h2>\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <Button variant=\"outline\" size=\"sm\" onClick={fetchEmails}>\n            <RefreshCw className=\"w-4 h-4 sm:mr-2\" />\n            <span className=\"hidden sm:inline\">Refresh</span>\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={syncEmails} disabled={syncing}>\n            <RefreshCw className={`w-4 h-4 sm:mr-2 ${syncing ? \"animate-spin\" : \"\"}`} />\n            <span className=\"hidden sm:inline\">Sync</span>\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={syncAllMailboxes} disabled={syncing}>\n            <RefreshCw className={`w-4 h-4 sm:mr-2 ${syncing ? \"animate-spin\" : \"\"}`} />\n            <span className=\"hidden sm:inline\">Sync All</span>\n          </Button>\n          <Button size=\"sm\" onClick={() => setShowCompose(true)}>\n            <Plus className=\"w-4 h-4 sm:mr-2\" />\n            <span className=\"hidden sm:inline\">Compose</span>\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col lg:flex-row items-stretch lg:items-center gap-3\">\n        <div className=\"relative w-full sm:w-[220px] lg:w-[240px]\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n        <div className=\"w-full lg:w-[280px]\">\n          <Select onValueChange={(v) => setSelectedAccountId(v)} value={selectedAccountId ?? undefined}>\n            <SelectTrigger className=\"w-full\">\n              <SelectValue placeholder=\"Select mailbox\" />\n            </SelectTrigger>\n            <SelectContent>\n              {accounts.length === 0 ? (\n                <SelectItem value=\"none\" disabled>\n                  No accounts\n                </SelectItem>\n              ) : (\n                accounts.map((a) => (\n                  <SelectItem key={a.id} value={a.id}>\n                    {a.email_address} {a.is_primary ? \"(Primary)\" : \"\"}\n                  </SelectItem>\n                ))\n              )}\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"w-full lg:flex-1 overflow-x-auto\">\n          <Tabs value={selectedFolder} onValueChange={setSelectedFolder} className=\"w-full\">\n            <TabsList className=\"flex w-full whitespace-nowrap\">\n              <TabsTrigger value=\"inbox\">Inbox</TabsTrigger>\n              <TabsTrigger value=\"sent\">Sent</TabsTrigger>\n              <TabsTrigger value=\"drafts\">Drafts</TabsTrigger>\n              <TabsTrigger value=\"archive\">Archive</TabsTrigger>\n              <TabsTrigger value=\"trash\">Trash</TabsTrigger>\n            </TabsList>\n          </Tabs>\n        </div>\n        <div className=\"w-full lg:w-auto flex items-center gap-2 shrink-0\">\n          <Select value={sortField} onValueChange={(v) => setSortField(v as any)}>\n            <SelectTrigger className=\"w-[160px]\">\n              <SelectValue placeholder=\"Sort by\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"received_at\">Date</SelectItem>\n              <SelectItem value=\"from_email\">From</SelectItem>\n              <SelectItem value=\"subject\">Subject</SelectItem>\n              <SelectItem value=\"priority\">Priority</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\")}\n            className=\"flex items-center gap-2\">\n            <ArrowUpDown className=\"w-4 h-4\" />\n            {sortDirection === \"asc\" ? \"Asc\" : \"Desc\"}\n          </Button>\n        </div>\n      </div>\n\n      {\n        <Card>\n          {loading ? (\n            <div className=\"p-8 text-center text-muted-foreground\">Loading emails...</div>\n          ) : emails.length === 0 ? (\n            <div className=\"p-8 text-center text-muted-foreground\">\n              <Mail className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n              <p>No emails found</p>\n            </div>\n          ) : (\n            <div className=\"divide-y\">\n              {emails.map((email) => (\n                <div\n                  key={email.id}\n                  className={`p-4 hover:bg-accent/5 cursor-pointer transition-colors ${!email.is_read ? \"bg-primary/5\" : \"\"} overflow-x-hidden`}\n                  onClick={() => handleEmailClick(email)}\n                >\n                  <div className=\"flex items-start gap-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          toggleStar(email.id, email.is_starred);\n                        }}\n                        className=\"text-muted-foreground hover:text-warning transition-colors\"\n                      >\n                        <Star className={`w-4 h-4 ${email.is_starred ? \"fill-warning text-warning\" : \"\"}`} />\n                      </button>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <button\n                            onClick={(e) => e.stopPropagation()}\n                            className={`transition-colors ${getPriorityColorClass(email.priority)}`}\n                            aria-label=\"Set priority\"\n                            title=\"Set priority\"\n                          >\n                            <Flag className=\"w-4 h-4\" />\n                          </button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"start\">\n                          <DropdownMenuLabel>Priority</DropdownMenuLabel>\n                          <DropdownMenuRadioGroup\n                            value={(email.priority || \"normal\").toLowerCase()}\n                            onValueChange={(v) => updateEmailPriority(email.id, v)}\n                          >\n                            <DropdownMenuRadioItem value=\"red\">\n                              <span className=\"inline-flex items-center gap-2\"><span className=\"w-2 h-2 rounded-full bg-red-500\" />Red</span>\n                            </DropdownMenuRadioItem>\n                            <DropdownMenuRadioItem value=\"yellow\">\n                              <span className=\"inline-flex items-center gap-2\"><span className=\"w-2 h-2 rounded-full bg-yellow-500\" />Yellow</span>\n                            </DropdownMenuRadioItem>\n                            <DropdownMenuRadioItem value=\"green\">\n                              <span className=\"inline-flex items-center gap-2\"><span className=\"w-2 h-2 rounded-full bg-green-500\" />Green</span>\n                            </DropdownMenuRadioItem>\n                            <DropdownMenuRadioItem value=\"brown\">\n                              <span className=\"inline-flex items-center gap-2\"><span className=\"w-2 h-2 rounded-full bg-amber-700\" />Brown</span>\n                            </DropdownMenuRadioItem>\n                            <DropdownMenuRadioItem value=\"normal\">\n                              <span className=\"inline-flex items-center gap-2\"><span className=\"w-2 h-2 rounded-full bg-muted-foreground\" />Normal</span>\n                            </DropdownMenuRadioItem>\n                          </DropdownMenuRadioGroup>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </div>\n                    <div className=\"flex-1 min-w-0 max-w-[100ch]\">\n                      <div className=\"flex items-center justify-between mb-1\">\n                        <div className=\"flex items-center gap-2 min-w-0\">\n                          <span className={`font-medium ${!email.is_read ? \"font-bold\" : \"\"} break-words whitespace-normal lg:truncate`}>\n                            {email.from_name || email.from_email}\n                          </span>\n                          {email.has_attachments && <Paperclip className=\"w-4 h-4 text-muted-foreground\" />}\n                        </div>\n                        <span className=\"text-xs text-muted-foreground\">{format(new Date(email.received_at), \"MMM d, h:mm a\")}</span>\n                      </div>\n                      <div className={`text-sm mb-1 ${!email.is_read ? \"font-semibold\" : \"\"} break-words whitespace-normal lg:truncate`}>{clampText(email.subject || \"\", 100)}</div>\n                      <div\n                        className=\"text-sm text-muted-foreground break-words whitespace-normal\"\n                        style={{ display: \"-webkit-box\", WebkitLineClamp: 2, WebkitBoxOrient: \"vertical\", overflow: \"hidden\" } as any}\n                      >\n                        {clampText(email.snippet || \"\", 100)}\n                      </div>\n                      <div className=\"mt-1\">\n                        <Button\n                          variant=\"link\"\n                          size=\"sm\"\n                          className=\"p-0 h-auto\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleEmailClick(email);\n                          }}\n                        >\n                          Open\n                        </Button>\n                      </div>\n                      {email.labels && email.labels.length > 0 && (\n                        <div className=\"flex gap-1 mt-2\">\n                          {email.labels.map((label, idx) => (\n                            <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                              {label}\n                            </Badge>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-1 shrink-0\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          moveToFolder(email.id, \"archive\");\n                        }}\n                      >\n                        <Archive className=\"w-4 h-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          moveToFolder(email.id, \"trash\");\n                        }}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </Card>\n      }\n\n      <EmailComposeDialog open={showCompose} onOpenChange={setShowCompose} />\n      \n      {selectedEmail && (\n        <EmailDetailDialog\n          open={showDetail}\n          onOpenChange={setShowDetail}\n          email={selectedEmail}\n          onRefresh={fetchEmails}\n        />\n      )}\n    </div>\n  );\n}\n  const getPriorityColorClass = (p?: string) => {\n    switch ((p || \"normal\").toLowerCase()) {\n      case \"red\":\n        return \"text-red-500\";\n      case \"yellow\":\n        return \"text-yellow-500\";\n      case \"green\":\n        return \"text-green-500\";\n      case \"brown\":\n        return \"text-amber-700\";\n      default:\n        return \"text-muted-foreground\";\n    }\n  };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/EmailTemplates.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[925,928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[925,928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1081,1084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1081,1084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1147,1150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1147,1150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1254,1257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1254,1257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2147,2150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2147,2150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2914,2917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2914,2917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3716,3719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3716,3719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6411,6414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6411,6414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6773,6776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6773,6776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8272,8275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8272,8275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8447,8450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8447,8450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8923,8926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8923,8926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9061,9064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9061,9064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9920,9923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9920,9923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":397,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14893,14896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14893,14896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":401,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15111,15114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15111,15114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":405,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15343,15346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15343,15346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":421,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":421,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16184,16187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16184,16187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":425,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":425,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16426,16429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16426,16429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'context?.isPlatformAdmin', 'context?.tenantId', 'fetchTemplates', 'roles', and 'toast'. Either include them or remove the dependency array.","line":91,"column":6,"nodeType":"ArrayExpression","endLine":91,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [context?.isPlatformAdmin, context?.tenantId, fetchTemplates, roles, toast]","fix":{"range":[3142,3144],"text":"[context?.isPlatformAdmin, context?.tenantId, fetchTemplates, roles, toast]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTemplates'. Either include it or remove the dependency array.","line":96,"column":6,"nodeType":"ArrayExpression","endLine":96,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTemplates, selectedTenantId]","fix":{"range":[3255,3273],"text":"[fetchTemplates, selectedTenantId]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Plus, FileText, Edit, Trash2, Copy, Eye } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport function EmailTemplates() {\n  const [templates, setTemplates] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showDialog, setShowDialog] = useState(false);\n  const [editing, setEditing] = useState<any | null>(null);\n  const [previewing, setPreviewing] = useState<any | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [selectedTenantId, setSelectedTenantId] = useState<string>(\"\");\n  const { toast } = useToast();\n  const { context, user } = useCRM();\n  const { roles } = useAuth();\n\n  const getTenantId = () => {\n    if (context?.isPlatformAdmin && selectedTenantId) return selectedTenantId;\n    return (\n      context?.tenantId ||\n      roles?.find((r) => !!r.tenant_id)?.tenant_id ||\n      null\n    );\n  };\n\n  const fetchTemplates = async () => {\n    try {\n      setLoading(true);\n      const tenantId = getTenantId();\n      if (!tenantId) {\n        setTemplates([]);\n        setLoading(false);\n        return;\n      }\n      const { data, error } = await supabase\n        .from(\"email_templates\")\n        .select(\"*\")\n        .eq(\"tenant_id\", tenantId)\n        .order(\"created_at\", { ascending: false });\n\n      if (error) throw error;\n      setTemplates(data || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      try {\n        if (context?.isPlatformAdmin) {\n          const { data, error } = await supabase\n            .from(\"tenants\")\n            .select(\"id, name\")\n            .eq(\"is_active\", true)\n            .order(\"name\");\n          if (error) throw error;\n          setTenants(data || []);\n          setSelectedTenantId((prev) => prev || (data?.[0]?.id ?? \"\"));\n        } else {\n          setSelectedTenantId(\n            context?.tenantId || roles?.find((r) => !!r.tenant_id)?.tenant_id || \"\"\n          );\n        }\n      } catch (err: any) {\n        toast({ title: \"Error\", description: err.message, variant: \"destructive\" });\n      } finally {\n        fetchTemplates();\n      }\n    };\n    init();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    fetchTemplates();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedTenantId]);\n\n  const seedTemplates = async () => {\n    try {\n      const tenantId = getTenantId();\n      if (!tenantId) {\n        toast({ title: \"No tenant selected\", description: \"Please switch to a tenant or assign a tenant role to seed templates.\", variant: \"destructive\" });\n        return;\n      }\n      const base = {\n        tenant_id: tenantId,\n        created_by: user?.id || null,\n        is_shared: true,\n        is_active: true,\n      } as any;\n      const seeds = [\n        {\n          name: \"Introduction  Discovery Call\",\n          description: \"Warm intro to schedule a discovery call\",\n          category: \"introduction\",\n          subject: \"{{sender_name}} | Quick intro and discovery call?\",\n          body_html:\n            \"<p>Hi {{first_name}},</p><p>Im {{sender_name}} from {{company}}. Id love to learn more about your goals and see if we can help. Are you available for a quick 1520 minute discovery call this week?</p><p>Best,<br>{{sender_name}}</p>\",\n        },\n        {\n          name: \"Follow Up  Checking in\",\n          description: \"Gentle follow up after no response\",\n          category: \"follow_up\",\n          subject: \"Quick follow up on my last note\",\n          body_html:\n            \"<p>Hi {{first_name}},</p><p>Just circling back on my previous message. Happy to share more details or tailor a quick overview.</p><p>Would a short call work sometime this week?</p><p>Thanks,<br>{{sender_name}}</p>\",\n        },\n        {\n          name: \"Meeting  Confirmation\",\n          description: \"Confirm upcoming meeting with agenda\",\n          category: \"meeting\",\n          subject: \"Confirmed: {{meeting_date}}  Agenda inside\",\n          body_html:\n            \"<p>Hi {{first_name}},</p><p>Looking forward to our meeting on {{meeting_date}}. Agenda:<br> Your goals and current process<br> Solution overview<br> Next steps</p><p>Feel free to add topics. Talk soon!<br>{{sender_name}}</p>\",\n        },\n        {\n          name: \"Proposal  Delivery\",\n          description: \"Share proposal and outline next steps\",\n          category: \"proposal\",\n          subject: \"Proposal enclosed  next steps\",\n          body_html:\n            \"<p>Hi {{first_name}},</p><p>Attached is the proposal we discussed. It includes scope, timeline, and pricing.</p><p>Shall we review together and finalize the plan?</p><p>Best,<br>{{sender_name}}</p>\",\n        },\n        {\n          name: \"Thank You  Post Meeting\",\n          description: \"Thanks and recap after a meeting\",\n          category: \"thank_you\",\n          subject: \"Thank you and quick recap\",\n          body_html:\n            \"<p>Hi {{first_name}},</p><p>Thanks for your time today. As a recap: {{recap_points}}.</p><p>Ill follow up with the next steps and materials.</p><p>Best,<br>{{sender_name}}</p>\",\n        },\n      ];\n      const { error } = await supabase\n        .from(\"email_templates\")\n        .insert(\n          seeds.map((s) => ({\n            ...base,\n            ...s,\n          }))\n        );\n      if (error) throw error;\n      toast({ title: \"Seeded\", description: \"Best-practice templates added\" });\n      fetchTemplates();\n    } catch (err: any) {\n      toast({ title: \"Error\", description: err.message, variant: \"destructive\" });\n    }\n  };\n\n  const openCreate = () => {\n    setEditing({\n      name: \"\",\n      description: \"\",\n      category: \"general\",\n      subject: \"\",\n      body_html: \"\",\n      is_shared: true,\n      is_active: true,\n    });\n    setShowDialog(true);\n  };\n\n  const openEdit = (t: any) => {\n    setEditing({ ...t });\n    setShowDialog(true);\n  };\n\n  const closeDialog = () => {\n    setShowDialog(false);\n    setEditing(null);\n  };\n\n  const handleSave = async () => {\n    if (!editing?.name || !editing?.subject) {\n      toast({ title: \"Missing fields\", description: \"Name and Subject are required.\", variant: \"destructive\" });\n      return;\n    }\n    try {\n      setSaving(true);\n      const tenantId = getTenantId();\n      if (!tenantId) {\n        toast({ title: \"No tenant selected\", description: \"Please switch to a tenant or assign a tenant role before saving templates.\", variant: \"destructive\" });\n        return;\n      }\n      const payload = {\n        name: editing.name,\n        description: editing.description || null,\n        category: editing.category || null,\n        subject: editing.subject,\n        body_html: editing.body_html || null,\n        body_text: null,\n        is_shared: editing.is_shared ?? true,\n        is_active: editing.is_active ?? true,\n        tenant_id: tenantId,\n        created_by: user?.id || null,\n      };\n      let resp;\n      if (editing.id) {\n        resp = await supabase\n          .from(\"email_templates\")\n          .update({ ...payload, updated_at: new Date().toISOString() })\n          .eq(\"id\", editing.id)\n          .select(\"*\")\n          .single();\n      } else {\n        resp = await supabase\n          .from(\"email_templates\")\n          .insert([{ ...payload }])\n          .select(\"*\");\n      }\n      const { error } = resp as any;\n      if (error) throw error;\n      toast({ title: \"Saved\", description: \"Template saved successfully\" });\n      closeDialog();\n      fetchTemplates();\n    } catch (err: any) {\n      toast({ title: \"Error\", description: err.message, variant: \"destructive\" });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm(\"Delete this template?\")) return;\n    try {\n      const { error } = await supabase.from(\"email_templates\").delete().eq(\"id\", id);\n      if (error) throw error;\n      toast({ title: \"Deleted\", description: \"Template removed\" });\n      fetchTemplates();\n    } catch (err: any) {\n      toast({ title: \"Error\", description: err.message, variant: \"destructive\" });\n    }\n  };\n\n  const handleDuplicate = async (t: any) => {\n    try {\n      const tenantId = getTenantId() || t.tenant_id;\n      if (!tenantId) {\n        toast({ title: \"No tenant selected\", description: \"Please switch to a tenant or assign a tenant role before duplicating.\", variant: \"destructive\" });\n        return;\n      }\n      const copy = {\n        name: `Copy of ${t.name}`,\n        description: t.description,\n        category: t.category,\n        subject: t.subject,\n        body_html: t.body_html,\n        body_text: t.body_text,\n        is_shared: t.is_shared,\n        is_active: t.is_active,\n        tenant_id: tenantId,\n        created_by: user?.id || null,\n      };\n      const { error } = await supabase.from(\"email_templates\").insert([copy]);\n      if (error) throw error;\n      toast({ title: \"Duplicated\", description: \"Template copy created\" });\n      fetchTemplates();\n    } catch (err: any) {\n      toast({ title: \"Error\", description: err.message, variant: \"destructive\" });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Email Templates</h2>\n          <p className=\"text-muted-foreground\">\n            Create reusable email templates for quick responses\n          </p>\n        </div>\n        <div className=\"flex gap-2 items-end\">\n          {context?.isPlatformAdmin && (\n            <div className=\"min-w-[240px]\">\n              <Label>Tenant</Label>\n              <Select value={selectedTenantId} onValueChange={setSelectedTenantId}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Choose tenant\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {tenants.map((t) => (\n                    <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n          <Button onClick={openCreate}>\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Create Template\n          </Button>\n          <Button variant=\"outline\" onClick={seedTemplates}>\n            Seed Best Templates\n          </Button>\n        </div>\n      </div>\n\n      {loading ? (\n        <Card>\n          <CardContent className=\"p-8 text-center text-muted-foreground\">\n            Loading templates...\n          </CardContent>\n        </Card>\n      ) : templates.length === 0 ? (\n        <Card>\n          <CardContent className=\"p-8 text-center\">\n            <FileText className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50\" />\n            <p className=\"text-muted-foreground mb-4\">\n              No email templates created{context?.isPlatformAdmin && !getTenantId() ? \n                \". Choose a tenant to manage templates.\" : \"\"}\n            </p>\n            <div className=\"flex justify-center gap-2\">\n              <Button onClick={openCreate}>\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Create Your First Template\n              </Button>\n              <Button variant=\"outline\" onClick={seedTemplates}>Seed Best Templates</Button>\n            </div>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {templates.map((template) => (\n            <Card key={template.id}>\n              <CardHeader>\n                <div className=\"flex items-start justify-between mb-2\">\n                  <CardTitle className=\"text-lg\">{template.name}</CardTitle>\n                  <div className=\"flex gap-1\">\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => setPreviewing(template)} title=\"Preview\">\n                      <Eye className=\"w-4 h-4\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDuplicate(template)} title=\"Duplicate\">\n                      <Copy className=\"w-4 h-4\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => openEdit(template)} title=\"Edit\">\n                      <Edit className=\"w-4 h-4\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDelete(template.id)} title=\"Delete\">\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </div>\n                {template.description && (\n                  <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                    {template.description}\n                  </p>\n                )}\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div>\n                    <p className=\"text-xs font-medium text-muted-foreground mb-1\">Subject</p>\n                    <p className=\"text-sm font-medium line-clamp-1\">{template.subject}</p>\n                  </div>\n                  {template.category && (\n                    <Badge variant=\"outline\">{template.category}</Badge>\n                  )}\n                  {template.is_shared && (\n                    <Badge variant=\"secondary\">Shared</Badge>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* Create/Edit Dialog */}\n      <Dialog open={showDialog} onOpenChange={setShowDialog}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>{editing?.id ? \"Edit Template\" : \"Create Template\"}</DialogTitle>\n            <DialogDescription>Design reusable email content for your team.</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label>Name *</Label>\n              <Input value={editing?.name || \"\"} onChange={(e) => setEditing((prev: any) => ({ ...prev, name: e.target.value }))} />\n            </div>\n            <div>\n              <Label>Description</Label>\n              <Input value={editing?.description || \"\"} onChange={(e) => setEditing((prev: any) => ({ ...prev, description: e.target.value }))} />\n            </div>\n            <div>\n              <Label>Category</Label>\n              <Select value={editing?.category || \"general\"} onValueChange={(v) => setEditing((prev: any) => ({ ...prev, category: v }))}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"general\">General</SelectItem>\n                  <SelectItem value=\"follow_up\">Follow Up</SelectItem>\n                  <SelectItem value=\"introduction\">Introduction</SelectItem>\n                  <SelectItem value=\"meeting\">Meeting</SelectItem>\n                  <SelectItem value=\"proposal\">Proposal</SelectItem>\n                  <SelectItem value=\"thank_you\">Thank You</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label>Subject *</Label>\n              <Input value={editing?.subject || \"\"} onChange={(e) => setEditing((prev: any) => ({ ...prev, subject: e.target.value }))} />\n            </div>\n            <div>\n              <Label>Body (HTML supported)</Label>\n              <Textarea rows={10} value={editing?.body_html || \"\"} onChange={(e) => setEditing((prev: any) => ({ ...prev, body_html: e.target.value }))} />\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={closeDialog}>Cancel</Button>\n              <Button onClick={handleSave} disabled={saving}>{saving ? \"Saving...\" : \"Save Template\"}</Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Preview Dialog */}\n      <Dialog open={!!previewing} onOpenChange={(o) => !o && setPreviewing(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          {previewing && (\n            <>\n              <DialogHeader>\n                <DialogTitle>{previewing.name}</DialogTitle>\n                <DialogDescription>{previewing.subject}</DialogDescription>\n              </DialogHeader>\n              <div className=\"prose prose-sm max-w-none\" dangerouslySetInnerHTML={{ __html: previewing.body_html || \"<p>(No content)</p>\" }} />\n              <div className=\"flex justify-end\">\n                <Button variant=\"outline\" onClick={() => setPreviewing(null)}>Close</Button>\n              </div>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/email/OAuthSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOAuthConfigs'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOAuthConfigs]","fix":{"range":[1511,1513],"text":"[fetchOAuthConfigs]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1678,1681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1678,1681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1890,1893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1890,1893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1910,1913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1910,1913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1968,1971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1968,1971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1988,1991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1988,1991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2670,2673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2670,2673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3891,3894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3891,3894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4098,4101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4098,4101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4364,4367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4364,4367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { Info, Save } from \"lucide-react\";\n\ninterface OAuthConfig {\n  id?: string;\n  provider: string;\n  client_id: string;\n  client_secret: string;\n  tenant_id?: string;\n  redirect_uri: string;\n  is_active: boolean;\n}\n\nexport function OAuthSettings() {\n  const [office365Config, setOffice365Config] = useState<OAuthConfig>({\n    provider: \"office365\",\n    client_id: \"\",\n    client_secret: \"\",\n    tenant_id: \"\",\n    redirect_uri: `${window.location.origin}/oauth/callback`,\n    is_active: true,\n  });\n\n  const [gmailConfig, setGmailConfig] = useState<OAuthConfig>({\n    provider: \"gmail\",\n    client_id: \"\",\n    client_secret: \"\",\n    redirect_uri: `${window.location.origin}/oauth/callback`,\n    is_active: true,\n  });\n\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const { toast } = useToast();\n  const { context } = useCRM();\n\n  useEffect(() => {\n    fetchOAuthConfigs();\n  }, []);\n\n  const fetchOAuthConfigs = async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from(\"oauth_configurations\" as any)\n        .select(\"*\")\n        .eq(\"user_id\", context.userId)\n        .in(\"provider\", [\"office365\", \"gmail\"]);\n\n      if (error) throw error;\n\n      if (data && Array.isArray(data)) {\n        const office365: any = data.find((c: any) => c.provider === \"office365\");\n        const gmail: any = data.find((c: any) => c.provider === \"gmail\");\n\n        if (office365) {\n          setOffice365Config({\n            ...office365Config,\n            id: office365.id,\n            client_id: office365.client_id || \"\",\n            client_secret: office365.client_secret || \"\",\n            tenant_id: office365.tenant_id_provider || \"\",\n            is_active: office365.is_active,\n          });\n        }\n\n        if (gmail) {\n          setGmailConfig({\n            ...gmailConfig,\n            id: gmail.id,\n            client_id: gmail.client_id || \"\",\n            client_secret: gmail.client_secret || \"\",\n            is_active: gmail.is_active,\n          });\n        }\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const saveOAuthConfig = async (config: OAuthConfig, isOffice365: boolean) => {\n    if (!config.client_id || !config.client_secret) {\n      toast({\n        title: \"Error\",\n        description: \"Client ID and Client Secret are required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (isOffice365 && !config.tenant_id) {\n      toast({\n        title: \"Error\",\n        description: \"Tenant ID is required for Office 365\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const configData = {\n        user_id: context.userId,\n        tenant_id: context.tenantId,\n        provider: config.provider,\n        client_id: config.client_id,\n        client_secret: config.client_secret,\n        tenant_id_provider: isOffice365 ? config.tenant_id : null,\n        redirect_uri: config.redirect_uri,\n        is_active: config.is_active,\n      };\n\n      let error;\n      if (config.id) {\n        const { error: updateError } = await supabase\n          .from(\"oauth_configurations\" as any)\n          .update(configData)\n          .eq(\"id\", config.id);\n        error = updateError;\n      } else {\n        const { error: insertError } = await supabase\n          .from(\"oauth_configurations\" as any)\n          .insert(configData);\n        error = insertError;\n      }\n\n      if (error) throw error;\n\n      toast({\n        title: \"Success\",\n        description: \"OAuth configuration saved successfully\",\n      });\n\n      fetchOAuthConfigs();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"p-8 text-center text-muted-foreground\">\n          Loading OAuth configurations...\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold\">OAuth Settings</h2>\n        <p className=\"text-muted-foreground\">\n          Configure OAuth credentials for email providers\n        </p>\n      </div>\n\n      <Alert>\n        <Info className=\"h-4 w-4\" />\n        <AlertDescription>\n          These credentials are required to enable \"Connect with Microsoft\" and \"Connect with Google\" buttons.\n          Keep your client secrets secure and never share them publicly.\n        </AlertDescription>\n      </Alert>\n\n      <Tabs defaultValue=\"office365\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"office365\">Office 365</TabsTrigger>\n          <TabsTrigger value=\"gmail\">Gmail</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"office365\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Office 365 OAuth Configuration</CardTitle>\n              <CardDescription>\n                Configure your Azure AD app registration credentials\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Alert>\n                <Info className=\"h-4 w-4\" />\n                <AlertDescription className=\"text-sm\">\n                  <p className=\"font-semibold mb-2\">How to get these credentials:</p>\n                  <ol className=\"list-decimal ml-4 space-y-1\">\n                    <li>Go to Azure Portal  Azure Active Directory  App registrations</li>\n                    <li>Create or select your app</li>\n                    <li>Copy the \"Application (client) ID\"</li>\n                    <li>Copy the \"Directory (tenant) ID\"</li>\n                    <li>Go to \"Certificates & secrets\"  Create new client secret</li>\n                    <li>Add redirect URI: <code className=\"bg-muted px-1 py-0.5 rounded\">{office365Config.redirect_uri}</code></li>\n                  </ol>\n                </AlertDescription>\n              </Alert>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <Label>Client ID (Application ID) *</Label>\n                  <Input\n                    placeholder=\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n                    value={office365Config.client_id}\n                    onChange={(e) => setOffice365Config({ ...office365Config, client_id: e.target.value })}\n                  />\n                </div>\n\n                <div>\n                  <Label>Client Secret *</Label>\n                  <Input\n                    type=\"password\"\n                    placeholder=\"Your client secret value\"\n                    value={office365Config.client_secret}\n                    onChange={(e) => setOffice365Config({ ...office365Config, client_secret: e.target.value })}\n                  />\n                </div>\n\n                <div>\n                  <Label>Tenant ID (Directory ID) *</Label>\n                  <Input\n                    placeholder=\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n                    value={office365Config.tenant_id}\n                    onChange={(e) => setOffice365Config({ ...office365Config, tenant_id: e.target.value })}\n                  />\n                </div>\n\n                <div>\n                  <Label>Redirect URI (Read-only)</Label>\n                  <Input\n                    value={office365Config.redirect_uri}\n                    readOnly\n                    className=\"bg-muted\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Add this exact URL to your Azure AD app's redirect URIs\n                  </p>\n                </div>\n\n                <Button\n                  onClick={() => saveOAuthConfig(office365Config, true)}\n                  disabled={saving}\n                  className=\"w-full\"\n                >\n                  <Save className=\"w-4 h-4 mr-2\" />\n                  {saving ? \"Saving...\" : \"Save Office 365 Configuration\"}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"gmail\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Gmail OAuth Configuration</CardTitle>\n              <CardDescription>\n                Configure your Google Cloud Console OAuth credentials\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Alert>\n                <Info className=\"h-4 w-4\" />\n                <AlertDescription className=\"text-sm\">\n                  <p className=\"font-semibold mb-2\">How to get these credentials:</p>\n                  <ol className=\"list-decimal ml-4 space-y-1\">\n                    <li>Go to Google Cloud Console  APIs & Services  Credentials</li>\n                    <li>Create OAuth 2.0 Client ID (Web application)</li>\n                    <li>Copy the \"Client ID\"</li>\n                    <li>Copy the \"Client Secret\"</li>\n                    <li>Add authorized redirect URI: <code className=\"bg-muted px-1 py-0.5 rounded\">{gmailConfig.redirect_uri}</code></li>\n                    <li>Enable Gmail API in your project</li>\n                  </ol>\n                </AlertDescription>\n              </Alert>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <Label>Client ID *</Label>\n                  <Input\n                    placeholder=\"xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com\"\n                    value={gmailConfig.client_id}\n                    onChange={(e) => setGmailConfig({ ...gmailConfig, client_id: e.target.value })}\n                  />\n                </div>\n\n                <div>\n                  <Label>Client Secret *</Label>\n                  <Input\n                    type=\"password\"\n                    placeholder=\"Your client secret value\"\n                    value={gmailConfig.client_secret}\n                    onChange={(e) => setGmailConfig({ ...gmailConfig, client_secret: e.target.value })}\n                  />\n                </div>\n\n                <div>\n                  <Label>Redirect URI (Read-only)</Label>\n                  <Input\n                    value={gmailConfig.redirect_uri}\n                    readOnly\n                    className=\"bg-muted\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Add this exact URL to your Google Cloud Console authorized redirect URIs\n                  </p>\n                </div>\n\n                <Button\n                  onClick={() => saveOAuthConfig(gmailConfig, false)}\n                  disabled={saving}\n                  className=\"w-full\"\n                >\n                  <Save className=\"w-4 h-4 mr-2\" />\n                  {saving ? \"Saving...\" : \"Save Gmail Configuration\"}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/forms/AdvancedFields.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2095,2098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2095,2098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2399,2402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2399,2402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-rest-params","severity":2,"message":"Use the rest parameters instead of 'arguments'.","line":86,"column":25,"nodeType":"Identifier","messageId":"preferRestParams","endLine":86,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3183,3186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3183,3186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-rest-params","severity":2,"message":"Use the rest parameters instead of 'arguments'.","line":131,"column":20,"nodeType":"Identifier","messageId":"preferRestParams","endLine":131,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4645,4648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4645,4648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-rest-params","severity":2,"message":"Use the rest parameters instead of 'arguments'.","line":210,"column":21,"nodeType":"Identifier","messageId":"preferRestParams","endLine":210,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7654,7657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7654,7657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9536,9539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9536,9539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-rest-params","severity":2,"message":"Use the rest parameters instead of 'arguments'.","line":274,"column":19,"nodeType":"Identifier","messageId":"preferRestParams","endLine":274,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9624,9627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9624,9627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Control, FieldPath, FieldValues } from \"react-hook-form\";\nimport { FormField, FormItem, FormLabel, FormControl, FormDescription, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { Calendar as CalendarIcon, ChevronsUpDown, Check } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\n\ntype BaseFieldProps<TFieldValues extends FieldValues, TName extends FieldPath<TFieldValues>> = {\n  control: Control<TFieldValues>;\n  name: TName;\n  label?: string;\n  description?: string;\n  placeholder?: string;\n  disabled?: boolean;\n  className?: string;\n};\n\n// Date picker field using shadcn Calendar + Popover. Stores Date in form state.\nexport function DateField<TFieldValues extends FieldValues, TName extends FieldPath<TFieldValues>>({\n  control,\n  name,\n  label,\n  description,\n  placeholder = \"Pick a date\",\n  disabled,\n  className,\n}: BaseFieldProps<TFieldValues, TName>) {\n  const [open, setOpen] = React.useState(false);\n\n  return (\n    <FormField\n      control={control}\n      name={name}\n      render={({ field }) => (\n        <FormItem className={className}>\n          {label && <FormLabel>{label}</FormLabel>}\n          <Popover open={open} onOpenChange={setOpen}>\n            <PopoverTrigger asChild>\n              <FormControl>\n                <Button\n                  variant=\"outline\"\n                  className={cn(\"w-full justify-start text-left font-normal\", !field.value && \"text-muted-foreground\")}\n                  disabled={disabled}\n                >\n                  <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                  {field.value ? (new Date(field.value as any).toLocaleDateString()) : placeholder}\n                </Button>\n              </FormControl>\n            </PopoverTrigger>\n            <PopoverContent className=\"p-0\" align=\"start\">\n              <Calendar\n                mode=\"single\"\n                selected={field.value ? new Date(field.value as any) : undefined}\n                onSelect={(date) => {\n                  field.onChange(date || undefined);\n                  setOpen(false);\n                }}\n                initialFocus\n              />\n            </PopoverContent>\n          </Popover>\n          {description && <FormDescription>{description}</FormDescription>}\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n\n// Currency field with a prefixed currency code, stores numeric amount.\nexport function CurrencyField<TFieldValues extends FieldValues, TName extends FieldPath<TFieldValues>>({\n  control,\n  name,\n  label,\n  description,\n  placeholder = \"0.00\",\n  disabled,\n  className,\n}: BaseFieldProps<TFieldValues, TName> & { currencyCode?: string }) {\n  const currencyCode = (arguments[0] as any)?.currencyCode ?? \"USD\";\n  return (\n    <FormField\n      control={control}\n      name={name}\n      render={({ field }) => (\n        <FormItem className={className}>\n          {label && <FormLabel>{label}</FormLabel>}\n          <FormControl>\n            <div className=\"relative\">\n              <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-sm text-muted-foreground\">{currencyCode}</span>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                placeholder={placeholder}\n                className=\"pl-14\"\n                disabled={disabled}\n                value={field.value ?? \"\"}\n                onChange={(e) => {\n                  const val = e.target.value;\n                  field.onChange(val === \"\" ? undefined : Number(val));\n                }}\n              />\n            </div>\n          </FormControl>\n          {description && <FormDescription>{description}</FormDescription>}\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n\n// Combobox field using Command + Popover. Supports static options.\nexport type ComboOption = { label: string; value: string };\n\nexport function ComboboxField<TFieldValues extends FieldValues, TName extends FieldPath<TFieldValues>>({\n  control,\n  name,\n  label,\n  description,\n  placeholder = \"Select option\",\n  disabled,\n  className,\n}: BaseFieldProps<TFieldValues, TName> & { options: ComboOption[] }) {\n  const options = (arguments[0] as any)?.options as ComboOption[];\n  const [open, setOpen] = React.useState(false);\n  const [search, setSearch] = React.useState(\"\");\n\n  return (\n    <FormField\n      control={control}\n      name={name}\n      render={({ field }) => {\n        const selected = options.find((o) => o.value === field.value);\n        const displayLabel = selected ? selected.label : placeholder;\n        return (\n          <FormItem className={className}>\n            {label && <FormLabel>{label}</FormLabel>}\n            <Popover open={open} onOpenChange={setOpen}>\n              <PopoverTrigger asChild>\n                <FormControl>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={open}\n                    className=\"w-full justify-between\"\n                    disabled={disabled}\n                  >\n                    <span className={cn(!selected && \"text-muted-foreground\")}>{displayLabel}</span>\n                    <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </FormControl>\n              </PopoverTrigger>\n              <PopoverContent className=\"p-0\" align=\"start\">\n                <Command>\n                  <CommandInput placeholder=\"Search...\" value={search} onValueChange={setSearch} />\n                  <CommandList>\n                    <CommandEmpty>No results.</CommandEmpty>\n                    <CommandGroup>\n                      {options\n                        .filter((o) => o.label.toLowerCase().includes(search.toLowerCase()))\n                        .map((o) => (\n                          <CommandItem\n                            key={o.value}\n                            value={o.value}\n                            onSelect={() => {\n                              field.onChange(o.value);\n                              setOpen(false);\n                            }}\n                          >\n                            <Check\n                              className={cn(\n                                \"mr-2 h-4 w-4\",\n                                field.value === o.value ? \"opacity-100\" : \"opacity-0\",\n                              )}\n                            />\n                            {o.label}\n                          </CommandItem>\n                        ))}\n                    </CommandGroup>\n                  </CommandList>\n                </Command>\n              </PopoverContent>\n            </Popover>\n            {description && <FormDescription>{description}</FormDescription>}\n            <FormMessage />\n          </FormItem>\n        );\n      }}\n    />\n  );\n}\n\n// File upload field storing File[]; shows selected file names.\nexport function FileUploadField<TFieldValues extends FieldValues, TName extends FieldPath<TFieldValues>>({\n  control,\n  name,\n  label,\n  description,\n  placeholder,\n  disabled,\n  className,\n}: BaseFieldProps<TFieldValues, TName> & { multiple?: boolean }) {\n  const multiple = (arguments[0] as any)?.multiple ?? true;\n  return (\n    <FormField\n      control={control}\n      name={name}\n      render={({ field }) => (\n        <FormItem className={className}>\n          {label && <FormLabel>{label}</FormLabel>}\n          <FormControl>\n            <div className=\"space-y-2\">\n              <Input\n                type=\"file\"\n                multiple={multiple}\n                disabled={disabled}\n                onChange={(e) => {\n                  const files = e.target.files ? Array.from(e.target.files) : [];\n                  field.onChange(files);\n                }}\n              />\n              {Array.isArray(field.value) && field.value.length > 0 && (\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\n                  {field.value.map((f: File, idx: number) => (\n                    <li key={idx}>{f.name}</li>\n                  ))}\n                </ul>\n              )}\n            </div>\n          </FormControl>\n          {description && <FormDescription>{description}</FormDescription>}\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n\n// Async combobox with Supabase loader and virtualized dropdown\nexport type AsyncComboLoader = (search: string) => Promise<ComboOption[]>;\n\nexport function AsyncComboboxField<\n  TFieldValues extends FieldValues,\n  TName extends FieldPath<TFieldValues>\n>({\n  control,\n  name,\n  label,\n  description,\n  placeholder = \"Search services...\",\n  disabled,\n  className,\n}: BaseFieldProps<TFieldValues, TName> & { loader?: AsyncComboLoader }) {\n  const defaultLoader: AsyncComboLoader = React.useCallback(async (search: string) => {\n    let query = supabase\n      .from(\"services\")\n      .select(\"id, name\")\n      .order(\"name\")\n      .limit(500);\n    if (search) {\n      query = query.ilike(\"name\", `%${search}%`);\n    }\n    const { data } = await query;\n    return (data || []).map((r: any) => ({ label: r.name, value: r.id }));\n  }, []);\n\n  const loader = (arguments[0] as any)?.loader ?? defaultLoader;\n  const [open, setOpen] = React.useState(false);\n  const [search, setSearch] = React.useState(\"\");\n  const [options, setOptions] = React.useState<ComboOption[]>([]);\n  const [loading, setLoading] = React.useState(false);\n\n  React.useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      setLoading(true);\n      try {\n        const opts = await loader(search);\n        if (!cancelled) setOptions(opts);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, [loader, search]);\n\n  // Virtualizer setup\n  const parentRef = React.useRef<HTMLDivElement | null>(null);\n  const rowVirtualizer = useVirtualizer({\n    count: options.length,\n    getScrollElement: () => parentRef.current,\n    estimateSize: () => 32,\n    overscan: 8,\n  });\n\n  return (\n    <FormField\n      control={control}\n      name={name}\n      render={({ field }) => {\n        const selected = options.find((o) => o.value === field.value);\n        const displayLabel = selected ? selected.label : placeholder;\n        return (\n          <FormItem className={className}>\n            {label && <FormLabel>{label}</FormLabel>}\n            <Popover open={open} onOpenChange={setOpen}>\n              <PopoverTrigger asChild>\n                <FormControl>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={open}\n                    className=\"w-full justify-between\"\n                    disabled={disabled}\n                  >\n                    <span className={cn(!selected && \"text-muted-foreground\")}>{displayLabel}</span>\n                    <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </FormControl>\n              </PopoverTrigger>\n              <PopoverContent className=\"p-0\" align=\"start\">\n                <Command>\n                  <CommandInput placeholder=\"Search...\" value={search} onValueChange={setSearch} />\n                  <CommandList>\n                    {loading && <CommandEmpty>Loading...</CommandEmpty>}\n                    {!loading && options.length === 0 && <CommandEmpty>No results.</CommandEmpty>}\n                    <CommandGroup>\n                      <div\n                        ref={parentRef}\n                        style={{ height: 240, overflow: \"auto\", position: \"relative\" }}\n                      >\n                        <div\n                          style={{\n                            height: `${rowVirtualizer.getTotalSize()}px`,\n                            width: \"100%\",\n                            position: \"relative\",\n                          }}\n                        >\n                          {rowVirtualizer.getVirtualItems().map((vi) => {\n                            const o = options[vi.index];\n                            return (\n                              <div\n                                key={o.value}\n                                style={{\n                                  position: \"absolute\",\n                                  top: 0,\n                                  left: 0,\n                                  width: \"100%\",\n                                  transform: `translateY(${vi.start}px)`,\n                                }}\n                              >\n                                <CommandItem\n                                  value={o.value}\n                                  onSelect={() => {\n                                    field.onChange(o.value);\n                                    setOpen(false);\n                                  }}\n                                >\n                                  <Check\n                                    className={cn(\n                                      \"mr-2 h-4 w-4\",\n                                      field.value === o.value ? \"opacity-100\" : \"opacity-0\",\n                                    )}\n                                  />\n                                  {o.label}\n                                </CommandItem>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    </CommandGroup>\n                  </CommandList>\n                </Command>\n              </PopoverContent>\n            </Popover>\n            {description && <FormDescription>{description}</FormDescription>}\n            <FormMessage />\n          </FormItem>\n        );\n      }}\n    />\n  );\n}\n\nexport default {};","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/forms/FormLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/forms/FormPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/forms/fields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/Draggable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/Droppable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/KanbanBoard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/KanbanCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/KanbanColumn.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/KanbanFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/KanbanFunnel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/kanban/SwimLane.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/landing/FeaturesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/landing/HeroSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/layout/AppSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2315,2318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2315,2318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2350,2353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2350,2353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2547,2550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2547,2550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2582,2585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2582,2585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2775,2778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2775,2778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2810,2813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2810,2813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5681,5684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5681,5684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5726,5729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5726,5729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6952,6955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6952,6955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6990,6993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6990,6993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7519,7522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7519,7522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":135,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":138,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7566,7569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7566,7569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Home, Building2, Users, UserPlus, CheckSquare, Package, FileText, Settings, LogOut, TrendingUp, GitBranch, Mail } from 'lucide-react';\nimport { NavLink, useLocation } from 'react-router-dom';\nimport { useEffect, useRef } from 'react';\nimport { useAuth } from '@/hooks/useAuth';\nimport Logo from '@/components/branding/Logo';\nimport { APP_MENU } from '@/config/navigation';\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarFooter,\n  useSidebar,\n} from '@/components/ui/sidebar';\nimport { Button } from '@/components/ui/button';\nimport { RoleGuard } from '@/components/auth/RoleGuard';\n\nexport function AppSidebar() {\n  const { state } = useSidebar();\n  const { signOut, profile } = useAuth();\n  const collapsed = state === 'collapsed';\n  const location = useLocation();\n  const scrollRef = useRef<HTMLDivElement | null>(null);\n\n  // Restore saved scroll position on mount\n  useEffect(() => {\n    const saved = sessionStorage.getItem('sidebar:scrollTop');\n    const el = scrollRef.current;\n    if (el && saved) {\n      el.scrollTop = Number(saved);\n    }\n  }, []);\n\n  // Persist scroll position during scrolling\n  useEffect(() => {\n    const el = scrollRef.current;\n    if (!el) return;\n    const handler = () => sessionStorage.setItem('sidebar:scrollTop', String(el.scrollTop));\n    el.addEventListener('scroll', handler);\n    return () => el.removeEventListener('scroll', handler);\n  }, []);\n\n  // Ensure active item stays in view after navigation\n  useEffect(() => {\n    const container = scrollRef.current;\n    if (!container) return;\n    const activeLink = container.querySelector('a[aria-current=\"page\"]') as HTMLElement | null;\n    if (activeLink) {\n      const linkRect = activeLink.getBoundingClientRect();\n      const contRect = container.getBoundingClientRect();\n      const outOfView = linkRect.top < contRect.top || linkRect.bottom > contRect.bottom;\n      if (outOfView) {\n        activeLink.scrollIntoView({ block: 'nearest' });\n      }\n    }\n  }, [location]);\n\n  // Use Salesforce-style order from navigation config\n  const salesItems = (APP_MENU.find((m) => m.label === 'Sales')?.items ?? []).map((i) => ({\n    title: i.name,\n    url: i.path,\n    icon: i.icon,\n    roles: (i as any).roles,\n    permissions: (i as any).permissions,\n  }));\n\n  const logisticsItems = (APP_MENU.find((m) => m.label === 'Logistics')?.items ?? []).map((i) => ({\n    title: i.name,\n    url: i.path,\n    icon: i.icon,\n    roles: (i as any).roles,\n    permissions: (i as any).permissions,\n  }));\n\n  const billingItems = (APP_MENU.find((m) => m.label === 'Billing')?.items ?? []).map((i) => ({\n    title: i.name,\n    url: i.path,\n    icon: i.icon,\n    roles: (i as any).roles,\n    permissions: (i as any).permissions,\n  }));\n\n  const adminItems = [\n    { title: 'Lead Assignment', url: '/dashboard/lead-assignment', icon: GitBranch, roles: ['platform_admin', 'tenant_admin'], permissions: ['admin.lead_assignment.manage'] },\n    { title: 'Lead Routing', url: '/dashboard/lead-routing', icon: GitBranch, roles: ['platform_admin', 'tenant_admin'], permissions: ['admin.lead_routing.manage'] },\n    { title: 'Tenants', url: '/dashboard/tenants', icon: FileText, roles: ['platform_admin'], permissions: ['admin.tenants.manage'] },\n    { title: 'Franchises', url: '/dashboard/franchises', icon: Package, roles: ['platform_admin', 'tenant_admin'], permissions: ['admin.franchises.manage'] },\n    { title: 'Users', url: '/dashboard/users', icon: Users, roles: ['platform_admin', 'tenant_admin', 'franchise_admin'], permissions: ['admin.users.manage'] },\n  ];\n\n  const getNavClass = ({ isActive }: { isActive: boolean }) =>\n    isActive ? 'bg-primary/10 text-primary font-medium' : 'hover:bg-muted/50';\n\n  return (\n    <Sidebar className={collapsed ? 'w-14' : 'w-64'} collapsible=\"icon\">\n      <SidebarContent ref={scrollRef}>\n        <SidebarGroup>\n          <SidebarGroupLabel>\n            {collapsed ? (\n              <div className=\"flex justify-center\">\n                <Logo size={32} />\n              </div>\n            ) : (\n              <Logo size={36} showWordmark wordmarkClassName=\"hidden sm:block\" />\n            )}\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {salesItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton asChild>\n                    <NavLink to={item.url} end className={getNavClass}>\n                      <item.icon className=\"h-4 w-4\" />\n                      {!collapsed && <span>{item.title}</span>}\n                    </NavLink>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <SidebarGroup>\n          <SidebarGroupLabel>\n            {!collapsed && <span>Logistics</span>}\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {logisticsItems.map((item) => {\n                const node = (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton asChild>\n                      <NavLink to={item.url} className={getNavClass}>\n                        <item.icon className=\"h-4 w-4\" />\n                        {!collapsed && <span>{item.title}</span>}\n                      </NavLink>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                );\n                return item.roles || item.permissions ? (\n                  <RoleGuard key={item.title} roles={(item.roles as any) || []} permissions={item.permissions as any}>\n                    {node}\n                  </RoleGuard>\n                ) : node;\n              })}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <SidebarGroup>\n          <SidebarGroupLabel>\n            {!collapsed && <span>Billing</span>}\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {billingItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton asChild>\n                    <NavLink to={item.url} className={getNavClass}>\n                      <item.icon className=\"h-4 w-4\" />\n                      {!collapsed && <span>{item.title}</span>}\n                    </NavLink>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <SidebarGroup>\n          <SidebarGroupLabel>\n            {!collapsed && <span>Administration</span>}\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {adminItems.map((item) => (\n                <RoleGuard key={item.title} roles={item.roles as any} permissions={item.permissions as any}>\n                  <SidebarMenuItem>\n                    <SidebarMenuButton asChild>\n                      <NavLink to={item.url} className={getNavClass}>\n                        <item.icon className=\"h-4 w-4\" />\n                        {!collapsed && <span>{item.title}</span>}\n                      </NavLink>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                </RoleGuard>\n              ))}\n              <RoleGuard roles={[\"platform_admin\",\"tenant_admin\",\"franchise_admin\"] as any} permissions={[\"admin.settings.manage\"] as any}>\n                <SidebarMenuItem>\n                  <SidebarMenuButton asChild>\n                    <NavLink to=\"/dashboard/settings\" className={getNavClass}>\n                      <Settings className=\"h-4 w-4\" />\n                      {!collapsed && <span>Settings</span>}\n                    </NavLink>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              </RoleGuard>\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"border-t p-4\">\n        {!collapsed && profile && (\n          <div className=\"mb-3 space-y-1\">\n            <p className=\"text-sm font-medium truncate\">\n              {profile.first_name} {profile.last_name}\n            </p>\n            <p className=\"text-xs text-muted-foreground truncate\">{profile.email}</p>\n          </div>\n        )}\n        <Button\n          variant=\"ghost\"\n          size={collapsed ? 'icon' : 'sm'}\n          className=\"w-full justify-start\"\n          onClick={signOut}\n        >\n          <LogOut className=\"h-4 w-4\" />\n          {!collapsed && <span className=\"ml-2\">Sign Out</span>}\n        </Button>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/layout/DashboardLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/layout/ObjectMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/layout/StickyActionsContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":37,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":37,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\n\ntype ActionsConfig = {\n  left?: React.ReactNode[];\n  right?: React.ReactNode[];\n};\n\ntype StickyActionsContextValue = {\n  actions: ActionsConfig;\n  setActions: (config: ActionsConfig) => void;\n  clearActions: () => void;\n};\n\nconst StickyActionsContext = React.createContext<StickyActionsContextValue | null>(null);\n\nexport function StickyActionsProvider({ children }: { children: React.ReactNode }) {\n  const [actions, setActionsState] = React.useState<ActionsConfig>({ left: [], right: [] });\n\n  const setActions = React.useCallback((config: ActionsConfig) => {\n    setActionsState({\n      left: config.left ?? [],\n      right: config.right ?? [],\n    });\n  }, []);\n\n  const clearActions = React.useCallback(() => {\n    setActionsState({ left: [], right: [] });\n  }, []);\n\n  const value = React.useMemo<StickyActionsContextValue>(() => ({ actions, setActions, clearActions }), [actions, setActions, clearActions]);\n\n  return (\n    <StickyActionsContext.Provider value={value}>{children}</StickyActionsContext.Provider>\n  );\n}\n\nexport function useStickyActions() {\n  const ctx = React.useContext(StickyActionsContext);\n  if (!ctx) {\n    throw new Error('useStickyActions must be used within StickyActionsProvider');\n  }\n  return ctx;\n}\n\nexport default StickyActionsContext;","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/CargoDetailsForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/CargoTypeForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/CarrierForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1703,1706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1703,1706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2500,2503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2500,2503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3074,3077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3074,3077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3478,3481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3478,3481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3533,3536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3533,3536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3587,3590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3587,3590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3644,3647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3644,3647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3707,3710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3707,3710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3819,3822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3819,3822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4452,4455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4452,4455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6218,6221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6218,6221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6792,6795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6792,6795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'context.isPlatformAdmin', 'form', and 'supabase'. Either include them or remove the dependency array.","line":108,"column":6,"nodeType":"ArrayExpression","endLine":108,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [carrierId, context.isPlatformAdmin, form, supabase]","fix":{"range":[3985,3996],"text":"[carrierId, context.isPlatformAdmin, form, supabase]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from 'sonner';\n\nconst carrierSchema = z.object({\n  carrier_name: z.string().min(1, 'Carrier name is required'),\n  carrier_code: z.string().optional(),\n  carrier_type: z.enum(['ocean', 'air', 'trucking', 'courier', 'rail']).optional(),\n  contact_person: z.string().optional(),\n  contact_email: z.string().email().optional().or(z.literal('')),\n  contact_phone: z.string().optional(),\n  website: z.string().url().optional().or(z.literal('')),\n  rating: z.string().optional(),\n  notes: z.string().optional(),\n  is_active: z.boolean().optional(),\n  street: z.string().optional(),\n  city: z.string().optional(),\n  state: z.string().optional(),\n  country: z.string().optional(),\n  postal_code: z.string().optional(),\n  tenant_id: z.string().optional(),\n});\n\nexport function CarrierForm({ carrierId, onSuccess }: { carrierId?: string; onSuccess?: () => void }) {\n  const { context, supabase } = useCRM();\n  const { roles } = useAuth();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [tenants, setTenants] = useState<any[]>([]);\n\n  const form = useForm<z.infer<typeof carrierSchema>>({\n    resolver: zodResolver(carrierSchema),\n    defaultValues: {\n      carrier_name: '',\n      carrier_code: '',\n      contact_person: '',\n      contact_email: '',\n      contact_phone: '',\n      website: '',\n      notes: '',\n      is_active: true,\n      tenant_id: context.tenantId || roles?.[0]?.tenant_id || '',\n    },\n  });\n\n  // Load existing carrier in edit mode\n  useEffect(() => {\n    const fetchTenants = async () => {\n      if (!context.isPlatformAdmin) return;\n      try {\n        const { data, error } = await supabase\n          .from('tenants')\n          .select('id, name')\n          .eq('is_active', true)\n          .order('name');\n        if (error) throw error;\n        setTenants(data || []);\n      } catch (err: any) {\n        console.warn('Failed to fetch tenants:', err?.message || err);\n      }\n    };\n    fetchTenants();\n\n    const loadCarrier = async () => {\n      if (!carrierId) return;\n      try {\n        const { data, error } = await supabase\n          .from('carriers')\n          .select('*')\n          .eq('id', carrierId)\n          .maybeSingle();\n        if (error) throw error;\n        if (data) {\n          form.reset({\n            carrier_name: data.carrier_name || '',\n            carrier_code: data.carrier_code || '',\n            carrier_type: (data.carrier_type as any) || undefined,\n            contact_person: data.contact_person || '',\n            contact_email: data.contact_email || '',\n            contact_phone: data.contact_phone || '',\n            website: data.website || '',\n            rating: data.rating != null ? String(data.rating) : '',\n            notes: data.notes || '',\n            is_active: !!data.is_active,\n            street: (data.address as any)?.street || '',\n            city: (data.address as any)?.city || '',\n            state: (data.address as any)?.state || '',\n            country: (data.address as any)?.country || '',\n            postal_code: (data.address as any)?.postal_code || '',\n            tenant_id: data.tenant_id || '',\n          });\n        }\n      } catch (e: any) {\n        toast.error(e.message || 'Failed to load carrier');\n      }\n    };\n    loadCarrier();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [carrierId]);\n\n  const onSubmit = async (values: z.infer<typeof carrierSchema>) => {\n    const contextTenantId = context.tenantId || roles?.[0]?.tenant_id;\n    const selectedTenantId = values.tenant_id?.trim() || '';\n\n    // Only require tenant when creating a new carrier\n    if (!carrierId && !context.isPlatformAdmin && !contextTenantId) {\n      toast.error('No tenant selected');\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const carrierData: any = {\n        carrier_name: values.carrier_name,\n        carrier_code: values.carrier_code || null,\n        carrier_type: values.carrier_type || null,\n        contact_person: values.contact_person || null,\n        contact_email: values.contact_email || null,\n        contact_phone: values.contact_phone || null,\n        website: values.website || null,\n        rating: values.rating ? parseFloat(values.rating) : null,\n        notes: values.notes || null,\n        is_active: values.is_active ?? true,\n        address: {\n          street: values.street || '',\n          city: values.city || '',\n          state: values.state || '',\n          country: values.country || '',\n          postal_code: values.postal_code || '',\n        },\n      };\n      if (carrierId) {\n        // Allow platform admins to change tenant association\n        if (context.isPlatformAdmin && selectedTenantId) {\n          carrierData.tenant_id = selectedTenantId;\n        }\n        const { error } = await supabase\n          .from('carriers')\n          .update(carrierData)\n          .eq('id', carrierId);\n        if (error) throw error;\n        toast.success('Carrier updated successfully');\n        onSuccess?.();\n      } else {\n        const effectiveTenantId = context.isPlatformAdmin\n          ? (selectedTenantId || contextTenantId)\n          : contextTenantId;\n        if (!effectiveTenantId) {\n          toast.error('Please select a tenant');\n          setIsSubmitting(false);\n          return;\n        }\n        const { error } = await supabase.from('carriers').insert([{ ...carrierData, tenant_id: effectiveTenantId }]);\n        if (error) throw error;\n        toast.success('Carrier created successfully');\n        onSuccess?.();\n        form.reset();\n      }\n    } catch (error: any) {\n      toast.error(error.message || (carrierId ? 'Failed to update carrier' : 'Failed to create carrier'));\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!carrierId) return;\n    if (!confirm('Delete this carrier? This action cannot be undone.')) return;\n    setIsSubmitting(true);\n    try {\n      const { error } = await supabase\n        .from('carriers')\n        .delete()\n        .eq('id', carrierId);\n      if (error) throw error;\n      toast.success('Carrier deleted');\n      onSuccess?.();\n    } catch (e: any) {\n      toast.error(e.message || 'Failed to delete carrier');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        {context.isPlatformAdmin && (\n          <FormField\n            control={form.control}\n            name=\"tenant_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Tenant</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value || undefined}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select tenant\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {tenants.map((tenant) => (\n                      <SelectItem key={tenant.id} value={tenant.id}>\n                        {tenant.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"carrier_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Carrier Name *</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"carrier_code\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Carrier Code</FormLabel>\n                <FormControl>\n                  <Input {...field} placeholder=\"e.g., MAEU, COSCO\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"carrier_type\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Carrier Type</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select type\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"ocean\">Ocean Freight</SelectItem>\n                    <SelectItem value=\"air\">Air Freight</SelectItem>\n                    <SelectItem value=\"trucking\">Trucking</SelectItem>\n                    <SelectItem value=\"courier\">Courier</SelectItem>\n                    <SelectItem value=\"rail\">Rail</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"rating\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Rating (0-5)</FormLabel>\n                <FormControl>\n                  <Input type=\"number\" step=\"0.1\" min=\"0\" max=\"5\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"contact_person\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Contact Person</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"contact_email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Contact Email</FormLabel>\n                <FormControl>\n                  <Input type=\"email\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"contact_phone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Contact Phone</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"website\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Website</FormLabel>\n                <FormControl>\n                  <Input {...field} placeholder=\"https://\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"space-y-4\">\n          <h3 className=\"font-medium\">Address</h3>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"street\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Street</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"city\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>City</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"state\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>State/Province</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"country\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Country</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"postal_code\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Postal Code</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"notes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Notes</FormLabel>\n              <FormControl>\n                <Textarea {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex items-center gap-3\">\n            <FormField\n              control={form.control}\n              name=\"is_active\"\n              render={({ field }) => (\n                <FormItem className=\"flex items-center gap-2\">\n                  <FormLabel>Active</FormLabel>\n                  <FormControl>\n                    <Switch checked={!!field.value} onCheckedChange={field.onChange} />\n                  </FormControl>\n                </FormItem>\n              )}\n            />\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {carrierId && (\n              <Button type=\"button\" variant=\"destructive\" onClick={handleDelete} disabled={isSubmitting}>\n                Delete\n              </Button>\n            )}\n            <Button type=\"submit\" disabled={isSubmitting}>\n              {isSubmitting ? (carrierId ? 'Saving...' : 'Creating...') : (carrierId ? 'Save Changes' : 'Create Carrier')}\n            </Button>\n          </div>\n        </div>\n      </form>\n    </Form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/ConsigneeForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[620,623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[620,623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[641,644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[641,644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[940,943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[940,943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3317,3320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3317,3320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3835,3838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3835,3838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4952,4955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4952,4955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'form' and 'supabase'. Either include them or remove the dependency array.","line":102,"column":6,"nodeType":"ArrayExpression","endLine":102,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [consigneeId, form, supabase]","fix":{"range":[3534,3547],"text":"[consigneeId, form, supabase]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from 'sonner';\n\n// Safely convert Supabase JSON/text to an object record\nconst toRecord = (value: any): Record<string, any> => {\n  if (!value) return {};\n  if (typeof value === 'string') {\n    try {\n      const parsed = JSON.parse(value);\n      return typeof parsed === 'object' && parsed !== null ? parsed : {};\n    } catch {\n      return {};\n    }\n  }\n  if (typeof value === 'object') return value as Record<string, any>;\n  return {};\n};\nconst consigneeSchema = z.object({\n  company_name: z.string().min(1, 'Company name is required'),\n  contact_person: z.string().optional(),\n  contact_email: z.string().email().optional().or(z.literal('')),\n  contact_phone: z.string().optional(),\n  tax_id: z.string().optional(),\n  customs_id: z.string().optional(),\n  notes: z.string().optional(),\n  street: z.string().optional(),\n  city: z.string().optional(),\n  state: z.string().optional(),\n  country: z.string().optional(),\n  postal_code: z.string().optional(),\n});\n\nexport function ConsigneeForm({ consigneeId, onSuccess }: { consigneeId?: string; onSuccess?: () => void }) {\n  const { context, supabase } = useCRM();\n  const { roles } = useAuth();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const form = useForm<z.infer<typeof consigneeSchema>>({\n    resolver: zodResolver(consigneeSchema),\n    defaultValues: {\n      company_name: '',\n      contact_person: '',\n      contact_email: '',\n      contact_phone: '',\n      tax_id: '',\n      customs_id: '',\n      notes: '',\n      street: '',\n      city: '',\n      state: '',\n      country: '',\n      postal_code: '',\n    },\n  });\n\n  useEffect(() => {\n    const loadConsignee = async () => {\n      if (!consigneeId) return;\n      setIsLoading(true);\n      try {\n        const { data, error } = await supabase\n          .from('consignees')\n          .select('*')\n          .eq('id', consigneeId)\n          .single();\n        if (error) throw error;\n        if (data) {\n          const addr = toRecord(data.address);\n          form.reset({\n            company_name: data.company_name || '',\n            contact_person: data.contact_person || '',\n            contact_email: data.contact_email || '',\n            contact_phone: data.contact_phone || '',\n            tax_id: data.tax_id || '',\n            customs_id: data.customs_id || '',\n            notes: data.notes || '',\n            street: typeof addr.street === 'string' ? addr.street : '',\n            city: typeof addr.city === 'string' ? addr.city : '',\n            state: typeof addr.state === 'string' ? addr.state : '',\n            country: typeof addr.country === 'string' ? addr.country : '',\n            postal_code: typeof addr.postal_code === 'string' ? addr.postal_code : '',\n          });\n        }\n      } catch (e: any) {\n        toast.error(e.message || 'Failed to load consignee');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadConsignee();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [consigneeId]);\n\n  const onSubmit = async (values: z.infer<typeof consigneeSchema>) => {\n    const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n\n    if (!tenantId) {\n      toast.error('No tenant selected');\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const consigneeData: any = {\n        company_name: values.company_name,\n        contact_person: values.contact_person || null,\n        contact_email: values.contact_email || null,\n        contact_phone: values.contact_phone || null,\n        tax_id: values.tax_id || null,\n        customs_id: values.customs_id || null,\n        notes: values.notes || null,\n        address: {\n          street: values.street || '',\n          city: values.city || '',\n          state: values.state || '',\n          country: values.country || '',\n          postal_code: values.postal_code || '',\n        },\n        tenant_id: tenantId,\n      };\n\n      if (consigneeId) {\n        const { error } = await supabase\n          .from('consignees')\n          .update(consigneeData)\n          .eq('id', consigneeId);\n        if (error) throw error;\n        toast.success('Consignee updated successfully');\n      } else {\n        const { error } = await supabase.from('consignees').insert([consigneeData]);\n        if (error) throw error;\n        toast.success('Consignee created successfully');\n        form.reset();\n      }\n      onSuccess?.();\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to create consignee');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <FormField\n          control={form.control}\n          name=\"company_name\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Company Name *</FormLabel>\n              <FormControl>\n                <Input {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"contact_person\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Contact Person</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"contact_email\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Contact Email</FormLabel>\n                <FormControl>\n                  <Input type=\"email\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"contact_phone\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Contact Phone</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"tax_id\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Tax ID</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"customs_id\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Customs ID</FormLabel>\n              <FormControl>\n                <Input {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"space-y-4\">\n          <h3 className=\"font-medium\">Address</h3>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"street\"\n              render={({ field }) => (\n                <FormItem className=\"col-span-2\">\n                  <FormLabel>Street</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"city\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>City</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"state\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>State/Province</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"country\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Country</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"postal_code\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Postal Code</FormLabel>\n                  <FormControl>\n                    <Input {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"notes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Notes</FormLabel>\n              <FormControl>\n                <Textarea {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <Button type=\"submit\" disabled={isSubmitting || isLoading}>\n          {isSubmitting ? (consigneeId ? 'Updating...' : 'Creating...') : (consigneeId ? 'Update Consignee' : 'Create Consignee')}\n        </Button>\n      </form>\n    </Form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/IncotermForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1340,1343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1340,1343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1493,1496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1493,1496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { toast } from \"sonner\";\n\nconst formSchema = z.object({\n  incoterm_code: z.string().min(1, \"Incoterm code is required\"),\n  incoterm_name: z.string().min(1, \"Incoterm name is required\"),\n  description: z.string().optional(),\n  is_active: z.boolean().default(true),\n});\n\ninterface IncotermFormProps {\n  onSuccess?: () => void;\n}\n\nexport function IncotermForm({ onSuccess }: IncotermFormProps) {\n  const { supabase, context } = useCRM();\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      incoterm_code: \"\",\n      incoterm_name: \"\",\n      description: \"\",\n      is_active: true,\n    },\n  });\n\n  async function onSubmit(values: z.infer<typeof formSchema>) {\n    try {\n      const { error } = await supabase.from(\"incoterms\").insert({\n        ...values,\n        tenant_id: context.tenantId!,\n      } as any);\n\n      if (error) throw error;\n\n      toast.success(\"Incoterm created successfully\");\n      form.reset();\n      onSuccess?.();\n    } catch (error: any) {\n      toast.error(error.message || \"Failed to create incoterm\");\n    }\n  }\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"incoterm_code\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Incoterm Code</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"FOB\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"incoterm_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Incoterm Name</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Free on Board\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"description\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Description</FormLabel>\n              <FormControl>\n                <Textarea placeholder=\"Seller delivers goods on board the vessel...\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"is_active\"\n          render={({ field }) => (\n            <FormItem className=\"flex items-center justify-between rounded-lg border p-3\">\n              <div>\n                <FormLabel>Active</FormLabel>\n              </div>\n              <FormControl>\n                <Switch checked={field.value} onCheckedChange={field.onChange} />\n              </FormControl>\n            </FormItem>\n          )}\n        />\n\n        <Button type=\"submit\" className=\"w-full\">\n          Create Incoterm\n        </Button>\n      </form>\n    </Form>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/PackageCategoryForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/PackageSizeForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/PortLocationForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[777,780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[777,780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[798,801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[798,801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1097,1100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1097,1100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2908,2911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2908,2911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3860,3863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3860,3863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4382,4385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4382,4385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5555,5558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5555,5558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'form' and 'supabase'. Either include them or remove the dependency array.","line":107,"column":6,"nodeType":"ArrayExpression","endLine":107,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [form, locationId, supabase]","fix":{"range":[4080,4092],"text":"[form, locationId, supabase]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from 'sonner';\n\n// Safely convert Supabase JSON/text to an object record\nconst toRecord = (value: any): Record<string, any> => {\n  if (!value) return {};\n  if (typeof value === 'string') {\n    try {\n      const parsed = JSON.parse(value);\n      return typeof parsed === 'object' && parsed !== null ? parsed : {};\n    } catch {\n      return {};\n    }\n  }\n  if (typeof value === 'object') return value as Record<string, any>;\n  return {};\n};\nconst portLocationSchema = z.object({\n  location_name: z.string().min(1, 'Location name is required'),\n  location_code: z.string().optional(),\n  location_type: z.enum(['seaport', 'airport', 'inland_port', 'warehouse', 'terminal']).optional(),\n  country: z.string().optional(),\n  city: z.string().optional(),\n  state_province: z.string().optional(),\n  postal_code: z.string().optional(),\n  operating_hours: z.string().optional(),\n  customs_available: z.boolean().default(false),\n  notes: z.string().optional(),\n  latitude: z.string().optional(),\n  longitude: z.string().optional(),\n});\n\nexport function PortLocationForm({ locationId, onSuccess }: { locationId?: string; onSuccess?: () => void }) {\n  const { context, supabase } = useCRM();\n  const { roles } = useAuth();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const form = useForm<z.infer<typeof portLocationSchema>>({\n    resolver: zodResolver(portLocationSchema),\n    defaultValues: {\n      location_name: '',\n      location_code: '',\n      country: '',\n      city: '',\n      state_province: '',\n      postal_code: '',\n      operating_hours: '',\n      customs_available: false,\n      notes: '',\n      latitude: '',\n      longitude: '',\n    },\n  });\n\n  useEffect(() => {\n    const loadLocation = async () => {\n      if (!locationId) return;\n      setIsLoading(true);\n      try {\n        const { data, error } = await supabase\n          .from('ports_locations')\n          .select('*')\n          .eq('id', locationId)\n          .single();\n        if (error) throw error;\n        if (data) {\n          const typeOptions = ['seaport', 'airport', 'inland_port', 'warehouse', 'terminal'] as const;\n          const typeValue = typeOptions.includes(data.location_type as any)\n            ? (data.location_type as (typeof typeOptions)[number])\n            : undefined;\n          const coords = toRecord(data.coordinates);\n          form.reset({\n            location_name: data.location_name || '',\n            location_code: data.location_code || '',\n            location_type: typeValue,\n            country: data.country || '',\n            city: data.city || '',\n            state_province: data.state_province || '',\n            postal_code: data.postal_code || '',\n            operating_hours: data.operating_hours || '',\n            customs_available: !!data.customs_available,\n            notes: data.notes || '',\n            latitude: typeof coords.latitude === 'number' || typeof coords.latitude === 'string' ? String(coords.latitude) : '',\n            longitude: typeof coords.longitude === 'number' || typeof coords.longitude === 'string' ? String(coords.longitude) : '',\n          });\n        }\n      } catch (e: any) {\n        toast.error(e.message || 'Failed to load port/location');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadLocation();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [locationId]);\n\n  const onSubmit = async (values: z.infer<typeof portLocationSchema>) => {\n    const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n\n    if (!tenantId) {\n      toast.error('No tenant selected');\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const locationData: any = {\n        location_name: values.location_name,\n        location_code: values.location_code || null,\n        location_type: values.location_type || null,\n        country: values.country || null,\n        city: values.city || null,\n        state_province: values.state_province || null,\n        postal_code: values.postal_code || null,\n        operating_hours: values.operating_hours || null,\n        customs_available: values.customs_available,\n        notes: values.notes || null,\n        coordinates: {\n          latitude: values.latitude || '',\n          longitude: values.longitude || '',\n        },\n        tenant_id: tenantId,\n      };\n\n      if (locationId) {\n        const { error } = await supabase\n          .from('ports_locations')\n          .update(locationData)\n          .eq('id', locationId);\n        if (error) throw error;\n        toast.success('Port/Location updated successfully');\n      } else {\n        const { error } = await supabase.from('ports_locations').insert([locationData]);\n        if (error) throw error;\n        toast.success('Port/Location created successfully');\n        form.reset();\n      }\n      onSuccess?.();\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to create port/location');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"location_name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Location Name *</FormLabel>\n                <FormControl>\n                  <Input {...field} placeholder=\"e.g., Port of Singapore\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"location_code\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Location Code</FormLabel>\n                <FormControl>\n                  <Input {...field} placeholder=\"e.g., SGSIN, JPTYO\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"location_type\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Location Type</FormLabel>\n              <Select onValueChange={field.onChange} defaultValue={field.value}>\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select type\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  <SelectItem value=\"seaport\">Seaport</SelectItem>\n                  <SelectItem value=\"airport\">Airport</SelectItem>\n                  <SelectItem value=\"inland_port\">Inland Port</SelectItem>\n                  <SelectItem value=\"warehouse\">Warehouse</SelectItem>\n                  <SelectItem value=\"terminal\">Terminal</SelectItem>\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"city\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>City</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"state_province\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>State/Province</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"country\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Country</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"postal_code\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Postal Code</FormLabel>\n                <FormControl>\n                  <Input {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"latitude\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Latitude</FormLabel>\n                <FormControl>\n                  <Input {...field} placeholder=\"e.g., 1.2897\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"longitude\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Longitude</FormLabel>\n                <FormControl>\n                  <Input {...field} placeholder=\"e.g., 103.8501\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"operating_hours\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Operating Hours</FormLabel>\n              <FormControl>\n                <Input {...field} placeholder=\"e.g., Mon-Fri 8AM-6PM\" />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"customs_available\"\n          render={({ field }) => (\n            <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n              <FormControl>\n                <Checkbox\n                  checked={field.value}\n                  onCheckedChange={field.onChange}\n                />\n              </FormControl>\n              <div className=\"space-y-1 leading-none\">\n                <FormLabel>Customs Available</FormLabel>\n              </div>\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"notes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Notes</FormLabel>\n              <FormControl>\n                <Textarea {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <Button type=\"submit\" disabled={isSubmitting || isLoading}>\n          {isSubmitting ? (locationId ? 'Updating...' : 'Creating...') : (locationId ? 'Update Port/Location' : 'Create Port/Location')}\n        </Button>\n      </form>\n    </Form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/ShipmentForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/ShipmentStats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/TrackingTimeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEvents'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchEvents, shipmentId]","fix":{"range":[807,819],"text":"[fetchEvents, shipmentId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { MapPin, Calendar, CheckCircle2 } from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { useCRM } from '@/hooks/useCRM';\nimport { format } from 'date-fns';\n\ninterface TrackingEvent {\n  id: string;\n  event_type: string;\n  event_date: string;\n  location_name: string | null;\n  description: string | null;\n  is_milestone: boolean;\n}\n\ninterface TrackingTimelineProps {\n  shipmentId: string;\n}\n\nexport function TrackingTimeline({ shipmentId }: TrackingTimelineProps) {\n  const [events, setEvents] = useState<TrackingEvent[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { supabase } = useCRM();\n\n  useEffect(() => {\n    fetchEvents();\n  }, [shipmentId]);\n\n  const fetchEvents = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tracking_events')\n        .select('*')\n        .eq('shipment_id', shipmentId)\n        .order('event_date', { ascending: false });\n\n      if (error) throw error;\n      setEvents(data || []);\n    } catch (error) {\n      console.error('Error fetching tracking events:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getEventColor = (eventType: string) => {\n    const colors: Record<string, string> = {\n      created: 'bg-blue-500',\n      confirmed: 'bg-green-500',\n      picked_up: 'bg-purple-500',\n      in_transit: 'bg-cyan-500',\n      customs_clearance: 'bg-yellow-500',\n      customs_released: 'bg-teal-500',\n      arrived_at_hub: 'bg-indigo-500',\n      out_for_delivery: 'bg-orange-500',\n      delivered: 'bg-green-600',\n      delayed: 'bg-red-500',\n      exception: 'bg-red-600',\n      returned: 'bg-gray-500',\n    };\n    return colors[eventType] || 'bg-gray-400';\n  };\n\n  const formatEventType = (type: string) => {\n    return type.split('_').map(word => \n      word.charAt(0).toUpperCase() + word.slice(1)\n    ).join(' ');\n  };\n\n  if (loading) {\n    return <div className=\"text-center py-8\">Loading tracking information...</div>;\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Tracking Timeline</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          {events.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No tracking events yet\n            </div>\n          ) : (\n            events.map((event, index) => (\n              <div key={event.id} className=\"relative flex gap-4\">\n                {index < events.length - 1 && (\n                  <div className=\"absolute left-5 top-12 bottom-0 w-0.5 bg-border\" />\n                )}\n                \n                <div className={`relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full ${getEventColor(event.event_type)}`}>\n                  {event.is_milestone ? (\n                    <CheckCircle2 className=\"h-5 w-5 text-white\" />\n                  ) : (\n                    <MapPin className=\"h-5 w-5 text-white\" />\n                  )}\n                </div>\n\n                <div className=\"flex-1 space-y-1\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <h4 className=\"font-semibold\">{formatEventType(event.event_type)}</h4>\n                      {event.is_milestone && (\n                        <Badge variant=\"outline\" className=\"text-xs\">Milestone</Badge>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                      <Calendar className=\"h-4 w-4\" />\n                      {format(new Date(event.event_date), 'MMM dd, yyyy HH:mm')}\n                    </div>\n                  </div>\n                  \n                  {event.location_name && (\n                    <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                      <MapPin className=\"h-4 w-4\" />\n                      {event.location_name}\n                    </div>\n                  )}\n                  \n                  {event.description && (\n                    <p className=\"text-sm text-muted-foreground\">{event.description}</p>\n                  )}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/VehicleForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/logistics/WarehouseForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/roles/CustomRoleDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1482,1485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1482,1485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2451,2454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2451,2454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4996,4999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4996,4999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { toast } from \"sonner\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { ROLE_PERMISSIONS } from \"@/config/permissions\";\n\nconst formSchema = z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  description: z.string().optional(),\n  is_active: z.boolean().default(true),\n  permissions: z.array(z.object({\n    key: z.string(),\n    access_type: z.enum(['grant', 'deny']),\n  })).min(1, \"Select at least one permission\"),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface CustomRoleDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  role?: any;\n}\n\nexport function CustomRoleDialog({ open, onOpenChange, role }: CustomRoleDialogProps) {\n  const { profile } = useAuth();\n  const queryClient = useQueryClient();\n  const [allPermissions, setAllPermissions] = useState<string[]>([]);\n\n  useEffect(() => {\n    // Extract all unique permissions from ROLE_PERMISSIONS\n    const permissions = new Set<string>();\n    Object.values(ROLE_PERMISSIONS).forEach((rolePerms) => {\n      rolePerms.forEach((perm) => permissions.add(perm));\n    });\n    setAllPermissions(Array.from(permissions).sort());\n  }, []);\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      is_active: true,\n      permissions: [],\n    },\n  });\n\n  useEffect(() => {\n    if (role) {\n      form.reset({\n        name: role.name,\n        description: role.description || \"\",\n        is_active: role.is_active,\n        permissions: role.custom_role_permissions?.map((p: any) => ({\n          key: p.permission_key,\n          access_type: p.access_type || 'grant'\n        })) || [],\n      });\n    } else {\n      form.reset({\n        name: \"\",\n        description: \"\",\n        is_active: true,\n        permissions: [],\n      });\n    }\n  }, [role, form]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      if (role) {\n        // Update existing role\n        const { error: roleError } = await supabase\n          .from(\"custom_roles\")\n          .update({\n            name: data.name,\n            description: data.description,\n            is_active: data.is_active,\n          })\n          .eq(\"id\", role.id);\n\n        if (roleError) throw roleError;\n\n        // Delete old permissions\n        const { error: deleteError } = await supabase\n          .from(\"custom_role_permissions\")\n          .delete()\n          .eq(\"role_id\", role.id);\n\n        if (deleteError) throw deleteError;\n\n        // Insert new permissions\n        if (data.permissions.length > 0) {\n          const { error: permError } = await supabase\n            .from(\"custom_role_permissions\")\n            .insert(\n              data.permissions.map((perm) => ({\n                role_id: role.id,\n                permission_key: perm.key,\n                access_type: perm.access_type,\n              }))\n            );\n\n          if (permError) throw permError;\n        }\n      } else {\n        // Create new role\n        const { data: newRole, error: roleError } = await supabase\n          .from(\"custom_roles\")\n          .insert({\n            name: data.name,\n            description: data.description,\n            is_active: data.is_active,\n            tenant_id: profile?.id, // This should be the actual tenant_id\n          })\n          .select()\n          .single();\n\n        if (roleError) throw roleError;\n\n        // Insert permissions\n        if (data.permissions.length > 0) {\n          const { error: permError } = await supabase\n            .from(\"custom_role_permissions\")\n            .insert(\n              data.permissions.map((perm) => ({\n                role_id: newRole.id,\n                permission_key: perm.key,\n                access_type: perm.access_type,\n              }))\n            );\n\n          if (permError) throw permError;\n        }\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"custom_roles\"] });\n      toast.success(role ? \"Role updated successfully\" : \"Role created successfully\");\n      onOpenChange(false);\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"Failed to save role\");\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    saveMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>{role ? \"Edit Custom Role\" : \"Create Custom Role\"}</DialogTitle>\n          <DialogDescription>\n            Define a custom role with specific permissions for your organization\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Role Name</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Sales Manager\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Description</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Describe what this role can do...\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"is_active\"\n              render={({ field }) => (\n                <FormItem className=\"flex items-center justify-between rounded-lg border p-4\">\n                  <div className=\"space-y-0.5\">\n                    <FormLabel>Active</FormLabel>\n                    <FormDescription>\n                      Inactive roles cannot be assigned to users\n                    </FormDescription>\n                  </div>\n                  <FormControl>\n                    <Switch\n                      checked={field.value}\n                      onCheckedChange={field.onChange}\n                    />\n                  </FormControl>\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"permissions\"\n              render={() => (\n                <FormItem>\n                  <div className=\"mb-4\">\n                    <FormLabel>Permissions</FormLabel>\n                    <FormDescription>\n                      Grant or deny permissions to override default role permissions\n                    </FormDescription>\n                  </div>\n                  <ScrollArea className=\"h-[300px] rounded-md border p-4\">\n                    <div className=\"space-y-2\">\n                      {allPermissions.map((permission) => (\n                        <FormField\n                          key={permission}\n                          control={form.control}\n                          name=\"permissions\"\n                          render={({ field }) => {\n                            const existingPerm = field.value?.find(p => p.key === permission);\n                            const isGranted = existingPerm?.access_type === 'grant';\n                            const isDenied = existingPerm?.access_type === 'deny';\n                            \n                            return (\n                              <div\n                                key={permission}\n                                className=\"flex items-center justify-between p-2 rounded hover:bg-accent\"\n                              >\n                                <FormLabel className=\"font-normal flex-1 cursor-pointer\">\n                                  {permission}\n                                </FormLabel>\n                                <div className=\"flex gap-2\">\n                                  <Button\n                                    type=\"button\"\n                                    size=\"sm\"\n                                    variant={isGranted ? \"default\" : \"outline\"}\n                                    onClick={() => {\n                                      const newPerms = field.value?.filter(p => p.key !== permission) || [];\n                                      if (!isGranted) {\n                                        field.onChange([...newPerms, { key: permission, access_type: 'grant' as const }]);\n                                      } else {\n                                        field.onChange(newPerms);\n                                      }\n                                    }}\n                                  >\n                                    Grant\n                                  </Button>\n                                  <Button\n                                    type=\"button\"\n                                    size=\"sm\"\n                                    variant={isDenied ? \"destructive\" : \"outline\"}\n                                    onClick={() => {\n                                      const newPerms = field.value?.filter(p => p.key !== permission) || [];\n                                      if (!isDenied) {\n                                        field.onChange([...newPerms, { key: permission, access_type: 'deny' as const }]);\n                                      } else {\n                                        field.onChange(newPerms);\n                                      }\n                                    }}\n                                  >\n                                    Deny\n                                  </Button>\n                                </div>\n                              </div>\n                            );\n                          }}\n                        />\n                      ))}\n                    </div>\n                  </ScrollArea>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={saveMutation.isPending}>\n                {saveMutation.isPending ? \"Saving...\" : role ? \"Update Role\" : \"Create Role\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/roles/UserRoleAssignment.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2219,2222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2219,2222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2764,2767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2764,2767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { toast } from \"sonner\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { X, Plus } from \"lucide-react\";\n\ninterface UserRoleAssignmentProps {\n  userId: string;\n}\n\nexport function UserRoleAssignment({ userId }: UserRoleAssignmentProps) {\n  const { profile } = useAuth();\n  const queryClient = useQueryClient();\n  const [selectedRoleId, setSelectedRoleId] = useState<string>(\"\");\n\n  // Fetch available custom roles\n  const { data: availableRoles } = useQuery({\n    queryKey: [\"custom_roles\"],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from(\"custom_roles\")\n        .select(\"*\")\n        .eq(\"is_active\", true)\n        .order(\"name\");\n      if (error) throw error;\n      return data;\n    },\n  });\n\n  // Fetch user's assigned custom roles\n  const { data: userRoles, isLoading } = useQuery({\n    queryKey: [\"user_custom_roles\", userId],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from(\"user_custom_roles\")\n        .select(`\n          *,\n          custom_roles(*)\n        `)\n        .eq(\"user_id\", userId);\n      if (error) throw error;\n      return data;\n    },\n  });\n\n  // Assign role mutation\n  const assignMutation = useMutation({\n    mutationFn: async (roleId: string) => {\n      const { error } = await supabase.from(\"user_custom_roles\").insert({\n        user_id: userId,\n        role_id: roleId,\n        tenant_id: profile?.id, // Should be actual tenant_id\n        assigned_by: profile?.id,\n      });\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"user_custom_roles\", userId] });\n      toast.success(\"Role assigned successfully\");\n      setSelectedRoleId(\"\");\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"Failed to assign role\");\n    },\n  });\n\n  // Revoke role mutation\n  const revokeMutation = useMutation({\n    mutationFn: async (assignmentId: string) => {\n      const { error } = await supabase\n        .from(\"user_custom_roles\")\n        .delete()\n        .eq(\"id\", assignmentId);\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"user_custom_roles\", userId] });\n      toast.success(\"Role revoked successfully\");\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"Failed to revoke role\");\n    },\n  });\n\n  const handleAssign = () => {\n    if (selectedRoleId) {\n      assignMutation.mutate(selectedRoleId);\n    }\n  };\n\n  const handleRevoke = (assignmentId: string) => {\n    revokeMutation.mutate(assignmentId);\n  };\n\n  // Filter out already assigned roles\n  const unassignedRoles = availableRoles?.filter(\n    (role) => !userRoles?.some((ur) => ur.role_id === role.id)\n  );\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Custom Roles</CardTitle>\n        <CardDescription>Manage additional custom roles for this user</CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* Assigned roles */}\n        <div>\n          <p className=\"text-sm font-medium mb-2\">Assigned Roles:</p>\n          {isLoading ? (\n            <div className=\"flex gap-2\">\n              <div className=\"h-6 w-20 bg-muted rounded animate-pulse\" />\n              <div className=\"h-6 w-24 bg-muted rounded animate-pulse\" />\n            </div>\n          ) : userRoles && userRoles.length > 0 ? (\n            <div className=\"flex flex-wrap gap-2\">\n              {userRoles.map((assignment) => (\n                <Badge key={assignment.id} variant=\"secondary\" className=\"gap-1\">\n                  {assignment.custom_roles?.name}\n                  <button\n                    onClick={() => handleRevoke(assignment.id)}\n                    className=\"ml-1 hover:bg-destructive hover:text-destructive-foreground rounded-full p-0.5\"\n                  >\n                    <X className=\"w-3 h-3\" />\n                  </button>\n                </Badge>\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground\">No custom roles assigned</p>\n          )}\n        </div>\n\n        {/* Assign new role */}\n        {unassignedRoles && unassignedRoles.length > 0 && (\n          <div className=\"flex gap-2\">\n            <Select value={selectedRoleId} onValueChange={setSelectedRoleId}>\n              <SelectTrigger className=\"flex-1\">\n                <SelectValue placeholder=\"Select a role to assign\" />\n              </SelectTrigger>\n              <SelectContent>\n                {unassignedRoles.map((role) => (\n                  <SelectItem key={role.id} value={role.id}>\n                    {role.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Button\n              onClick={handleAssign}\n              disabled={!selectedRoleId || assignMutation.isPending}\n            >\n              <Plus className=\"w-4 h-4 mr-1\" />\n              Assign\n            </Button>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/CarrierQuotesSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[930,933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[930,933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2168,2171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2168,2171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2792,2795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2792,2795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7355,7358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7355,7358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7364,7367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7364,7367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7597,7600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7597,7600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7606,7609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7606,7609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7781,7784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7781,7784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Dispatch, SetStateAction, useEffect, useState } from 'react';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { FormLabel, FormControl } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Input } from '@/components/ui/input';\nimport { Plus, Trash2 } from 'lucide-react';\nimport { Accordion, AccordionItem, AccordionTrigger, AccordionContent } from '@/components/ui/accordion';\n\ntype Charge = {\n  type: string;\n  amount: number;\n  currency: string;\n  note?: string;\n};\n\ntype CarrierQuote = {\n  carrier_id: string;\n  mode?: string;\n  buying_charges: Charge[];\n  selling_charges: Charge[];\n};\n\nexport function CarrierQuotesSection({\n  carriers,\n  selectedServiceType,\n  carrierQuotes,\n  setCarrierQuotes,\n  onSave,\n  onReload,\n}: {\n  carriers: any[];\n  selectedServiceType: string;\n  carrierQuotes: CarrierQuote[];\n  setCarrierQuotes: Dispatch<SetStateAction<CarrierQuote[]>>;\n  onSave?: () => void | Promise<void>;\n  onReload?: () => void | Promise<void>;\n}) {\n  // Collapsible on mobile, open by default on md+; persist to localStorage\n  const [accordionOpen, setAccordionOpen] = useState<boolean>(true);\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('carrierQuotesAccordionOpen');\n      if (saved !== null) {\n        setAccordionOpen(saved === 'true');\n      } else {\n        setAccordionOpen(window.innerWidth >= 768);\n      }\n    }\n  }, []);\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('carrierQuotesAccordionOpen', String(accordionOpen));\n    }\n  }, [accordionOpen]);\n  const addCarrierQuote = () => {\n    setCarrierQuotes((prev) => ([\n      ...prev,\n      { carrier_id: '', mode: selectedServiceType || undefined, buying_charges: [], selling_charges: [] },\n    ]));\n  };\n\n  const removeCarrierQuote = (index: number) => {\n    setCarrierQuotes((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  const updateCarrierField = (index: number, field: keyof CarrierQuote, value: any) => {\n    setCarrierQuotes((prev) => {\n      const next = [...prev];\n      next[index] = { ...next[index], [field]: value };\n      return next;\n    });\n  };\n\n  const addCharge = (index: number, side: 'buy' | 'sell') => {\n    setCarrierQuotes((prev) => {\n      const next = [...prev];\n      const targetList = side === 'buy' ? next[index].buying_charges : next[index].selling_charges;\n      targetList.push({ type: 'freight', amount: 0, currency: 'USD' });\n      return next;\n    });\n  };\n\n  const updateCharge = (\n    index: number,\n    side: 'buy' | 'sell',\n    chargeIndex: number,\n    field: keyof Charge,\n    value: any,\n  ) => {\n    setCarrierQuotes((prev) => {\n      const next = [...prev];\n      const targetList = side === 'buy' ? next[index].buying_charges : next[index].selling_charges;\n      targetList[chargeIndex] = { ...targetList[chargeIndex], [field]: value } as Charge;\n      return next;\n    });\n  };\n\n  const removeCharge = (index: number, side: 'buy' | 'sell', chargeIndex: number) => {\n    setCarrierQuotes((prev) => {\n      const next = [...prev];\n      const targetList = side === 'buy' ? next[index].buying_charges : next[index].selling_charges;\n      next[index] = {\n        ...next[index],\n        [side === 'buy' ? 'buying_charges' : 'selling_charges']:\n          targetList.filter((_, i) => i !== chargeIndex),\n      } as CarrierQuote;\n      return next;\n    });\n  };\n\n  const totalCharges = (charges: Charge[]) => charges.reduce((sum, c) => sum + (Number(c.amount) || 0), 0);\n\n  return (\n    <Card className=\"ef-card\">\n      <CardHeader className=\"ef-header\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2\">\n          <CardTitle className=\"ef-title\">Carrier Quotations</CardTitle>\n          <div className=\"flex gap-2\">\n            <Button type=\"button\" onClick={addCarrierQuote} size=\"sm\" className=\"ef-hover\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Quote\n            </Button>\n            {onSave && (\n              <Button type=\"button\" variant=\"default\" size=\"sm\" onClick={() => onSave?.()} className=\"ef-hover\">\n                Save Rates\n              </Button>\n            )}\n            {onReload && (\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => onReload?.()} className=\"ef-hover\">\n                Reload Saved\n              </Button>\n            )}\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <Accordion type=\"single\" collapsible value={accordionOpen ? 'carrier-quotes' : undefined} onValueChange={(v) => setAccordionOpen(!!v)}>\n          <AccordionItem value=\"carrier-quotes\">\n            <AccordionTrigger className=\"text-base transition-colors duration-200\">Charges & breakdown</AccordionTrigger>\n            <AccordionContent className=\"space-y-4 transition-all duration-300 ease-in-out\">\n              {carrierQuotes.length === 0 ? (\n                <div className=\"text-sm text-muted-foreground\">No carrier quotations added. Use \"Add Carrier Quote\" to begin.</div>\n              ) : (\n                carrierQuotes.map((cq, idx) => (\n            <div key={idx} className=\"border rounded-lg p-4 space-y-4\">\n              <div className=\"flex justify-between items-start\">\n                <span className=\"font-medium\">Carrier Quote {idx + 1}</span>\n                <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => removeCarrierQuote(idx)}>\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n\n              <div className=\"ef-grid\">\n                <div className=\"space-y-2\">\n                  <FormLabel>Transport Mode</FormLabel>\n                  <Select value={cq.mode || ''} onValueChange={(v) => updateCarrierField(idx, 'mode', v)}>\n                    <FormControl>\n                      <SelectTrigger className=\"w-full\">\n                        <SelectValue placeholder=\"Select mode\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"ocean\">Ocean Freight</SelectItem>\n                      <SelectItem value=\"air\">Air Freight</SelectItem>\n                      <SelectItem value=\"trucking\">Trucking</SelectItem>\n                      <SelectItem value=\"courier\">Courier</SelectItem>\n                      <SelectItem value=\"moving\">Moving & Packing</SelectItem>\n                      <SelectItem value=\"railway_transport\">Railways</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <FormLabel>Carrier</FormLabel>\n                  <Select value={cq.carrier_id} onValueChange={(v) => updateCarrierField(idx, 'carrier_id', v)}>\n                    <FormControl>\n                      <SelectTrigger className=\"w-full\">\n                        <SelectValue placeholder=\"Select carrier\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {carriers\n                        .reduce((acc: Record<string, any>, c: any) => {\n                          acc[String(c.id)] = c;\n                          return acc;\n                        }, {})\n                        && Object.values(\n                          carriers.reduce((acc: Record<string, any>, c: any) => {\n                            acc[String(c.id)] = c;\n                            return acc;\n                          }, {}),\n                        ).map((carrier: any) => (\n                          <SelectItem key={carrier.id} value={String(carrier.id)}>\n                            {String(carrier.carrier_name || '').trim()}\n                          </SelectItem>\n                        ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium\">Buying Charges</span>\n                    <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => addCharge(idx, 'buy')}>\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Charge\n                    </Button>\n                  </div>\n                  {cq.buying_charges.length === 0 ? (\n                    <div className=\"text-sm text-muted-foreground\">No buying charges.</div>\n                  ) : (\n                    cq.buying_charges.map((ch, cIdx) => (\n                      <div key={`buy-${cIdx}`} className=\"grid grid-cols-2 md:grid-cols-4 gap-2 items-end\">\n                        <div>\n                          <FormLabel className=\"text-xs\">Type</FormLabel>\n                          <Select value={ch.type} onValueChange={(v) => updateCharge(idx, 'buy', cIdx, 'type', v)}>\n                            <FormControl>\n                              <SelectTrigger className=\"w-full\">\n                                <SelectValue placeholder=\"Type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"freight\">Freight</SelectItem>\n                              <SelectItem value=\"fuel\">Fuel</SelectItem>\n                              <SelectItem value=\"handling\">Handling</SelectItem>\n                              <SelectItem value=\"documentation\">Documentation</SelectItem>\n                              <SelectItem value=\"origin\">Origin</SelectItem>\n                              <SelectItem value=\"destination\">Destination</SelectItem>\n                              <SelectItem value=\"customs\">Customs</SelectItem>\n                              <SelectItem value=\"other\">Other</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                        <div>\n                          <FormLabel className=\"text-xs\">Amount</FormLabel>\n                          <Input type=\"number\" step=\"0.01\" value={ch.amount}\n                                 onChange={(e) => updateCharge(idx, 'buy', cIdx, 'amount', parseFloat(e.target.value) || 0)} />\n                        </div>\n                        <div>\n                          <FormLabel className=\"text-xs\">Currency</FormLabel>\n                          <Input value={ch.currency} onChange={(e) => updateCharge(idx, 'buy', cIdx, 'currency', e.target.value)} />\n                        </div>\n                        <div className=\"flex items-end justify-end\">\n                          <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => removeCharge(idx, 'buy', cIdx)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                  <div className=\"flex justify-between text-sm border-t pt-2\">\n                    <span>Total Buy:</span>\n                    <span className=\"font-medium\">${totalCharges(cq.buying_charges).toFixed(2)}</span>\n                  </div>\n                </div>\n\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium\">Selling Charges</span>\n                    <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => addCharge(idx, 'sell')}>\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Charge\n                    </Button>\n                  </div>\n                  {cq.selling_charges.length === 0 ? (\n                    <div className=\"text-sm text-muted-foreground\">No selling charges.</div>\n                  ) : (\n                    cq.selling_charges.map((ch, cIdx) => (\n                      <div key={`sell-${cIdx}`} className=\"grid grid-cols-2 md:grid-cols-4 gap-2 items-end\">\n                        <div>\n                          <FormLabel className=\"text-xs\">Type</FormLabel>\n                          <Select value={ch.type} onValueChange={(v) => updateCharge(idx, 'sell', cIdx, 'type', v)}>\n                            <FormControl>\n                              <SelectTrigger className=\"w-full\">\n                                <SelectValue placeholder=\"Type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"freight\">Freight</SelectItem>\n                              <SelectItem value=\"fuel\">Fuel</SelectItem>\n                              <SelectItem value=\"handling\">Handling</SelectItem>\n                              <SelectItem value=\"documentation\">Documentation</SelectItem>\n                              <SelectItem value=\"origin\">Origin</SelectItem>\n                              <SelectItem value=\"destination\">Destination</SelectItem>\n                              <SelectItem value=\"customs\">Customs</SelectItem>\n                              <SelectItem value=\"other\">Other</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                        <div>\n                          <FormLabel className=\"text-xs\">Amount</FormLabel>\n                          <Input type=\"number\" step=\"0.01\" value={ch.amount}\n                                 onChange={(e) => updateCharge(idx, 'sell', cIdx, 'amount', parseFloat(e.target.value) || 0)} />\n                        </div>\n                        <div>\n                          <FormLabel className=\"text-xs\">Currency</FormLabel>\n                          <Input value={ch.currency} onChange={(e) => updateCharge(idx, 'sell', cIdx, 'currency', e.target.value)} />\n                        </div>\n                        <div className=\"flex items-end justify-end\">\n                          <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={() => removeCharge(idx, 'sell', cIdx)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                  <div className=\"flex justify-between text-sm border-t pt-2\">\n                    <span>Total Sell:</span>\n                    <span className=\"font-medium\">${totalCharges(cq.selling_charges).toFixed(2)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n            </AccordionContent>\n          </AccordionItem>\n        </Accordion>\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/ChargesTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1333,1336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1333,1336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1392,1395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1392,1395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1441,1444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1441,1444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1500,1503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1500,1503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useMemo } from 'react';\nimport { Table, TableHeader, TableRow, TableCell, TableBody } from '@/components/ui/table';\nimport { Select, SelectTrigger, SelectContent, SelectItem, SelectValue } from '@/components/ui/select';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { supabase } from '@/integrations/supabase/client';\n\ntype ChargeRow = {\n  charge_side_id?: string;\n  category_id?: string;\n  basis_id?: string;\n  quantity?: number;\n  unit?: string | null;\n  rate?: number;\n  amount?: number;\n  currency_id?: string;\n  note?: string | null;\n  sort_order?: number;\n  side?: 'buy' | 'sell';\n};\n\ntype CombinedRow = {\n  key: string;\n  category_id?: string;\n  basis_id?: string;\n  unit?: string | null;\n  currency_id?: string;\n  note?: string | null;\n  buy?: { idx: number; quantity?: number; rate?: number; amount?: number; charge_side_id?: string };\n  sell?: { idx: number; quantity?: number; rate?: number; amount?: number; charge_side_id?: string };\n};\n\nexport default function ChargesTable({ charges, onChange, defaultCurrencyId, onSaveClick, saveDisabled }: { charges: ChargeRow[]; onChange: (rows: ChargeRow[]) => void; defaultCurrencyId?: string | null; onSaveClick?: () => void; saveDisabled?: boolean }) {\n  const [sides, setSides] = useState<any[]>([]);\n  const [categories, setCategories] = useState<any[]>([]);\n  const [bases, setBases] = useState<any[]>([]);\n  const [currencies, setCurrencies] = useState<any[]>([]);\n\n  useEffect(() => {\n    (async () => {\n      const { data: ss } = await supabase.from('charge_sides').select('id, name, code').order('name');\n      setSides(ss ?? []);\n      const { data: cc } = await supabase.from('charge_categories').select('id, name, code').order('name');\n      setCategories(cc ?? []);\n      const { data: bb } = await supabase.from('charge_bases').select('id, name, code').order('name');\n      setBases(bb ?? []);\n      const { data: cur } = await supabase.from('currencies').select('id, code').order('code');\n      setCurrencies(cur ?? []);\n    })();\n  }, []);\n\n  const totals = useMemo(() => {\n    const buy = charges.filter(c => c.side === 'buy').reduce((s, c) => s + (c.amount || (c.rate ?? 0) * (c.quantity ?? 1)), 0);\n    const sell = charges.filter(c => c.side === 'sell').reduce((s, c) => s + (c.amount || (c.rate ?? 0) * (c.quantity ?? 1)), 0);\n    return { buy, sell, margin: sell - buy };\n  }, [charges]);\n\n  const groupKey = (c: ChargeRow) => [c.category_id ?? '', c.basis_id ?? '', c.currency_id ?? '', c.unit ?? '', c.note ?? ''].join('|');\n\n  const combinedRows = useMemo<CombinedRow[]>(() => {\n    const map = new Map<string, CombinedRow>();\n    charges.forEach((c, idx) => {\n      const key = groupKey(c);\n      const entry = map.get(key) ?? {\n        key,\n        category_id: c.category_id,\n        basis_id: c.basis_id,\n        unit: c.unit ?? null,\n        currency_id: c.currency_id,\n        note: c.note ?? null,\n      };\n      const sideRef = { idx, quantity: c.quantity, rate: c.rate, amount: c.amount, charge_side_id: c.charge_side_id };\n      if (c.side === 'buy') entry.buy = sideRef; else if (c.side === 'sell') entry.sell = sideRef;\n      map.set(key, entry);\n    });\n    return Array.from(map.values());\n  }, [charges]);\n\n  const addRow = (sideCode: 'buy'|'sell') => {\n    const side = sides.find(s => s.code === sideCode);\n    onChange([\n      ...charges,\n      {\n        side: sideCode,\n        charge_side_id: side?.id,\n        category_id: categories[0]?.id,\n        basis_id: bases[0]?.id,\n        quantity: 1,\n        rate: 0,\n        amount: 0,\n        currency_id: defaultCurrencyId ?? currencies[0]?.id,\n        note: null,\n        sort_order: 1000,\n      },\n    ]);\n  };\n\n  const addCombinedRow = () => {\n    const buySide = sides.find(s => s.code === 'buy');\n    const sellSide = sides.find(s => s.code === 'sell');\n    const base = {\n      category_id: categories[0]?.id,\n      basis_id: bases[0]?.id,\n      unit: '',\n      currency_id: defaultCurrencyId ?? currencies[0]?.id,\n      note: null as string | null,\n      sort_order: 1000,\n    };\n    const newRows: ChargeRow[] = [\n      { ...base, side: 'buy', charge_side_id: buySide?.id, quantity: 1, rate: 0, amount: 0 },\n      { ...base, side: 'sell', charge_side_id: sellSide?.id, quantity: 1, rate: 0, amount: 0 },\n    ];\n    onChange([...(charges ?? []), ...newRows]);\n  };\n\n  const updateRow = (idx: number, patch: Partial<ChargeRow>) => {\n    const next = charges.slice();\n    next[idx] = { ...next[idx], ...patch };\n    const q = next[idx].quantity ?? 1;\n    const r = next[idx].rate ?? 0;\n    next[idx].amount = Number(next[idx].amount ?? r * q);\n    onChange(next);\n  };\n\n  const removeCombinedRow = (row: CombinedRow) => {\n    const next = charges.slice();\n    const indexes = [row.buy?.idx, row.sell?.idx].filter((x): x is number => typeof x === 'number').sort((a,b) => b-a);\n    indexes.forEach(i => next.splice(i, 1));\n    onChange(next);\n  };\n\n  const updateShared = (row: CombinedRow, patchShared: Partial<ChargeRow>) => {\n    const next = charges.slice();\n    [row.buy?.idx, row.sell?.idx].forEach(i => {\n      if (typeof i === 'number') {\n        next[i] = { ...next[i], ...patchShared };\n        const q = next[i].quantity ?? 1;\n        const r = next[i].rate ?? 0;\n        next[i].amount = Number(next[i].amount ?? r * q);\n      }\n    });\n    onChange(next);\n  };\n\n  const updateSide = (sideIdx: number | undefined, patch: Partial<ChargeRow>) => {\n    if (typeof sideIdx !== 'number') return;\n    const next = charges.slice();\n    next[sideIdx] = { ...next[sideIdx], ...patch };\n    const q = next[sideIdx].quantity ?? 1;\n    const r = next[sideIdx].rate ?? 0;\n    next[sideIdx].amount = Number(next[sideIdx].amount ?? r * q);\n    onChange(next);\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex gap-2\">\n        <Button variant=\"outline\" onClick={addCombinedRow}>Add Combined Charge</Button>\n      </div>\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableCell>Category</TableCell>\n            <TableCell>Basis</TableCell>\n            <TableCell>Unit</TableCell>\n            <TableCell>Currency</TableCell>\n            <TableCell>Buy Qty</TableCell>\n            <TableCell>Buy Rate</TableCell>\n            <TableCell>Buy Amount</TableCell>\n            <TableCell>Sell Qty</TableCell>\n            <TableCell>Sell Rate</TableCell>\n            <TableCell>Sell Amount</TableCell>\n            <TableCell>Note</TableCell>\n            <TableCell />\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {combinedRows.map((row) => (\n            <TableRow key={row.key}>\n              <TableCell>\n                <Select value={row.category_id} onValueChange={(val) => updateShared(row, { category_id: val })}>\n                  <SelectTrigger><SelectValue /></SelectTrigger>\n                  <SelectContent>\n                    {categories.map(cat => <SelectItem key={cat.id} value={cat.id}>{cat.name}</SelectItem>)}\n                  </SelectContent>\n                </Select>\n              </TableCell>\n              <TableCell>\n                <Select value={row.basis_id} onValueChange={(val) => updateShared(row, { basis_id: val })}>\n                  <SelectTrigger><SelectValue /></SelectTrigger>\n                  <SelectContent>\n                    {bases.map(b => <SelectItem key={b.id} value={b.id}>{b.name}</SelectItem>)}\n                  </SelectContent>\n                </Select>\n              </TableCell>\n              <TableCell><Input value={row.unit ?? ''} onChange={e => updateShared(row, { unit: e.target.value })} /></TableCell>\n              <TableCell>\n                <Select value={row.currency_id} onValueChange={(val) => updateShared(row, { currency_id: val })}>\n                  <SelectTrigger><SelectValue /></SelectTrigger>\n                  <SelectContent>\n                    {currencies.map(cur => <SelectItem key={cur.id} value={cur.id}>{cur.code}</SelectItem>)}\n                  </SelectContent>\n                </Select>\n              </TableCell>\n              <TableCell><Input type=\"number\" value={row.buy?.quantity ?? 1} onChange={e => updateSide(row.buy?.idx, { quantity: Number(e.target.value) })} /></TableCell>\n              <TableCell><Input type=\"number\" value={row.buy?.rate ?? 0} onChange={e => updateSide(row.buy?.idx, { rate: Number(e.target.value), amount: Number(e.target.value) * (row.buy?.quantity || 1) })} /></TableCell>\n              <TableCell><Input type=\"number\" value={row.buy?.amount ?? 0} onChange={e => updateSide(row.buy?.idx, { amount: Number(e.target.value) })} /></TableCell>\n              <TableCell><Input type=\"number\" value={row.sell?.quantity ?? 1} onChange={e => updateSide(row.sell?.idx, { quantity: Number(e.target.value) })} /></TableCell>\n              <TableCell><Input type=\"number\" value={row.sell?.rate ?? 0} onChange={e => updateSide(row.sell?.idx, { rate: Number(e.target.value), amount: Number(e.target.value) * (row.sell?.quantity || 1) })} /></TableCell>\n              <TableCell><Input type=\"number\" value={row.sell?.amount ?? 0} onChange={e => updateSide(row.sell?.idx, { amount: Number(e.target.value) })} /></TableCell>\n              <TableCell><Input value={row.note ?? ''} onChange={e => updateShared(row, { note: e.target.value })} /></TableCell>\n              <TableCell><Button variant=\"destructive\" size=\"sm\" onClick={() => removeCombinedRow(row)}>Remove</Button></TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n      <div className=\"flex items-center justify-end gap-6 text-sm\">\n        <div>Buy: <span className=\"font-semibold\">{totals.buy.toFixed(2)}</span></div>\n        <div>Sell: <span className=\"font-semibold\">{totals.sell.toFixed(2)}</span></div>\n        <div>Margin: <span className=\"font-semibold\">{totals.margin.toFixed(2)}</span></div>\n        {onSaveClick && (\n          <Button onClick={onSaveClick} disabled={!!saveDisabled}>Save Charges</Button>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/MultiModalQuoteComposer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1124,1127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1124,1127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2086,2089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2086,2089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2143,2146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2143,2146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2672,2675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2672,2675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3162,3165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3162,3165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3233,3236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3233,3236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3294,3297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3294,3297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3353,3356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3353,3356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3422,3425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3422,3425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3489,3492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3489,3492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3556,3559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3556,3559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3726,3729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3726,3729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4063,4066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4063,4066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'canProceed', 'handleBack', 'handleNext', 'loadInitialData', and 'saveQuotation'. Either include them or remove the dependency array.","line":127,"column":6,"nodeType":"ArrayExpression","endLine":127,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [canProceed, currentStep, handleBack, handleNext, loadInitialData, saveQuotation, saving]","fix":{"range":[4875,4896],"text":"[canProceed, currentStep, handleBack, handleNext, loadInitialData, saveQuotation, saving]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadOptionData'. Either include it or remove the dependency array.","line":133,"column":6,"nodeType":"ArrayExpression","endLine":133,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [loadOptionData, optionId, tenantId]","fix":{"range":[4987,5007],"text":"[loadOptionData, optionId, tenantId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6073,6076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6073,6076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6127,6130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6127,6130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6191,6194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6191,6194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6957,6960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6957,6960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7740,7743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7740,7743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8424,8427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8424,8427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8463,8466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8463,8466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8504,8507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8504,8507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8540,8543],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8540,8543],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8575,8578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8575,8578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8615,8618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8615,8618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8654,8657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8654,8657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8693,8696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8693,8696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":402,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14934,14937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14934,14937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":420,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15574,15577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15574,15577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":529,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":529,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19479,19482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19479,19482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":537,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":537,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19742,19745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19742,19745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":545,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":545,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20010,20013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20010,20013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":579,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":579,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21001,21004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21001,21004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":583,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":583,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21174,21177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21174,21177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":623,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":623,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22755,22758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22755,22758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":630,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":630,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23040,23043],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23040,23043],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":631,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":631,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23083,23086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23083,23086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":654,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":654,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23973,23976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23973,23976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":670,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":670,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24658,24661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24658,24661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":757,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":757,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27231,27234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27231,27234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":837,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":837,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29583,29586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29583,29586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":906,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":906,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32097,32100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32097,32100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1134,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1134,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40241,40244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40241,40244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1190,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1190,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42327,42330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42327,42330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1372,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1372,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48657,48660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48657,48660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":46,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { ArrowLeft, ArrowRight, Save, Loader2 } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { QuotationWorkflowStepper } from './composer/QuotationWorkflowStepper';\nimport { QuoteDetailsStep } from './composer/QuoteDetailsStep';\nimport { LegsConfigurationStep } from './composer/LegsConfigurationStep';\nimport { ChargesManagementStep } from './composer/ChargesManagementStep';\nimport { ReviewAndSaveStep } from './composer/ReviewAndSaveStep';\nimport { BasisConfigModal } from './composer/BasisConfigModal';\nimport { DeleteConfirmDialog } from './composer/DeleteConfirmDialog';\nimport { SaveProgress } from './composer/SaveProgress';\nimport { ErrorBoundary } from './composer/ErrorBoundary';\nimport { ValidationFeedback } from './composer/ValidationFeedback';\n\ninterface Leg {\n  id: string;\n  mode: string;\n  serviceTypeId: string;\n  origin: string;\n  destination: string;\n  charges: any[];\n  legType?: 'transport' | 'service';\n  serviceOnlyCategory?: string;\n}\n\ninterface MultiModalQuoteComposerProps {\n  quoteId: string;\n  versionId: string;\n  optionId?: string;\n}\n\nconst STEPS = [\n  { id: 1, title: 'Quote Details', description: 'Basic information' },\n  { id: 2, title: 'Transport Legs', description: 'Configure routes' },\n  { id: 3, title: 'Charges', description: 'Add costs' },\n  { id: 4, title: 'Review & Save', description: 'Finalize quote' }\n];\n\nexport function MultiModalQuoteComposer({ quoteId, versionId, optionId: initialOptionId }: MultiModalQuoteComposerProps) {\n  const { toast } = useToast();\n  const [currentStep, setCurrentStep] = useState(1);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [optionId, setOptionId] = useState<string | null>(initialOptionId || null);\n  const [legs, setLegs] = useState<Leg[]>([]);\n  const [combinedCharges, setCombinedCharges] = useState<any[]>([]);\n  const [quoteData, setQuoteData] = useState<any>({});\n  const [autoMargin, setAutoMargin] = useState(false);\n  const [marginPercent, setMarginPercent] = useState(15);\n  const [tenantId, setTenantId] = useState<string | null>(null);\n  const [franchiseId, setFranchiseId] = useState<string | null>(null);\n  \n  // Track charges to delete\n  const [chargesToDelete, setChargesToDelete] = useState<string[]>([]);\n  \n  // Delete confirmation state\n  const [deleteDialog, setDeleteDialog] = useState<{\n    open: boolean;\n    type: 'leg' | 'charge' | 'combinedCharge';\n    target?: any;\n  }>({ open: false, type: 'leg' });\n\n  // Save progress tracking\n  const [saveProgress, setSaveProgress] = useState<{\n    show: boolean;\n    steps: { label: string; completed: boolean }[];\n  }>({\n    show: false,\n    steps: []\n  });\n  \n  // Validation feedback\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\n  const [validationWarnings, setValidationWarnings] = useState<string[]>([]);\n\n  // Reference data\n  const [serviceTypes, setServiceTypes] = useState<any[]>([]);\n  const [chargeCategories, setChargeCategories] = useState<any[]>([]);\n  const [chargeBases, setChargeBases] = useState<any[]>([]);\n  const [currencies, setCurrencies] = useState<any[]>([]);\n  const [tradeDirections, setTradeDirections] = useState<any[]>([]);\n  const [containerTypes, setContainerTypes] = useState<any[]>([]);\n  const [containerSizes, setContainerSizes] = useState<any[]>([]);\n\n  // Basis configuration modal\n  const [basisModalOpen, setBasisModalOpen] = useState(false);\n  const [currentBasisConfig, setCurrentBasisConfig] = useState<any>({\n    tradeDirection: '',\n    containerType: '',\n    containerSize: '',\n    quantity: 1\n  });\n  const [basisTarget, setBasisTarget] = useState<{ type: 'leg' | 'combined'; legId?: string; chargeIdx: number } | null>(null);\n\n  // Transport modes for mode-to-service-type mapping\n  const [transportModes, setTransportModes] = useState<any[]>([]);\n\n  useEffect(() => {\n    loadInitialData();\n    \n    // Keyboard shortcuts\n    const handleKeyboard = (e: KeyboardEvent) => {\n      // Cmd/Ctrl + S to save\n      if ((e.metaKey || e.ctrlKey) && e.key === 's') {\n        e.preventDefault();\n        if (currentStep === 4 && !saving) {\n          saveQuotation();\n        }\n      }\n      // Cmd/Ctrl +  to go next\n      if ((e.metaKey || e.ctrlKey) && e.key === 'ArrowRight') {\n        e.preventDefault();\n        if (canProceed()) handleNext();\n      }\n      // Cmd/Ctrl +  to go back\n      if ((e.metaKey || e.ctrlKey) && e.key === 'ArrowLeft') {\n        e.preventDefault();\n        handleBack();\n      }\n    };\n    \n    window.addEventListener('keydown', handleKeyboard);\n    return () => window.removeEventListener('keydown', handleKeyboard);\n  }, [currentStep, saving]);\n\n  useEffect(() => {\n    if (optionId && tenantId) {\n      loadOptionData();\n    }\n  }, [optionId, tenantId]);\n\n  const loadInitialData = async () => {\n    console.log('[Composer] Loading initial data...', { quoteId, versionId, optionId: initialOptionId });\n    setLoading(true);\n    \n    const errors: string[] = [];\n    \n    try {\n      // Step 1: Resolve tenant ID\n      console.log('[Composer] Step 1: Resolving tenant ID');\n      const { data: { user } } = await supabase.auth.getUser();\n      const userTenantId = user?.user_metadata?.tenant_id;\n      let resolvedTenantId: string | null = userTenantId ?? null;\n\n      // Fallback 1: fetch from quote context\n      if (!resolvedTenantId && quoteId) {\n        try {\n          const { data: quoteRow, error: quoteError } = await supabase\n            .from('quotes')\n            .select('tenant_id, franchise_id')\n            .eq('id', quoteId)\n            .maybeSingle();\n          \n          if (quoteError) {\n            console.error('[Composer] Error fetching quote:', quoteError);\n            errors.push('Failed to load quote details');\n          } else if (quoteRow) {\n            resolvedTenantId = (quoteRow as any)?.tenant_id ?? null;\n            if ((quoteRow as any)?.franchise_id) {\n              setFranchiseId((quoteRow as any).franchise_id);\n            }\n            console.log('[Composer] Resolved tenant from quote:', resolvedTenantId);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception fetching quote:', error);\n        }\n      }\n\n      // Fallback 2: fetch from quotation version\n      if (!resolvedTenantId && versionId) {\n        try {\n          const { data: versionRow, error: versionError } = await supabase\n            .from('quotation_versions')\n            .select('tenant_id')\n            .eq('id', versionId)\n            .maybeSingle();\n          \n          if (versionError) {\n            console.error('[Composer] Error fetching version:', versionError);\n          } else if (versionRow) {\n            resolvedTenantId = (versionRow as any)?.tenant_id ?? null;\n            console.log('[Composer] Resolved tenant from version:', resolvedTenantId);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception fetching version:', error);\n        }\n      }\n\n      // Fallback 3: fetch from existing option if provided\n      if (!resolvedTenantId && initialOptionId) {\n        try {\n          const { data: optionRow, error: optionError } = await supabase\n            .from('quotation_version_options')\n            .select('tenant_id')\n            .eq('id', initialOptionId)\n            .maybeSingle();\n          \n          if (optionError) {\n            console.error('[Composer] Error fetching option:', optionError);\n          } else if (optionRow) {\n            resolvedTenantId = (optionRow as any)?.tenant_id ?? null;\n            console.log('[Composer] Resolved tenant from option:', resolvedTenantId);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception fetching option:', error);\n        }\n      }\n\n      if (!resolvedTenantId) {\n        console.error('[Composer] Failed to resolve tenant ID');\n        errors.push('Could not determine tenant context');\n      }\n\n      setTenantId(resolvedTenantId);\n\n      // Step 2: Load reference data with individual error handling\n      console.log('[Composer] Step 2: Loading reference data');\n      \n      const loadReferenceData = async () => {\n        const results = {\n          serviceTypes: [] as any[],\n          transportModes: [] as any[],\n          chargeCategories: [] as any[],\n          chargeBases: [] as any[],\n          currencies: [] as any[],\n          tradeDirections: [] as any[],\n          containerTypes: [] as any[],\n          containerSizes: [] as any[]\n        };\n\n        // Load service types\n        try {\n          const { data, error } = await supabase\n            .from('service_types')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading service_types:', error);\n            errors.push('Failed to load service types');\n          } else {\n            results.serviceTypes = data || [];\n            console.log('[Composer] Loaded service types:', results.serviceTypes.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading service_types:', error);\n          errors.push('Failed to load service types');\n        }\n\n        // Load transport modes\n        try {\n          const { data, error } = await supabase\n            .from('transport_modes')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading transport_modes:', error);\n            errors.push('Failed to load transport modes');\n          } else {\n            results.transportModes = data || [];\n            console.log('[Composer] Loaded transport modes:', results.transportModes.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading transport_modes:', error);\n          errors.push('Failed to load transport modes');\n        }\n\n        // Load charge categories\n        try {\n          const { data, error } = await supabase\n            .from('charge_categories')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading charge_categories:', error);\n            errors.push('Failed to load charge categories');\n          } else {\n            results.chargeCategories = data || [];\n            console.log('[Composer] Loaded charge categories:', results.chargeCategories.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading charge_categories:', error);\n          errors.push('Failed to load charge categories');\n        }\n\n        // Load charge bases\n        try {\n          const { data, error } = await supabase\n            .from('charge_bases')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading charge_bases:', error);\n            errors.push('Failed to load charge bases');\n          } else {\n            results.chargeBases = data || [];\n            console.log('[Composer] Loaded charge bases:', results.chargeBases.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading charge_bases:', error);\n          errors.push('Failed to load charge bases');\n        }\n\n        // Load currencies\n        try {\n          const { data, error } = await supabase\n            .from('currencies')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading currencies:', error);\n            errors.push('Failed to load currencies');\n          } else {\n            results.currencies = data || [];\n            console.log('[Composer] Loaded currencies:', results.currencies.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading currencies:', error);\n          errors.push('Failed to load currencies');\n        }\n\n        // Load trade directions\n        try {\n          const { data, error } = await supabase\n            .from('trade_directions')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading trade_directions:', error);\n            errors.push('Failed to load trade directions');\n          } else {\n            results.tradeDirections = data || [];\n            console.log('[Composer] Loaded trade directions:', results.tradeDirections.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading trade_directions:', error);\n          errors.push('Failed to load trade directions');\n        }\n\n        // Load container types\n        try {\n          const { data, error } = await supabase\n            .from('container_types')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading container_types:', error);\n            errors.push('Failed to load container types');\n          } else {\n            results.containerTypes = data || [];\n            console.log('[Composer] Loaded container types:', results.containerTypes.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading container_types:', error);\n          errors.push('Failed to load container types');\n        }\n\n        // Load container sizes\n        try {\n          const { data, error } = await supabase\n            .from('container_sizes')\n            .select('*')\n            .eq('is_active', true);\n          \n          if (error) {\n            console.error('[Composer] Error loading container_sizes:', error);\n            errors.push('Failed to load container sizes');\n          } else {\n            results.containerSizes = data || [];\n            console.log('[Composer] Loaded container sizes:', results.containerSizes.length);\n          }\n        } catch (error) {\n          console.error('[Composer] Exception loading container_sizes:', error);\n          errors.push('Failed to load container sizes');\n        }\n\n        return results;\n      };\n\n      const refData = await loadReferenceData();\n      \n      setServiceTypes(refData.serviceTypes);\n      setTransportModes(refData.transportModes);\n      setChargeCategories(refData.chargeCategories);\n      setChargeBases(refData.chargeBases);\n      setCurrencies(refData.currencies);\n      setTradeDirections(refData.tradeDirections);\n      setContainerTypes(refData.containerTypes);\n      setContainerSizes(refData.containerSizes);\n\n      // Set default currency\n      if (refData.currencies.length > 0) {\n        setQuoteData((prev: any) => ({ ...prev, currencyId: refData.currencies[0].id }));\n        console.log('[Composer] Set default currency:', refData.currencies[0].id);\n      }\n\n      // Step 3: Ensure option exists if we have a versionId\n      if (versionId && resolvedTenantId) {\n        await ensureOptionExists(resolvedTenantId);\n      }\n\n      console.log('[Composer] Initial data load complete. Errors:', errors.length);\n      \n      if (errors.length > 0) {\n        toast({ \n          title: 'Partial Load', \n          description: `Some data failed to load: ${errors.join(', ')}`, \n          variant: 'destructive' \n        });\n      }\n    } catch (error: any) {\n      console.error('[Composer] Critical error in loadInitialData:', error);\n      toast({ title: 'Error', description: 'Failed to initialize composer: ' + error.message, variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Ensure an option exists for this version\n  const ensureOptionExists = async (resolvedTenantId: string) => {\n    console.log('[Composer] Ensuring option exists for version:', versionId);\n    \n    try {\n      // Check if we already have an optionId from props\n      if (initialOptionId) {\n        console.log('[Composer] Using initial optionId:', initialOptionId);\n        setOptionId(initialOptionId);\n        return;\n      }\n\n      // Query for existing options\n      const { data: existingOptions, error: queryError } = await supabase\n        .from('quotation_version_options')\n        .select('id, created_at')\n        .eq('quotation_version_id', versionId)\n        .order('created_at', { ascending: false })\n        .limit(1);\n\n      if (queryError) {\n        console.error('[Composer] Error querying options:', queryError);\n        return;\n      }\n\n      if (existingOptions && existingOptions.length > 0) {\n        const existingId = existingOptions[0].id;\n        console.log('[Composer] Found existing option:', existingId);\n        setOptionId(existingId);\n        \n        // Update URL to include optionId to prevent duplicates on reload\n        const url = new URL(window.location.href);\n        if (!url.searchParams.has('optionId')) {\n          url.searchParams.set('optionId', existingId);\n          window.history.replaceState({}, '', url.toString());\n          console.log('[Composer] Updated URL with optionId');\n        }\n        return;\n      }\n\n      // Create new option only if none exists\n      console.log('[Composer] Creating new option for version');\n      const { data: newOption, error: insertError } = await supabase\n        .from('quotation_version_options')\n        .insert({\n          quotation_version_id: versionId,\n          tenant_id: resolvedTenantId\n        })\n        .select()\n        .maybeSingle();\n\n      if (insertError) {\n        console.error('[Composer] Error creating option:', insertError);\n        \n        // Check if option was created by another process\n        const { data: retry } = await supabase\n          .from('quotation_version_options')\n          .select('id')\n          .eq('quotation_version_id', versionId)\n          .limit(1)\n          .maybeSingle();\n\n        if (retry?.id) {\n          console.log('[Composer] Option found on retry:', retry.id);\n          setOptionId(retry.id);\n          \n          // Update URL\n          const url = new URL(window.location.href);\n          url.searchParams.set('optionId', retry.id);\n          window.history.replaceState({}, '', url.toString());\n        }\n        return;\n      }\n\n      if (newOption?.id) {\n        console.log('[Composer] Created new option:', newOption.id);\n        setOptionId(newOption.id);\n        \n        // Update URL with new optionId\n        const url = new URL(window.location.href);\n        url.searchParams.set('optionId', newOption.id);\n        window.history.replaceState({}, '', url.toString());\n        console.log('[Composer] Updated URL with new optionId');\n      }\n    } catch (error) {\n      console.error('[Composer] Unexpected error in ensureOptionExists:', error);\n    }\n  };\n\n  // Helper to ensure tenantId exists at save time\n  const ensureTenantForSave = async (): Promise<string | null> => {\n    if (tenantId) return tenantId;\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      let resolved: string | null = user?.user_metadata?.tenant_id ?? null;\n      if (!resolved && quoteId) {\n        const { data: q } = await supabase\n          .from('quotes')\n          .select('tenant_id')\n          .eq('id', quoteId)\n          .maybeSingle();\n        resolved = (q as any)?.tenant_id ?? null;\n      }\n      if (!resolved && versionId) {\n        const { data: v } = await supabase\n          .from('quotation_versions')\n          .select('tenant_id')\n          .eq('id', versionId)\n          .maybeSingle();\n        resolved = (v as any)?.tenant_id ?? null;\n      }\n      if (!resolved && optionId) {\n        const { data: o } = await supabase\n          .from('quotation_version_options')\n          .select('tenant_id')\n          .eq('id', optionId)\n          .maybeSingle();\n        resolved = (o as any)?.tenant_id ?? null;\n      }\n      if (resolved) setTenantId(resolved);\n      return resolved;\n    } catch {\n      return null;\n    }\n  };\n\n  const loadOptionData = async () => {\n    if (!optionId || !tenantId) return;\n\n    setLoading(true);\n    try {\n      // Load legs from quotation_version_option_legs to align with FK on quote_charges.leg_id\n      const { data: legData, error: legError } = await supabase\n        .from('quotation_version_option_legs')\n        .select(`\n          *,\n          quote_charges(\n            *,\n            charge_sides(code),\n            charge_categories(name, code),\n            charge_bases(name, code),\n            currencies(code, symbol)\n          )\n        `)\n        .eq('quotation_version_option_id', optionId)\n        .order('sort_order', { ascending: true });\n\n      if (legError) throw legError;\n\n      if (legData && legData.length > 0) {\n        // Group charges by leg and pair buy/sell\n        const legsWithCharges = legData.map((leg: any) => {\n          const chargesMap = new Map();\n\n          // Group charges by their base properties (category, basis, etc.)\n          leg.quote_charges?.forEach((charge: any) => {\n            const key = `${charge.category_id}-${charge.basis_id}-${charge.note || ''}`;\n            if (!chargesMap.has(key)) {\n              chargesMap.set(key, {\n                id: charge.id,\n                category_id: charge.category_id,\n                basis_id: charge.basis_id,\n                unit: charge.unit,\n                currency_id: charge.currency_id,\n                note: charge.note,\n                buy: { quantity: 0, rate: 0 },\n                sell: { quantity: 0, rate: 0 }\n              });\n            }\n\n            const chargeObj = chargesMap.get(key);\n            const side = charge.charge_sides?.code;\n            if (side === 'buy') {\n              chargeObj.buy = { quantity: charge.quantity || 0, rate: charge.rate || 0 };\n            } else if (side === 'sell') {\n              chargeObj.sell = { quantity: charge.quantity || 0, rate: charge.rate || 0 };\n            }\n          });\n\n          return {\n            id: leg.id,\n            mode: leg.mode || 'ocean',\n            serviceTypeId: leg.service_type_id || '',\n            origin: leg.origin_location || '',\n            destination: leg.destination_location || '',\n            legType: leg.leg_type || 'transport',\n            serviceOnlyCategory: leg.service_only_category || '',\n            charges: Array.from(chargesMap.values())\n          };\n        });\n\n        setLegs(legsWithCharges);\n      }\n      // Load combined charges (leg_id IS NULL) and pair buy/sell\n      const { data: combinedData, error: combinedErr } = await supabase\n        .from('quote_charges' as any)\n        .select(`*, charge_sides(code)`)\n        .eq('quote_option_id', optionId)\n        .is('leg_id', null)\n        .order('sort_order', { ascending: true });\n      if (combinedErr) throw combinedErr;\n      if (Array.isArray(combinedData)) {\n        const map = new Map<string, any>();\n        combinedData.forEach((row: any) => {\n          const key = `${row.category_id}-${row.basis_id}-${row.note || ''}`;\n          const existing = map.get(key) || {\n            id: row.id,\n            category_id: row.category_id,\n            basis_id: row.basis_id,\n            unit: row.unit,\n            currency_id: row.currency_id,\n            note: row.note,\n            buy: { quantity: 0, rate: 0 },\n            sell: { quantity: 0, rate: 0 }\n          };\n          if (row.charge_sides?.code === 'buy') {\n            existing.buy = { quantity: row.quantity || 0, rate: row.rate || 0 };\n          } else if (row.charge_sides?.code === 'sell') {\n            existing.sell = { quantity: row.quantity || 0, rate: row.rate || 0 };\n          }\n          map.set(key, existing);\n        });\n        setCombinedCharges(Array.from(map.values()));\n      } else {\n        setCombinedCharges([]);\n      }\n    } catch (error: any) {\n      toast({ title: 'Error loading data', description: error.message, variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const addLeg = (modeId: string) => {\n    // Resolve the selected transport mode so we can use its code for lookups and labels\n    const selectedMode = transportModes.find((tm) => tm.id === modeId);\n    const modeCode = selectedMode?.code || modeId;\n    const lowerModeCode = modeCode.toLowerCase();\n    \n    // Find matching service types by looking at their transport_modes relationship\n    const matchingServiceTypes = serviceTypes.filter((st) => {\n      if (!st.is_active) return false;\n      const transportMode = (st as any).transport_modes;\n      return transportMode && transportMode.code?.toLowerCase() === lowerModeCode;\n    });\n    \n    const defaultServiceType = matchingServiceTypes[0];\n\n    const newLeg: Leg = {\n      id: `leg-${Date.now()}`,\n      mode: modeCode,\n      serviceTypeId: defaultServiceType?.id || '',\n      origin: '',\n      destination: '',\n      charges: [],\n      legType: 'transport',\n    };\n    setLegs([...legs, newLeg]);\n    \n    // Show toast if service type was auto-selected\n    if (defaultServiceType) {\n      toast({\n        title: 'Service Type Auto-Selected',\n        description: `${defaultServiceType.name} has been automatically selected for ${selectedMode?.name || modeCode} transport.`,\n      });\n    }\n  };\n\n  const updateLeg = (legId: string, updates: Partial<Leg>) => {\n    setLegs(legs.map(leg => leg.id === legId ? { ...leg, ...updates } : leg));\n  };\n\n  const confirmRemoveLeg = (legId: string) => {\n    const leg = legs.find(l => l.id === legId);\n    const hasCharges = leg && leg.charges.length > 0;\n    \n    if (hasCharges) {\n      setDeleteDialog({\n        open: true,\n        type: 'leg',\n        target: legId\n      });\n    } else {\n      removeLeg(legId);\n    }\n  };\n\n  const removeLeg = (legId: string) => {\n    // Track charges that need to be deleted from DB\n    const legToRemove = legs.find(leg => leg.id === legId);\n    if (legToRemove) {\n      const chargeIdsToDelete: string[] = [];\n      legToRemove.charges.forEach(charge => {\n        if (charge.buy?.dbChargeId) chargeIdsToDelete.push(charge.buy.dbChargeId);\n        if (charge.sell?.dbChargeId) chargeIdsToDelete.push(charge.sell.dbChargeId);\n      });\n      if (chargeIdsToDelete.length > 0) {\n        setChargesToDelete(prev => [...prev, ...chargeIdsToDelete]);\n      }\n    }\n    \n    setLegs(legs.filter(leg => leg.id !== legId));\n    setDeleteDialog({ open: false, type: 'leg' });\n  };\n\n  const addCharge = (legId: string) => {\n    setLegs(legs.map(leg => {\n      if (leg.id === legId) {\n        return {\n          ...leg,\n          charges: [\n            ...leg.charges,\n            {\n              id: `charge-${Date.now()}`,\n              category_id: '',\n              basis_id: '',\n              unit: '',\n              currency_id: currencies[0]?.id || '',\n              buy: { quantity: 1, rate: 0, dbChargeId: null },\n              sell: { quantity: 1, rate: 0, dbChargeId: null },\n              note: ''\n            }\n          ]\n        };\n      }\n      return leg;\n    }));\n  };\n\n  const updateCharge = (legId: string, chargeIdx: number, field: string, value: any) => {\n    setLegs(legs.map(leg => {\n      if (leg.id === legId) {\n        const charges = [...leg.charges];\n        const charge = { ...charges[chargeIdx] };\n\n        if (field.includes('.')) {\n          const [parent, child] = field.split('.');\n          charge[parent] = { ...(charge[parent] || {}), [child]: value };\n        } else {\n          charge[field] = value;\n        }\n\n        // Apply auto margin if enabled\n        if (autoMargin && marginPercent > 0 && field.startsWith('buy.')) {\n          const sellRate = (charge.buy?.rate || 0) * (1 + marginPercent / 100);\n          charge.sell = {\n            quantity: charge.buy?.quantity || 1,\n            rate: sellRate\n          };\n        }\n\n        charges[chargeIdx] = charge;\n        return { ...leg, charges };\n      }\n      return leg;\n    }));\n  };\n\n  const confirmRemoveCharge = (legId: string, chargeIdx: number) => {\n    setDeleteDialog({\n      open: true,\n      type: 'charge',\n      target: { legId, chargeIdx }\n    });\n  };\n\n  const removeCharge = (legId: string, chargeIdx: number) => {\n    setLegs(legs.map(leg => {\n      if (leg.id === legId) {\n        const chargeToRemove = leg.charges[chargeIdx];\n        \n        // Track DB charge IDs for deletion\n        if (chargeToRemove) {\n          const idsToDelete: string[] = [];\n          if (chargeToRemove.buy?.dbChargeId) idsToDelete.push(chargeToRemove.buy.dbChargeId);\n          if (chargeToRemove.sell?.dbChargeId) idsToDelete.push(chargeToRemove.sell.dbChargeId);\n          if (idsToDelete.length > 0) {\n            setChargesToDelete(prev => [...prev, ...idsToDelete]);\n          }\n        }\n        \n        return {\n          ...leg,\n          charges: leg.charges.filter((_, idx) => idx !== chargeIdx)\n        };\n      }\n      return leg;\n    }));\n    \n    setDeleteDialog({ open: false, type: 'charge' });\n  };\n\n  // Combined charges handlers\n  const addCombinedCharge = () => {\n    setCombinedCharges(prev => ([\n      ...prev,\n      {\n        id: `combined-${Date.now()}`,\n        category_id: '',\n        basis_id: '',\n        unit: '',\n        currency_id: currencies[0]?.id || '',\n        buy: { quantity: 1, rate: 0, dbChargeId: null },\n        sell: { quantity: 1, rate: 0, dbChargeId: null },\n        note: ''\n      }\n    ]));\n  };\n\n  const updateCombinedCharge = (chargeIdx: number, field: string, value: any) => {\n    setCombinedCharges(prev => {\n      const next = [...prev];\n      const charge = { ...next[chargeIdx] };\n      if (field.includes('.')) {\n        const [parent, child] = field.split('.');\n        charge[parent] = { ...(charge[parent] || {}), [child]: value };\n      } else {\n        charge[field] = value;\n      }\n      if (autoMargin && marginPercent > 0 && field.startsWith('buy.')) {\n        const buyAmount = (charge.buy?.quantity || 1) * (charge.buy?.rate || 0);\n        const sellRate = (charge.buy?.rate || 0) * (1 + marginPercent / 100);\n        charge.sell = {\n          quantity: charge.buy?.quantity || 1,\n          rate: sellRate\n        };\n      }\n      next[chargeIdx] = charge;\n      return next;\n    });\n  };\n\n  const confirmRemoveCombinedCharge = (chargeIdx: number) => {\n    setDeleteDialog({\n      open: true,\n      type: 'combinedCharge',\n      target: chargeIdx\n    });\n  };\n\n  const removeCombinedCharge = (chargeIdx: number) => {\n    setCombinedCharges(prev => {\n      const chargeToRemove = prev[chargeIdx];\n      \n      // Track DB charge IDs for deletion\n      if (chargeToRemove) {\n        const idsToDelete: string[] = [];\n        if (chargeToRemove.buy?.dbChargeId) idsToDelete.push(chargeToRemove.buy.dbChargeId);\n        if (chargeToRemove.sell?.dbChargeId) idsToDelete.push(chargeToRemove.sell.dbChargeId);\n        if (idsToDelete.length > 0) {\n          setChargesToDelete(prevIds => [...prevIds, ...idsToDelete]);\n        }\n      }\n      \n      return prev.filter((_, idx) => idx !== chargeIdx);\n    });\n    \n    setDeleteDialog({ open: false, type: 'combinedCharge' });\n  };\n\n  const openBasisModal = (legId: string, chargeIdx: number) => {\n    setBasisTarget({ type: 'leg', legId, chargeIdx });\n    const tdId = String(tradeDirections?.[0]?.id ?? '');\n    const ctId = String(containerTypes?.[0]?.id ?? '');\n    const csId = String(containerSizes?.[0]?.id ?? '');\n    setCurrentBasisConfig({ tradeDirection: tdId, containerType: ctId, containerSize: csId, quantity: 1 });\n    setBasisModalOpen(true);\n  };\n\n  const openCombinedBasisModal = (chargeIdx: number) => {\n    setBasisTarget({ type: 'combined', chargeIdx });\n    const tdId = String(tradeDirections?.[0]?.id ?? '');\n    const ctId = String(containerTypes?.[0]?.id ?? '');\n    const csId = String(containerSizes?.[0]?.id ?? '');\n    setCurrentBasisConfig({ tradeDirection: tdId, containerType: ctId, containerSize: csId, quantity: 1 });\n    setBasisModalOpen(true);\n  };\n\n  const saveBasisConfig = (config: any) => {\n    if (!basisTarget) return;\n    const size = containerSizes.find(s => s.id === config.containerSize);\n\n    if (basisTarget.type === 'leg' && basisTarget.legId) {\n      const { legId, chargeIdx } = basisTarget;\n      setLegs(legs.map(leg => {\n        if (leg.id === legId) {\n          const charges = [...leg.charges];\n          charges[chargeIdx] = {\n            ...charges[chargeIdx],\n            unit: `${config.quantity}x${size?.name || ''}`,\n            buy: { ...charges[chargeIdx].buy, quantity: config.quantity },\n            sell: { ...charges[chargeIdx].sell, quantity: config.quantity },\n            basisDetails: config\n          };\n          return { ...leg, charges };\n        }\n        return leg;\n      }));\n    } else if (basisTarget.type === 'combined') {\n      const { chargeIdx } = basisTarget;\n      setCombinedCharges(prev => {\n        const next = [...prev];\n        next[chargeIdx] = {\n          ...next[chargeIdx],\n          unit: `${config.quantity}x${size?.name || ''}`,\n          buy: { ...(next[chargeIdx].buy || {}), quantity: config.quantity },\n          sell: { ...(next[chargeIdx].sell || {}), quantity: config.quantity },\n          basisDetails: config\n        };\n        return next;\n      });\n    }\n\n    setBasisModalOpen(false);\n    setCurrentBasisConfig({ tradeDirection: '', containerType: '', containerSize: '', quantity: 1 });\n  };\n\n  const validateQuotation = () => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Validate legs\n    if (legs.length === 0) {\n      errors.push('At least one transport leg is required');\n    }\n\n    legs.forEach((leg, idx) => {\n      if (!leg.mode) errors.push(`Leg ${idx + 1}: Mode is required`);\n      if (!leg.origin) errors.push(`Leg ${idx + 1}: Origin is required`);\n      if (!leg.destination) errors.push(`Leg ${idx + 1}: Destination is required`);\n      \n      if (leg.charges.length === 0) {\n        warnings.push(`Leg ${idx + 1}: No charges added. Consider adding at least one charge.`);\n      }\n      \n      leg.charges.forEach((charge, chargeIdx) => {\n        if (!charge.category_id) {\n          errors.push(`Leg ${idx + 1}, Charge ${chargeIdx + 1}: Category is required`);\n        }\n        if (!charge.currency_id) {\n          errors.push(`Leg ${idx + 1}, Charge ${chargeIdx + 1}: Currency is required`);\n        }\n        \n        // Warn about zero rates\n        if (charge.sell?.rate === 0) {\n          warnings.push(`Leg ${idx + 1}, Charge ${chargeIdx + 1}: Sell rate is zero`);\n        }\n      });\n    });\n\n    // Validate combined charges\n    combinedCharges.forEach((charge, idx) => {\n      if (!charge.category_id) {\n        errors.push(`Combined Charge ${idx + 1}: Category is required`);\n      }\n      if (!charge.currency_id) {\n        errors.push(`Combined Charge ${idx + 1}: Currency is required`);\n      }\n    });\n    \n    // Check if all legs have zero charges and no combined charges\n    if (legs.every(leg => leg.charges.length === 0) && combinedCharges.length === 0) {\n      errors.push('At least one leg must have charges, or add combined charges');\n    }\n\n    return { errors, warnings };\n  };\n\n  const saveQuotation = async () => {\n    // Validate first\n    const validation = validateQuotation();\n    setValidationErrors(validation.errors);\n    setValidationWarnings(validation.warnings);\n    \n    if (validation.errors.length > 0) {\n      toast({\n        title: 'Validation Error',\n        description: `Please fix ${validation.errors.length} error${validation.errors.length > 1 ? 's' : ''} before saving`,\n        variant: 'destructive'\n      });\n      return;\n    }\n\n    setSaving(true);\n    \n    // Initialize progress tracking\n    const progressSteps = [\n      { label: 'Validating data...', completed: false },\n      { label: 'Creating quotation option...', completed: false },\n      { label: 'Cleaning up deleted items...', completed: false },\n      { label: 'Saving transport legs...', completed: false },\n      { label: 'Saving charges...', completed: false },\n      { label: 'Finalizing...', completed: false }\n    ];\n    \n    setSaveProgress({ show: true, steps: progressSteps });\n    \n    const updateProgress = (stepIndex: number) => {\n      progressSteps[stepIndex].completed = true;\n      setSaveProgress({ show: true, steps: [...progressSteps] });\n    };\n\n    try {\n      // Ensure tenant is resolved before proceeding\n      const finalTenantId = await ensureTenantForSave();\n      if (!finalTenantId) {\n        toast({\n          title: 'Save Failed',\n          description: 'Tenant ID not found. Please ensure the quote belongs to a tenant or your user has a tenant assigned.',\n          variant: 'destructive'\n        });\n        setSaving(false);\n        setSaveProgress({ show: false, steps: [] });\n        return;\n      }\n\n      updateProgress(0); // Validation complete\n\n      // Ensure we have an option to save to\n      console.log('[Composer] Ensuring option exists before save. Current optionId:', optionId);\n      let currentOptionId = optionId;\n      \n      if (!currentOptionId) {\n        // This should rarely happen now that we call ensureOptionExists in loadInitialData\n        console.log('[Composer] No optionId - checking for existing options');\n        const { data: existingOptions } = await supabase\n          .from('quotation_version_options')\n          .select('id')\n          .eq('quotation_version_id', versionId)\n          .order('created_at', { ascending: false })\n          .limit(1);\n\n        if (existingOptions && existingOptions.length > 0) {\n          currentOptionId = existingOptions[0].id;\n          setOptionId(currentOptionId);\n          console.log('[Composer] Using existing option:', currentOptionId);\n        } else {\n          console.log('[Composer] Creating new option during save');\n          const { data: newOption, error: optError } = await supabase\n            .from('quotation_version_options')\n            .insert({\n              quotation_version_id: versionId,\n              tenant_id: finalTenantId\n            })\n            .select()\n            .maybeSingle();\n          \n          if (optError) {\n            console.error('[Composer] Error creating option:', optError);\n            throw new Error(`Failed to create quotation option: ${optError.message}`);\n          }\n          \n          if (newOption?.id) {\n            currentOptionId = newOption.id;\n            setOptionId(currentOptionId);\n            console.log('[Composer] Created option:', currentOptionId);\n          }\n        }\n      } else {\n        console.log('[Composer] Using existing optionId:', currentOptionId);\n      }\n      \n      updateProgress(1); // Option created\n\n      // Delete tracked charges first\n      if (chargesToDelete.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('quote_charges')\n          .delete()\n          .in('id', chargesToDelete);\n        \n        if (deleteError) {\n          console.error('Error deleting charges:', deleteError);\n          throw new Error(`Failed to delete charges: ${deleteError.message}`);\n        }\n        \n        // Clear the deletion queue\n        setChargesToDelete([]);\n      }\n\n      // Get charge side IDs\n      const [buySideRes, sellSideRes] = await Promise.all([\n        supabase.from('charge_sides').select('id').eq('code', 'buy').single(),\n        supabase.from('charge_sides').select('id').eq('code', 'sell').single()\n      ]);\n\n      if (buySideRes.error || sellSideRes.error || !buySideRes.data || !sellSideRes.data) {\n        throw new Error('Failed to fetch charge sides');\n      }\n\n      const buySideId = buySideRes.data.id;\n      const sellSideId = sellSideRes.data.id;\n\n      // Clean up orphaned legs and their charges\n      const { data: existingLegs } = await supabase\n        .from('quotation_version_option_legs')\n        .select('id')\n        .eq('quotation_version_option_id', currentOptionId);\n      \n      const stateLegIds = new Set(\n        (legs || [])\n          .filter(l => !String(l.id).startsWith('leg-'))\n          .map(l => String(l.id))\n      );\n      \n      const toDeleteLegIds = (existingLegs || [])\n        .map((l: any) => String(l.id))\n        .filter((id: string) => !stateLegIds.has(id));\n      \n      if (toDeleteLegIds.length > 0) {\n        // Delete charges associated with removed legs\n        const { error: chargeDeleteError } = await supabase\n          .from('quote_charges')\n          .delete()\n          .in('leg_id', toDeleteLegIds)\n          .eq('quote_option_id', currentOptionId);\n        \n        if (chargeDeleteError) {\n          console.error('Error deleting leg charges:', chargeDeleteError);\n          throw new Error(`Failed to delete leg charges: ${chargeDeleteError.message}`);\n        }\n        \n        // Delete the legs themselves\n        const { error: legDeleteError } = await supabase\n          .from('quotation_version_option_legs')\n          .delete()\n          .in('id', toDeleteLegIds);\n        \n        if (legDeleteError) {\n          console.error('Error deleting legs:', legDeleteError);\n          throw new Error(`Failed to delete legs: ${legDeleteError.message}`);\n        }\n      }\n      \n      updateProgress(2); // Cleanup complete\n\n      // Save legs and charges\n      for (let i = 0; i < legs.length; i++) {\n        const leg = legs[i];\n        let legId = leg.id;\n        \n        if (leg.id.startsWith('leg-')) {\n          // New leg\n          const { data: newLeg, error: legError } = await supabase\n            .from('quotation_version_option_legs')\n            .insert({\n              quotation_version_option_id: currentOptionId,\n              mode: leg.mode,\n              service_type_id: leg.serviceTypeId || null,\n              origin_location: leg.origin,\n              destination_location: leg.destination,\n              leg_type: leg.legType || 'transport',\n              service_only_category: leg.serviceOnlyCategory || null,\n              tenant_id: finalTenantId,\n              franchise_id: franchiseId,\n              sort_order: i\n            })\n            .select()\n            .single();\n          \n          if (legError) throw legError;\n          if (!newLeg) throw new Error('Failed to create leg');\n          legId = (newLeg as any).id;\n        } else {\n          // Update existing leg\n          const { error: updateError } = await supabase\n            .from('quotation_version_option_legs')\n            .update({\n              mode: leg.mode,\n              service_type_id: leg.serviceTypeId || null,\n              origin_location: leg.origin,\n              destination_location: leg.destination,\n              leg_type: leg.legType || 'transport',\n              service_only_category: leg.serviceOnlyCategory || null,\n              sort_order: i\n            })\n            .eq('id', legId);\n          \n          if (updateError) throw updateError;\n        }\n\n        // Save charges with UPDATE/INSERT logic\n        for (const charge of leg.charges) {\n          const chargeData = {\n            quote_option_id: currentOptionId,\n            leg_id: legId,\n            category_id: charge.category_id || null,\n            basis_id: charge.basis_id || null,\n            currency_id: charge.currency_id || null,\n            unit: charge.unit || null,\n            note: charge.note || null,\n            tenant_id: finalTenantId,\n            franchise_id: franchiseId\n          };\n\n          // Handle buy side\n          if (charge.buy?.dbChargeId) {\n            // Update existing\n            const { error: updateError } = await supabase\n              .from('quote_charges')\n              .update({\n                ...chargeData,\n                quantity: charge.buy.quantity || 1,\n                rate: charge.buy.rate || 0,\n                amount: (charge.buy.quantity || 1) * (charge.buy.rate || 0)\n              })\n              .eq('id', charge.buy.dbChargeId);\n            if (updateError) throw updateError;\n          } else {\n            // Insert new\n            const { error: insertError } = await supabase\n              .from('quote_charges')\n              .insert({\n                ...chargeData,\n                charge_side_id: buySideId,\n                quantity: charge.buy?.quantity || 1,\n                rate: charge.buy?.rate || 0,\n                amount: (charge.buy?.quantity || 1) * (charge.buy?.rate || 0)\n              });\n            if (insertError) throw insertError;\n          }\n\n          // Handle sell side\n          if (charge.sell?.dbChargeId) {\n            // Update existing\n            const { error: updateError } = await supabase\n              .from('quote_charges')\n              .update({\n                ...chargeData,\n                quantity: charge.sell.quantity || 1,\n                rate: charge.sell.rate || 0,\n                amount: (charge.sell.quantity || 1) * (charge.sell.rate || 0)\n              })\n              .eq('id', charge.sell.dbChargeId);\n            if (updateError) throw updateError;\n          } else {\n            // Insert new\n            const { error: insertError } = await supabase\n              .from('quote_charges')\n              .insert({\n                ...chargeData,\n                charge_side_id: sellSideId,\n                quantity: charge.sell?.quantity || 1,\n                rate: charge.sell?.rate || 0,\n                amount: (charge.sell?.quantity || 1) * (charge.sell?.rate || 0)\n              });\n            if (insertError) throw insertError;\n          }\n        }\n      }\n      \n      updateProgress(3); // Legs saved\n\n      // Save combined charges with UPDATE/INSERT logic\n      for (const charge of combinedCharges || []) {\n        const chargeData = {\n          quote_option_id: currentOptionId,\n          leg_id: null,\n          category_id: charge.category_id || null,\n          basis_id: charge.basis_id || null,\n          currency_id: charge.currency_id || null,\n          unit: charge.unit || null,\n          note: charge.note || null,\n          tenant_id: finalTenantId\n        };\n\n        // Handle buy side\n        if (charge.buy?.dbChargeId) {\n          const { error: updateError } = await supabase\n            .from('quote_charges')\n            .update({\n              ...chargeData,\n              quantity: charge.buy.quantity || 1,\n              rate: charge.buy.rate || 0,\n              amount: (charge.buy.quantity || 1) * (charge.buy.rate || 0)\n            })\n            .eq('id', charge.buy.dbChargeId);\n          if (updateError) throw updateError;\n        } else {\n          const { error: insertError } = await supabase\n            .from('quote_charges')\n            .insert({\n              ...chargeData,\n              charge_side_id: buySideId,\n              quantity: charge.buy?.quantity || 1,\n              rate: charge.buy?.rate || 0,\n              amount: (charge.buy?.quantity || 1) * (charge.buy?.rate || 0)\n            });\n          if (insertError) throw insertError;\n        }\n\n        // Handle sell side\n        if (charge.sell?.dbChargeId) {\n          const { error: updateError } = await supabase\n            .from('quote_charges')\n            .update({\n              ...chargeData,\n              quantity: charge.sell.quantity || 1,\n              rate: charge.sell.rate || 0,\n              amount: (charge.sell.quantity || 1) * (charge.sell.rate || 0)\n            })\n            .eq('id', charge.sell.dbChargeId);\n          if (updateError) throw updateError;\n        } else {\n          const { error: insertError } = await supabase\n            .from('quote_charges')\n            .insert({\n              ...chargeData,\n              charge_side_id: sellSideId,\n              quantity: charge.sell?.quantity || 1,\n              rate: charge.sell?.rate || 0,\n              amount: (charge.sell?.quantity || 1) * (charge.sell?.rate || 0)\n            });\n          if (insertError) throw insertError;\n        }\n      }\n      \n      updateProgress(4); // Charges saved\n\n      toast({ \n        title: 'Success', \n        description: 'Quotation saved successfully',\n        duration: 3000\n      });\n      \n      // Reload data to sync with database\n      if (currentOptionId) {\n        await loadOptionData();\n      }\n      \n      // Clear deletion queue after successful save\n      setChargesToDelete([]);\n      \n      // Clear validation feedback\n      setValidationErrors([]);\n      setValidationWarnings([]);\n      \n      updateProgress(5); // Complete\n      \n      // Keep success display for a moment\n      setTimeout(() => {\n        setSaveProgress({ show: false, steps: [] });\n      }, 1000);\n      \n    } catch (error: any) {\n      console.error('Save quotation error:', error);\n      const errorMessage = error.message || 'Failed to save quotation';\n      \n      // Hide progress on error\n      setSaveProgress({ show: false, steps: [] });\n      \n      toast({ \n        title: 'Save Failed', \n        description: errorMessage,\n        variant: 'destructive' \n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleNext = () => {\n    // Clear validation on navigation\n    setValidationErrors([]);\n    setValidationWarnings([]);\n    \n    if (currentStep < 4) {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    // Clear validation on navigation\n    setValidationErrors([]);\n    setValidationWarnings([]);\n    \n    if (currentStep > 1) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const canProceed = () => {\n    switch (currentStep) {\n      case 1:\n        // Quote details - require at least currency\n        return quoteData.currencyId;\n      case 2:\n        // Legs - require at least one valid leg\n        return legs.length > 0 && legs.every(leg => \n          leg.mode && leg.origin && leg.destination\n        );\n      case 3:\n        // Charges - at least one leg should have charges OR there should be combined charges\n        return legs.some(leg => leg.charges.length > 0) || combinedCharges.length > 0;\n      default:\n        return true;\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"py-12 flex flex-col items-center justify-center gap-4\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          <p className=\"text-sm text-muted-foreground\">Loading quotation data...</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Validation Feedback */}\n      {(validationErrors.length > 0 || validationWarnings.length > 0) && (\n        <ValidationFeedback errors={validationErrors} warnings={validationWarnings} />\n      )}\n      \n      <Card>\n        <CardContent className=\"pt-6\">\n          <QuotationWorkflowStepper\n            currentStep={currentStep}\n            onStepClick={setCurrentStep}\n            steps={STEPS}\n          />\n        </CardContent>\n      </Card>\n\n      {currentStep === 1 && (\n        <QuoteDetailsStep\n          quoteData={quoteData}\n          currencies={currencies}\n          onChange={(field, value) => setQuoteData({ ...quoteData, [field]: value })}\n        />\n      )}\n\n      {currentStep === 2 && (\n        <LegsConfigurationStep\n          legs={legs}\n          serviceTypes={serviceTypes}\n          onAddLeg={addLeg}\n          onUpdateLeg={updateLeg}\n          onRemoveLeg={confirmRemoveLeg}\n        />\n      )}\n\n      {currentStep === 3 && (\n        <ChargesManagementStep\n          legs={legs}\n          combinedCharges={combinedCharges}\n          chargeCategories={chargeCategories}\n          chargeBases={chargeBases}\n          currencies={currencies}\n          tradeDirections={tradeDirections}\n          containerTypes={containerTypes}\n          containerSizes={containerSizes}\n          serviceTypes={serviceTypes}\n          autoMargin={autoMargin}\n          marginPercent={marginPercent}\n          onAutoMarginChange={setAutoMargin}\n          onMarginPercentChange={setMarginPercent}\n          onAddCharge={addCharge}\n          onUpdateCharge={updateCharge}\n          onRemoveCharge={confirmRemoveCharge}\n          onConfigureBasis={openBasisModal}\n          onAddCombinedCharge={addCombinedCharge}\n          onUpdateCombinedCharge={updateCombinedCharge}\n          onRemoveCombinedCharge={confirmRemoveCombinedCharge}\n          onConfigureCombinedBasis={openCombinedBasisModal}\n        />\n      )}\n\n      {currentStep === 4 && (\n        <ReviewAndSaveStep\n          legs={legs}\n          quoteData={quoteData}\n          currencies={currencies}\n          combinedCharges={combinedCharges}\n        />\n      )}\n\n      {/* Navigation */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={handleBack}\n              disabled={currentStep === 1}\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back\n            </Button>\n\n            {currentStep < 4 ? (\n              <Button onClick={handleNext} disabled={!canProceed()}>\n                Next\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            ) : (\n              <Button onClick={saveQuotation} disabled={saving} size=\"lg\">\n                {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                <Save className=\"mr-2 h-4 w-4\" />\n                Save Quotation\n                <span className=\"ml-2 text-xs opacity-70\">(Ctrl+S)</span>\n              </Button>\n            )}\n          </div>\n          \n          {/* Keyboard shortcuts hint */}\n          <p className=\"text-xs text-center text-muted-foreground mt-4\">\n             Tip: Use <kbd className=\"px-2 py-1 bg-muted rounded text-xs\">Ctrl</kbd> + <kbd className=\"px-2 py-1 bg-muted rounded text-xs\"></kbd> / <kbd className=\"px-2 py-1 bg-muted rounded text-xs\"></kbd> to navigate, <kbd className=\"px-2 py-1 bg-muted rounded text-xs\">Ctrl</kbd> + <kbd className=\"px-2 py-1 bg-muted rounded text-xs\">S</kbd> to save\n          </p>\n        </CardContent>\n      </Card>\n\n      {/* Basis Configuration Modal */}\n      <BasisConfigModal\n        open={basisModalOpen}\n        onClose={() => setBasisModalOpen(false)}\n        onSave={saveBasisConfig}\n        config={currentBasisConfig}\n        onChange={(updates) => setCurrentBasisConfig({ ...currentBasisConfig, ...updates })}\n        tradeDirections={tradeDirections}\n        containerTypes={containerTypes}\n        containerSizes={containerSizes}\n      />\n\n      {/* Delete Confirmation Dialog */}\n      <DeleteConfirmDialog\n        open={deleteDialog.open}\n        onOpenChange={(open) => setDeleteDialog({ ...deleteDialog, open })}\n        onConfirm={() => {\n          if (deleteDialog.type === 'leg' && deleteDialog.target) {\n            removeLeg(deleteDialog.target);\n          } else if (deleteDialog.type === 'charge' && deleteDialog.target) {\n            removeCharge(deleteDialog.target.legId, deleteDialog.target.chargeIdx);\n          } else if (deleteDialog.type === 'combinedCharge' && typeof deleteDialog.target === 'number') {\n            removeCombinedCharge(deleteDialog.target);\n          }\n        }}\n        title={\n          deleteDialog.type === 'leg' \n            ? 'Delete Transport Leg' \n            : deleteDialog.type === 'charge'\n            ? 'Delete Charge'\n            : 'Delete Combined Charge'\n        }\n        description={\n          deleteDialog.type === 'leg'\n            ? 'This will remove the leg and all its associated charges. This action cannot be undone.'\n          : 'This will remove this charge. This action cannot be undone.'\n        }\n      />\n      \n      {/* Save Progress Overlay */}\n      <SaveProgress show={saveProgress.show} steps={saveProgress.steps} />\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/QuotationPackagesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/QuotationVersionHistory.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2892,2895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2892,2895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3446,3449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3446,3449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'rateMap' is never reassigned. Use 'const' instead.","line":93,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":93,"endColumn":41,"fix":{"range":[3498,3536],"text":"const rateMap: Record<string, any> = {};"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3526,3529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3526,3529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3862,3865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3862,3865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4000,4003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4000,4003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5047,5050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5047,5050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":146,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":146,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5687,5687],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":150,"column":6,"nodeType":"ArrayExpression","endLine":150,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [load, quoteId]","fix":{"range":[5725,5734],"text":"[load, quoteId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6302,6305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6302,6305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6518,6521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6518,6521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7130,7133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7130,7133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7259,7262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7259,7262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8696,8699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8696,8699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9024,9027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9024,9027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9389,9392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9389,9392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10849,10852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10849,10852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":356,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12747,12750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12747,12750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useState } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { toast } from '@/components/ui/use-toast';\nimport { useNavigate } from 'react-router-dom';\nimport { createQuotationVersionWithOptions, recordCustomerSelection, createBlankOption } from '@/integrations/supabase/carrierRatesActions';\nimport { VersionCard } from './quotation-versions/VersionCard';\nimport { VersionActions } from './quotation-versions/VersionActions';\nimport { EmptyState } from './quotation-versions/EmptyState';\nimport { VersionComparison } from './quotation-versions/VersionComparison';\nimport { CustomerSelectionDialog } from './quotation-versions/CustomerSelectionDialog';\nimport { Loader2 } from 'lucide-react';\n\ntype Version = {\n  id: string;\n  quote_id: string;\n  version_number: number;\n  kind: 'minor' | 'major';\n  status: string | null;\n  created_at: string;\n  is_current?: boolean;\n};\n\ntype Option = {\n  id: string;\n  quotation_version_id: string;\n  option_name?: string | null;\n  carrier_name: string;\n  total_amount: number;\n  currency: string;\n  transit_time_days: number | null;\n  total_buy?: number;\n  total_sell?: number;\n  margin_amount?: number;\n  margin_percentage?: number;\n};\n\nexport function QuotationVersionHistory({ quoteId }: { quoteId: string }) {\n  const [versions, setVersions] = useState<Version[]>([]);\n  const [optionsByVersion, setOptionsByVersion] = useState<Record<string, Option[]>>({});\n  const [loading, setLoading] = useState(false);\n  const [tenantId, setTenantId] = useState<string | null>(null);\n  const [franchiseId, setFranchiseId] = useState<string | null>(null);\n  const [userId, setUserId] = useState<string | null>(null);\n  const [compareVersionIds, setCompareVersionIds] = useState<{ v1: string; v2: string } | null>(null);\n  const [selectionDialogOpen, setSelectionDialogOpen] = useState(false);\n  const [selectedVersionForCustomer, setSelectedVersionForCustomer] = useState<string | null>(null);\n  const navigate = useNavigate();\n\n  const load = async () => {\n    setLoading(true);\n    try {\n      // Get current version ID from quote\n      const { data: quoteData } = await supabase\n        .from('quotes')\n        .select('current_version_id')\n        .eq('id', quoteId)\n        .maybeSingle();\n\n      const currentVersionId = quoteData?.current_version_id;\n\n      const { data: vs, error: vErr } = await supabase\n        .from('quotation_versions')\n        .select('*')\n        .eq('quote_id', quoteId)\n        .order('version_number', { ascending: false });\n      if (vErr) throw vErr;\n\n      // Mark current version\n      const versionsWithCurrent = (vs ?? []).map(v => ({\n        ...v,\n        is_current: v.id === currentVersionId,\n      })) as Version[];\n\n      const versionIds = versionsWithCurrent.map((v: any) => v.id);\n      if (versionIds.length > 0) {\n        const { data: opts, error: oErr } = await supabase\n          .from('quotation_version_options')\n          .select(`\n            id,\n            quotation_version_id,\n            carrier_rate_id,\n            option_name,\n            total_buy,\n            total_sell,\n            total_amount,\n            margin_amount,\n            margin_percentage\n          `)\n          .in('quotation_version_id', versionIds);\n        if (oErr) throw oErr;\n        const carrierRateIds = (opts ?? []).map((o: any) => o.carrier_rate_id).filter(Boolean);\n        let rateMap: Record<string, any> = {};\n        if (carrierRateIds.length > 0) {\n          const { data: rates, error: rErr } = await supabase\n            .from('carrier_rates')\n            .select('id, carrier_name, currency, base_rate, mode, valid_until')\n            .in('id', carrierRateIds);\n          if (rErr) throw rErr;\n          (rates ?? []).forEach((r: any) => { rateMap[String(r.id)] = r; });\n        }\n        const grouped: Record<string, Option[]> = {};\n        (opts ?? []).forEach((o: any) => {\n          const key = o.quotation_version_id as string;\n          const r = rateMap[String(o.carrier_rate_id)] || {};\n          const opt: Option = {\n            id: o.id,\n            quotation_version_id: key,\n            option_name: o.option_name || null,\n            carrier_name: r.carrier_name || 'Carrier',\n            total_amount: Number(o.total_amount ?? r.base_rate ?? 0),\n            currency: r.currency || 'USD',\n            transit_time_days: null,\n            total_buy: o.total_buy ? Number(o.total_buy) : undefined,\n            total_sell: o.total_sell ? Number(o.total_sell) : undefined,\n            margin_amount: o.margin_amount ? Number(o.margin_amount) : undefined,\n            margin_percentage: o.margin_percentage ? Number(o.margin_percentage) : undefined,\n          };\n          grouped[key] = grouped[key] || [];\n          grouped[key].push(opt);\n        });\n        setOptionsByVersion(grouped);\n      } else {\n        setOptionsByVersion({});\n      }\n      setVersions(versionsWithCurrent);\n    } catch (e: any) {\n      toast({ title: 'Failed to load versions', description: e.message, variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      try {\n        const { data: q } = await supabase\n          .from('quotes')\n          .select('tenant_id, franchise_id')\n          .eq('id', quoteId)\n          .maybeSingle();\n        if (q?.tenant_id) setTenantId(String(q.tenant_id));\n        if (q?.franchise_id) setFranchiseId(String(q.franchise_id));\n        const { data: auth } = await supabase.auth.getUser();\n        setUserId(auth?.user?.id ?? null);\n      } catch {}\n    };\n    init();\n    load();\n  }, [quoteId]);\n\n  const latestVersionNumber = useMemo(\n    () => (versions[0]?.version_number ?? 0),\n    [versions]\n  );\n\n  const createVersion = async (kind: 'minor' | 'major') => {\n    try {\n      const nextNumber = kind === 'minor' ? latestVersionNumber + 1 : 1;\n      if (!tenantId || !franchiseId) throw new Error('Missing tenant or franchise context');\n      const res = await createQuotationVersionWithOptions(\n        tenantId,\n        franchiseId,\n        quoteId,\n        [],\n        { kind, version_number: nextNumber, created_by: userId || null },\n        supabase as any,\n      );\n      if (!res?.version_id) throw new Error('Version creation did not return id');\n      toast({ title: `${kind === 'minor' ? 'Minor' : 'Major'} version created` });\n      await load();\n    } catch (e: any) {\n      toast({ title: 'Version creation failed', description: e.message, variant: 'destructive' });\n    }\n  };\n\n  const selectOption = async (versionId: string, optionId: string) => {\n    setSelectedVersionForCustomer(versionId);\n    setSelectionDialogOpen(true);\n  };\n\n  const handleConfirmSelection = async (optionId: string, reason: string) => {\n    if (!tenantId || !userId || !selectedVersionForCustomer) return;\n    try {\n      await recordCustomerSelection(\n        tenantId,\n        quoteId,\n        selectedVersionForCustomer,\n        optionId,\n        reason,\n        userId,\n        supabase as any,\n      );\n      toast({ title: 'Success', description: 'Customer selection recorded' });\n      await load();\n    } catch (e: any) {\n      toast({ title: 'Error', description: e.message, variant: 'destructive' });\n    }\n  };\n\n  const handleCompare = (versionId: string) => {\n    // If no comparison started, set first version\n    if (!compareVersionIds) {\n      setCompareVersionIds({ v1: versionId, v2: '' });\n      toast({ \n        title: 'Select second version', \n        description: 'Click compare on another version to compare' \n      });\n      return;\n    }\n\n    // If first version selected, set second and open comparison\n    if (compareVersionIds.v1 && !compareVersionIds.v2) {\n      setCompareVersionIds({ v1: compareVersionIds.v1, v2: versionId });\n      return;\n    }\n\n    // Reset if already comparing\n    setCompareVersionIds({ v1: versionId, v2: '' });\n    toast({ \n      title: 'Select second version', \n      description: 'Click compare on another version to compare' \n    });\n  };\n\n  const chunk = (arr: string[], size: number) => {\n    const out: string[][] = [];\n    for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));\n    return out;\n  };\n\n  const deleteVersionsByIds = async (versionIds: string[]) => {\n    if (!versionIds.length) return;\n    setLoading(true);\n    try {\n      const { data: opts, error: oErr } = await supabase\n        .from('quotation_version_options')\n        .select('id')\n        .in('quotation_version_id', versionIds);\n      if (oErr) throw oErr;\n      const optionIds = (opts ?? []).map((o: any) => String(o.id));\n\n      let quoteLegIds: string[] = [];\n      if (optionIds.length) {\n        const { data: legs1, error: lErr1 } = await supabase\n          .from('quote_legs')\n          .select('id')\n          .in('quote_option_id', optionIds);\n        if (lErr1) throw lErr1;\n        quoteLegIds = (legs1 ?? []).map((l: any) => String(l.id));\n      }\n\n      let compLegIds: string[] = [];\n      if (optionIds.length) {\n        const { data: legs2, error: lErr2 } = await supabase\n          .from('quotation_version_option_legs')\n          .select('id')\n          .in('quotation_version_option_id', optionIds);\n        if (lErr2) throw lErr2;\n        compLegIds = (legs2 ?? []).map((l: any) => String(l.id));\n      }\n\n      for (const b of chunk(optionIds, 1000)) {\n        if (!b.length) continue;\n        const { error } = await supabase.from('quote_charges').delete().in('quote_option_id', b);\n        if (error) throw error;\n      }\n      for (const b of chunk(quoteLegIds, 1000)) {\n        if (!b.length) continue;\n        const { error } = await supabase.from('quote_charges').delete().in('leg_id', b);\n        if (error) throw error;\n      }\n\n      for (const b of chunk(quoteLegIds, 1000)) {\n        if (!b.length) continue;\n        const { error } = await supabase.from('quote_legs').delete().in('id', b);\n        if (error) throw error;\n      }\n      for (const b of chunk(compLegIds, 1000)) {\n        if (!b.length) continue;\n        const { error } = await supabase.from('quotation_version_option_legs').delete().in('id', b);\n        if (error) throw error;\n      }\n\n      for (const b of chunk(optionIds, 1000)) {\n        if (!b.length) continue;\n        const { error } = await supabase.from('quotation_version_options').delete().in('id', b);\n        if (error) throw error;\n      }\n      for (const b of chunk(versionIds, 1000)) {\n        if (!b.length) continue;\n        const { error } = await supabase.from('quotation_versions').delete().in('id', b);\n        if (error) throw error;\n      }\n\n      toast({ title: 'Deleted versions', description: `Removed ${versionIds.length} version(s)` });\n      await load();\n    } catch (e: any) {\n      toast({ title: 'Delete failed', description: e.message, variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deleteVersion = async (versionId: string) => {\n    const ok = window.confirm('Delete this version and all its options/legs/charges?');\n    if (!ok) return;\n    await deleteVersionsByIds([versionId]);\n  };\n\n  const deleteByKind = async (kind: 'minor' | 'major') => {\n    const ids = versions.filter(v => v.kind === kind).map(v => v.id);\n    if (!ids.length) {\n      toast({ title: 'No versions', description: `No ${kind} versions to delete` });\n      return;\n    }\n    const ok = window.confirm(`Delete all ${kind} versions and their data?`);\n    if (!ok) return;\n    await deleteVersionsByIds(ids);\n  };\n\n  const createNewOption = async (versionId: string) => {\n    if (!tenantId || !franchiseId) {\n      toast({ title: 'Error', description: 'Tenant ID or Franchise ID not found', variant: 'destructive' });\n      return;\n    }\n\n    try {\n      const optionId = await createBlankOption(tenantId, franchiseId, versionId);\n      \n      toast({\n        title: 'Success',\n        description: 'New option created successfully',\n      });\n\n      // Navigate to the composer with the new option\n      navigate(`/dashboard/multimodal-quote?quoteId=${quoteId}&versionId=${versionId}&optionId=${optionId}`);\n    } catch (error) {\n      console.error('Failed to create option:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to create new option',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleSetCurrent = async (versionId: string) => {\n    try {\n      const { error } = await supabase.rpc('set_current_version', {\n        p_version_id: versionId,\n      });\n      if (error) throw error;\n      toast({ title: 'Success', description: 'Current version updated' });\n      await load();\n    } catch (e: any) {\n      toast({ title: 'Error', description: e.message, variant: 'destructive' });\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Quotation Versions</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <VersionActions\n          loading={loading}\n          onCreateMinor={() => createVersion('minor')}\n          onCreateMajor={() => createVersion('major')}\n          onDeleteMinor={() => deleteByKind('minor')}\n          onDeleteMajor={() => deleteByKind('major')}\n        />\n\n        {loading && versions.length === 0 ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n          </div>\n        ) : versions.length === 0 ? (\n          <EmptyState onCreateMinor={() => createVersion('minor')} loading={loading} />\n        ) : (\n          <div className=\"space-y-4\">\n            {versions.map((version) => (\n              <VersionCard\n                key={version.id}\n                version={version}\n                options={optionsByVersion[version.id] ?? []}\n                quoteId={quoteId}\n                onCreateOption={createNewOption}\n                onEditOption={(vId, optId) =>\n                  navigate(`/dashboard/multimodal-quote?quoteId=${quoteId}&versionId=${vId}&optionId=${optId}`)\n                }\n                onSelectOption={selectOption}\n                onDeleteVersion={deleteVersion}\n                onSetCurrent={handleSetCurrent}\n                onStatusChange={load}\n                onCompare={handleCompare}\n                loading={loading}\n              />\n            ))}\n          </div>\n        )}\n\n        {/* Version Comparison Dialog */}\n        {compareVersionIds?.v1 && compareVersionIds?.v2 && (\n          <VersionComparison\n            open={true}\n            onClose={() => setCompareVersionIds(null)}\n            version1Id={compareVersionIds.v1}\n            version2Id={compareVersionIds.v2}\n          />\n        )}\n\n        {/* Customer Selection Dialog */}\n        <CustomerSelectionDialog\n          open={selectionDialogOpen}\n          onClose={() => {\n            setSelectionDialogOpen(false);\n            setSelectedVersionForCustomer(null);\n          }}\n          versionId={selectedVersionForCustomer || ''}\n          options={selectedVersionForCustomer ? (optionsByVersion[selectedVersionForCustomer] || []) : []}\n          onConfirm={handleConfirmSelection}\n        />\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/QuoteForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3610,3613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3610,3613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3665,3668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3665,3668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3724,3727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3724,3727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3773,3776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3773,3776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3828,3831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3828,3831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3883,3886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3883,3886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3948,3951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3948,3951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4021,4024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4021,4024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4084,4087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4084,4087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5671,5674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5671,5674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5725,5728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5725,5728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5802,5805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5802,5805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6087,6090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6087,6090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6176,6179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6176,6179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6261,6264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6261,6264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6487,6490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6487,6490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6553,6556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6553,6556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8257,8260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8257,8260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8301,8304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8301,8304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9447,9450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9447,9450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'servicesById' is never reassigned. Use 'const' instead.","line":232,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":232,"endColumn":44,"fix":{"range":[9495,9538],"text":"const servicesById: Record<string, any> = {};"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9528,9531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9528,9531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":244,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10015,10018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10015,10018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10349,10352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10349,10352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10564,10567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10564,10567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":267,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11079,11082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11079,11082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11439,11442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11439,11442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":287,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12003,12006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12003,12006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12278,12281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12278,12281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'svcQuery' is never reassigned. Use 'const' instead.","line":301,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":301,"endColumn":23,"fix":{"range":[12528,12728],"text":"const svcQuery = supabase\n            .from('services')\n            .select('id, service_name, service_type, tenant_id, is_active')\n            .eq('is_active', true)\n            .order('service_name');"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":308,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12898,12901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12898,12901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13100,13103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13100,13103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13352,13355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13352,13355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'form' and 'supabase'. Either include them or remove the dependency array.","line":382,"column":6,"nodeType":"ArrayExpression","endLine":382,"endColumn":85,"suggestions":[{"desc":"Update the dependencies array to be: [quoteId, user.id, context.tenantId, roles, opportunities, accounts, contacts, supabase, form]","fix":{"range":[15717,15796],"text":"[quoteId, user.id, context.tenantId, roles, opportunities, accounts, contacts, supabase, form]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":404,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":404,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16538,16541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16538,16541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":408,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":408,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[16663,16663],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":412,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":412,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16852,16855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16852,16855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":412,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":412,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16891,16894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16891,16894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":413,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":413,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16960,16963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16960,16963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":413,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":413,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16995,16998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16995,16998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":414,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17060,17063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17060,17063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":414,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17095,17098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17095,17098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":423,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17443,17446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17443,17446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":446,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18250,18253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18250,18253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":477,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19582,19585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19582,19585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":500,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":500,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[20356,20356],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":505,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":505,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20514,20517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20514,20517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":519,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":519,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20979,20982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20979,20982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":526,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":526,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21234,21237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21234,21237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":533,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21481,21484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21481,21484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":541,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":541,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21769,21772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21769,21772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":551,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22153,22156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22153,22156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":552,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":552,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22204,22207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22204,22207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":553,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":553,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22265,22268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22265,22268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":553,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":553,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22313,22316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22313,22316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":554,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":554,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22373,22376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22373,22376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":554,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":554,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22416,22419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22416,22419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":555,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22470,22473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22470,22473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":556,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":556,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22529,22532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22529,22532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":557,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":557,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22613,22616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22613,22616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":557,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":557,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22656,22659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22656,22659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":558,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":558,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22713,22716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22713,22716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":558,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":558,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22758,22761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22758,22761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":559,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":559,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22819,22822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22819,22822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":559,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":559,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22866,22869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22866,22869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":560,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":560,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22934,22937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22934,22937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":560,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":560,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22986,22989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22986,22989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":564,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":564,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23164,23167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23164,23167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":565,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":565,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23221,23224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23221,23224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":566,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":566,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23278,23281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23278,23281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":566,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":566,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23322,23325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23322,23325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":567,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":567,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23384,23387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23384,23387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":567,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":567,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23432,23435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23432,23435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":568,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":568,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23499,23502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23499,23502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":569,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":569,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23555,23558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23555,23558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":573,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":573,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23730,23733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23730,23733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":573,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":573,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23767,23770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23767,23770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":577,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":577,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[23948,23948],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":579,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":579,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24084,24087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24084,24087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":587,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":587,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[24408,24408],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":598,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":598,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24916,24919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24916,24919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":613,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":613,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25642,25645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25642,25645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":615,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":615,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25725,25728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25725,25728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":619,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":619,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25949,25952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25949,25952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":640,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":640,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[26937,26937],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":643,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":643,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27035,27038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27035,27038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":645,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":645,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[27088,27088],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":649,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":649,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27243,27246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27243,27246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":650,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":650,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27309,27312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27309,27312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":671,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":671,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[28271,28271],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":679,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":679,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[28628,28628],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":686,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":686,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[29002,29002],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":690,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":690,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29229,29232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29229,29232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":692,"column":128,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":692,"endColumn":131,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29507,29510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29507,29510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":694,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":694,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29729,29732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29729,29732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":695,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":695,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29808,29811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29808,29811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":702,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":702,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30128,30131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30128,30131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":705,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":705,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[30295,30295],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":713,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":713,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[30715,30715],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":716,"column":128,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":716,"endColumn":131,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30930,30933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30930,30933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":718,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":718,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31152,31155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31152,31155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":719,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":719,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31231,31234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31231,31234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":726,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":726,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31557,31560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31557,31560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":729,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":729,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[31724,31724],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":737,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":737,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[32144,32144],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":744,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":744,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32326,32329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32326,32329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":745,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":745,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32398,32401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32398,32401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":754,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":754,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32757,32760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32757,32760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":755,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":755,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32823,32826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32823,32826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":764,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":764,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33190,33193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33190,33193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":765,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":765,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33259,33262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33259,33262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":775,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":775,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33717,33720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33717,33720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":776,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":776,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33797,33800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33797,33800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":778,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":778,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33928,33931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33928,33931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":790,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":790,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34434,34437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34434,34437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":799,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":799,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[34949,34949],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":811,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":811,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[35529,35529],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":815,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":815,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35730,35733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35730,35733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":820,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":820,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35946,35949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35946,35949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":822,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":822,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36043,36046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36043,36046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":831,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":831,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[36558,36558],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":842,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":842,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[37065,37065],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":845,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":845,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[37122,37122],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":852,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":852,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37340,37343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37340,37343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":870,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":870,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38038,38041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38038,38041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":876,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":876,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[38291,38291],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":886,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":886,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38613,38616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38613,38616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":896,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":896,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[39008,39008],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'debugHydration'. Either include it or remove the dependency array.","line":897,"column":6,"nodeType":"ArrayExpression","endLine":897,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [debugHydration, selectedServiceType]","fix":{"range":[39015,39036],"text":"[debugHydration, selectedServiceType]"}}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":902,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":902,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[39197,39197],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'debugHydration'. Either include it or remove the dependency array.","line":903,"column":6,"nodeType":"ArrayExpression","endLine":903,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [debugHydration, filteredServices]","fix":{"range":[39204,39222],"text":"[debugHydration, filteredServices]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":912,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":912,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39553,39556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39553,39556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":913,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":913,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39646,39649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39646,39649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":920,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":920,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39910,39913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39910,39913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":923,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":923,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40059,40062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40059,40062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":931,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":931,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40411,40414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40411,40414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":932,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":932,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40575,40578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40575,40578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":937,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":937,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[40760,40760],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":941,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":941,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[40809,40809],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":957,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":957,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41524,41527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41524,41527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":963,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":963,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41806,41809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41806,41809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":964,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":964,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41897,41900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41897,41900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":989,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":989,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42882,42885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42882,42885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":990,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":990,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42918,42921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42918,42921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":991,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":991,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42959,42962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42959,42962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1029,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1029,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[45028,45028],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1038,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1038,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[45348,45348],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1044,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1044,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45677,45680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45677,45680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1071,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1071,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46709,46712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46709,46712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1080,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1080,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47284,47287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47284,47287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1081,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1081,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47332,47335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47332,47335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1082,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1082,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47406,47409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47406,47409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1090,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1090,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47760,47763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47760,47763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1123,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1123,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49144,49147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49144,49147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1124,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1124,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49198,49201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49198,49201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1125,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1125,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49309,49312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49309,49312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1131,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1131,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49659,49662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49659,49662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1182,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1182,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51813,51816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51813,51816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1188,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1188,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[52139,52139],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1193,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1193,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52361,52364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52361,52364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1207,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1207,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53011,53014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53011,53014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1208,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1208,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53078,53081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53078,53081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1208,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1208,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53123,53126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53123,53126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1208,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1208,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53138,53141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53138,53141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1215,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1215,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53481,53484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53481,53484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1218,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1218,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[53615,53615],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1227,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1227,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53881,53884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53881,53884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1235,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1235,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54229,54232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54229,54232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1244,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1244,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54687,54690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54687,54690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1245,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1245,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54746,54749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54746,54749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1246,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1246,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54813,54816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54813,54816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1254,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1254,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55261,55264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55261,55264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1256,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1256,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55353,55356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55353,55356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1269,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1269,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56049,56052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56049,56052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1272,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1272,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[56183,56183],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1281,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1281,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56450,56453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56450,56453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1289,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1289,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56806,56809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56806,56809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1298,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1298,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57268,57271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57268,57271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1299,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1299,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57335,57338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57335,57338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1299,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1299,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57376,57379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57376,57379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1299,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1299,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57391,57394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57391,57394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1306,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1306,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57739,57742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57739,57742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1309,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1309,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[57873,57873],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1320,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1320,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58153,58156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58153,58156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1337,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1337,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58801,58804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58801,58804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1367,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1367,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59736,59739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59736,59739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1367,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1367,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59761,59764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59761,59764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1380,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1380,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60394,60397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60394,60397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1381,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1381,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60436,60439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60436,60439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1382,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1382,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60504,60507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60504,60507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1389,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1389,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60836,60839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60836,60839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1410,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1410,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61687,61690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61687,61690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1423,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1423,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62174,62177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62174,62177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1444,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1444,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62973,62976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62973,62976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'quoteId', 'roles', and 'supabase'. Either include them or remove the dependency array.","line":1456,"column":6,"nodeType":"ArrayExpression","endLine":1456,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [context.tenantId, context.franchiseId, roles, quoteId, supabase]","fix":{"range":[63378,63417],"text":"[context.tenantId, context.franchiseId, roles, quoteId, supabase]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1465,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1465,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63928,63931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63928,63931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'form'. Either include it or remove the dependency array.","line":1469,"column":6,"nodeType":"ArrayExpression","endLine":1469,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [accountId, contacts, form]","fix":{"range":[64133,64154],"text":"[accountId, contacts, form]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1474,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1474,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[64354,64357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[64354,64357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1485,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1485,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[64902,64905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[64902,64905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1486,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1486,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[64938,64938],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1505,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1505,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[65423,65426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[65423,65426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1518,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1518,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66070,66073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66070,66073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1519,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1519,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66162,66165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66162,66165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1564,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1564,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[67802,67802],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1631,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1631,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70295,70298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70295,70298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1744,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1744,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[74896,74899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[74896,74899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1761,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1761,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75610,75613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75610,75613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1780,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1780,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76332,76335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76332,76335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1793,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1793,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76886,76889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76886,76889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1806,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1806,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77410,77413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77410,77413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1815,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1815,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77889,77892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77889,77892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1827,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1827,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78358,78361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78358,78361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1832,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1832,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78639,78642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78639,78642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1839,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1839,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79079,79082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79079,79082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1841,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1841,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79151,79154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79151,79154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1844,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1844,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[79277,79277],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1847,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1847,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79325,79328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79325,79328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1852,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1852,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79618,79621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79618,79621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1855,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1855,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[79738,79738],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1863,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1863,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79877,79880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79877,79880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1910,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1910,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[81779,81779],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1920,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1920,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82131,82134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82131,82134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1922,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1922,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82261,82264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82261,82264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1923,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1923,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82334,82337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82334,82337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1925,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1925,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[82401,82401],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1938,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1938,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82757,82760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82757,82760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1955,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1955,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[83546,83549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[83546,83549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1962,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1962,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[83817,83820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[83817,83820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1993,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1993,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85144,85147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85144,85147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2069,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2069,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88286,88289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88286,88289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2081,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2081,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[88860,88860],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2100,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2100,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[89617,89620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[89617,89620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2113,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2113,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90069,90072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90069,90072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2117,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2117,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90131,90134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90131,90134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2124,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2124,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90443,90446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90443,90446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2238,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2238,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95540,95543],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95540,95543],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2271,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2271,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[97125,97128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[97125,97128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2277,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2277,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[97465,97468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[97465,97468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2308,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2308,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[98892,98895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[98892,98895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2317,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2317,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99486,99489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99486,99489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2318,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2318,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99588,99591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99588,99591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2383,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2383,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[102668,102671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[102668,102671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2428,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2428,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104992,104995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104992,104995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2435,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2435,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105455,105458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105455,105458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2546,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2546,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[110571,110574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[110571,110574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2592,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2592,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113067,113070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113067,113070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2593,"column":35,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2593,"endColumn":37,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[113127,113127],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2599,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2599,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113463,113466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113463,113466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2600,"column":35,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2600,"endColumn":37,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[113538,113538],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2614,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2614,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[114269,114272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[114269,114272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2615,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2615,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[114335,114338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[114335,114338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2619,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2619,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[114607,114610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[114607,114610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2640,"column":35,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2640,"endColumn":37,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[115858,115858],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2643,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2643,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[116000,116003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[116000,116003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2645,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2645,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[116080,116083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[116080,116083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2773,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2773,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[122004,122007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[122004,122007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2801,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2801,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[123632,123635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[123632,123635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3040,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3040,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133131,133134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133131,133134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchData' and 'fetchServiceData'. Either include them or remove the dependency array.","line":336,"column":6,"nodeType":"ArrayExpression","endLine":336,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [context.tenantId, fetchData, fetchServiceData, resolvedTenantId]","fix":{"range":[13707,13743],"text":"[context.tenantId, fetchData, fetchServiceData, resolvedTenantId]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'consignees', 'debugHydration', 'form', 'ports', 'selectedServiceType', 'serviceTypes', 'services', and 'supabase'. Either include them or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setServices' needs the current value of 'selectedServiceType'.","line":861,"column":6,"nodeType":"ArrayExpression","endLine":861,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [consignees, debugHydration, form, ports, quoteId, selectedServiceType, serviceTypes, services, supabase]","fix":{"range":[37648,37657],"text":"[consignees, debugHydration, form, ports, quoteId, selectedServiceType, serviceTypes, services, supabase]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'form'. Either include it or remove the dependency array.","line":878,"column":6,"nodeType":"ArrayExpression","endLine":878,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [serviceTypes, isEditMode, form]","fix":{"range":[38358,38384],"text":"[serviceTypes, isEditMode, form]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedServiceType'. Either include it or remove the dependency array.","line":891,"column":6,"nodeType":"ArrayExpression","endLine":891,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [selectedServiceType, serviceTypeId, serviceTypes]","fix":{"range":[38821,38850],"text":"[selectedServiceType, serviceTypeId, serviceTypes]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'form' and 'supabase'. Either include them or remove the dependency array.","line":943,"column":6,"nodeType":"ArrayExpression","endLine":943,"endColumn":63,"suggestions":[{"desc":"Update the dependencies array to be: [isEditMode, selectedServiceType, services, serviceTypes, form, supabase]","fix":{"range":[40876,40933],"text":"[isEditMode, selectedServiceType, services, serviceTypes, form, supabase]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'context.tenantId', 'form', 'roles', 'serviceTypes', and 'supabase'. Either include them or remove the dependency array.","line":1404,"column":6,"nodeType":"ArrayExpression","endLine":1404,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [selectedServiceType, resolvedTenantId, isHydrating, context.tenantId, roles, form, serviceTypes, supabase]","fix":{"range":[61447,61499],"text":"[selectedServiceType, resolvedTenantId, isHydrating, context.tenantId, roles, form, serviceTypes, supabase]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'carriers' and 'supabase'. Either include them or remove the dependency array.","line":1433,"column":6,"nodeType":"ArrayExpression","endLine":1433,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [carrierId, carriers, supabase]","fix":{"range":[62506,62517],"text":"[carrierId, carriers, supabase]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'clearActions', 'downloadItemsCSV', 'downloadPDF', 'form', 'navigate', 'onSubmit', and 'setActions'. Either include them or remove the dependency array.","line":1725,"column":6,"nodeType":"ArrayExpression","endLine":1725,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [isSubmitting, isEditMode, items, downloadItemsCSV, downloadPDF, setActions, navigate, form, onSubmit, clearActions]","fix":{"range":[74384,74417],"text":"[isSubmitting, isEditMode, items, downloadItemsCSV, downloadPDF, setActions, navigate, form, onSubmit, clearActions]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":41,"fatalErrorCount":0,"warningCount":217,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useMemo } from 'react';\nimport { useSearchParams, useNavigate } from 'react-router-dom';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage, FormDescription } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { MultiModalQuoteComposer } from '@/components/sales/MultiModalQuoteComposer';\nimport { CarrierQuotesSection } from '@/components/sales/CarrierQuotesSection';\nimport { Plus, Trash2, Search, Loader2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from 'sonner';\nimport OpportunitySelectDialogList from '@/components/crm/OpportunitySelectDialogList';\nimport AccountSelectDialogList from '@/components/crm/AccountSelectDialogList';\nimport ContactSelectDialogList from '@/components/crm/ContactSelectDialogList';\nimport { useStickyActions } from '@/components/layout/StickyActionsContext';\nimport {\n  upsertRatesAndChargesForQuote,\n  createQuotationVersionWithOptions,\n  listCarrierRatesForQuote,\n} from '@/integrations/supabase/carrierRatesActions';\n\nconst quoteSchema = z.object({\n  title: z.string().min(1, 'Title is required'),\n  description: z.string().optional(),\n  service_type_id: z.string().optional(),\n  service_id: z.string().optional(),\n  incoterms: z.string().optional(),\n  trade_direction: z.enum(['import', 'export']).optional(),\n  carrier_id: z.string().optional(),\n  consignee_id: z.string().optional(),\n  origin_port_id: z.string().optional(),\n  destination_port_id: z.string().optional(),\n  account_id: z.string().optional(),\n  contact_id: z.string().optional(),\n  opportunity_id: z.string().optional(),\n  status: z.string(),\n  valid_until: z.string().optional(),\n  tax_percent: z.string().optional(),\n  shipping_amount: z.string().optional(),\n  terms_conditions: z.string().optional(),\n  notes: z.string().optional(),\n});\n\ntype QuoteItem = {\n  line_number: number;\n  product_name: string;\n  description?: string;\n  quantity: number;\n  unit_price: number;\n  discount_percent: number;\n  package_category_id?: string;\n  package_size_id?: string;\n};\n\ntype Charge = {\n  type: string;\n  amount: number;\n  currency: string;\n  note?: string;\n};\n\ntype CarrierQuote = {\n  carrier_rate_id?: string;\n  carrier_id: string;\n  mode?: string;\n  buying_charges: Charge[];\n  selling_charges: Charge[];\n};\n\nexport function QuoteForm({ quoteId, onSuccess }: { quoteId?: string; onSuccess?: (quoteId: string) => void }) {\n  const { context, supabase, user } = useCRM();\n  const { roles } = useAuth();\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const isEditMode = !!quoteId;\n  const [items, setItems] = useState<QuoteItem[]>([\n    { line_number: 1, product_name: '', quantity: 1, unit_price: 0, discount_percent: 0 },\n  ]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isHydrating, setIsHydrating] = useState(false);\n  const [serviceTypes, setServiceTypes] = useState<{ id: string; code: string; name: string }[]>([]);\n  const [services, setServices] = useState<any[]>([]);\n  const [carriers, setCarriers] = useState<any[]>([]);\n  const [consignees, setConsignees] = useState<any[]>([]);\n  const [ports, setPorts] = useState<any[]>([]);\n  const [accounts, setAccounts] = useState<any[]>([]);\n  const [contacts, setContacts] = useState<any[]>([]);\n  const [opportunities, setOpportunities] = useState<any[]>([]);\n  const [packageCategories, setPackageCategories] = useState<any[]>([]);\n  const [packageSizes, setPackageSizes] = useState<any[]>([]);\n  const [resolvedTenantId, setResolvedTenantId] = useState<string | null>(null);\n  const [resolvedTenantName, setResolvedTenantName] = useState<string | null>(null);\n  const [selectedServiceType, setSelectedServiceType] = useState<string>('');\n  const [carrierQuotes, setCarrierQuotes] = useState<CarrierQuote[]>([]);\n  const [existingRateIds, setExistingRateIds] = useState<string[]>([]);\n  const [composerVersionId, setComposerVersionId] = useState<string | null>(null);\n  // Display-only hint; actual quote_number is generated in DB\n  const [quoteNumberPreview, setQuoteNumberPreview] = useState<string>('Auto-generated on save');\n  // Resolved labels for hidden contacts\n  const [resolvedContactLabels, setResolvedContactLabels] = useState<Record<string, string>>({});\n  // Resolved labels for services that are not directly visible due to tenant scope/RLS\n  const [resolvedServiceLabels, setResolvedServiceLabels] = useState<Record<string, string>>({});\n  // Resolved labels for carriers not yet in the dropdown list\n  const [resolvedCarrierLabels, setResolvedCarrierLabels] = useState<Record<string, string>>({});\n  // Resolved labels for package categories and sizes that may be hidden by RLS/tenant scope\n  const [resolvedPackageCategoryLabels, setResolvedPackageCategoryLabels] = useState<Record<string, string>>({});\n  const [resolvedPackageSizeLabels, setResolvedPackageSizeLabels] = useState<Record<string, string>>({});\n  const debugHydration = import.meta.env.DEV;\n\n  // Ensure unique option lists by id to avoid duplicate React keys\n  const uniqueById = (arr: any[]) => {\n    try {\n      const map: Record<string, any> = {};\n      for (const item of arr || []) {\n        const id = (item as any)?.id;\n        if (id != null) map[String(id)] = item;\n      }\n      return Object.values(map);\n    } catch {\n      return arr || [];\n    }\n  };\n  \n  // Ensure unique carriers by normalized name; prefer current tenant entry when duplicates exist\n  const uniqueByCarrierName = (arr: any[], preferredTenantId?: string | null) => {\n    try {\n      const map: Record<string, any> = {};\n      for (const item of arr || []) {\n        const key = String((item as any)?.carrier_name || '').trim().toLowerCase();\n        if (!key) continue;\n        const existing = map[key];\n        if (!existing) {\n          map[key] = item;\n        } else {\n          const existingTenant = (existing as any)?.tenant_id ?? null;\n          const currentTenant = (item as any)?.tenant_id ?? null;\n          if (preferredTenantId && existingTenant !== preferredTenantId && currentTenant === preferredTenantId) {\n            map[key] = item;\n          }\n        }\n      }\n      return Object.values(map);\n    } catch {\n      return arr || [];\n    }\n  };\n  \n  // Format carrier name defensively to avoid accidental repeated text in UI (e.g., \"ABCABC\")\n  const formatCarrierName = (name: string) => {\n    if (!name) return name;\n    const trimmed = String(name).trim();\n    const len = trimmed.length;\n    if (len % 2 === 0) {\n      const half = len / 2;\n      const first = trimmed.slice(0, half);\n      const second = trimmed.slice(half);\n      if (first === second) return first;\n    }\n    return trimmed;\n  };\n\n  // filteredServices will be defined after form and serviceTypeId are available\n\n  const form = useForm<z.infer<typeof quoteSchema>>({\n    resolver: zodResolver(quoteSchema),\n    defaultValues: {\n      status: 'draft',\n      opportunity_id: searchParams.get('opportunityId') || '',\n      // Keep inputs controlled from mount\n      title: '',\n      description: '',\n      service_type_id: '',\n      service_id: '',\n      incoterms: '',\n      trade_direction: undefined,\n      carrier_id: '',\n      consignee_id: '',\n      origin_port_id: '',\n      destination_port_id: '',\n      account_id: '',\n      contact_id: '',\n      valid_until: '',\n      tax_percent: '0',\n      shipping_amount: '0',\n      terms_conditions: '',\n      notes: '',\n    },\n  });\n\n  // Filter services by the currently selected service_type_id (FK-only)\n  const filteredServices = useMemo(() => {\n    const currentTypeId = form.getValues('service_type_id');\n    if (!currentTypeId) return [] as any[];\n    return services.filter((service: any) => String(service.service_type_id || '') === String(currentTypeId));\n  }, [form, services]);\n\n  // Watch selected account to enable contact filtering\n  const accountId = form.watch('account_id');\n  // Watch selected carrier to ensure its label is available immediately\n  const carrierId = form.watch('carrier_id');\n  // Watch service type id (UUID) to sync code for filtering/mappings\n  const serviceTypeId = form.watch('service_type_id');\n\n  const fetchServiceData = async () => {\n    try {\n      const tenantId = resolvedTenantId || context.tenantId || roles?.[0]?.tenant_id;\n\n      let query = supabase\n        .from('service_type_mappings')\n        .select('service_type_id, service_id, is_default, priority')\n        .eq('is_active', true)\n        .order('priority', { ascending: false });\n\n      if (tenantId) {\n        query = query.eq('tenant_id', tenantId);\n      } else {\n        query = query.is('tenant_id', null);\n      }\n\n      const { data: mappingsData, error: mappingsError } = await query;\n\n      const mappingRows = Array.isArray(mappingsData) ? mappingsData : [];\n      const serviceIds = [...new Set(mappingRows.map((m: any) => m.service_id).filter(Boolean))];\n\n      let servicesById: Record<string, any> = {};\n      if (serviceIds.length > 0) {\n        const { data: svcData, error: svcErr } = await supabase\n          .from('services')\n          .select('id, service_name, is_active')\n          .in('id', serviceIds)\n          .eq('is_active', true);\n        if (svcErr) throw svcErr;\n        for (const s of svcData || []) servicesById[String(s.id)] = s;\n      }\n\n      // Extract unique service type ids for dropdown (FKs)\n      const uniqueTypeIds = [...new Set(mappingRows.map((m: any) => String(m.service_type_id)).filter(Boolean))];\n\n      // Resolve service_type_id to canonical service_types (UUID id + name + code)\n      let serviceTypesForDropdown: { id: string; code: string; name: string }[] = [];\n      if (uniqueTypeIds.length > 0) {\n        const { data: typeRows, error: typesErr } = await (supabase as any)\n          .from('service_types')\n          .select('id, name, code')\n          .in('id', uniqueTypeIds);\n        if (!typesErr && Array.isArray(typeRows)) {\n          serviceTypesForDropdown = typeRows.map((t: any) => ({\n            id: String(t.id),\n            code: String(t.code),\n            name: t.name || String(t.code),\n          }));\n        }\n      }\n      // Fallback if service_types table didn't resolve some/any codes\n      // Create a mapping for unresolved service types, but don't use them as IDs to avoid UUID errors\n      // No text fallback in FK-only mode\n      \n      // Build services list matched to mappings and available service records\n      let servicesForDropdown = mappingRows\n        .map((m: any) => {\n          const svc = servicesById[String(m.service_id)];\n          if (!svc) return null;\n          return {\n            id: svc.id,\n            service_name: svc.service_name,\n            service_type_id: m.service_type_id,\n            is_default: m.is_default,\n            priority: m.priority,\n          };\n        })\n        .filter(Boolean) as any[];\n\n      // Robust fallback ONLY when no tenant is resolved (e.g., platform admin browsing globally).\n      // For tenant-specific flows, strictly rely on service_type_mappings.\n      const noResolvedTypes = serviceTypesForDropdown.filter(st => st.id !== '').length === 0;\n      const noServices = servicesForDropdown.length === 0;\n      if (!tenantId && (mappingsError || mappingRows.length === 0 || noResolvedTypes || noServices)) {\n        try {\n          // Fetch active service types globally\n          const { data: fallbackTypes } = await (supabase as any)\n            .from('service_types')\n            .select('id, name, code')\n            .eq('is_active', true)\n            .order('name');\n          if (Array.isArray(fallbackTypes) && fallbackTypes.length > 0) {\n            serviceTypesForDropdown = fallbackTypes.map((t: any) => ({\n              id: String(t.id),\n              code: String(t.code),\n              name: t.name || String(t.code),\n            }));\n          }\n\n          // Fetch services scoped to tenant when available; otherwise global active\n          let svcQuery = supabase\n            .from('services')\n            .select('id, service_name, service_type, tenant_id, is_active')\n            .eq('is_active', true)\n            .order('service_name');\n          const { data: fallbackServices } = await svcQuery;\n          if (Array.isArray(fallbackServices)) {\n            servicesForDropdown = fallbackServices.map((s: any) => ({\n              id: s.id,\n              service_name: s.service_name,\n              service_type: s.service_type,\n              is_default: false,\n              priority: 0,\n            })) as any[];\n          }\n        } catch (fallbackErr) {\n          console.warn('Fallback service data load failed:', fallbackErr);\n        }\n      }\n\n      // Finalize\n      setServiceTypes(serviceTypesForDropdown);\n      setServices(servicesForDropdown as any[]);\n\n    } catch (error) {\n      console.error('Error loading service data:', error);\n      toast.error('Failed to load service options.');\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n    fetchServiceData();\n    // Re-run when tenant context resolves so mappings/services populate\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [context.tenantId, resolvedTenantId]);\n\n  // Pre-populate with user's last used values for new quotes\n  // Only runs after opportunities/accounts/contacts data is loaded\n  useEffect(() => {\n    if (quoteId || !user?.id) return; // Skip for edit mode or no user\n    if (opportunities.length === 0 && accounts.length === 0) return; // Wait for data\n    \n    const fetchLastUsedValues = async () => {\n      try {\n        const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n        if (!tenantId) return;\n\n        // Get user's most recent quote to pre-populate fields\n        const { data: lastQuote, error } = await supabase\n          .from('quotes')\n          .select('opportunity_id, account_id, contact_id')\n          .eq('tenant_id', tenantId)\n          .eq('created_by', user.id)\n          .order('created_at', { ascending: false })\n          .limit(1)\n          .maybeSingle();\n\n        if (error || !lastQuote) return;\n\n        // Pre-populate if values exist and form fields are empty\n        const currentOppId = form.getValues('opportunity_id');\n        const currentAccId = form.getValues('account_id');\n        const currentConId = form.getValues('contact_id');\n\n        // Only pre-populate if the items exist in the loaded data\n        if (!currentOppId && lastQuote.opportunity_id && opportunities.find(o => String(o.id) === String(lastQuote.opportunity_id))) {\n          form.setValue('opportunity_id', String(lastQuote.opportunity_id));\n        }\n        if (!currentAccId && lastQuote.account_id && accounts.find(a => String(a.id) === String(lastQuote.account_id))) {\n          form.setValue('account_id', String(lastQuote.account_id));\n        }\n        if (!currentConId && lastQuote.contact_id && contacts.find(c => String(c.id) === String(lastQuote.contact_id))) {\n          form.setValue('contact_id', String(lastQuote.contact_id));\n        }\n      } catch (error) {\n        console.warn('Failed to fetch last used values:', error);\n      }\n    };\n\n    fetchLastUsedValues();\n  }, [quoteId, user?.id, context.tenantId, roles, opportunities, accounts, contacts]);\n\n  // Load existing quote for edit mode independent of tenant context\n  useEffect(() => {\n    if (!quoteId) return;\n    (async () => {\n      setIsHydrating(true);\n      try {\n        const { data: quote, error: quoteErr } = await supabase\n          .from('quotes')\n          .select(`\n            *,\n            opportunities:opportunity_id(id, name, account_id, contact_id),\n            contacts:contact_id(id, first_name, last_name, account_id)\n          `)\n          .eq('id', quoteId)\n          .maybeSingle();\n        if (quoteErr) throw quoteErr;\n        if (!quote) return;\n\n        // Ensure tenant is resolved early from the quote itself (important when no account is selected)\n        try {\n          const qTenantId = (quote as any)?.tenant_id;\n          if (qTenantId) {\n            setResolvedTenantId(String(qTenantId));\n          }\n        } catch {}\n\n        // CRITICAL: Hydrate dropdown lists BEFORE setting form values\n        // This ensures Select components recognize the values as valid options\n        const selOppId = (quote as any).opportunity_id ? String((quote as any).opportunity_id) : undefined;\n        const selAccId = (quote as any).account_id ? String((quote as any).account_id) : undefined;\n        const selConId = (quote as any).contact_id ? String((quote as any).contact_id) : undefined;\n\n        // Collect all items to add to dropdowns BEFORE any state updates\n        let opportunityToAdd = null;\n        let accountToAdd = null;\n        let contactToAdd = null;\n        let carrierToAdd = null;\n\n        // Fetch carrier FIRST if it exists (critical for display)\n        const selCarrierId = (quote as any).carrier_id;\n        if (selCarrierId) {\n          try {\n            const { data: carrierData } = await supabase\n              .from('carriers')\n              .select('id, carrier_name')\n              .eq('id', selCarrierId)\n              .maybeSingle();\n            if (carrierData) {\n              carrierToAdd = carrierData;\n              setResolvedCarrierLabels((prev) => ({\n                ...prev,\n                [String(carrierData.id)]: carrierData.carrier_name || 'Selected Carrier',\n              }));\n            }\n          } catch (err) {\n            console.warn('Failed to fetch carrier:', err);\n          }\n        }\n\n        // Fetch opportunity data with full details\n        if (selOppId) {\n          try {\n            const { data: fullOpp, error: oppError } = await (supabase as any).functions.invoke('get-opportunity-full', {\n              body: { id: selOppId },\n            });\n            if (!oppError && fullOpp) {\n              opportunityToAdd = {\n                id: fullOpp.id,\n                name: fullOpp.name || 'Selected Opportunity',\n                account_id: fullOpp.account_id,\n                contact_id: fullOpp.contact_id\n              };\n              \n              // Also prepare account from opportunity if not explicitly selected\n              if (fullOpp.accounts && !selAccId) {\n                accountToAdd = { \n                  id: String(fullOpp.account_id), \n                  name: fullOpp.accounts.name || 'Selected Account' \n                };\n              }\n              \n              // Also prepare contact from opportunity if not explicitly selected\n              if (fullOpp.contacts && !selConId) {\n                contactToAdd = {\n                  id: String(fullOpp.contact_id),\n                  first_name: fullOpp.contacts.first_name || '',\n                  last_name: fullOpp.contacts.last_name || '',\n                  account_id: fullOpp.account_id\n                };\n              }\n            }\n          } catch (oppErr) {\n            console.warn('Failed to load full opportunity, using fallback:', oppErr);\n            const joinedOpp = (quote as any)?.opportunities;\n            if (joinedOpp?.name) {\n              opportunityToAdd = { \n                id: selOppId, \n                name: joinedOpp.name, \n                account_id: joinedOpp.account_id, \n                contact_id: joinedOpp.contact_id \n              };\n            }\n          }\n        }\n\n        // Fetch account if not already prepared from opportunity\n        if (selAccId && !accountToAdd) {\n          try {\n            const { data: accData } = await supabase\n              .from('accounts')\n              .select('id, name')\n              .eq('id', selAccId)\n              .maybeSingle();\n            if (accData) {\n              accountToAdd = { id: accData.id, name: accData.name || 'Selected Account' };\n            }\n          } catch {}\n        }\n\n        // Fetch contact if not already prepared from opportunity\n        if (selConId && !contactToAdd) {\n          const joinedCon = (quote as any)?.contacts;\n          if (joinedCon) {\n            contactToAdd = {\n              id: selConId,\n              first_name: joinedCon.first_name || '',\n              last_name: joinedCon.last_name || '',\n              account_id: joinedCon.account_id\n            };\n          }\n        }\n\n        // NOW update all states at once in the correct order\n        if (opportunityToAdd) {\n          setOpportunities((prev) => {\n            const exists = prev.some((o: any) => String(o.id) === String(opportunityToAdd.id));\n            return exists ? prev : [opportunityToAdd, ...prev];\n          });\n        }\n        \n        if (accountToAdd) {\n          setAccounts((prev) => {\n            const exists = prev.some((a: any) => String(a.id) === String(accountToAdd.id));\n            return exists ? prev : [accountToAdd, ...prev];\n          });\n        }\n        \n        if (contactToAdd) {\n          setContacts((prev) => {\n            const exists = prev.some((c: any) => String(c.id) === String(contactToAdd.id));\n            return exists ? prev : [contactToAdd, ...prev];\n          });\n        }\n\n        // Add carrier to list BEFORE form reset\n        if (carrierToAdd) {\n          setCarriers((prev) => {\n            const exists = prev.some((c: any) => String(c.id) === String(carrierToAdd.id));\n            return exists ? prev : [carrierToAdd, ...prev];\n          });\n        }\n\n        // Small delay to ensure React has processed the state updates\n        await new Promise(resolve => setTimeout(resolve, 50));\n\n        // NOW set form values after dropdown lists are hydrated\n        form.reset({\n          title: (quote as any).title || '',\n          description: (quote as any).description || '',\n          service_type_id: (quote as any).service_type_id != null ? String((quote as any).service_type_id) : '',\n          service_id: (quote as any).service_id != null ? String((quote as any).service_id) : '',\n          incoterms: (quote as any).incoterms || '',\n          trade_direction: (quote as any).regulatory_data?.trade_direction || undefined,\n          carrier_id: (quote as any).carrier_id != null ? String((quote as any).carrier_id) : '',\n          consignee_id: (quote as any).consignee_id != null ? String((quote as any).consignee_id) : '',\n          origin_port_id: (quote as any).origin_port_id != null ? String((quote as any).origin_port_id) : '',\n          destination_port_id: (quote as any).destination_port_id != null ? String((quote as any).destination_port_id) : '',\n          account_id: selAccId || '',\n          contact_id: selConId || '',\n          opportunity_id: selOppId || '',\n          status: (quote as any).status || 'draft',\n          valid_until: (quote as any).valid_until || '',\n          tax_percent: (quote as any).tax_percent != null ? String((quote as any).tax_percent) : '0',\n          shipping_amount: (quote as any).shipping_amount != null ? String((quote as any).shipping_amount) : '0',\n          terms_conditions: (quote as any).terms_conditions || '',\n          notes: (quote as any).notes || '',\n        });\n        // If the quote has a textual service_type (legacy), seed selectedServiceType\n        try {\n          const qServiceTypeText = (quote as any).service_type ? String((quote as any).service_type) : '';\n          if (qServiceTypeText && !selectedServiceType) {\n            setSelectedServiceType(canonicalType(qServiceTypeText));\n          }\n        } catch {}\n        // Defer syncing of selectedServiceType (code) to effect that watches service_type_id\n        setQuoteNumberPreview((quote as any).quote_number || '');\n        if (debugHydration) {\n          try {\n            console.debug('[hydrate] form.reset applied', {\n              service_type_id: form.getValues('service_type_id'),\n              service_id: form.getValues('service_id'),\n              selectedServiceType,\n            });\n          } catch {}\n        }\n\n        // Load items; tolerate RLS issues by falling back to empty\n        const { data: itemsRes, error: itemsErr } = await supabase\n          .from('quote_items')\n          .select('line_number, product_name, description, quantity, unit_price, discount_percent, package_category_id, package_size_id')\n          .eq('quote_id', quoteId)\n          .order('line_number', { ascending: true });\n        if (!itemsErr && Array.isArray(itemsRes)) {\n          setItems(\n            itemsRes.map((it: any) => ({\n              line_number: it.line_number,\n              product_name: it.product_name || '',\n              description: it.description || '',\n              quantity: Number(it.quantity) || 0,\n              unit_price: Number(it.unit_price) || 0,\n              discount_percent: Number(it.discount_percent) || 0,\n              package_category_id: it.package_category_id ? String(it.package_category_id) : undefined,\n              package_size_id: it.package_size_id ? String(it.package_size_id) : undefined,\n            }))\n          );\n        }\n\n        // Load carrier rates and charges using robust helper with fallbacks\n        try {\n          const rows = await listCarrierRatesForQuote(quoteId, supabase as any);\n          if (Array.isArray(rows)) {\n            const mapped = rows.map((r: any) => ({\n              carrier_rate_id: String(r.id),\n              carrier_id: String(r.carrier_id),\n              mode: r.mode || selectedServiceType || undefined,\n              buying_charges: (r.charges || []).map((c: any) => ({\n                type: (() => {\n                  const ct = String(c.charge_type || '').toUpperCase();\n                  if (ct === 'AFT' || ct === 'OFT') return 'freight';\n                  if (ct === 'BAF') return 'fuel';\n                  if (ct === 'THC') return 'handling';\n                  if (ct === 'DOC') return 'documentation';\n                  if (ct === 'ISF' || ct === 'AMS' || ct === 'ISPS') return 'customs';\n                  return 'other';\n                })(),\n                amount: Number(c.amount || 0),\n                currency: c.currency || 'USD',\n                note: c.notes || undefined,\n                basis: c.basis || undefined,\n                quantity: c.quantity ?? 1,\n              })),\n              selling_charges: [],\n            }));\n            if (debugHydration) {\n              try {\n                console.debug('[hydrate:rates] quoteId', String(quoteId), 'rows', rows.length, 'mapped', mapped.length);\n              } catch {}\n            }\n            setCarrierQuotes(mapped);\n            setExistingRateIds(rows.map((r: any) => String(r.id)));\n          }\n        } catch {}\n\n        // Ensure selected lookup values appear in dropdowns even if tenant filters exclude them\n        try {\n          const selServiceId = (quote as any).service_id;\n          if (selServiceId && !services.some((s: any) => String(s.id) === String(selServiceId))) {\n            const { data } = await supabase\n              .from('services')\n              .select('id, service_name, service_type')\n              .eq('id', selServiceId)\n              .maybeSingle();\n            if (data) {\n              setServices((prev) => [data, ...prev]);\n              // Keep a resolved label for fallback rendering paths\n              setResolvedServiceLabels((prev) => ({\n                ...prev,\n                [String(data.id)]: data.service_name || 'Selected Service',\n              }));\n              if (debugHydration) {\n                try {\n                  console.debug('[hydrate] injected service from fetch', {\n                    id: String(data.id),\n                    label: data.service_name,\n                    svcType: String(data.service_type || ''),\n                    formServiceId: form.getValues('service_id'),\n                  });\n                } catch {}\n              }\n              // If edit mode has no selectedServiceType yet, derive from saved service\n              try {\n                const svcTypeCode = String(data.service_type || '').trim();\n                if (svcTypeCode && !selectedServiceType) {\n                  setSelectedServiceType(svcTypeCode);\n                }\n              } catch {}\n              // Ensure the form's service_id reflects the injected value\n              try {\n                const curFormServiceId = form.getValues('service_id');\n                if (String(curFormServiceId) !== String(selServiceId)) {\n                  form.setValue('service_id', String(selServiceId), { shouldDirty: false });\n                }\n              } catch {}\n            } else {\n              // Fallback: if direct fetch is blocked (e.g., RLS), resolve label via Edge Function and inject minimal entry\n              try {\n                const { data: fnData } = await (supabase as any).functions.invoke('get-service-label', { body: { id: selServiceId } });\n                const fallbackLabel = fnData?.label || 'Selected Service';\n                setServices((prev) => [{ id: String(selServiceId), service_name: fallbackLabel, service_type: String((quote as any).service_type || selectedServiceType || '') }, ...prev]);\n                setResolvedServiceLabels((prev) => ({ ...prev, [String(selServiceId)]: fallbackLabel }));\n                if (!selectedServiceType && (quote as any).service_type) {\n                  setSelectedServiceType(String((quote as any).service_type));\n                }\n                if (debugHydration) {\n                  try {\n                    console.debug('[hydrate] injected service via fallback', {\n                      id: String(selServiceId),\n                      label: fallbackLabel,\n                      svcType: String((quote as any).service_type || selectedServiceType || ''),\n                      formServiceId: form.getValues('service_id'),\n                    });\n                  } catch {}\n                }\n                // Ensure the form reflects the saved selection even without full dataset\n                try {\n                  const curFormServiceId = form.getValues('service_id');\n                  if (String(curFormServiceId) !== String(selServiceId)) {\n                    form.setValue('service_id', String(selServiceId), { shouldDirty: false });\n                  }\n                } catch {}\n              } catch (_) {\n                const fallbackLabel = 'Selected Service';\n                setServices((prev) => [{ id: String(selServiceId), service_name: fallbackLabel, service_type: String((quote as any).service_type || selectedServiceType || '') }, ...prev]);\n                setResolvedServiceLabels((prev) => ({ ...prev, [String(selServiceId)]: fallbackLabel }));\n                if (!selectedServiceType && (quote as any).service_type) {\n                  setSelectedServiceType(String((quote as any).service_type));\n                }\n                if (debugHydration) {\n                  try {\n                    console.debug('[hydrate] injected service via final fallback', {\n                      id: String(selServiceId),\n                      label: fallbackLabel,\n                      svcType: String((quote as any).service_type || selectedServiceType || ''),\n                      formServiceId: form.getValues('service_id'),\n                    });\n                  } catch {}\n                }\n                // Ensure the form reflects the saved selection even without full dataset\n                try {\n                  const curFormServiceId = form.getValues('service_id');\n                  if (String(curFormServiceId) !== String(selServiceId)) {\n                    form.setValue('service_id', String(selServiceId), { shouldDirty: false });\n                  }\n                } catch {}\n              }\n            }\n          }\n\n          // Carrier already fetched and added before form.reset above, skip redundant check\n\n          const selConsigneeId = (quote as any).consignee_id;\n          if (selConsigneeId && !consignees.some((c: any) => String(c.id) === String(selConsigneeId))) {\n            const { data } = await supabase\n              .from('consignees')\n              .select('id, company_name')\n              .eq('id', selConsigneeId)\n              .maybeSingle();\n            if (data) setConsignees((prev) => [data, ...prev]);\n          }\n\n          const selOriginId = (quote as any).origin_port_id;\n          if (selOriginId && !ports.some((p: any) => String(p.id) === String(selOriginId))) {\n            const { data } = await supabase\n              .from('ports_locations')\n              .select('id, location_name, location_code')\n              .eq('id', selOriginId)\n              .maybeSingle();\n            if (data) setPorts((prev) => [data, ...prev]);\n          }\n\n          const selDestId = (quote as any).destination_port_id;\n          if (selDestId && !ports.some((p: any) => String(p.id) === String(selDestId))) {\n            const { data } = await supabase\n              .from('ports_locations')\n              .select('id, location_name, location_code')\n              .eq('id', selDestId)\n              .maybeSingle();\n            if (data) setPorts((prev) => [data, ...prev]);\n          }\n\n          // Ensure saved service type appears in dropdowns even if mappings exclude it\n          const selServiceTypeId = (quote as any).service_type_id;\n          if (selServiceTypeId && !serviceTypes.some((st: any) => String(st.id) === String(selServiceTypeId))) {\n            try {\n              const { data: stData } = await (supabase as any)\n                .from('service_types')\n                .select('id, name, code')\n                .eq('id', selServiceTypeId)\n                .maybeSingle();\n              if (stData) {\n                const injected = {\n                  id: String(stData.id),\n                  code: String(stData.code || ''),\n                  name: stData.name || String(stData.code || 'Service Type'),\n                };\n                setServiceTypes((prev) => {\n                  const exists = prev.some((st: any) => String(st.id) === String(injected.id));\n                  return exists ? prev : [injected, ...prev];\n                });\n                // Keep form value aligned with injected entry\n                try {\n                  const curFormTypeId = form.getValues('service_type_id');\n                  if (String(curFormTypeId) !== String(selServiceTypeId)) {\n                    form.setValue('service_type_id', String(selServiceTypeId), { shouldDirty: false });\n                  }\n                } catch {}\n                // Also seed selectedServiceType code if not yet set\n                if (!selectedServiceType && injected.code) {\n                  setSelectedServiceType(injected.code);\n                }\n                if (debugHydration) {\n                  try {\n                    console.debug('[hydrate] injected service type from fetch', {\n                      id: String(selServiceTypeId),\n                      code: String(injected.code || ''),\n                      formTypeId: form.getValues('service_type_id'),\n                    });\n                  } catch {}\n                }\n              } else {\n                // Fallback: inject minimal service type from textual service_type on quote if available\n                const derivedCode = String((quote as any).service_type || '');\n                const injected = {\n                  id: String(selServiceTypeId),\n                  code: derivedCode,\n                  name: 'Selected Service Type',\n                } as any;\n                setServiceTypes((prev) => {\n                  const exists = prev.some((st: any) => String(st.id) === String(injected.id));\n                  return exists ? prev : [injected, ...prev];\n                });\n                // Keep form value aligned with injected entry\n                try {\n                  const curFormTypeId = form.getValues('service_type_id');\n                  if (String(curFormTypeId) !== String(selServiceTypeId)) {\n                    form.setValue('service_type_id', String(selServiceTypeId), { shouldDirty: false });\n                  }\n                } catch {}\n                if (!selectedServiceType && derivedCode) {\n                  setSelectedServiceType(derivedCode);\n                }\n                if (debugHydration) {\n                  try {\n                    console.debug('[hydrate] injected service type via fallback', {\n                      id: String(selServiceTypeId),\n                      code: String(derivedCode || ''),\n                      formTypeId: form.getValues('service_type_id'),\n                    });\n                  } catch {}\n                }\n              }\n            } catch {}\n          }\n\n          // Note: opportunity, account, contact already fetched above\n        } catch (e) {\n          console.warn('Failed to hydrate selected options for edit mode:', e);\n        }\n      } catch (err: any) {\n        console.error('Failed to load existing quote:', err?.message || err);\n        toast.error('Failed to load existing quote', { description: err?.message });\n      }\n      finally {\n        setIsHydrating(false);\n      }\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [quoteId]);\n\n  // Ensure defaults are applied when service types are loaded\n  useEffect(() => {\n    try {\n      if (isEditMode) return;\n      const hasServiceTypes = Array.isArray(serviceTypes) && serviceTypes.length > 0;\n      const currentTypeId = form.getValues('service_type_id');\n      if (!currentTypeId && hasServiceTypes) {\n        const defaultServiceType = serviceTypes.find((st: any) => st.id !== '');\n        if (defaultServiceType) {\n          form.setValue('service_type_id', String(defaultServiceType.id), { shouldDirty: true });\n          setSelectedServiceType(String(defaultServiceType.code));\n        }\n      }\n    } catch {}\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [serviceTypes, isEditMode]);\n\n  // Sync selectedServiceType (code like 'ocean') whenever the UUID in the form changes\n  useEffect(() => {\n    if (!serviceTypeId) {\n      setSelectedServiceType('');\n      return;\n    }\n    const st = serviceTypes.find((t: any) => String(t.id) === String(serviceTypeId));\n    if (st && selectedServiceType !== st.code) {\n      setSelectedServiceType(st.code);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [serviceTypeId, serviceTypes]);\n  useEffect(() => {\n    if (!debugHydration) return;\n    try {\n      console.debug('[render] selectedServiceType code', selectedServiceType);\n    } catch {}\n  }, [selectedServiceType]);\n  useEffect(() => {\n    if (!debugHydration) return;\n    try {\n      console.debug('[render] filteredServices length', filteredServices.length);\n    } catch {}\n  }, [filteredServices]);\n\n  // In edit mode, if selectedServiceType is still empty, derive it from saved service or fetch by type id\n  useEffect(() => {\n    if (!isEditMode) return;\n    try {\n      if (!selectedServiceType) {\n        const curServiceId = form.getValues('service_id');\n        if (curServiceId) {\n          const svc = services.find((s: any) => String(s.id) === String(curServiceId));\n          const svcTypeCode = String((svc as any)?.service_type || '').trim();\n          if (svcTypeCode) {\n            setSelectedServiceType(svcTypeCode);\n            return;\n          }\n        }\n        const curTypeId = form.getValues('service_type_id');\n        if (curTypeId && !serviceTypes.some((st: any) => String(st.id) === String(curTypeId))) {\n          (async () => {\n            try {\n              const { data: stData } = await (supabase as any)\n                .from('service_types')\n                .select('id, code')\n                .eq('id', curTypeId)\n                .maybeSingle();\n              if (stData && stData.code) {\n                // Inject missing type to list to keep Select happy\n                setServiceTypes((prev) => {\n                  const exists = prev.some((st: any) => String(st.id) === String(curTypeId));\n                  const injected = { id: String(stData.id), code: String(stData.code), name: String(stData.code) } as any;\n                  return exists ? prev : [injected, ...prev];\n                });\n                setSelectedServiceType(String(stData.code));\n              }\n            } catch {}\n          })();\n        }\n      }\n    } catch {}\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isEditMode, selectedServiceType, services, serviceTypes]);\n\n  // When service_type_id changes: filter services based on FK and auto-select\n  useEffect(() => {\n    if (isEditMode) return; // don't disturb existing selections in edit mode\n    const selectedTypeId = form.getValues('service_type_id');\n    if (!selectedTypeId) {\n      // No type selected: clear service\n      const currentServiceId = form.getValues('service_id');\n      if (currentServiceId) form.setValue('service_id', '', { shouldDirty: true });\n      return;\n    }\n\n    // Filter services by service_type_id from the mapping table\n    const matchingServices = services.filter((s: any) => String(s.service_type_id || '') === String(selectedTypeId));\n    \n    const currentServiceId = form.getValues('service_id');\n    \n    // If current service doesn't match the type, select first matching service\n    if (currentServiceId) {\n      const svc = services.find((s: any) => String(s.id) === String(currentServiceId));\n      const svcTypeId = String((svc as any)?.service_type_id || '');\n      const matches = svc && (svcTypeId === String(selectedTypeId));\n      if (!matches) {\n        if (matchingServices.length > 0) {\n          form.setValue('service_id', String(matchingServices[0].id), { shouldDirty: true });\n        } else {\n          form.setValue('service_id', '', { shouldDirty: true });\n        }\n      }\n      return;\n    }\n\n    // If no service selected yet, auto-select first matching service\n    if (matchingServices.length > 0) {\n      form.setValue('service_id', String(matchingServices[0].id), { shouldDirty: true });\n    }\n  }, [services, isEditMode, form]);\n\n  const fetchData = async () => {\n    const tenantId = resolvedTenantId || context.tenantId || roles?.[0]?.tenant_id;\n    // If no tenant is resolved, still allow platform admins to load global services\n    if (!tenantId && !context.isPlatformAdmin) return;\n\n    try {\n      // Local lists used later in this function regardless of branch\n      let accountsList: any[] = [];\n      let contactsList: any[] = [];\n      let opportunitiesList: any[] = [];\n\n      if (tenantId) {\n        const [consigneesRes, portsRes, accountsRes, contactsRes, opportunitiesRes, pkgCatsRes, pkgSizesRes] = await Promise.all([\n          supabase.from('consignees').select('*').eq('tenant_id', tenantId).eq('is_active', true),\n          supabase.from('ports_locations').select('*').eq('tenant_id', tenantId).eq('is_active', true),\n          supabase.from('accounts').select('id, name, tenant_id').eq('tenant_id', tenantId),\n          supabase.from('contacts').select('id, first_name, last_name, account_id').eq('tenant_id', tenantId),\n          supabase.from('opportunities').select('id, name, account_id, contact_id, tenant_id').eq('tenant_id', tenantId),\n          supabase.from('package_categories').select('*').eq('tenant_id', tenantId).eq('is_active', true),\n          supabase.from('package_sizes').select('*').eq('tenant_id', tenantId).eq('is_active', true),\n        ]);\n\n        if (consigneesRes.error) throw consigneesRes.error;\n        if (portsRes.error) throw portsRes.error;\n        if (accountsRes.error) throw accountsRes.error;\n        if (contactsRes.error) throw contactsRes.error;\n        if (opportunitiesRes.error) throw opportunitiesRes.error;\n        if (pkgCatsRes.error) throw pkgCatsRes.error;\n        if (pkgSizesRes.error) throw pkgSizesRes.error;\n\n        setConsignees(consigneesRes.data || []);\n        setPorts(portsRes.data || []);\n        setAccounts(accountsRes.data || []);\n        setContacts(contactsRes.data || []);\n        setOpportunities(opportunitiesRes.data || []);\n        setPackageCategories(pkgCatsRes.data || []);\n        setPackageSizes(pkgSizesRes.data || []);\n\n        // Fallback: if tenant-scoped lists are empty, attempt global fetch (subject to RLS)\n        try {\n          if (!pkgCatsRes.data || pkgCatsRes.data.length === 0) {\n            const { data: globalCats } = await supabase\n              .from('package_categories')\n              .select('*')\n              .eq('is_active', true);\n            setPackageCategories(globalCats || []);\n          }\n        } catch {}\n        try {\n          if (!pkgSizesRes.data || pkgSizesRes.data.length === 0) {\n            const { data: globalSizes } = await supabase\n              .from('package_sizes')\n              .select('*')\n              .eq('is_active', true);\n            setPackageSizes(globalSizes || []);\n          }\n        } catch {}\n\n        // Fetch carriers filtered by selected service type via mapping table\n        const currentServiceTypeId = selectedServiceType || form.getValues('service_type_id');\n        if (currentServiceTypeId) {\n          // Get service type code to use for carrier filtering\n          const serviceType = serviceTypes.find((st: any) => String(st.id) === String(currentServiceTypeId));\n          const serviceTypeCode = serviceType?.code;\n          \n          if (serviceTypeCode) {\n            // Normalize to carrier_service_types.service_type values\n            const normCode = (() => {\n              const raw = String(serviceTypeCode).toLowerCase();\n              switch (raw) {\n                case 'ocean':\n                case 'ocean_freight':\n                  return 'ocean';\n                case 'air':\n                case 'air_freight':\n                  return 'air';\n                case 'inland_trucking':\n                case 'trucking':\n                case 'road':\n                  return 'trucking';\n                case 'courier':\n                  return 'courier';\n                case 'railway_transport':\n                case 'rail':\n                  return 'railway_transport';\n                default:\n                  return raw.split('_')[0];\n              }\n            })();\n            const carriersRes = await (supabase as any)\n              .from('carrier_service_types')\n              .select('carrier_id, service_type, is_active, carriers:carrier_id(id, carrier_name, tenant_id, is_active)')\n              .or(tenantId ? `tenant_id.eq.${tenantId},tenant_id.is.null` : 'tenant_id.is.null')\n              .eq('service_type', normCode)\n              .eq('is_active', true);\n            if (carriersRes.error) throw carriersRes.error;\n            // Map carriers from join and de-duplicate by id to avoid double labels\n            const mappedRaw = (carriersRes.data || [])\n              .map((row: any) => row.carriers)\n              .filter((c: any) => !!c && c.is_active);\n            const mappedById: Record<string, any> = {};\n            for (const c of mappedRaw) {\n              mappedById[String(c.id)] = c;\n            }\n            let mapped = Object.values(mappedById);\n\n            // Fallback: if no mappings present, use carriers table by mode/carrier_type\n            if (mapped.length === 0) {\n              const { data: allCarriers } = await (supabase as any)\n                .from('carriers')\n                .select('id, carrier_name, is_active, carrier_type, mode, tenant_id')\n                .or(tenantId ? `tenant_id.eq.${tenantId},tenant_id.is.null` : 'tenant_id.is.null')\n                .order('carrier_name');\n              const normalizeCarrierType = (mode?: string, type?: string) => {\n                const m = String(mode || '').toLowerCase();\n                const t = String(type || '').toLowerCase();\n                const key = m || t;\n                switch (key) {\n                  case 'ocean':\n                    return 'ocean';\n                  case 'air':\n                  case 'air_cargo':\n                    return 'air';\n                  case 'inland_trucking':\n                  case 'trucking':\n                  case 'road':\n                    return 'trucking';\n                  case 'courier':\n                    return 'courier';\n                  case 'movers_packers':\n                  case 'movers_and_packers':\n                  case 'moving':\n                    return 'moving';\n                  case 'railway_transport':\n                  case 'rail':\n                    return 'railway_transport';\n                  default:\n                    return key.split('_')[0];\n                }\n              };\n              const fallbacks = (allCarriers || [])\n                .filter((c: any) => c && c.is_active)\n                .filter((c: any) => normalizeCarrierType(c.mode, c.carrier_type) === normCode);\n              const fbById: Record<string, any> = {};\n              for (const c of fallbacks) fbById[String(c.id)] = c;\n              mapped = Object.values(fbById);\n            }\n            // Ensure saved carrier (in edit mode) appears in the list even if not mapped\n            const selectedCarrierId = form.getValues('carrier_id');\n            if (selectedCarrierId && !mapped.some((c: any) => String(c.id) === String(selectedCarrierId))) {\n              const { data: selCarrier } = await supabase\n                .from('carriers')\n                .select('id, carrier_name, is_active')\n                .eq('id', selectedCarrierId)\n                .maybeSingle();\n              if (selCarrier) {\n                mappedById[String(selCarrier.id)] = selCarrier;\n                mapped = Object.values(mappedById);\n              }\n            }\n            // Dedupe by name to avoid global + tenant duplicates; prefer tenant entry\n            setCarriers(uniqueByCarrierName(mapped, tenantId));\n          } else {\n            // No service type code found\n            setCarriers([]);\n          }\n        } else {\n          // No service type selected yet; do not show carriers\n          setCarriers([]);\n        }\n\n        // Seed resolved tenant from current context\n        setResolvedTenantId(tenantId);\n\n        // Capture local lists for use below\n        accountsList = Array.isArray(accountsRes.data) ? accountsRes.data : [];\n        contactsList = Array.isArray(contactsRes.data) ? contactsRes.data : [];\n        opportunitiesList = Array.isArray(opportunitiesRes.data) ? opportunitiesRes.data : [];\n\n      } else {\n        // Platform admin path without tenant: fetch services globally (respecting RLS)\n        // Attempt to fetch categories and sizes globally if permitted\n        try {\n          const [{ data: cats = [] }, { data: sizes = [] }] = await Promise.all([\n            supabase.from('package_categories').select('*').eq('is_active', true),\n            supabase.from('package_sizes').select('*').eq('is_active', true),\n          ]);\n          setPackageCategories(cats || []);\n          setPackageSizes(sizes || []);\n        } catch (e) {\n          // Non-fatal if RLS blocks global lists\n          setPackageCategories([]);\n          setPackageSizes([]);\n        }\n      }\n\n      // If an opportunity is preselected (e.g. via URL), auto-fill account/contact\n      try {\n        const preselectedOppId = form.getValues('opportunity_id');\n        if (preselectedOppId) {\n          const opp = opportunitiesList.find((o: any) => String(o.id) === String(preselectedOppId));\n          if (opp) {\n            if (opp.account_id) form.setValue('account_id', String(opp.account_id), { shouldDirty: true });\n            if (opp.contact_id) form.setValue('contact_id', String(opp.contact_id), { shouldDirty: true });\n          }\n        }\n      } catch {}\n\n      // Ensure currently selected CRM IDs appear in dropdowns even if tenant lists exclude them\n      try {\n        const curAccountId = form.getValues('account_id');\n        if (curAccountId && !accountsList.some((a: any) => String(a.id) === String(curAccountId))) {\n          const { data } = await supabase\n            .from('accounts')\n            .select('id, name, tenant_id')\n            .eq('id', curAccountId)\n            .maybeSingle();\n          if (data) {\n            setAccounts((prev) => [data, ...prev]);\n          } else {\n            // Resolve account label via Edge Function when direct fetch is blocked by RLS\n            try {\n              const { data: labelData, error: fnError } = await supabase.functions.invoke('get-account-label', {\n                body: { id: curAccountId },\n              });\n              if (!fnError && (labelData as any)?.name) {\n                const resolved = { id: (labelData as any).id ?? curAccountId, name: (labelData as any).name } as any;\n                setAccounts((prev) => [resolved, ...prev]);\n                try {\n                  await supabase.from('audit_logs').insert([{ \n                    user_id: user?.id || null,\n                    action: 'label_fallback_used',\n                    resource_type: 'account',\n                    resource_id: curAccountId as any,\n                    details: { method: 'edge_function', reason: 'rls_blocked' },\n                  }]);\n                } catch {}\n              }\n            } catch (fnErr) {\n              console.warn('Account label resolution failed:', fnErr);\n            }\n          }\n        }\n\n        const curContactId = form.getValues('contact_id');\n        if (curContactId && !contactsList.some((c: any) => String(c.id) === String(curContactId))) {\n          const { data } = await supabase\n            .from('contacts')\n            .select('id, first_name, last_name, account_id')\n            .eq('id', curContactId)\n            .maybeSingle();\n          if (data) {\n            setContacts((prev) => {\n              const exists = prev.some((c: any) => String(c.id) === String(data.id));\n              return exists ? prev : [data, ...prev];\n            });\n          } else {\n            // Resolve contact label via Edge Function when direct fetch is blocked by RLS\n            try {\n              const { data: labelData, error: fnError } = await supabase.functions.invoke('get-contact-label', {\n                body: { id: curContactId },\n              });\n              const first = (labelData as any)?.first_name;\n              const last = (labelData as any)?.last_name;\n              const resolvedAccId = (labelData as any)?.account_id;\n              if (!fnError && (first || last)) {\n                // Inject the resolved contact into list so it appears under the selected account filter\n                const resolvedContact = {\n                  id: String(curContactId),\n                  first_name: first || '',\n                  last_name: last || '',\n                  account_id: resolvedAccId || form.getValues('account_id') || null,\n                } as any;\n                setContacts((prev) => {\n                  const exists = prev.some((c: any) => String(c.id) === String(curContactId));\n                  return exists ? prev : [resolvedContact, ...prev];\n                });\n                // Keep label map for any fallback rendering paths\n                setResolvedContactLabels((prev) => ({\n                  ...prev,\n                  [String(curContactId)]: [first, last].filter(Boolean).join(' ').trim() || 'Selected Contact',\n                }));\n                try {\n                  await supabase.from('audit_logs').insert([{ \n                    user_id: user?.id || null,\n                    action: 'label_fallback_used',\n                    resource_type: 'contact',\n                    resource_id: curContactId as any,\n                    details: { method: 'edge_function', reason: 'rls_blocked' },\n                  }]);\n                } catch {}\n              }\n            } catch (fnErr) {\n              console.warn('Contact label resolution failed:', fnErr);\n            }\n          }\n        }\n\n        const curOppId = form.getValues('opportunity_id');\n        if (curOppId && !opportunitiesList.some((o: any) => String(o.id) === String(curOppId))) {\n          const { data } = await supabase\n            .from('opportunities')\n            .select('id, name, account_id, contact_id, tenant_id')\n            .eq('id', curOppId)\n            .maybeSingle();\n          if (data) {\n            setOpportunities((prev) => {\n              const exists = prev.some((o: any) => String(o.id) === String(data.id));\n              return exists ? prev : [data, ...prev];\n            });\n          } else {\n            // Fallback: resolve label via Edge Function when direct fetch is blocked by RLS\n            try {\n              const { data: labelData, error: fnError } = await supabase.functions.invoke('get-opportunity-label', {\n                body: { id: curOppId },\n              });\n              if (!fnError && (labelData as any)?.name) {\n                const resolved = { id: (labelData as any).id ?? curOppId, name: (labelData as any).name } as any;\n                setOpportunities((prev) => [resolved, ...prev]);\n                try {\n                  await supabase.from('audit_logs').insert([{ \n                    user_id: user?.id || null,\n                    action: 'label_fallback_used',\n                    resource_type: 'opportunity',\n                    resource_id: curOppId as any,\n                    details: { method: 'edge_function', reason: 'rls_blocked' },\n                  }]);\n                } catch {}\n              }\n            } catch (fnErr) {\n              console.warn('Opportunity label resolution failed:', fnErr);\n            }\n          }\n        }\n      } catch (e) {\n        console.warn('CRM option merge after tenant fetch failed:', e);\n      }\n\n    } catch (error: any) {\n      console.error('Failed to fetch data:', error);\n    }\n  };\n\n  // Refetch carriers when service type changes to enforce filtering\n  useEffect(() => {\n    const tenantId = resolvedTenantId || context.tenantId || roles?.[0]?.tenant_id;\n    // Skip during initial hydration to preserve manually-added carriers from edit mode\n    if (!tenantId || isHydrating) return;\n    const currentServiceTypeId = form.getValues('service_type_id');\n    if (!currentServiceTypeId) {\n      setCarriers([]);\n      return;\n    }\n    (async () => {\n      // Get service type code to use for carrier filtering\n       const serviceType = serviceTypes.find((st: any) => String(st.id) === String(currentServiceTypeId));\n       const serviceTypeCode = serviceType?.code;\n      \n      if (!serviceTypeCode) {\n        setCarriers([]);\n        return;\n      }\n      // Normalize to carrier_service_types.service_type values and include global mappings\n      const normCode = (() => {\n        const raw = String(serviceTypeCode).toLowerCase();\n        switch (raw) {\n          case 'ocean':\n          case 'ocean_freight':\n            return 'ocean';\n          case 'air':\n          case 'air_freight':\n            return 'air';\n          case 'inland_trucking':\n          case 'trucking':\n          case 'road':\n            return 'trucking';\n          case 'courier':\n            return 'courier';\n          case 'railway_transport':\n          case 'rail':\n            return 'railway_transport';\n          default:\n            return raw.split('_')[0];\n        }\n      })();\n      const carriersRes: any = await (supabase as any)\n        .from('carrier_service_types')\n        .select('carrier_id, service_type, is_active, carriers:carrier_id(id, carrier_name, tenant_id, is_active)')\n        .or(tenantId ? `tenant_id.eq.${tenantId},tenant_id.is.null` : 'tenant_id.is.null')\n        .eq('service_type', normCode)\n        .eq('is_active', true);\n      if (carriersRes.error) {\n        console.warn('Failed to fetch carriers by service type:', carriersRes.error);\n        setCarriers([]);\n        return;\n      }\n      // Map carriers from join and de-duplicate by id to avoid double labels\n      const mappedRaw = (carriersRes.data || [])\n        .map((row: any) => row.carriers)\n        .filter((c: any) => !!c && c.is_active);\n      const mappedById: Record<string, any> = {};\n      for (const c of mappedRaw) {\n        mappedById[String(c.id)] = c;\n      }\n      let mapped = Object.values(mappedById);\n      // Ensure saved carrier (in edit mode) appears in the list even if not mapped\n      const selectedCarrierId = form.getValues('carrier_id');\n      if (selectedCarrierId && !mapped.some((c: any) => String(c.id) === String(selectedCarrierId))) {\n        const { data: selCarrier } = await supabase\n          .from('carriers')\n          .select('id, carrier_name, is_active')\n          .eq('id', selectedCarrierId)\n          .maybeSingle();\n        if (selCarrier) {\n          mappedById[String(selCarrier.id)] = selCarrier;\n          mapped = Object.values(mappedById);\n        }\n      }\n      // Dedupe by name to avoid global + tenant duplicates; prefer tenant entry\n      setCarriers(uniqueByCarrierName(mapped, tenantId));\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedServiceType, resolvedTenantId, isHydrating]);\n\n  // Ensure selected carrier appears promptly even before service-type filtered list loads\n  useEffect(() => {\n    const id = carrierId;\n    if (!id) return;\n    if (carriers.some((c: any) => String(c.id) === String(id))) return;\n    (async () => {\n      try {\n        const { data: selCarrier } = await supabase\n          .from('carriers')\n          .select('id, carrier_name, is_active')\n          .eq('id', id)\n          .maybeSingle();\n        if (selCarrier) {\n          setResolvedCarrierLabels((prev) => ({\n            ...prev,\n            [String(selCarrier.id)]: selCarrier.carrier_name || 'Selected Carrier',\n          }));\n          const byId: Record<string, any> = {};\n          for (const c of carriers) byId[String(c.id)] = c;\n          byId[String(selCarrier.id)] = selCarrier;\n          setCarriers(Object.values(byId));\n        }\n      } catch (e) {\n        // Silent; fallback label will still render\n      }\n    })();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [carrierId]);\n\n  // Preview next quote number via RPC when context becomes available\n  useEffect(() => {\n    const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n    const franchiseId = context.franchiseId || roles?.[0]?.franchise_id || null;\n    if (!tenantId) return;\n    // In edit mode, use existing quote number preview and skip RPC\n    if (quoteId) return;\n    const preview = async () => {\n      try {\n        const { data, error } = await (supabase as any).rpc('preview_next_quote_number', {\n          p_tenant_id: tenantId,\n          p_franchise_id: franchiseId,\n        });\n        if (error) throw error;\n        setQuoteNumberPreview(typeof data === 'string' ? data : 'Auto-generated on save');\n      } catch (err) {\n        // Keep default hint on any error\n        console.warn('Preview quote number failed:', err);\n      }\n    };\n    preview();\n  }, [context.tenantId, context.franchiseId]);\n\n  // When account changes, clear contact if it no longer belongs to the selected account\n  useEffect(() => {\n    if (!accountId) return;\n    if (!Array.isArray(contacts) || contacts.length === 0) return; // wait until contacts load\n    const currentContactId = form.getValues('contact_id');\n    // Only clear if the selected contact exists and belongs to a different account.\n    // If the contact is not present (e.g., RLS-hidden and rendered via fallback), keep it.\n    const selected = contacts.find((c: any) => String(c.id) === String(currentContactId));\n    if (selected && String(selected.account_id) !== String(accountId)) {\n      form.setValue('contact_id', undefined, { shouldDirty: true });\n    }\n  }, [accountId, contacts]);\n\n  // Resolve tenant from selected account or context\n  useEffect(() => {\n    let nextTenantId: string | null = context.tenantId || roles?.[0]?.tenant_id || null;\n    const acc = accounts.find((a: any) => String(a.id) === String(accountId));\n    if (acc?.tenant_id) nextTenantId = acc.tenant_id;\n    setResolvedTenantId(nextTenantId);\n  }, [accountId, accounts, context.tenantId, roles]);\n\n  // Fetch tenant name for hint when resolved tenant changes\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!resolvedTenantId) { setResolvedTenantName(null); return; }\n        const { data, error } = await supabase.from('tenants').select('name').eq('id', resolvedTenantId).maybeSingle();\n        if (!error) setResolvedTenantName((data as any)?.name ?? null);\n      } catch {}\n    })();\n  }, [resolvedTenantId, supabase]);\n\n\n  const addItem = () => {\n    setItems([\n      ...items,\n      { line_number: items.length + 1, product_name: '', quantity: 1, unit_price: 0, discount_percent: 0 },\n    ]);\n  };\n\n  const removeItem = (index: number) => {\n    const next = items\n      .filter((_, i) => i !== index)\n      .map((it, idx) => ({ ...it, line_number: idx + 1 }));\n    setItems(next);\n  };\n\n  const updateItem = (index: number, field: keyof QuoteItem, value: any) => {\n    const newItems = [...items];\n    newItems[index] = { ...newItems[index], [field]: value };\n    setItems(newItems);\n  };\n\n  // Resolve labels for package category/size IDs that are selected but not present in the current lists\n  useEffect(() => {\n    const resolveMissingLabels = async () => {\n      try {\n        const catIds = Array.from(new Set(items.map((i) => i.package_category_id).filter((v): v is string => !!v).map(String)));\n        const sizeIds = Array.from(new Set(items.map((i) => i.package_size_id).filter((v): v is string => !!v).map(String)));\n\n        const presentCatIds = new Set((packageCategories || []).map((c: any) => String(c.id)));\n        const presentSizeIds = new Set((packageSizes || []).map((s: any) => String(s.id)));\n\n        const missingCatIds = catIds.filter((id) => !presentCatIds.has(id));\n        const missingSizeIds = sizeIds.filter((id) => !presentSizeIds.has(id));\n\n        if (missingCatIds.length > 0) {\n          try {\n            const { data: cats } = await supabase\n              .from('package_categories')\n              .select('id, category_name, is_active')\n              .in('id', missingCatIds);\n            if (Array.isArray(cats)) {\n              setResolvedPackageCategoryLabels((prev) => {\n                const next = { ...prev };\n                for (const c of cats) {\n                  next[String(c.id)] = c.category_name || 'Selected Category';\n                }\n                return next;\n              });\n            }\n          } catch (e) {\n            // Non-fatal if RLS blocks direct resolution\n          }\n        }\n\n        if (missingSizeIds.length > 0) {\n          try {\n            const { data: sizes } = await supabase\n              .from('package_sizes')\n              .select('id, size_name, size_code, is_active')\n              .in('id', missingSizeIds);\n            if (Array.isArray(sizes)) {\n              setResolvedPackageSizeLabels((prev) => {\n                const next = { ...prev };\n                for (const s of sizes) {\n                  const base = s.size_name || 'Selected Size';\n                  next[String(s.id)] = s.size_code ? `${base} (${s.size_code})` : base;\n                }\n                return next;\n              });\n            }\n          } catch (e) {\n            // Non-fatal if RLS blocks direct resolution\n          }\n        }\n      } catch {}\n    };\n    resolveMissingLabels();\n  }, [items, packageCategories, packageSizes, supabase]);\n\n  // ===== Import/Export helpers =====\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n\n  const parseCSV = (text: string): QuoteItem[] => {\n    const lines = text.trim().split(/\\r?\\n/);\n    if (lines.length === 0) return [];\n    const parseLine = (line: string) => {\n      const result: string[] = [];\n      let cur = '';\n      let inQuotes = false;\n      for (let i = 0; i < line.length; i++) {\n        const ch = line[i];\n        if (ch === '\"') {\n          // Toggle quotes or escape\n          if (inQuotes && line[i + 1] === '\"') { cur += '\"'; i++; }\n          else { inQuotes = !inQuotes; }\n        } else if (ch === ',' && !inQuotes) {\n          result.push(cur.trim()); cur = '';\n        } else {\n          cur += ch;\n        }\n      }\n      result.push(cur.trim());\n      return result;\n    };\n    const headers = parseLine(lines[0]).map((h) => h.toLowerCase().replace(/\\s+/g, '_'));\n    const idx = (name: string, aliases: string[]) => {\n      const names = [name, ...aliases];\n      for (const n of names) {\n        const pos = headers.indexOf(n);\n        if (pos !== -1) return pos;\n      }\n      return -1;\n    };\n    const iLine = idx('line_number', ['line', 'no']);\n    const iProd = idx('product_name', ['product', 'item', 'name']);\n    const iDesc = idx('description', ['desc']);\n    const iQty = idx('quantity', ['qty']);\n    const iPrice = idx('unit_price', ['price', 'unitprice']);\n    const iDisc = idx('discount_percent', ['discount', 'disc_percent']);\n    const parsed: QuoteItem[] = [];\n    for (let r = 1; r < lines.length; r++) {\n      const cols = parseLine(lines[r]);\n      const q = Number(cols[iQty >= 0 ? iQty : -1] || 1);\n      const p = Number(cols[iPrice >= 0 ? iPrice : -1] || 0);\n      const d = Number(cols[iDisc >= 0 ? iDisc : -1] || 0);\n      const product = cols[iProd >= 0 ? iProd : -1] || '';\n      const description = cols[iDesc >= 0 ? iDesc : -1] || '';\n      if (!product && description === '' && isNaN(q) && isNaN(p)) continue;\n      parsed.push({\n        line_number: Number(cols[iLine >= 0 ? iLine : -1] || parsed.length + 1),\n        product_name: product,\n        description,\n        quantity: isNaN(q) ? 1 : q,\n        unit_price: isNaN(p) ? 0 : p,\n        discount_percent: isNaN(d) ? 0 : d,\n      });\n    }\n    return parsed;\n  };\n\n  const handleUploadClick = () => fileInputRef.current?.click();\n  const handleFileSelected = (e: any) => {\n    try {\n      const file = e?.target?.files?.[0];\n      if (!file) return;\n      const reader = new FileReader();\n      reader.onload = () => {\n        try {\n          const text = String(reader.result || '');\n          const next = parseCSV(text);\n          if (next.length) setItems(next);\n          toast.success('Items imported from Excel/CSV');\n        } catch {\n          toast.error('Failed to parse CSV. Please check columns.');\n        }\n      };\n      reader.readAsText(file);\n    } catch {\n      toast.error('Import failed');\n    } finally {\n      if (e?.target) e.target.value = '';\n    }\n  };\n\n  const downloadItemsCSV = () => {\n    const headers = ['line_number','product_name','description','quantity','unit_price','discount_percent'];\n    const rows = items.map(i => [i.line_number, i.product_name, i.description || '', i.quantity, i.unit_price, i.discount_percent]);\n    const csv = [headers.join(','), ...rows.map(r => r.map(v => {\n      const s = String(v ?? '');\n      return s.includes(',') || s.includes('\"') || s.includes('\\n') ? '\"' + s.replace(/\"/g,'\"\"') + '\"' : s;\n    }).join(','))].join('\\n');\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `quote_items_${quoteId || 'new'}.csv`;\n    a.click();\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n  };\n\n  const downloadPDF = () => {\n    try {\n      const totals = calculateTotals();\n      const rows = items.map(i => `<tr><td>${i.line_number}</td><td>${i.product_name}</td><td>${i.description || ''}</td><td>${i.quantity}</td><td>${i.unit_price.toFixed(2)}</td><td>${i.discount_percent}%</td></tr>`).join('');\n      const html = `<!doctype html><html><head><meta charset=\"utf-8\"/><title>Quote</title>\n        <style>\n          body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,\"Helvetica Neue\",sans-serif;padding:24px;color:#111}\n          h1{font-size:20px;margin:0 0 12px}\n          table{width:100%;border-collapse:collapse}\n          th,td{border:1px solid #ddd;padding:6px;text-align:left;font-size:12px}\n          tfoot td{font-weight:bold}\n        </style>\n      </head><body>\n        <h1>Quotation ${quoteNumberPreview || ''}</h1>\n        <table>\n          <thead><tr><th>Line</th><th>Product</th><th>Description</th><th>Qty</th><th>Unit Price</th><th>Discount</th></tr></thead>\n          <tbody>${rows}</tbody>\n          <tfoot>\n            <tr><td colspan=\"5\">Subtotal</td><td>${totals.subtotal.toFixed(2)}</td></tr>\n            <tr><td colspan=\"5\">Tax</td><td>${totals.taxAmount.toFixed(2)}</td></tr>\n            <tr><td colspan=\"5\">Total</td><td>${totals.total.toFixed(2)}</td></tr>\n          </tfoot>\n        </table>\n      </body></html>`;\n      const w = window.open('', '_blank');\n      if (!w) { toast.error('Popup blocked. Allow popups to download PDF.'); return; }\n      w.document.write(html);\n      w.document.close();\n      w.focus();\n      w.print();\n    } catch {\n      toast.error('Failed to prepare PDF');\n    }\n  };\n\n  // Register sticky actions in Dashboard layout (inside component)\n  const { setActions, clearActions } = useStickyActions();\n\n  useEffect(() => {\n    const left = [\n      (<Button key=\"close\" type=\"button\" variant=\"secondary\" onClick={() => navigate(-1)}>Close</Button>),\n    ];\n\n    const right = [\n      (<Button key=\"import\" type=\"button\" variant=\"outline\" onClick={handleUploadClick}>Import</Button>),\n      (<Button key=\"export\" type=\"button\" variant=\"outline\" onClick={downloadItemsCSV}>Export</Button>),\n      (<Button key=\"export-pdf\" type=\"button\" variant=\"outline\" onClick={downloadPDF}>Export.PDF</Button>),\n      (<Button key=\"submit\" type=\"button\" disabled={isSubmitting} onClick={() => form.handleSubmit(onSubmit)()}>\n        {isSubmitting ? (isEditMode ? 'Modifying...' : 'Saving...') : (isEditMode ? 'Modify' : 'Add')}\n      </Button>),\n    ];\n\n    setActions({ left, right });\n    return () => clearActions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSubmitting, isEditMode, items]);\n\n  // Carrier quotations helpers\n  const addCarrierQuote = () => {\n    setCarrierQuotes([\n      ...carrierQuotes,\n      {\n        carrier_id: '',\n        mode: selectedServiceType || undefined,\n        buying_charges: [],\n        selling_charges: [],\n      },\n    ]);\n  };\n\n  const removeCarrierQuote = (index: number) => {\n    setCarrierQuotes(carrierQuotes.filter((_, i) => i !== index));\n  };\n\n  const updateCarrierField = (index: number, field: keyof CarrierQuote, value: any) => {\n    const next = [...carrierQuotes];\n    next[index] = { ...next[index], [field]: value };\n    setCarrierQuotes(next);\n  };\n\n  const addCharge = (index: number, side: 'buy' | 'sell') => {\n    const next = [...carrierQuotes];\n    const targetList = side === 'buy' ? next[index].buying_charges : next[index].selling_charges;\n    targetList.push({ type: 'freight', amount: 0, currency: 'USD' });\n    setCarrierQuotes(next);\n  };\n\n  // Opportunity selection dialog state\n  const [oppDialogOpen, setOppDialogOpen] = useState(false);\n  const [accDialogOpen, setAccDialogOpen] = useState(false);\n  const [contactDialogOpen, setContactDialogOpen] = useState(false);\n  const handleSelectOpportunity = async (opp: any) => {\n    try {\n      if (!opp?.id) return;\n      \n      form.setValue('opportunity_id', String(opp.id), { shouldDirty: true });\n      \n      // Fetch full opportunity data including account and contact\n      const { data: fullOpp, error } = await supabase.functions.invoke('get-opportunity-full', {\n        body: { id: opp.id }\n      });\n\n      if (!error && fullOpp) {\n        // Auto-populate account if opportunity has one\n        if (fullOpp.account_id) {\n          form.setValue('account_id', String(fullOpp.account_id), { shouldDirty: true });\n          \n          // Ensure account is in the list\n          if (fullOpp.accounts) {\n            setAccounts((prev) => {\n              const exists = prev.some((a: any) => String(a.id) === String(fullOpp.account_id));\n              return exists ? prev : [{ id: fullOpp.accounts.id, name: fullOpp.accounts.name }, ...prev];\n            });\n          }\n        }\n        \n        // Auto-populate contact if opportunity has one\n        if (fullOpp.contact_id) {\n          form.setValue('contact_id', String(fullOpp.contact_id), { shouldDirty: true });\n          \n          // Ensure contact is in the list\n          if (fullOpp.contacts) {\n            setContacts((prev) => {\n              const exists = prev.some((c: any) => String(c.id) === String(fullOpp.contact_id));\n              return exists ? prev : [{ \n                id: fullOpp.contacts.id, \n                first_name: fullOpp.contacts.first_name || '', \n                last_name: fullOpp.contacts.last_name || '', \n                account_id: fullOpp.account_id \n              }, ...prev];\n            });\n          }\n        }\n        \n        // Ensure selected opportunity appears in the dropdown\n        setOpportunities((prev) => {\n          const exists = prev.some((o: any) => String(o.id) === String(fullOpp.id));\n          return exists ? prev : [fullOpp, ...prev];\n        });\n      } else {\n        // Fallback to provided data if edge function fails\n        if (opp.account_id) form.setValue('account_id', String(opp.account_id), { shouldDirty: true });\n        if (opp.contact_id) form.setValue('contact_id', String(opp.contact_id), { shouldDirty: true });\n        \n        setOpportunities((prev) => {\n          const exists = prev.some((o: any) => String(o.id) === String(opp.id));\n          return exists ? prev : [opp, ...prev];\n        });\n      }\n    } catch (err) {\n      console.error('Error selecting opportunity:', err);\n      // Basic fallback\n      if (opp.account_id) form.setValue('account_id', String(opp.account_id), { shouldDirty: true });\n      if (opp.contact_id) form.setValue('contact_id', String(opp.contact_id), { shouldDirty: true });\n    }\n  };\n\n  const handleSelectAccount = (account: any) => {\n    try {\n      if (account?.id) form.setValue('account_id', String(account.id), { shouldDirty: true });\n      // If currently selected contact does not belong, clear it\n      const currentContactId = form.getValues('contact_id');\n      const belongs = contacts.some((c: any) => String(c.id) === String(currentContactId) && String(c.account_id) === String(account.id));\n      if (!belongs) form.setValue('contact_id', undefined, { shouldDirty: true });\n      // Normalize injected account shape to ensure label and tenant resolution work\n      const normalized = {\n        id: account.id,\n        name: account.name || account.account_name || 'Account',\n        tenant_id: account.tenant_id ?? null,\n      } as any;\n      setAccounts((prev) => {\n        const exists = prev.some((a: any) => String(a.id) === String(normalized.id));\n        return exists ? prev : [normalized, ...prev];\n      });\n    } catch {}\n  };\n\n  const handleSelectContact = (contact: any) => {\n    try {\n      if (contact?.id) form.setValue('contact_id', String(contact.id), { shouldDirty: true });\n      if (contact?.account_id) form.setValue('account_id', String(contact.account_id), { shouldDirty: true });\n      setContacts((prev) => {\n        const exists = prev.some((c: any) => String(c.id) === String(contact.id));\n        return exists ? prev : [contact, ...prev];\n      });\n    } catch {}\n  };\n\n  const updateCharge = (\n    index: number,\n    side: 'buy' | 'sell',\n    chargeIndex: number,\n    field: keyof Charge,\n    value: any,\n  ) => {\n    const next = [...carrierQuotes];\n    const targetList = side === 'buy' ? next[index].buying_charges : next[index].selling_charges;\n    targetList[chargeIndex] = { ...targetList[chargeIndex], [field]: value } as Charge;\n    setCarrierQuotes(next);\n  };\n\n  const removeCharge = (index: number, side: 'buy' | 'sell', chargeIndex: number) => {\n    const next = [...carrierQuotes];\n    const targetList = side === 'buy' ? next[index].buying_charges : next[index].selling_charges;\n    next[index] = {\n      ...next[index],\n      [side === 'buy' ? 'buying_charges' : 'selling_charges']:\n        targetList.filter((_, i) => i !== chargeIndex),\n    } as CarrierQuote;\n    setCarrierQuotes(next);\n  };\n\n  const totalCharges = (charges: Charge[]) => charges.reduce((sum, c) => sum + (Number(c.amount) || 0), 0);\n\n  const calculateTotals = () => {\n    const subtotal = items.reduce((sum, item) => {\n      const lineTotal = item.quantity * item.unit_price;\n      const discount = lineTotal * (item.discount_percent / 100);\n      return sum + (lineTotal - discount);\n    }, 0);\n\n    const taxPercent = parseFloat(form.getValues('tax_percent') || '0');\n    const shippingAmount = parseFloat(form.getValues('shipping_amount') || '0');\n    const taxAmount = subtotal * (taxPercent / 100);\n    const total = subtotal + taxAmount + shippingAmount;\n\n    return { subtotal, taxAmount, total };\n  };\n\n  const onSubmit = async (values: z.infer<typeof quoteSchema>) => {\n    // Resolve tenant_id from context/role, and fall back to selected account/opportunity\n    let tenantId = context.tenantId || roles?.[0]?.tenant_id;\n    if (!tenantId && values.account_id) {\n      try {\n        const { data: acc } = await supabase\n          .from('accounts')\n          .select('tenant_id')\n          .eq('id', values.account_id)\n          .maybeSingle();\n        tenantId = acc?.tenant_id || tenantId;\n      } catch {}\n    }\n    // As an additional fallback, infer from opportunity if provided\n    if (!tenantId && values.opportunity_id) {\n      try {\n        const { data: opp } = await supabase\n          .from('opportunities')\n          .select('tenant_id, account_id')\n          .eq('id', values.opportunity_id)\n          .maybeSingle();\n        tenantId = (opp as any)?.tenant_id || tenantId;\n        // Backfill account_id from opportunity if missing\n        if (!values.account_id && (opp as any)?.account_id) {\n          form.setValue('account_id', String((opp as any).account_id), { shouldDirty: true });\n        }\n      } catch {}\n    }\n    const franchiseId = context.franchiseId || roles?.[0]?.franchise_id || null;\n\n    if (!tenantId) {\n      toast.error('No tenant selected. Please ensure your account is linked to a tenant.');\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const { subtotal, taxAmount, total } = calculateTotals();\n      \n      const regulatory: any = {};\n      if (values.trade_direction) regulatory.trade_direction = values.trade_direction;\n      if (selectedServiceType) regulatory.transport_mode = selectedServiceType;\n      if (carrierQuotes.length > 0) {\n        regulatory.carrier_quotes = carrierQuotes.map((cq) => ({\n          carrier_id: cq.carrier_id,\n          mode: cq.mode || selectedServiceType || null,\n          buying_charges: cq.buying_charges,\n          selling_charges: cq.selling_charges,\n          total_buy: totalCharges(cq.buying_charges),\n          total_sell: totalCharges(cq.selling_charges),\n        }));\n      }\n\n      // Only generate a quote number for new quotes\n      let quoteNumber: string | null = null;\n      if (!quoteId) {\n        const { data: genNumber, error: genError } = await (supabase as any).rpc('generate_quote_number', {\n          p_tenant_id: tenantId,\n          p_franchise_id: franchiseId,\n        });\n        quoteNumber = genError || !genNumber ? null : (typeof genNumber === 'string' ? genNumber : String(genNumber));\n      }\n\n      const quoteData: any = {\n        ...(quoteNumber ? { quote_number: quoteNumber } : {}),\n        title: values.title,\n        description: values.description || null,\n        service_type_id: values.service_type_id || null,\n        service_id: values.service_id || null,\n        incoterms: values.incoterms || null,\n        regulatory_data: Object.keys(regulatory).length ? regulatory : null,\n        carrier_id: values.carrier_id || null,\n        consignee_id: values.consignee_id || null,\n        origin_port_id: values.origin_port_id || null,\n        destination_port_id: values.destination_port_id || null,\n        account_id: values.account_id || null,\n        contact_id: values.contact_id || null,\n        opportunity_id: values.opportunity_id || null,\n        status: values.status,\n        valid_until: values.valid_until || null,\n        tenant_id: tenantId,\n        franchise_id: franchiseId,\n        owner_id: user?.id || null,\n        created_by: user?.id || null,\n        subtotal,\n        tax_amount: taxAmount,\n        tax_percent: parseFloat(values.tax_percent || '0'),\n        shipping_amount: parseFloat(values.shipping_amount || '0'),\n        total_amount: total,\n        terms_conditions: values.terms_conditions || null,\n        notes: values.notes || null,\n        compliance_status: 'pending',\n      };\n\n      let quote: any = null;\n      if (quoteId) {\n        const { data: updated, error: updateErr } = await supabase\n          .from('quotes')\n          .update(quoteData)\n          .eq('id', quoteId)\n          .select()\n          .maybeSingle();\n        if (updateErr) throw updateErr;\n        quote = updated || { id: quoteId };\n      } else {\n        const { data: created, error: quoteError } = await supabase\n          .from('quotes')\n          .insert([quoteData])\n          .select()\n          .single();\n        if (quoteError) throw quoteError;\n        quote = created;\n      }\n\n      // Update opportunity stage based on quote status when linked\n      try {\n        const oppId = quote?.opportunity_id || values.opportunity_id;\n        const qStatus = String(values.status || '').toLowerCase();\n        if (oppId) {\n          let nextStage: string | null = null;\n          if (qStatus === 'draft' || qStatus === 'sent') nextStage = 'proposal';\n          else if (qStatus === 'accepted') nextStage = 'closed_won';\n          else if (qStatus === 'rejected') nextStage = 'closed_lost';\n          if (nextStage) {\n            const updatePayload: Record<string, unknown> = { stage: nextStage };\n            if (nextStage === 'closed_won') {\n              updatePayload.closed_at = new Date().toISOString();\n            }\n            await supabase.from('opportunities').update(updatePayload).eq('id', oppId);\n          }\n        }\n      } catch (e) {\n        console.warn('Failed to update opportunity stage from quote status', e);\n      }\n\n      const itemsData = items.map((item) => ({\n        quote_id: quote.id,\n        line_number: Number(item.line_number) || 1,\n        product_name: item.product_name,\n        description: item.description ?? null,\n        quantity: Number(item.quantity) || 0,\n        unit_price: Number(item.unit_price) || 0,\n        discount_percent: Number(item.discount_percent) || 0,\n        package_category_id: item.package_category_id ? String(item.package_category_id) : null,\n        package_size_id: item.package_size_id ? String(item.package_size_id) : null,\n        line_total:\n          (Number(item.quantity) || 0) * (Number(item.unit_price) || 0) * (1 - (Number(item.discount_percent) || 0) / 100),\n      }));\n\n      // Replace existing items on edit; insert on create\n      if (quoteId) {\n        const { error: delErr } = await supabase\n          .from('quote_items')\n          .delete()\n          .eq('quote_id', quoteId);\n        if (delErr) throw delErr;\n      }\n      const { error: itemsError } = await supabase.from('quote_items').insert(itemsData);\n\n      if (itemsError) throw itemsError;\n\n      // Immediately reload items to ensure all fields (including container size) are persisted\n      try {\n        const { data: savedItems } = await supabase\n          .from('quote_items')\n          .select('line_number, product_name, description, quantity, unit_price, discount_percent, package_category_id, package_size_id')\n          .eq('quote_id', quote.id)\n          .order('line_number', { ascending: true });\n        if (Array.isArray(savedItems)) {\n          setItems(\n            savedItems.map((it: any) => ({\n              line_number: it.line_number,\n              product_name: it.product_name || '',\n              description: it.description || '',\n              quantity: Number(it.quantity) || 0,\n              unit_price: Number(it.unit_price) || 0,\n              discount_percent: Number(it.discount_percent) || 0,\n              package_category_id: it.package_category_id ? String(it.package_category_id) : undefined,\n              package_size_id: it.package_size_id ? String(it.package_size_id) : undefined,\n            }))\n          );\n        }\n      } catch {}\n\n      // Persist carrier rates and charges, then generate quotation version/options\n      try {\n        if (carrierQuotes.length > 0) {\n          const rateIds = await upsertRatesAndChargesForQuote(\n            quote.id,\n            tenantId!,\n            values.service_id || null,\n            values.origin_port_id || null,\n            values.destination_port_id || null,\n            carrierQuotes.map((cq) => ({\n              carrier_rate_id: cq.carrier_rate_id,\n              carrier_id: cq.carrier_id,\n              mode: cq.mode || selectedServiceType || undefined,\n              buying_charges: cq.buying_charges || [],\n              selling_charges: cq.selling_charges || [],\n            })),\n            existingRateIds,\n            supabase as any,\n          );\n          if (rateIds.length > 0) {\n            await createQuotationVersionWithOptions(\n              tenantId!,\n              franchiseId!,\n              quote.id,\n              rateIds,\n              {\n                valid_until: values.valid_until || undefined,\n                created_by: user?.id || null,\n                change_reason: 'Initial options from captured carrier rates',\n              },\n              supabase as any,\n            );\n          }\n        }\n      } catch (err: any) {\n        console.warn('Carrier rates/options handling failed', err);\n        toast.error('Saved quote, but failed to generate options from carrier rates');\n      }\n\n      toast.success(quoteId ? 'Quote updated successfully' : 'Quote created successfully');\n      onSuccess?.(quote.id);\n    } catch (error: any) {\n      toast.error(error.message || (quoteId ? 'Failed to update quote' : 'Failed to create quote'));\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"enterprise-form pb-24\">\n      <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3\">\n        {/* Hidden file input for Import (CSV) */}\n        <input ref={fileInputRef} type=\"file\" accept=\".csv\" className=\"hidden\" onChange={handleFileSelected} />\n        <fieldset disabled={isHydrating} aria-busy={isHydrating}>\n        <Card className=\"ef-card\">\n          <CardHeader className=\"ef-header\">\n            <CardTitle className=\"ef-title\">\n              Quote Information\n              {isEditMode && (\n                <span className=\"ml-2 ef-subtitle\">Edit Mode</span>\n              )}\n            </CardTitle>\n            {isEditMode && isHydrating && (\n              <div className=\"mt-1 text-xs text-muted-foreground flex items-center\">\n                <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" /> Loading saved data\n              </div>\n            )}\n          </CardHeader>\n          <CardContent className=\"space-y-1\">\n            <div className=\"ef-grid hidden\">\n              {/* Compact top grid spacing */}\n              <FormField\n                control={form.control}\n                name=\"title\"\n                render={({ field }) => (\n                  <FormItem className=\"col-span-1 sm:col-span-2 lg:col-span-2\">\n                    <FormLabel>Title</FormLabel>\n                    <FormControl>\n                      <Input value={field.value ?? ''} onChange={field.onChange} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem className=\"col-span-1 sm:col-span-2 lg:col-span-2\">\n                    <FormLabel>Description</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        value={field.value ?? ''}\n                        onChange={field.onChange}\n                        rows={1}\n                        className=\"min-h-[2.25rem] overflow-hidden resize-none\"\n                        onInput={(e) => {\n                          const el = e.currentTarget;\n                          el.style.height = 'auto';\n                          el.style.height = `${el.scrollHeight}px`;\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n            <div className=\"ef-divider\" />\n            {/* Quotation, Opportunity, Account, Contact section */}\n            <section aria-labelledby=\"quote-identifiers\" className=\"border border-border rounded-md p-3\">\n              <h3 id=\"quote-identifiers\" className=\"sr-only\">Quotation, Opportunity, Account, Contact</h3>\n              <div className=\"ef-grid\">\n                {/* Quotation Number */}\n                <FormItem>\n                  <FormLabel>Quotation Number</FormLabel>\n                  <FormControl>\n                    <Input readOnly value={quoteNumberPreview} />\n                  </FormControl>\n                </FormItem>\n\n              {/* Opportunity Number */}\n              <FormField\n                control={form.control}\n                name=\"opportunity_id\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Opportunity Number</FormLabel>\n                    <Select \n                      onValueChange={(value) => {\n                        field.onChange(value);\n                        const opp = opportunities.find((o) => String(o.id) === value);\n                        if (opp) {\n                          if (opp.account_id) form.setValue('account_id', String(opp.account_id), { shouldDirty: true });\n                          if (opp.contact_id) form.setValue('contact_id', String(opp.contact_id), { shouldDirty: true });\n                        }\n                      }} \n                      value={field.value ?? ''}\n                    >\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select opportunity\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {uniqueById(opportunities).map((opp) => (\n                          <SelectItem key={String(opp.id)} value={String(opp.id)}>\n                            {opp.name}\n                          </SelectItem>\n                        ))}\n                        {opportunities.length === 0 && (\n                          <SelectItem disabled value=\"__no_opportunities__\">No opportunities found</SelectItem>\n                        )}\n                        {field.value && !opportunities.some((o: any) => String(o.id) === String(field.value)) && (\n                          <SelectItem key={`selected-opportunity-${field.value}`} value={String(field.value)}>\n                            Selected Opportunity\n                          </SelectItem>\n                        )}\n                      </SelectContent>\n                    </Select>\n                    <div className=\"mt-2\">\n                      <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => setOppDialogOpen(true)}>\n                        <Search className=\"h-4 w-4 mr-2\" /> Browse opportunities\n                      </Button>\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Account */}\n              <FormField\n                control={form.control}\n                name=\"account_id\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Account</FormLabel>\n                    <Select onValueChange={(v) => field.onChange(v)} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select account\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {uniqueById(accounts).map((account) => (\n                          <SelectItem key={String(account.id)} value={String(account.id)}>\n                            {account.name || (account as any).account_name || 'Account'}\n                          </SelectItem>\n                        ))}\n                        {accounts.length === 0 && (\n                          <SelectItem disabled value=\"__no_accounts__\">No accounts found</SelectItem>\n                        )}\n                        {field.value && !accounts.some((a: any) => String(a.id) === String(field.value)) && (\n                          <SelectItem key={`selected-account-${field.value}`} value={String(field.value)}>\n                            Selected Account\n                          </SelectItem>\n                        )}\n                      </SelectContent>\n                    </Select>\n                    <div className=\"mt-2\">\n                      <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => setAccDialogOpen(true)}>\n                        <Search className=\"h-4 w-4 mr-2\" /> Browse accounts\n                      </Button>\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Contact */}\n              <FormField\n                control={form.control}\n                name=\"contact_id\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Contact</FormLabel>\n                    <Select onValueChange={(v) => field.onChange(v)} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select contact\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {uniqueById(accountId ? contacts.filter((c: any) => String(c.account_id) === String(accountId)) : contacts).map((contact) => (\n                          <SelectItem key={String(contact.id)} value={String(contact.id)}>\n                            {contact.first_name} {contact.last_name}\n                          </SelectItem>\n                        ))}\n                        {contacts.length === 0 && (\n                          <SelectItem disabled value=\"__no_contacts__\">No contacts found</SelectItem>\n                        )}\n                        {field.value && !(\n                          (accountId ? contacts.filter((c: any) => String(c.account_id) === String(accountId)) : contacts)\n                            .some((c: any) => String(c.id) === String(field.value))\n                        ) && (\n                          <SelectItem key={`selected-contact-${field.value}`} value={String(field.value)}>\n                            {resolvedContactLabels[String(field.value)] || 'Selected Contact'}\n                          </SelectItem>\n                        )}\n                      </SelectContent>\n                    </Select>\n                    <div className=\"mt-2\">\n                      <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => setContactDialogOpen(true)}>\n                        <Search className=\"h-4 w-4 mr-2\" /> Browse contacts\n                      </Button>\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              </div>\n            </section>\n            <div className=\"ef-divider\" />\n\n            <div className=\"ef-grid\">\n              {/* Arrange Valid Until, Service Type, Service, Import/Export in one row */}\n              <FormField\n                control={form.control}\n                name=\"valid_until\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Valid Until</FormLabel>\n                    <FormControl>\n                      <Input type=\"date\" value={field.value ?? ''} onChange={field.onChange} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"service_type_id\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Service Type</FormLabel>\n                      <Select\n                        value={field.value}\n                        onValueChange={(value) => {\n                          const selectedType = serviceTypes.find(st => st.id === value);\n                          if (selectedType && selectedType.id !== '') {\n                            form.setValue('service_type_id', selectedType.id, { shouldDirty: true });\n                            setSelectedServiceType(selectedType.code);\n                            form.setValue('service_id', '', { shouldDirty: true }); // Reset service selection\n                          }\n                        }}\n                      >\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a service type\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {(() => {\n                          const list = serviceTypes.filter(st => st.id !== '');\n                          const currentTypeId = form.getValues('service_type_id');\n                          const inList = list.some(st => String(st.id) === String(currentTypeId));\n                          const unique = uniqueById(list);\n                          const items = unique.map((st: any) => (\n                            <SelectItem key={String(st.id)} value={String(st.id)}>\n                              {st.name}\n                            </SelectItem>\n                          ));\n                          if (currentTypeId && !inList) {\n                            const labelFromList = serviceTypes.find(st => String(st.id) === String(currentTypeId))?.name;\n                            const fallbackLabel = labelFromList || (selectedServiceType ? selectedServiceType : 'Selected Service Type');\n                            items.unshift(\n                              <SelectItem key={`fallback-service-type-${String(currentTypeId)}`} value={String(currentTypeId)}>\n                                {fallbackLabel}\n                              </SelectItem>\n                            );\n                          }\n                          if (items.length > 0) return items;\n                          return (\n                            <SelectItem disabled value=\"__no_service_types__\">\n                              No service types available\n                            </SelectItem>\n                          );\n                        })()}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"service_id\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Service</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value} disabled={!selectedServiceType && !field.value}>\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a service\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {(() => {\n                          const currentServiceId = form.getValues('service_id');\n                          const inList = filteredServices.some((s) => String(s.id) === String(currentServiceId));\n                          const unique = uniqueById(filteredServices);\n                          const items = unique.map((service: any) => (\n                            <SelectItem key={String(service.id)} value={String(service.id)}>\n                              {service.service_name}\n                            </SelectItem>\n                          ));\n                          // Add a fallback item for the saved selection when not present in the filtered list\n                          if (currentServiceId && !inList) {\n                            const existing = services.find((s: any) => String(s.id) === String(currentServiceId));\n                            const label = resolvedServiceLabels[String(currentServiceId)] || existing?.service_name || 'Selected Service';\n                            items.unshift(\n                              <SelectItem key={`fallback-service-${String(currentServiceId)}`} value={String(currentServiceId)}>\n                                {label}\n                              </SelectItem>\n                            );\n                          }\n                          if (items.length > 0) return items;\n                          return (\n                            <div className=\"p-4 text-sm text-gray-500\">\n                              {selectedServiceType\n                                ? 'No services found for this service type.'\n                                : 'Please select a service type first.'}\n                            </div>\n                          );\n                        })()}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"trade_direction\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Import/Export</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select direction\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"import\">Import</SelectItem>\n                        <SelectItem value=\"export\">Export</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\n              <FormField\n                control={form.control}\n                name=\"origin_port_id\"\n                render={({ field }) => (\n                  <FormItem className=\"hidden\">\n                    <FormLabel>Origin Port/Location</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select origin\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {uniqueById(ports).map((port) => (\n                          <SelectItem key={String(port.id)} value={String(port.id)}>\n                            {port.location_name} ({port.location_code || 'N/A'})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"destination_port_id\"\n                render={({ field }) => (\n                  <FormItem className=\"hidden\">\n                    <FormLabel>Destination Port/Location</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select destination\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {uniqueById(ports).map((port) => (\n                          <SelectItem key={String(port.id)} value={String(port.id)}>\n                            {port.location_name} ({port.location_code || 'N/A'})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"carrier_id\"\n                render={({ field }) => (\n                  <FormItem className=\"hidden\">\n                    <FormLabel>Carrier</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select carrier\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {/* Ensure currently selected carrier appears even if list is filtered out or still loading */}\n                        {field.value && !carriers.some((c: any) => String(c.id) === String(field.value)) && (\n                          <SelectItem key={`selected-carrier-${field.value}`} value={String(field.value)}>\n                            {formatCarrierName(resolvedCarrierLabels[String(field.value)] || 'Selected Carrier')}\n                          </SelectItem>\n                        )}\n                        {uniqueByCarrierName(uniqueById(carriers), resolvedTenantId || context.tenantId || roles?.[0]?.tenant_id).map((carrier) => (\n                          <SelectItem key={carrier.id} value={String(carrier.id)}>\n                            {formatCarrierName(carrier.carrier_name)}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Fourth column: Capture Carrier Rates label and button/dialog */}\n              <div className=\"space-y-2\">\n                <FormLabel>Capture Carrier Rates</FormLabel>\n                <Dialog\n                  onOpenChange={async (open) => {\n                    try {\n                      if (!open) return;\n                      if (!quoteId) {\n                        toast.error('Save the quote before capturing rates');\n                        return;\n                      }\n                      const { data: existing } = await supabase\n                        .from('quotation_versions')\n                        .select('id, version_number')\n                        .eq('quote_id', quoteId)\n                        .order('version_number', { ascending: false })\n                        .limit(1);\n                      if (Array.isArray(existing) && existing.length && existing[0]?.id) {\n                        setComposerVersionId(String(existing[0].id));\n                      } else {\n                        let finalTenantId = resolvedTenantId || context.tenantId || roles?.[0]?.tenant_id || null;\n                        // Fallback: resolve tenant from the quote row when context is missing\n                        if (!finalTenantId) {\n                          try {\n                            const { data: qRow } = await supabase\n                              .from('quotes')\n                              .select('tenant_id')\n                              .eq('id', quoteId)\n                              .maybeSingle();\n                            finalTenantId = (qRow as any)?.tenant_id ?? null;\n                          } catch {}\n                        }\n                        // Last fallback: use authenticated user's tenant_id from metadata\n                        if (!finalTenantId) {\n                          try {\n                            const { data: { user } } = await supabase.auth.getUser();\n                            finalTenantId = (user as any)?.user_metadata?.tenant_id ?? null;\n                          } catch {}\n                        }\n                        if (!finalTenantId) {\n                          toast.error('Missing tenant context');\n                          return;\n                        }\n                        const { data: v } = await supabase\n                          .from('quotation_versions')\n                          .insert({ quote_id: quoteId, tenant_id: finalTenantId, version_number: 1 })\n                          .select('id')\n                          .single();\n                        if (v?.id) setComposerVersionId(String(v.id));\n                      }\n                      if (carrierQuotes.length === 0) {\n                        const rows = await listCarrierRatesForQuote(quoteId, supabase as any);\n                        const mapped = (rows || []).map((r: any) => ({\n                          carrier_rate_id: String(r.id),\n                          carrier_id: String(r.carrier_id),\n                          mode: r.mode || selectedServiceType || undefined,\n                          buying_charges: (r.charges || []).map((c: any) => ({\n                            type: (() => {\n                              const ct = String(c.charge_type || '').toUpperCase();\n                              if (ct === 'AFT' || ct === 'OFT') return 'freight';\n                              if (ct === 'BAF') return 'fuel';\n                              if (ct === 'THC') return 'handling';\n                              if (ct === 'DOC') return 'documentation';\n                              if (ct === 'ISF' || ct === 'AMS' || ct === 'ISPS') return 'customs';\n                              return 'other';\n                            })(),\n                            amount: Number(c.amount || 0),\n                            currency: c.currency || 'USD',\n                            note: c.notes || undefined,\n                            basis: c.basis || undefined,\n                            quantity: c.quantity ?? 1,\n                          })),\n                          selling_charges: [],\n                        }));\n                        if (debugHydration) {\n                          try {\n                            console.debug('[modal:rates] auto-hydrate on open', { quoteId, rows: (rows || []).length, mapped: mapped.length });\n                          } catch {}\n                        }\n                        setCarrierQuotes(mapped);\n                        setExistingRateIds((rows || []).map((r: any) => String(r.id)));\n                      }\n                    } catch (e: any) {\n                      console.warn('Prepare composer & hydrate rates failed', e);\n                    }\n                  }}\n                >\n                  <DialogTrigger asChild>\n                    <Button\n                      type=\"button\"\n                      variant=\"default\"\n                      size=\"lg\"\n                      className=\"w-full md:w-auto font-semibold shadow-lg ring-4 ring-primary/70 animate-pulse\"\n                    >\n                      {/* Using an icon to emphasize action */}\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"h-4 w-4 mr-2\">\n                        <rect width=\"18\" height=\"14\" x=\"3\" y=\"5\" rx=\"2\" ry=\"2\"></rect>\n                        <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n                      </svg>\n                      Capture Carrier Rates\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent className=\"sm:max-w-6xl max-h-[85vh] overflow-y-auto\">\n                    <DialogHeader>\n                      <DialogTitle>Quotation Composer</DialogTitle>\n                    </DialogHeader>\n                    {quoteId && composerVersionId ? (\n                      <MultiModalQuoteComposer quoteId={quoteId} versionId={composerVersionId} />\n                    ) : (\n                      <div className=\"p-4 text-sm text-muted-foreground\">Preparing composer...</div>\n                    )}\n                    <div className=\"hidden\">\n                      <CarrierQuotesSection\n                        carriers={carriers}\n                        selectedServiceType={selectedServiceType}\n                        carrierQuotes={carrierQuotes}\n                        setCarrierQuotes={setCarrierQuotes}\n                        onSave={async () => {}}\n                        onReload={async () => {}}\n                      />\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </div>\n\n            </div>\n\n            <div className=\"ef-grid\">\n\n            </div>\n\n            <div className=\"ef-grid\">\n\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-2\">\n\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Carrier quotations moved into dialog opened by the Carrier Rates button above */}\n\n        <div className=\"ef-divider\" />\n        <Card className=\"ef-card\">\n          <CardHeader className=\"ef-header\">\n            <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2\">\n              <CardTitle className=\"ef-title\">Line Items</CardTitle>\n              <Button type=\"button\" onClick={addItem} size=\"sm\" className=\"ef-hover\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Item\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-1\">\n            {items.map((item, index) => (\n              <div key={index} className=\"border rounded-lg p-2 space-y-1\">\n                <div className=\"flex justify-between items-start\">\n                  <span className=\"font-medium\">Item {index + 1}</span>\n                  {items.length > 1 && (\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => removeItem(index)}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n                <div className=\"grid grid-cols-1 lg:grid-cols-8 gap-2 items-end\">\n                  <Input\n                    placeholder=\"Product Name\"\n                    value={item.product_name}\n                    onChange={(e) => updateItem(index, 'product_name', e.target.value)}\n                  />\n                  <Input\n                    placeholder=\"Description\"\n                    value={item.description || ''}\n                    onChange={(e) => updateItem(index, 'description', e.target.value)}\n                  />\n                  <Input\n                    className=\"min-w-[2ch]\"\n                    type=\"number\"\n                    placeholder=\"Quantity\"\n                    value={item.quantity}\n                    onChange={(e) => updateItem(index, 'quantity', parseFloat(e.target.value) || 0)}\n                  />\n                  {selectedServiceType === 'ocean' && (\n                    <>\n                      <div>\n                        <FormLabel>Container Category</FormLabel>\n                        <Select\n                          value={item.package_category_id || ''}\n                          onValueChange={(v) => updateItem(index, 'package_category_id', v)}\n                        >\n                          <FormControl>\n                            <SelectTrigger className=\"w-full\">\n                              <SelectValue placeholder=\"Select category\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {item.package_category_id && !packageCategories.some((cat) => String(cat.id) === String(item.package_category_id)) && (\n                              <SelectItem key={`fallback-cat-${index}`} value={String(item.package_category_id)}>\n                                {resolvedPackageCategoryLabels[String(item.package_category_id)] || 'Selected Category'}\n                              </SelectItem>\n                            )}\n                            {packageCategories.length === 0 && (\n                              <SelectItem disabled value=\"__no_categories__\">No categories found</SelectItem>\n                            )}\n                            {uniqueById(packageCategories).map((cat: any) => (\n                              <SelectItem key={String(cat.id)} value={String(cat.id)}>\n                                {cat.category_name || 'Category'}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div>\n                        <FormLabel>Container Size</FormLabel>\n                        <Select\n                          value={item.package_size_id || ''}\n                          onValueChange={(v) => updateItem(index, 'package_size_id', v)}\n                        >\n                          <FormControl>\n                            <SelectTrigger className=\"w-full\">\n                              <SelectValue placeholder=\"Select size\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {item.package_size_id && !packageSizes.some((sz) => String(sz.id) === String(item.package_size_id)) && (\n                              <SelectItem key={`fallback-size-${index}`} value={String(item.package_size_id)}>\n                                {resolvedPackageSizeLabels[String(item.package_size_id)] || 'Selected Size'}\n                              </SelectItem>\n                            )}\n                            {packageSizes.length === 0 && (\n                              <SelectItem disabled value=\"__no_sizes__\">No sizes found</SelectItem>\n                            )}\n                            {uniqueById(packageSizes).map((sz: any) => (\n                              <SelectItem key={String(sz.id)} value={String(sz.id)}>\n                                {(sz.size_name || 'Size') + (sz.size_code ? ` (${sz.size_code})` : '')}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </>\n                  )}\n                  <Input\n                    className=\"min-w-[5ch]\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    placeholder=\"Unit Price\"\n                    value={item.unit_price}\n                    onChange={(e) => updateItem(index, 'unit_price', parseFloat(e.target.value) || 0)}\n                  />\n                  <Input\n                    className=\"min-w-[3ch]\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    placeholder=\"Discount %\"\n                    value={item.discount_percent}\n                    onChange={(e) => updateItem(index, 'discount_percent', parseFloat(e.target.value) || 0)}\n                  />\n                  <div className=\"min-w-[5ch] flex items-center\">\n                    <span className=\"text-sm font-medium\">\n                      Total: ${(item.quantity * item.unit_price * (1 - item.discount_percent / 100)).toFixed(2)}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n\n\n\n        <Card className=\"ef-card\">\n          <CardHeader className=\"ef-header\">\n            <CardTitle className=\"ef-title\">Totals & Additional Details</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-1\">\n            <div className=\"ef-grid\">\n              <FormField\n                control={form.control}\n                name=\"tax_percent\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Tax %</FormLabel>\n                    <FormControl>\n                      <Input type=\"number\" step=\"0.01\" value={field.value ?? ''} onChange={field.onChange} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"shipping_amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Shipping Amount</FormLabel>\n                    <FormControl>\n                      <Input type=\"number\" step=\"0.01\" value={field.value ?? ''} onChange={field.onChange} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <div className=\"border-t pt-1 space-y-1\">\n              <div className=\"flex justify-between\">\n                <span>Subtotal:</span>\n                <span className=\"font-medium\">${calculateTotals().subtotal.toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Tax:</span>\n                <span className=\"font-medium\">${calculateTotals().taxAmount.toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Shipping:</span>\n                <span className=\"font-medium\">${parseFloat(form.watch('shipping_amount') || '0').toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between text-lg font-bold border-t pt-2\">\n                <span>Total:</span>\n                <span>${calculateTotals().total.toFixed(2)}</span>\n              </div>\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"terms_conditions\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Terms & Conditions</FormLabel>\n                  <FormControl>\n                    <Textarea value={field.value ?? ''} onChange={field.onChange} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"notes\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Notes</FormLabel>\n                  <FormControl>\n                    <Textarea value={field.value ?? ''} onChange={field.onChange} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </CardContent>\n        </Card>\n\n        <Card className=\"ef-card\">\n          <CardHeader className=\"ef-header\">\n            <CardTitle className=\"ef-title\">Additional Details</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-1\">\n            <div className=\"ef-grid\">\n              <FormField\n                control={form.control}\n                name=\"consignee_id\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Consignee</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select consignee\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {uniqueById(consignees).map((consignee) => (\n                          <SelectItem key={String(consignee.id)} value={String(consignee.id)}>\n                            {consignee.company_name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"incoterms\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Incoterms</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value ?? ''}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue placeholder=\"Select incoterms\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"FOB\">FOB - Free On Board</SelectItem>\n                        <SelectItem value=\"CIF\">CIF - Cost, Insurance & Freight</SelectItem>\n                        <SelectItem value=\"EXW\">EXW - Ex Works</SelectItem>\n                        <SelectItem value=\"FCA\">FCA - Free Carrier</SelectItem>\n                        <SelectItem value=\"CPT\">CPT - Carriage Paid To</SelectItem>\n                        <SelectItem value=\"CIP\">CIP - Carriage & Insurance Paid</SelectItem>\n                        <SelectItem value=\"DAP\">DAP - Delivered At Place</SelectItem>\n                        <SelectItem value=\"DDP\">DDP - Delivered Duty Paid</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"status\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Status</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger className=\"w-full\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"draft\">Draft</SelectItem>\n                        <SelectItem value=\"sent\">Sent</SelectItem>\n                        <SelectItem value=\"accepted\">Accepted</SelectItem>\n                        <SelectItem value=\"rejected\">Rejected</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Submit button removed from main form per request; actions moved to sticky panel */}\n\n        {/* Opportunity selection dialog */}\n        <OpportunitySelectDialogList\n          open={oppDialogOpen}\n          onOpenChange={setOppDialogOpen}\n          onSelect={handleSelectOpportunity}\n        />\n\n        {/* Account selection dialog */}\n        <AccountSelectDialogList\n          open={accDialogOpen}\n          onOpenChange={setAccDialogOpen}\n          onSelect={handleSelectAccount}\n        />\n\n        {/* Contact selection dialog */}\n        <ContactSelectDialogList\n          open={contactDialogOpen}\n          onOpenChange={setContactDialogOpen}\n          onSelect={handleSelectContact}\n        />\n\n        {/* Sticky actions handled globally via DashboardLayout sticky bar */}\n        \n        </fieldset>\n      </form>\n    </Form>\n    </div>\n  );\n}\n  // Helper to normalize service_type values for robust filtering\n  const canonicalType = (t: any) => {\n    const raw = String(t || '').trim().toLowerCase();\n    const map: Record<string, string> = {\n      ocean: 'ocean',\n      'ocean_freight': 'ocean',\n      sea: 'ocean',\n      'sea_freight': 'ocean',\n      air: 'air',\n      'air_freight': 'air',\n      trucking: 'trucking',\n      road: 'trucking',\n      courier: 'courier',\n      parcel: 'courier',\n      moving: 'moving',\n      'movers_packers': 'moving',\n      railway_transport: 'railway_transport',\n      rail: 'railway_transport',\n    };\n    return map[raw] || raw;\n  };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/VersionStatusSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/BasisConfigModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/ChargeRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/ChargesManagementStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/DeleteConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/HelpTooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/LegsConfigurationStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/QuotationWorkflowStepper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/QuoteDetailsStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/ReviewAndSaveStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/SaveProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/TransportModeSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/composer/ValidationFeedback.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/ApprovalWorkflow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/CustomerSelectionDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/OptionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/PDFGenerator.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2184,2187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2184,2187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2198,2201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2198,2201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2212,2215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2212,2215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { FileText, Loader2 } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { toast } from '@/components/ui/use-toast';\n\ninterface PDFGeneratorProps {\n  versionId: string;\n  versionNumber: number;\n  quoteId: string;\n}\n\nexport function PDFGenerator({ versionId, versionNumber, quoteId }: PDFGeneratorProps) {\n  const [generating, setGenerating] = useState(false);\n\n  const generatePDF = async () => {\n    setGenerating(true);\n    try {\n      // Fetch version details with options\n      const { data: version, error: vErr } = await supabase\n        .from('quotation_versions')\n        .select('*')\n        .eq('id', versionId)\n        .single();\n\n      if (vErr) throw vErr;\n\n      const { data: quote, error: qErr } = await supabase\n        .from('quotes')\n        .select('*, accounts(*)')\n        .eq('id', quoteId)\n        .single();\n\n      if (qErr) throw qErr;\n\n      const { data: options, error: oErr } = await supabase\n        .from('quotation_version_options')\n        .select(`\n          *,\n          carrier_rates(carrier_name, currency),\n          quotation_version_option_legs(\n            *,\n            quote_charges(*)\n          )\n        `)\n        .eq('quotation_version_id', versionId);\n\n      if (oErr) throw oErr;\n\n      // Generate PDF content\n      const pdfContent = generatePDFContent(quote, version, options || []);\n      \n      // Create a simple HTML-based PDF using window.print\n      const printWindow = window.open('', '_blank');\n      if (printWindow) {\n        printWindow.document.write(pdfContent);\n        printWindow.document.close();\n        printWindow.focus();\n        printWindow.print();\n      }\n\n      toast({\n        title: 'PDF Generated',\n        description: 'Quote PDF has been opened for printing',\n      });\n    } catch (error) {\n      console.error('Failed to generate PDF:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to generate PDF',\n        variant: 'destructive',\n      });\n    } finally {\n      setGenerating(false);\n    }\n  };\n\n  const generatePDFContent = (quote: any, version: any, options: any[]) => {\n    const account = quote.accounts || {};\n    \n    return `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Quote #${quote.quote_number} - Version ${versionNumber}</title>\n        <style>\n          body {\n            font-family: Arial, sans-serif;\n            margin: 40px;\n            color: #333;\n          }\n          .header {\n            border-bottom: 3px solid #333;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .header h1 {\n            margin: 0;\n            color: #2563eb;\n          }\n          .section {\n            margin-bottom: 30px;\n          }\n          .section h2 {\n            background: #f3f4f6;\n            padding: 10px;\n            margin: 0 0 15px 0;\n          }\n          .info-row {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px 0;\n            border-bottom: 1px solid #e5e7eb;\n          }\n          .option {\n            border: 2px solid #e5e7eb;\n            border-radius: 8px;\n            padding: 20px;\n            margin-bottom: 20px;\n            page-break-inside: avoid;\n          }\n          .option-header {\n            background: #3b82f6;\n            color: white;\n            padding: 10px 15px;\n            margin: -20px -20px 20px -20px;\n            border-radius: 6px 6px 0 0;\n            font-size: 18px;\n            font-weight: bold;\n          }\n          .pricing {\n            background: #f9fafb;\n            padding: 15px;\n            border-radius: 6px;\n            margin-top: 15px;\n          }\n          .pricing-row {\n            display: flex;\n            justify-content: space-between;\n            padding: 5px 0;\n          }\n          .total {\n            font-size: 20px;\n            font-weight: bold;\n            color: #2563eb;\n            border-top: 2px solid #333;\n            padding-top: 10px;\n            margin-top: 10px;\n          }\n          @media print {\n            body { margin: 20px; }\n            .no-print { display: none; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"header\">\n          <h1>Quotation</h1>\n          <div style=\"display: flex; justify-content: space-between; margin-top: 10px;\">\n            <div>\n              <strong>Quote #:</strong> ${quote.quote_number}<br>\n              <strong>Version:</strong> ${versionNumber} (${version.kind})\n            </div>\n            <div style=\"text-align: right;\">\n              <strong>Date:</strong> ${new Date(version.created_at).toLocaleDateString()}<br>\n              <strong>Status:</strong> ${version.status || 'Draft'}\n            </div>\n          </div>\n        </div>\n\n        <div class=\"section\">\n          <h2>Customer Information</h2>\n          <div class=\"info-row\">\n            <span><strong>Company:</strong></span>\n            <span>${account.name || 'N/A'}</span>\n          </div>\n          ${account.email ? `\n          <div class=\"info-row\">\n            <span><strong>Email:</strong></span>\n            <span>${account.email}</span>\n          </div>` : ''}\n          ${account.phone ? `\n          <div class=\"info-row\">\n            <span><strong>Phone:</strong></span>\n            <span>${account.phone}</span>\n          </div>` : ''}\n        </div>\n\n        <div class=\"section\">\n          <h2>Quote Options</h2>\n          ${options.map((option, index) => `\n            <div class=\"option\">\n              <div class=\"option-header\">\n                Option ${String.fromCharCode(65 + index)}: ${option.option_name || option.carrier_rates?.carrier_name || 'Unknown'}\n              </div>\n              \n              <div class=\"pricing\">\n                ${option.total_buy !== null ? `\n                <div class=\"pricing-row\">\n                  <span>Cost:</span>\n                  <span>${option.carrier_rates?.currency || 'USD'} ${Number(option.total_buy).toLocaleString('en-US', { minimumFractionDigits: 2 })}</span>\n                </div>` : ''}\n                \n                <div class=\"pricing-row total\">\n                  <span>Total Price:</span>\n                  <span>${option.carrier_rates?.currency || 'USD'} ${Number(option.total_sell || option.total_amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}</span>\n                </div>\n                \n                ${option.margin_amount !== null ? `\n                <div class=\"pricing-row\" style=\"color: #059669; font-weight: 600;\">\n                  <span>Margin:</span>\n                  <span>${option.carrier_rates?.currency || 'USD'} ${Number(option.margin_amount).toLocaleString('en-US', { minimumFractionDigits: 2 })} (${Number(option.margin_percentage).toFixed(1)}%)</span>\n                </div>` : ''}\n                \n                ${option.transit_time_days ? `\n                <div class=\"pricing-row\">\n                  <span>Transit Time:</span>\n                  <span>${option.transit_time_days} days</span>\n                </div>` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n\n        <div class=\"section\">\n          <p style=\"font-size: 12px; color: #6b7280; margin-top: 40px; border-top: 1px solid #e5e7eb; padding-top: 20px;\">\n            This quotation is valid for 30 days from the date of issue. Terms and conditions apply.\n          </p>\n        </div>\n      </body>\n      </html>\n    `;\n  };\n\n  return (\n    <Button\n      size=\"sm\"\n      variant=\"outline\"\n      onClick={generatePDF}\n      disabled={generating}\n    >\n      {generating ? (\n        <Loader2 className=\"w-4 h-4 mr-1 animate-spin\" />\n      ) : (\n        <FileText className=\"w-4 h-4 mr-1\" />\n      )}\n      Generate PDF\n    </Button>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/VersionActions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/VersionCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3601,3604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3601,3604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Clock, Trash2, Plus, CheckCircle, GitCompare, FileText } from 'lucide-react';\nimport { VersionStatusSelector } from '../VersionStatusSelector';\nimport { OptionCard } from './OptionCard';\nimport { ApprovalWorkflow } from './ApprovalWorkflow';\nimport { PDFGenerator } from './PDFGenerator';\n\ninterface Option {\n  id: string;\n  quotation_version_id: string;\n  option_name?: string | null;\n  carrier_name: string;\n  total_amount: number;\n  currency: string;\n  transit_time_days: number | null;\n  total_buy?: number;\n  total_sell?: number;\n  margin_amount?: number;\n  margin_percentage?: number;\n}\n\ninterface Version {\n  id: string;\n  quote_id: string;\n  version_number: number;\n  kind: 'minor' | 'major';\n  status: string | null;\n  created_at: string;\n  is_current?: boolean;\n}\n\ninterface VersionCardProps {\n  version: Version;\n  options: Option[];\n  quoteId: string;\n  onCreateOption: (versionId: string) => void;\n  onEditOption: (versionId: string, optionId: string) => void;\n  onSelectOption: (versionId: string, optionId: string) => void;\n  onDeleteVersion: (versionId: string) => void;\n  onSetCurrent: (versionId: string) => void;\n  onStatusChange: () => void;\n  onCompare?: (versionId: string) => void;\n  loading: boolean;\n}\n\nexport function VersionCard({\n  version,\n  options,\n  quoteId,\n  onCreateOption,\n  onEditOption,\n  onSelectOption,\n  onDeleteVersion,\n  onSetCurrent,\n  onStatusChange,\n  onCompare,\n  loading,\n}: VersionCardProps) {\n  const formattedDate = new Date(version.created_at).toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n\n  return (\n    <Card className=\"hover:shadow-md transition-shadow\">\n      <CardContent className=\"p-6\">\n        {/* Version Header */}\n        <div className=\"flex items-start justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <div>\n              <div className=\"flex items-center gap-2 mb-1\">\n                <h3 className=\"font-semibold text-lg\">\n                  Version {version.version_number}\n                </h3>\n                <Badge variant={version.kind === 'major' ? 'default' : 'secondary'}>\n                  {version.kind}\n                </Badge>\n                {version.is_current && (\n                  <Badge variant=\"outline\" className=\"bg-primary/10 text-primary border-primary/20\">\n                    <CheckCircle className=\"w-3 h-3 mr-1\" />\n                    Current\n                  </Badge>\n                )}\n              </div>\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Clock className=\"w-3 h-3\" />\n                {formattedDate}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <PDFGenerator\n              versionId={version.id}\n              versionNumber={version.version_number}\n              quoteId={quoteId}\n            />\n            {onCompare && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => onCompare(version.id)}\n                disabled={loading}\n              >\n                <GitCompare className=\"w-4 h-4 mr-1\" />\n                Compare\n              </Button>\n            )}\n            <VersionStatusSelector\n              versionId={version.id}\n              currentStatus={(version.status as any) || 'draft'}\n              onStatusChange={onStatusChange}\n            />\n            {!version.is_current && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => onSetCurrent(version.id)}\n                disabled={loading}\n              >\n                Set as Current\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Options Section */}\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <h4 className=\"text-sm font-medium text-muted-foreground\">\n              Options ({options.length})\n            </h4>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => onCreateOption(version.id)}\n              disabled={loading}\n            >\n              <Plus className=\"w-4 h-4 mr-1\" />\n              Add Option\n            </Button>\n          </div>\n\n          {options.length > 0 ? (\n            <div className=\"grid gap-3\">\n              {options.map((option) => (\n                <OptionCard\n                  key={option.id}\n                  option={option}\n                  versionId={version.id}\n                  onEdit={onEditOption}\n                  onSelect={onSelectOption}\n                />\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8 bg-muted/30 rounded-lg border-2 border-dashed\">\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                No options created yet\n              </p>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => onCreateOption(version.id)}\n                disabled={loading}\n              >\n                <Plus className=\"w-4 h-4 mr-1\" />\n                Create First Option\n              </Button>\n            </div>\n          )}\n        </div>\n\n        {/* Delete Action */}\n        <div className=\"flex justify-end mt-4 pt-4 border-t\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => onDeleteVersion(version.id)}\n            disabled={loading}\n            className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n          >\n            <Trash2 className=\"w-4 h-4 mr-1\" />\n            Delete Version\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/sales/quotation-versions/VersionComparison.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadVersionData'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [loadVersionData, open, version1Id, version2Id]","fix":{"range":[1399,1429],"text":"[loadVersionData, open, version1Id, version2Id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2347,2350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2347,2350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2824,2827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2824,2827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Loader2, ArrowRight, TrendingUp, Clock } from 'lucide-react';\n\ninterface Version {\n  id: string;\n  version_number: number;\n  kind: string;\n  status: string | null;\n  created_at: string;\n}\n\ninterface Option {\n  id: string;\n  option_name: string | null;\n  carrier_name: string;\n  total_amount: number;\n  currency: string;\n  total_buy?: number;\n  total_sell?: number;\n  margin_amount?: number;\n  margin_percentage?: number;\n  transit_time_days: number | null;\n}\n\ninterface VersionComparisonProps {\n  open: boolean;\n  onClose: () => void;\n  version1Id: string;\n  version2Id: string;\n}\n\nexport function VersionComparison({ open, onClose, version1Id, version2Id }: VersionComparisonProps) {\n  const [loading, setLoading] = useState(false);\n  const [version1, setVersion1] = useState<Version | null>(null);\n  const [version2, setVersion2] = useState<Version | null>(null);\n  const [options1, setOptions1] = useState<Option[]>([]);\n  const [options2, setOptions2] = useState<Option[]>([]);\n\n  useEffect(() => {\n    if (open && version1Id && version2Id) {\n      loadVersionData();\n    }\n  }, [open, version1Id, version2Id]);\n\n  const loadVersionData = async () => {\n    setLoading(true);\n    try {\n      // Load both versions\n      const { data: v1 } = await supabase\n        .from('quotation_versions')\n        .select('*')\n        .eq('id', version1Id)\n        .single();\n\n      const { data: v2 } = await supabase\n        .from('quotation_versions')\n        .select('*')\n        .eq('id', version2Id)\n        .single();\n\n      setVersion1(v1);\n      setVersion2(v2);\n\n      // Load options for both versions\n      const { data: opts1 } = await supabase\n        .from('quotation_version_options')\n        .select('*, carrier_rates(carrier_name, currency)')\n        .eq('quotation_version_id', version1Id);\n\n      const { data: opts2 } = await supabase\n        .from('quotation_version_options')\n        .select('*, carrier_rates(carrier_name, currency)')\n        .eq('quotation_version_id', version2Id);\n\n      setOptions1(opts1?.map((o: any) => ({\n        id: o.id,\n        option_name: o.option_name,\n        carrier_name: o.carrier_rates?.carrier_name || 'Unknown',\n        total_amount: o.total_amount,\n        currency: o.carrier_rates?.currency || 'USD',\n        total_buy: o.total_buy,\n        total_sell: o.total_sell,\n        margin_amount: o.margin_amount,\n        margin_percentage: o.margin_percentage,\n        transit_time_days: o.transit_time_days,\n      })) || []);\n\n      setOptions2(opts2?.map((o: any) => ({\n        id: o.id,\n        option_name: o.option_name,\n        carrier_name: o.carrier_rates?.carrier_name || 'Unknown',\n        total_amount: o.total_amount,\n        currency: o.carrier_rates?.currency || 'USD',\n        total_buy: o.total_buy,\n        total_sell: o.total_sell,\n        margin_amount: o.margin_amount,\n        margin_percentage: o.margin_percentage,\n        transit_time_days: o.transit_time_days,\n      })) || []);\n    } catch (error) {\n      console.error('Failed to load comparison data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const VersionColumn = ({ version, options }: { version: Version | null; options: Option[] }) => (\n    <div className=\"flex-1 space-y-4\">\n      {version && (\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <h3 className=\"font-semibold\">Version {version.version_number}</h3>\n              <Badge variant={version.kind === 'major' ? 'default' : 'secondary'}>\n                {version.kind}\n              </Badge>\n              <Badge variant=\"outline\">{version.status || 'draft'}</Badge>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              Created: {new Date(version.created_at).toLocaleDateString()}\n            </p>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"space-y-3\">\n        <h4 className=\"text-sm font-medium\">Options ({options.length})</h4>\n        {options.map((option) => (\n          <Card key={option.id} className=\"hover:shadow-sm transition-shadow\">\n            <CardContent className=\"p-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <Badge variant=\"outline\" className=\"font-medium\">\n                    {option.option_name || option.carrier_name}\n                  </Badge>\n                  {option.transit_time_days && (\n                    <span className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                      <Clock className=\"w-3 h-3\" />\n                      {option.transit_time_days} days\n                    </span>\n                  )}\n                </div>\n                <div className=\"text-sm space-y-1\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Total:</span>\n                    <span className=\"font-semibold\">\n                      {option.currency} {Number(option.total_amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}\n                    </span>\n                  </div>\n                  {option.margin_amount !== undefined && (\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground flex items-center gap-1\">\n                        <TrendingUp className=\"w-3 h-3\" />\n                        Margin:\n                      </span>\n                      <span className=\"font-medium text-primary\">\n                        {option.currency} {Number(option.margin_amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}\n                        <span className=\"text-xs ml-1\">({Number(option.margin_percentage).toFixed(1)}%)</span>\n                      </span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Version Comparison</DialogTitle>\n        </DialogHeader>\n\n        {loading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n          </div>\n        ) : (\n          <div className=\"flex gap-6\">\n            <VersionColumn version={version1} options={options1} />\n            <div className=\"flex items-center justify-center\">\n              <ArrowRight className=\"w-6 h-6 text-muted-foreground\" />\n            </div>\n            <VersionColumn version={version2} options={options2} />\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/subscription/PlanCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[464,467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[464,467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2882,2885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2882,2885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Check } from 'lucide-react';\n\ninterface PlanCardProps {\n  plan: {\n    id: string;\n    name: string;\n    slug: string;\n    description: string | null;\n    price_monthly: number;\n    price_annual: number | null;\n    tier: string | null;\n    features: any;\n    billing_period: string;\n    is_active: boolean;\n  };\n  isCurrentPlan?: boolean;\n  onSelect?: (planId: string) => void;\n  showActions?: boolean;\n}\n\nexport function PlanCard({ plan, isCurrentPlan, onSelect, showActions = true }: PlanCardProps) {\n  const features = Array.isArray(plan.features) ? plan.features : [];\n  const displayPrice = plan.billing_period === 'annual' && plan.price_annual \n    ? plan.price_annual \n    : plan.price_monthly;\n\n  const getTierColor = (tier: string | null) => {\n    const colors: Record<string, string> = {\n      starter: 'bg-blue-500/10 text-blue-500',\n      professional: 'bg-purple-500/10 text-purple-500',\n      business: 'bg-orange-500/10 text-orange-500',\n      enterprise: 'bg-green-500/10 text-green-500',\n    };\n    return tier ? colors[tier.toLowerCase()] || 'bg-gray-500/10 text-gray-500' : 'bg-gray-500/10 text-gray-500';\n  };\n\n  return (\n    <Card className={`relative ${isCurrentPlan ? 'border-primary shadow-lg' : ''}`}>\n      {isCurrentPlan && (\n        <div className=\"absolute -top-3 left-1/2 transform -translate-x-1/2\">\n          <Badge className=\"bg-primary\">Current Plan</Badge>\n        </div>\n      )}\n      \n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <CardTitle>{plan.name}</CardTitle>\n            {plan.tier && (\n              <Badge variant=\"outline\" className={getTierColor(plan.tier)}>\n                {plan.tier}\n              </Badge>\n            )}\n          </div>\n        </div>\n        {plan.description && (\n          <CardDescription className=\"mt-2\">{plan.description}</CardDescription>\n        )}\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        <div className=\"flex items-baseline gap-1\">\n          <span className=\"text-4xl font-bold\">${displayPrice}</span>\n          <span className=\"text-muted-foreground\">\n            /{plan.billing_period === 'annual' ? 'year' : 'month'}\n          </span>\n        </div>\n\n        {plan.price_annual && plan.billing_period === 'monthly' && (\n          <p className=\"text-sm text-muted-foreground\">\n            Save 20% with annual billing (${plan.price_annual}/year)\n          </p>\n        )}\n\n        <div className=\"space-y-2\">\n          <p className=\"text-sm font-semibold\">Features:</p>\n          {features.length > 0 ? (\n            <ul className=\"space-y-2\">\n              {features.slice(0, 5).map((feature: any, index: number) => {\n                const featureName = typeof feature === 'string' ? feature : feature.name || feature.key;\n                return (\n                  <li key={index} className=\"flex items-start gap-2 text-sm\">\n                    <Check className=\"h-4 w-4 text-primary shrink-0 mt-0.5\" />\n                    <span>{featureName}</span>\n                  </li>\n                );\n              })}\n              {features.length > 5 && (\n                <li className=\"text-sm text-muted-foreground\">\n                  +{features.length - 5} more features\n                </li>\n              )}\n            </ul>\n          ) : (\n            <p className=\"text-sm text-muted-foreground\">No features listed</p>\n          )}\n        </div>\n      </CardContent>\n\n      {showActions && (\n        <CardFooter>\n          {isCurrentPlan ? (\n            <Button variant=\"outline\" className=\"w-full\" disabled>\n              Current Plan\n            </Button>\n          ) : (\n            <Button \n              className=\"w-full\" \n              onClick={() => onSelect?.(plan.id)}\n              disabled={!plan.is_active}\n            >\n              {plan.is_active ? 'Select Plan' : 'Unavailable'}\n            </Button>\n          )}\n        </CardFooter>\n      )}\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/subscription/UsageMetrics.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchUsage'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUsage, tenantId]","fix":{"range":[823,833],"text":"[fetchUsage, tenantId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { Badge } from '@/components/ui/badge';\nimport { AlertCircle } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ninterface UsageRecord {\n  feature_key: string;\n  usage_count: number;\n  limit_count: number | null;\n  period_start: string;\n  period_end: string;\n}\n\ninterface UsageMetricsProps {\n  tenantId: string;\n}\n\nexport function UsageMetrics({ tenantId }: UsageMetricsProps) {\n  const [usageRecords, setUsageRecords] = useState<UsageRecord[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { supabase } = useCRM();\n\n  useEffect(() => {\n    fetchUsage();\n  }, [tenantId]);\n\n  const fetchUsage = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('usage_records')\n        .select('*')\n        .eq('tenant_id', tenantId)\n        .gte('period_end', new Date().toISOString())\n        .order('feature_key');\n\n      if (error) throw error;\n      setUsageRecords(data || []);\n    } catch (error: any) {\n      toast.error('Failed to load usage data');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getUsagePercentage = (usage: number, limit: number | null) => {\n    if (!limit) return 0;\n    return Math.min((usage / limit) * 100, 100);\n  };\n\n  const getUsageStatus = (usage: number, limit: number | null) => {\n    if (!limit) return 'unlimited';\n    const percentage = (usage / limit) * 100;\n    if (percentage >= 90) return 'critical';\n    if (percentage >= 75) return 'warning';\n    return 'normal';\n  };\n\n  const formatFeatureName = (key: string) => {\n    return key\n      .split('_')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"py-8 text-center\">\n          <p className=\"text-muted-foreground\">Loading usage data...</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Usage Metrics</CardTitle>\n        <CardDescription>Current billing period usage</CardDescription>\n      </CardHeader>\n      <CardContent>\n        {usageRecords.length === 0 ? (\n          <p className=\"text-sm text-muted-foreground text-center py-4\">\n            No usage data available for this period\n          </p>\n        ) : (\n          <div className=\"space-y-6\">\n            {usageRecords.map((record) => {\n              const status = getUsageStatus(record.usage_count, record.limit_count);\n              const percentage = getUsagePercentage(record.usage_count, record.limit_count);\n\n              return (\n                <div key={record.feature_key} className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm font-medium\">\n                        {formatFeatureName(record.feature_key)}\n                      </p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {record.usage_count} / {record.limit_count || ''}\n                        {record.limit_count ? ' used' : ' (unlimited)'}\n                      </p>\n                    </div>\n                    {status === 'critical' && (\n                      <Badge variant=\"destructive\" className=\"gap-1\">\n                        <AlertCircle className=\"h-3 w-3\" />\n                        Limit Reached\n                      </Badge>\n                    )}\n                    {status === 'warning' && (\n                      <Badge variant=\"outline\" className=\"gap-1 border-yellow-500 text-yellow-500\">\n                        <AlertCircle className=\"h-3 w-3\" />\n                        Near Limit\n                      </Badge>\n                    )}\n                  </div>\n                  {record.limit_count && (\n                    <Progress \n                      value={percentage} \n                      className={\n                        status === 'critical' \n                          ? '[&>div]:bg-red-500' \n                          : status === 'warning' \n                          ? '[&>div]:bg-yellow-500' \n                          : ''\n                      }\n                    />\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/testing/QuotationTestRunner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/ActionsToolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/StickyActionsBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/app-launcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":31,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":31,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default: \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive: \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        success: \"border-transparent bg-success text-success-foreground hover:bg-success/80\",\n        warning: \"border-transparent bg-warning text-warning-foreground hover:bg-warning/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nexport interface BadgeProps extends React.HTMLAttributes<HTMLDivElement>, VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return <div className={cn(badgeVariants({ variant }), className)} {...props} />;\n}\n\nexport { Badge, badgeVariants };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":48,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":48,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground shadow-sm hover:bg-primary/90 hover:shadow-md active:scale-[0.98]\",\n        destructive: \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90 hover:shadow-md active:scale-[0.98]\",\n        outline: \"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-accent-foreground/20\",\n        secondary: \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80 hover:shadow-md active:scale-[0.98]\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n        brand: \"bg-[hsl(211,100%,43%)] text-white shadow-sm hover:bg-[hsl(211,100%,38%)] hover:shadow-md active:scale-[0.98]\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-11 rounded-md px-8 text-base\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;\n  },\n);\nButton.displayName = \"Button\";\n\nexport { Button, buttonVariants };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/command.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":24,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":24,"endColumn":29,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[710,761],"text":"type CommandDialogProps = DialogProps"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\nimport { Command as CommandPrimitive } from \"cmdk\";\nimport { Search } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className,\n    )}\n    {...props}\n  />\n));\nCommand.displayName = CommandPrimitive.displayName;\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className,\n      )}\n      {...props}\n    />\n  </div>\n));\n\nCommandInput.displayName = CommandPrimitive.Input.displayName;\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n));\n\nCommandList.displayName = CommandPrimitive.List.displayName;\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className,\n    )}\n    {...props}\n  />\n));\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\n));\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\n      className,\n    )}\n    {...props}\n  />\n));\n\nCommandItem.displayName = CommandPrimitive.Item.displayName;\n\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\n};\nCommandShortcut.displayName = \"CommandShortcut\";\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/editable-text.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/empty-state.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":61,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":61,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { FileText, Search, Plus, Inbox, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\n\ninterface EmptyStateProps {\n  icon?: React.ComponentType<{ className?: string }>;\n  title: string;\n  description: string;\n  action?: {\n    label: string;\n    onClick: () => void;\n    icon?: React.ComponentType<{ className?: string }>;\n  };\n  secondaryAction?: {\n    label: string;\n    onClick: () => void;\n  };\n  variant?: \"default\" | \"search\" | \"error\";\n  className?: string;\n}\n\nexport function EmptyState({\n  icon: Icon = Inbox,\n  title,\n  description,\n  action,\n  secondaryAction,\n  variant = \"default\",\n  className,\n}: EmptyStateProps) {\n  const iconColor = variant === \"error\" ? \"text-destructive\" : \"text-muted-foreground\";\n\n  return (\n    <div className={cn(\"flex flex-col items-center justify-center py-12 px-4 text-center\", className)}>\n      <div className={cn(\"p-4 rounded-full bg-muted mb-4\", iconColor)}>\n        <Icon className=\"h-12 w-12\" />\n      </div>\n      <h3 className=\"text-lg font-semibold mb-2\">{title}</h3>\n      <p className=\"text-sm text-muted-foreground max-w-md mb-6\">{description}</p>\n      {(action || secondaryAction) && (\n        <div className=\"flex flex-col sm:flex-row gap-3\">\n          {action && (\n            <Button onClick={action.onClick} variant=\"brand\">\n              {action.icon && <action.icon className=\"mr-2 h-4 w-4\" />}\n              {action.label}\n            </Button>\n          )}\n          {secondaryAction && (\n            <Button onClick={secondaryAction.onClick} variant=\"outline\">\n              {secondaryAction.label}\n            </Button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Pre-configured empty states\nexport const emptyStates = {\n  noResults: (onClear?: () => void): EmptyStateProps => ({\n    icon: Search,\n    title: \"No results found\",\n    description: \"We couldn't find any items matching your search criteria. Try adjusting your filters.\",\n    variant: \"search\",\n    ...(onClear && {\n      action: {\n        label: \"Clear filters\",\n        onClick: onClear,\n      },\n    }),\n  }),\n\n  noItems: (itemName: string, onCreate?: () => void): EmptyStateProps => ({\n    icon: Inbox,\n    title: `No ${itemName} yet`,\n    description: `Get started by creating your first ${itemName.toLowerCase()}.`,\n    ...(onCreate && {\n      action: {\n        label: `Create ${itemName}`,\n        onClick: onCreate,\n        icon: Plus,\n      },\n    }),\n  }),\n\n  error: (message?: string, onRetry?: () => void): EmptyStateProps => ({\n    icon: AlertCircle,\n    title: \"Something went wrong\",\n    description: message || \"We encountered an error loading this data. Please try again.\",\n    variant: \"error\",\n    ...(onRetry && {\n      action: {\n        label: \"Try again\",\n        onClick: onRetry,\n      },\n    }),\n  }),\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/environment-indicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":129,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":129,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { Controller, ControllerProps, FieldPath, FieldValues, FormProvider, useFormContext } from \"react-hook-form\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Label } from \"@/components/ui/label\";\n\nconst Form = FormProvider;\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n> = {\n  name: TName;\n};\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  );\n};\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext);\n  const itemContext = React.useContext(FormItemContext);\n  const { getFieldState, formState } = useFormContext();\n\n  const fieldState = getFieldState(fieldContext.name, formState);\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\");\n  }\n\n  const { id } = itemContext;\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  };\n};\n\ntype FormItemContextValue = {\n  id: string;\n};\n\nconst FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);\n\nconst FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    const id = React.useId();\n\n    return (\n      <FormItemContext.Provider value={{ id }}>\n        <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n      </FormItemContext.Provider>\n    );\n  },\n);\nFormItem.displayName = \"FormItem\";\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField();\n\n  return <Label ref={ref} className={cn(error && \"text-destructive\", className)} htmlFor={formItemId} {...props} />;\n});\nFormLabel.displayName = \"FormLabel\";\n\nconst FormControl = React.forwardRef<React.ElementRef<typeof Slot>, React.ComponentPropsWithoutRef<typeof Slot>>(\n  ({ ...props }, ref) => {\n    const { error, formItemId, formDescriptionId, formMessageId } = useFormField();\n\n    return (\n      <Slot\n        ref={ref}\n        id={formItemId}\n        aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}\n        aria-invalid={!!error}\n        {...props}\n      />\n    );\n  },\n);\nFormControl.displayName = \"FormControl\";\n\nconst FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\n  ({ className, ...props }, ref) => {\n    const { formDescriptionId } = useFormField();\n\n    return <p ref={ref} id={formDescriptionId} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />;\n  },\n);\nFormDescription.displayName = \"FormDescription\";\n\nconst FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\n  ({ className, children, ...props }, ref) => {\n    const { error, formMessageId } = useFormField();\n    const body = error ? String(error?.message) : children;\n\n    if (!body) {\n      return null;\n    }\n\n    return (\n      <p ref={ref} id={formMessageId} className={cn(\"text-sm font-medium text-destructive\", className)} {...props}>\n        {body}\n      </p>\n    );\n  },\n);\nFormMessage.displayName = \"FormMessage\";\n\nexport { useFormField, Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/global-search.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/hsl-picker.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'l' is never reassigned. Use 'const' instead.","line":48,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":48,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\n\ntype HslPickerProps = {\n  label?: string;\n  value: string; // e.g., \"217 91% 60%\"\n  onChange: (v: string) => void;\n};\n\nfunction clamp(n: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, n));\n}\n\nfunction parseHslString(str: string) {\n  const parts = str.trim().split(/\\s+/);\n  const h = clamp(parseFloat(parts[0] ?? '0') || 0, 0, 360);\n  const s = clamp(parseFloat((parts[1] ?? '0').replace('%', '')) || 0, 0, 100);\n  const l = clamp(parseFloat((parts[2] ?? '0').replace('%', '')) || 0, 0, 100);\n  return { h, s, l };\n}\n\nfunction composeHslString(h: number, s: number, l: number) {\n  return `${Math.round(h)} ${Math.round(s)}% ${Math.round(l)}%`;\n}\n\nfunction hslToHexString(h: number, s: number, l: number) {\n  s = s / 100; l = l / 100;\n  const c = (1 - Math.abs(2 * l - 1)) * s;\n  const x = c * (1 - Math.abs(((h / 60) % 2) - 1));\n  const m = l - c / 2;\n  let r = 0, g = 0, b = 0;\n  if (0 <= h && h < 60) { r = c; g = x; b = 0; }\n  else if (60 <= h && h < 120) { r = x; g = c; b = 0; }\n  else if (120 <= h && h < 180) { r = 0; g = c; b = x; }\n  else if (180 <= h && h < 240) { r = 0; g = x; b = c; }\n  else if (240 <= h && h < 300) { r = x; g = 0; b = c; }\n  else if (300 <= h && h < 360) { r = c; g = 0; b = x; }\n  const toHex = (v: number) => Math.round((v + m) * 255).toString(16).padStart(2, '0');\n  return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\n}\n\nfunction hexToHslString(hex: string) {\n  const r = parseInt(hex.slice(1, 3), 16) / 255;\n  const g = parseInt(hex.slice(3, 5), 16) / 255;\n  const b = parseInt(hex.slice(5, 7), 16) / 255;\n  const max = Math.max(r, g, b), min = Math.min(r, g, b);\n  let h = 0, s = 0, l = (max + min) / 2;\n  if (max !== min) {\n    const d = max - min;\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n    switch (max) {\n      case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n      case g: h = (b - r) / d + 2; break;\n      case b: h = (r - g) / d + 4; break;\n    }\n    h = h * 60;\n  }\n  return composeHslString(h, s * 100, l * 100);\n}\n\nexport function HslPicker({ label, value, onChange }: HslPickerProps) {\n  const { h, s, l } = useMemo(() => parseHslString(value), [value]);\n  const hex = useMemo(() => hslToHexString(h, s, l), [h, s, l]);\n\n  return (\n    <div className=\"space-y-2\">\n      {label && <Label className=\"text-sm\">{label} (HSL)</Label>}\n      <div className=\"flex items-center gap-2\">\n        <Label className=\"text-xs\">Pick</Label>\n        <Input type=\"color\" value={hex} onChange={(e) => onChange(hexToHslString(e.target.value))} />\n        <div className=\"h-6 w-6 rounded\" style={{ backgroundColor: hex }} />\n      </div>\n      <div className=\"space-y-1\">\n        <div className=\"grid grid-cols-5 items-center gap-2\">\n          <Label className=\"text-xs\">Hue</Label>\n          <input className=\"col-span-3\" type=\"range\" min={0} max={360} value={h} onChange={(e) => onChange(composeHslString(Number(e.target.value), s, l))} />\n          <Input className=\"text-xs\" type=\"number\" min={0} max={360} value={h} onChange={(e) => onChange(composeHslString(Number(e.target.value), s, l))} />\n        </div>\n        <div className=\"grid grid-cols-5 items-center gap-2\">\n          <Label className=\"text-xs\">Sat</Label>\n          <input className=\"col-span-3\" type=\"range\" min={0} max={100} value={s} onChange={(e) => onChange(composeHslString(h, Number(e.target.value), l))} />\n          <Input className=\"text-xs\" type=\"number\" min={0} max={100} value={s} onChange={(e) => onChange(composeHslString(h, Number(e.target.value), l))} />\n        </div>\n        <div className=\"grid grid-cols-5 items-center gap-2\">\n          <Label className=\"text-xs\">Light</Label>\n          <input className=\"col-span-3\" type=\"range\" min={0} max={100} value={l} onChange={(e) => onChange(composeHslString(h, s, Number(e.target.value))) } />\n          <Input className=\"text-xs\" type=\"number\" min={0} max={100} value={l} onChange={(e) => onChange(composeHslString(h, s, Number(e.target.value))) } />\n        </div>\n      </div>\n      <Input value={value} onChange={(e) => onChange(e.target.value)} placeholder=\"e.g., 217 91% 60%\" />\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/inline-edit.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1589,1592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1589,1592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { useState, useRef, useEffect } from \"react\";\nimport { Check, X, Pencil } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { cn } from \"@/lib/utils\";\nimport { z } from \"zod\";\n\ninterface InlineEditProps {\n  value: string;\n  onSave: (value: string) => Promise<void> | void;\n  multiline?: boolean;\n  validation?: z.ZodString;\n  className?: string;\n  placeholder?: string;\n  maxLength?: number;\n}\n\nexport function InlineEdit({\n  value,\n  onSave,\n  multiline = false,\n  validation,\n  className,\n  placeholder = \"Enter value...\",\n  maxLength = 500,\n}: InlineEditProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(value);\n  const [error, setError] = useState<string | null>(null);\n  const [saving, setSaving] = useState(false);\n  const inputRef = useRef<HTMLInputElement | HTMLTextAreaElement>(null);\n\n  useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.focus();\n      inputRef.current.select();\n    }\n  }, [isEditing]);\n\n  const handleSave = async () => {\n    setError(null);\n\n    // Validate\n    if (validation) {\n      try {\n        validation.parse(editValue);\n      } catch (err) {\n        if (err instanceof z.ZodError) {\n          setError(err.errors[0]?.message || \"Invalid input\");\n          return;\n        }\n      }\n    }\n\n    setSaving(true);\n    try {\n      await onSave(editValue);\n      setIsEditing(false);\n    } catch (err: any) {\n      setError(err.message || \"Failed to save\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setEditValue(value);\n    setError(null);\n    setIsEditing(false);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !multiline && !e.shiftKey) {\n      e.preventDefault();\n      handleSave();\n    } else if (e.key === \"Escape\") {\n      e.preventDefault();\n      handleCancel();\n    }\n  };\n\n  if (!isEditing) {\n    return (\n      <div\n        className={cn(\n          \"group flex items-center gap-2 py-1 px-2 rounded hover:bg-accent/50 cursor-pointer transition-colors\",\n          className\n        )}\n        onClick={() => setIsEditing(true)}\n      >\n        <span className={cn(\"flex-1\", !value && \"text-muted-foreground italic\")}>\n          {value || placeholder}\n        </span>\n        <Pencil className=\"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn(\"flex flex-col gap-1\", className)}>\n      <div className=\"flex items-start gap-2\">\n        {multiline ? (\n          <Textarea\n            ref={inputRef as React.RefObject<HTMLTextAreaElement>}\n            value={editValue}\n            onChange={(e) => setEditValue(e.target.value)}\n            onKeyDown={handleKeyDown}\n            className=\"flex-1 min-h-[60px]\"\n            maxLength={maxLength}\n            disabled={saving}\n          />\n        ) : (\n          <Input\n            ref={inputRef as React.RefObject<HTMLInputElement>}\n            value={editValue}\n            onChange={(e) => setEditValue(e.target.value)}\n            onKeyDown={handleKeyDown}\n            className=\"flex-1\"\n            maxLength={maxLength}\n            disabled={saving}\n          />\n        )}\n        <div className=\"flex items-center gap-1\">\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            className=\"h-8 w-8 text-success\"\n            onClick={handleSave}\n            disabled={saving}\n          >\n            <Check className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            className=\"h-8 w-8 text-muted-foreground\"\n            onClick={handleCancel}\n            disabled={saving}\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n      {error && <p className=\"text-xs text-destructive\">{error}</p>}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/keyboard-shortcuts.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":100,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":100,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Command } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface Shortcut {\n  keys: string[];\n  description: string;\n  category: string;\n}\n\nconst shortcuts: Shortcut[] = [\n  { keys: [\"\", \"K\"], description: \"Open global search\", category: \"Navigation\" },\n  { keys: [\"\", \"N\"], description: \"Create new item\", category: \"Actions\" },\n  { keys: [\"\", \"S\"], description: \"Save changes\", category: \"Actions\" },\n  { keys: [\"\", \"E\"], description: \"Edit selected item\", category: \"Actions\" },\n  { keys: [\"\", \"D\"], description: \"Delete selected item\", category: \"Actions\" },\n  { keys: [\"\", \"/\"], description: \"Show keyboard shortcuts\", category: \"Help\" },\n  { keys: [\"Esc\"], description: \"Close dialog or cancel\", category: \"Navigation\" },\n  { keys: [\"\", \"\"], description: \"Navigate items\", category: \"Navigation\" },\n  { keys: [\"Enter\"], description: \"Select item\", category: \"Navigation\" },\n  { keys: [\"Tab\"], description: \"Next field\", category: \"Forms\" },\n  { keys: [\"Shift\", \"Tab\"], description: \"Previous field\", category: \"Forms\" },\n];\n\nexport function KeyboardShortcuts() {\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    const down = (e: KeyboardEvent) => {\n      if (e.key === \"/\" && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n        setOpen((open) => !open);\n      }\n    };\n    document.addEventListener(\"keydown\", down);\n    return () => document.removeEventListener(\"keydown\", down);\n  }, []);\n\n  const categories = Array.from(new Set(shortcuts.map((s) => s.category)));\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Command className=\"h-5 w-5\" />\n            Keyboard Shortcuts\n          </DialogTitle>\n          <DialogDescription>\n            Use these keyboard shortcuts to navigate faster\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-6\">\n          {categories.map((category) => (\n            <div key={category}>\n              <h3 className=\"font-semibold text-sm mb-3 text-muted-foreground\">{category}</h3>\n              <div className=\"space-y-2\">\n                {shortcuts\n                  .filter((s) => s.category === category)\n                  .map((shortcut, i) => (\n                    <div key={i} className=\"flex items-center justify-between py-2 px-3 rounded-md hover:bg-accent\">\n                      <span className=\"text-sm\">{shortcut.description}</span>\n                      <div className=\"flex gap-1\">\n                        {shortcut.keys.map((key, j) => (\n                          <React.Fragment key={j}>\n                            <kbd\n                              className={cn(\n                                \"px-2 py-1 text-xs font-semibold bg-muted border border-border rounded\",\n                                \"min-w-[24px] text-center\"\n                              )}\n                            >\n                              {key}\n                            </kbd>\n                            {j < shortcut.keys.length - 1 && (\n                              <span className=\"text-muted-foreground mx-1\">+</span>\n                            )}\n                          </React.Fragment>\n                        ))}\n                      </div>\n                    </div>\n                  ))}\n              </div>\n            </div>\n          ))}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Hook to register custom shortcuts\nexport function useKeyboardShortcut(\n  key: string,\n  callback: () => void,\n  options: { ctrl?: boolean; shift?: boolean; alt?: boolean } = {}\n) {\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      const { ctrl = false, shift = false, alt = false } = options;\n      \n      if (\n        e.key.toLowerCase() === key.toLowerCase() &&\n        (ctrl ? e.ctrlKey || e.metaKey : true) &&\n        (shift ? e.shiftKey : !e.shiftKey) &&\n        (alt ? e.altKey : !e.altKey)\n      ) {\n        e.preventDefault();\n        callback();\n      }\n    };\n\n    document.addEventListener(\"keydown\", handler);\n    return () => document.removeEventListener(\"keydown\", handler);\n  }, [key, callback, options]);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/multi-select-bar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":111,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":111,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\";\nimport { cva } from \"class-variance-authority\";\nimport { ChevronDown } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\"relative z-10 flex max-w-max flex-1 items-center justify-center\", className)}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n));\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\"group flex flex-1 list-none items-center justify-center space-x-1\", className)}\n    {...props}\n  />\n));\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item;\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\",\n);\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n));\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto\",\n      className,\n    )}\n    {...props}\n  />\n));\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link;\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n));\nNavigationMenuViewport.displayName = NavigationMenuPrimitive.Viewport.displayName;\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className,\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n));\nNavigationMenuIndicator.displayName = NavigationMenuPrimitive.Indicator.displayName;\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/recently-viewed.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":103,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":103,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { useEffect, useState } from \"react\";\nimport { Clock, FileText, Users, Building2, Package } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useNavigate } from \"react-router-dom\";\nimport { cn } from \"@/lib/utils\";\n\ninterface RecentItem {\n  id: string;\n  title: string;\n  type: \"lead\" | \"account\" | \"contact\" | \"quote\" | \"opportunity\";\n  path: string;\n  timestamp: number;\n}\n\nconst MAX_RECENT_ITEMS = 10;\nconst STORAGE_KEY = \"recently-viewed-items\";\n\nexport function RecentlyViewed({ className }: { className?: string }) {\n  const [recentItems, setRecentItems] = useState<RecentItem[]>([]);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // Load from localStorage\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (stored) {\n      try {\n        setRecentItems(JSON.parse(stored));\n      } catch (error) {\n        console.error(\"Failed to parse recent items:\", error);\n      }\n    }\n  }, []);\n\n  const getIcon = (type: RecentItem[\"type\"]) => {\n    switch (type) {\n      case \"lead\": return FileText;\n      case \"account\": return Building2;\n      case \"contact\": return Users;\n      case \"quote\": return Package;\n      case \"opportunity\": return FileText;\n    }\n  };\n\n  const formatTime = (timestamp: number) => {\n    const now = Date.now();\n    const diff = now - timestamp;\n    const minutes = Math.floor(diff / 60000);\n    const hours = Math.floor(diff / 3600000);\n    const days = Math.floor(diff / 86400000);\n\n    if (minutes < 60) return `${minutes}m ago`;\n    if (hours < 24) return `${hours}h ago`;\n    return `${days}d ago`;\n  };\n\n  if (recentItems.length === 0) {\n    return null;\n  }\n\n  return (\n    <Card className={cn(\"w-full\", className)}>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n          <Clock className=\"h-4 w-4\" />\n          Recently Viewed\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <ScrollArea className=\"h-[300px]\">\n          <div className=\"space-y-1\">\n            {recentItems.map((item) => {\n              const Icon = getIcon(item.type);\n              return (\n                <button\n                  key={item.id}\n                  onClick={() => navigate(item.path)}\n                  className={cn(\n                    \"w-full flex items-center gap-3 px-3 py-2 rounded-md text-sm\",\n                    \"hover:bg-accent transition-colors text-left\"\n                  )}\n                >\n                  <Icon className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium truncate\">{item.title}</p>\n                    <p className=\"text-xs text-muted-foreground capitalize\">{item.type}</p>\n                  </div>\n                  <span className=\"text-xs text-muted-foreground shrink-0\">\n                    {formatTime(item.timestamp)}\n                  </span>\n                </button>\n              );\n            })}\n          </div>\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n\n// Hook to track viewed items\nexport function useRecentlyViewed() {\n  const addRecentItem = (item: Omit<RecentItem, \"timestamp\">) => {\n    const stored = localStorage.getItem(STORAGE_KEY);\n    let items: RecentItem[] = [];\n    \n    if (stored) {\n      try {\n        items = JSON.parse(stored);\n      } catch (error) {\n        console.error(\"Failed to parse recent items:\", error);\n      }\n    }\n\n    // Remove if already exists\n    items = items.filter((i) => i.id !== item.id);\n\n    // Add to front with timestamp\n    items.unshift({ ...item, timestamp: Date.now() });\n\n    // Keep only MAX_RECENT_ITEMS\n    items = items.slice(0, MAX_RECENT_ITEMS);\n\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n  };\n\n  return { addRecentItem };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/row-actions.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":55,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":55,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { MoreHorizontal, Pencil, Trash2, Eye, Copy, Archive } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\nexport interface RowAction {\n  label: string;\n  icon?: React.ComponentType<{ className?: string }>;\n  onClick: () => void;\n  variant?: \"default\" | \"destructive\";\n  separator?: boolean;\n}\n\ninterface RowActionsProps {\n  actions: RowAction[];\n  label?: string;\n}\n\nexport function RowActions({ actions, label = \"Actions\" }: RowActionsProps) {\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n          <MoreHorizontal className=\"h-4 w-4\" />\n          <span className=\"sr-only\">{label}</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-48\">\n        <DropdownMenuLabel>{label}</DropdownMenuLabel>\n        {actions.map((action, index) => (\n          <React.Fragment key={index}>\n            {action.separator && <DropdownMenuSeparator />}\n            <DropdownMenuItem\n              onClick={action.onClick}\n              className={action.variant === \"destructive\" ? \"text-destructive focus:text-destructive\" : \"\"}\n            >\n              {action.icon && <action.icon className=\"mr-2 h-4 w-4\" />}\n              {action.label}\n            </DropdownMenuItem>\n          </React.Fragment>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\n// Pre-built common actions\nexport const commonActions = {\n  view: (onClick: () => void): RowAction => ({\n    label: \"View Details\",\n    icon: Eye,\n    onClick,\n  }),\n  edit: (onClick: () => void): RowAction => ({\n    label: \"Edit\",\n    icon: Pencil,\n    onClick,\n  }),\n  duplicate: (onClick: () => void): RowAction => ({\n    label: \"Duplicate\",\n    icon: Copy,\n    onClick,\n  }),\n  archive: (onClick: () => void): RowAction => ({\n    label: \"Archive\",\n    icon: Archive,\n    onClick,\n    separator: true,\n  }),\n  delete: (onClick: () => void): RowAction => ({\n    label: \"Delete\",\n    icon: Trash2,\n    onClick,\n    variant: \"destructive\",\n    separator: true,\n  }),\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":648,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":648,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { VariantProps, cva } from \"class-variance-authority\";\nimport { PanelLeft } from \"lucide-react\";\n\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\";\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;\nconst SIDEBAR_WIDTH = \"16rem\";\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\";\nconst SIDEBAR_WIDTH_ICON = \"3rem\";\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\";\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\";\n  open: boolean;\n  setOpen: (open: boolean) => void;\n  openMobile: boolean;\n  setOpenMobile: (open: boolean) => void;\n  isMobile: boolean;\n  toggleSidebar: () => void;\n};\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null);\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext);\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\");\n  }\n\n  return context;\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean;\n    open?: boolean;\n    onOpenChange?: (open: boolean) => void;\n  }\n>(({ defaultOpen = true, open: openProp, onOpenChange: setOpenProp, className, style, children, ...props }, ref) => {\n  const isMobile = useIsMobile();\n  const [openMobile, setOpenMobile] = React.useState(false);\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState<boolean>(() => {\n    try {\n      const match = document.cookie.match(new RegExp(`${SIDEBAR_COOKIE_NAME}=([^;]+)`));\n      if (match && match[1]) {\n        const v = decodeURIComponent(match[1]);\n        if (v === \"true\" || v === \"expanded\") return true;\n        if (v === \"false\" || v === \"collapsed\") return false;\n      }\n    } catch (_) {\n      // ignore cookie parsing errors and fall back to default\n    }\n    return defaultOpen;\n  });\n  const open = openProp ?? _open;\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value;\n      if (setOpenProp) {\n        setOpenProp(openState);\n      } else {\n        _setOpen(openState);\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;\n    },\n    [setOpenProp, open],\n  );\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);\n  }, [isMobile, setOpen, setOpenMobile]);\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {\n        event.preventDefault();\n        toggleSidebar();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [toggleSidebar]);\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\";\n\n  const contextValue = React.useMemo<SidebarContext>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],\n  );\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\", className)}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  );\n});\nSidebarProvider.displayName = \"SidebarProvider\";\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\";\n    variant?: \"sidebar\" | \"floating\" | \"inset\";\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\";\n  }\n>(({ side = \"left\", variant = \"sidebar\", collapsible = \"offcanvas\", className, children, ...props }, ref) => {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        className={cn(\"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\", className)}\n        ref={ref}\n        {...props}\n      >\n        {children}\n      </div>\n    );\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    );\n  }\n\n  return (\n    <div\n      ref={ref}\n      className=\"group peer hidden text-sidebar-foreground md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        className={cn(\n          \"relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\",\n        )}\n      />\n      <div\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className,\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n});\nSidebar.displayName = \"Sidebar\";\n\nconst SidebarTrigger = React.forwardRef<React.ElementRef<typeof Button>, React.ComponentProps<typeof Button>>(\n  ({ className, onClick, ...props }, ref) => {\n    const { toggleSidebar } = useSidebar();\n\n    return (\n      <Button\n        ref={ref}\n        data-sidebar=\"trigger\"\n        variant=\"ghost\"\n        size=\"icon\"\n        className={cn(\"h-7 w-7\", className)}\n        onClick={(event) => {\n          onClick?.(event);\n          toggleSidebar();\n        }}\n        {...props}\n      >\n        <PanelLeft />\n        <span className=\"sr-only\">Toggle Sidebar</span>\n      </Button>\n    );\n  },\n);\nSidebarTrigger.displayName = \"SidebarTrigger\";\n\nconst SidebarRail = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\">>(\n  ({ className, ...props }, ref) => {\n    const { toggleSidebar } = useSidebar();\n\n    return (\n      <button\n        ref={ref}\n        data-sidebar=\"rail\"\n        aria-label=\"Toggle Sidebar\"\n        tabIndex={-1}\n        onClick={toggleSidebar}\n        title=\"Toggle Sidebar\"\n        className={cn(\n          \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex\",\n          \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n          \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n          \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n          \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n          \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarRail.displayName = \"SidebarRail\";\n\nconst SidebarInset = React.forwardRef<HTMLDivElement, React.ComponentProps<\"main\">>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarInset.displayName = \"SidebarInset\";\n\nconst SidebarInput = React.forwardRef<React.ElementRef<typeof Input>, React.ComponentProps<typeof Input>>(\n  ({ className, ...props }, ref) => {\n    return (\n      <Input\n        ref={ref}\n        data-sidebar=\"input\"\n        className={cn(\n          \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarInput.displayName = \"SidebarInput\";\n\nconst SidebarHeader = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return <div ref={ref} data-sidebar=\"header\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\n});\nSidebarHeader.displayName = \"SidebarHeader\";\n\nconst SidebarFooter = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return <div ref={ref} data-sidebar=\"footer\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\n});\nSidebarFooter.displayName = \"SidebarFooter\";\n\nconst SidebarSeparator = React.forwardRef<React.ElementRef<typeof Separator>, React.ComponentProps<typeof Separator>>(\n  ({ className, ...props }, ref) => {\n    return (\n      <Separator\n        ref={ref}\n        data-sidebar=\"separator\"\n        className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n        {...props}\n      />\n    );\n  },\n);\nSidebarSeparator.displayName = \"SidebarSeparator\";\n\nconst SidebarContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarContent.displayName = \"SidebarContent\";\n\nconst SidebarGroup = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarGroup.displayName = \"SidebarGroup\";\n\nconst SidebarGroupLabel = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\"> & { asChild?: boolean }>(\n  ({ className, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"div\";\n\n    return (\n      <Comp\n        ref={ref}\n        data-sidebar=\"group-label\"\n        className={cn(\n          \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n          \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\";\n\nconst SidebarGroupAction = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\"> & { asChild?: boolean }>(\n  ({ className, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n\n    return (\n      <Comp\n        ref={ref}\n        data-sidebar=\"group-action\"\n        className={cn(\n          \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n          // Increases the hit area of the button on mobile.\n          \"after:absolute after:-inset-2 after:md:hidden\",\n          \"group-data-[collapsible=icon]:hidden\",\n          className,\n        )}\n        {...props}\n      />\n    );\n  },\n);\nSidebarGroupAction.displayName = \"SidebarGroupAction\";\n\nconst SidebarGroupContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\n  ({ className, ...props }, ref) => (\n    <div ref={ref} data-sidebar=\"group-content\" className={cn(\"w-full text-sm\", className)} {...props} />\n  ),\n);\nSidebarGroupContent.displayName = \"SidebarGroupContent\";\n\nconst SidebarMenu = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(({ className, ...props }, ref) => (\n  <ul ref={ref} data-sidebar=\"menu\" className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)} {...props} />\n));\nSidebarMenu.displayName = \"SidebarMenu\";\n\nconst SidebarMenuItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ className, ...props }, ref) => (\n  <li ref={ref} data-sidebar=\"menu-item\" className={cn(\"group/menu-item relative\", className)} {...props} />\n));\nSidebarMenuItem.displayName = \"SidebarMenuItem\";\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    isActive?: boolean;\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>;\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(({ asChild = false, isActive = false, variant = \"default\", size = \"default\", tooltip, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n  const { isMobile, state } = useSidebar();\n\n  const button = (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  );\n\n  if (!tooltip) {\n    return button;\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    };\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent side=\"right\" align=\"center\" hidden={state !== \"collapsed\" || isMobile} {...tooltip} />\n    </Tooltip>\n  );\n});\nSidebarMenuButton.displayName = \"SidebarMenuButton\";\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    showOnHover?: boolean;\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuAction.displayName = \"SidebarMenuAction\";\n\nconst SidebarMenuBadge = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\n  ({ className, ...props }, ref) => (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  ),\n);\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\";\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean;\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`;\n  }, []);\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && <Skeleton className=\"size-4 rounded-md\" data-sidebar=\"menu-skeleton-icon\" />}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  );\n});\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\";\n\nconst SidebarMenuSub = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(\n  ({ className, ...props }, ref) => (\n    <ul\n      ref={ref}\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  ),\n);\nSidebarMenuSub.displayName = \"SidebarMenuSub\";\n\nconst SidebarMenuSubItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ ...props }, ref) => (\n  <li ref={ref} {...props} />\n));\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\";\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean;\n    size?: \"sm\" | \"md\";\n    isActive?: boolean;\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\";\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/skeleton-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":24,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":24,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Toaster as Sonner, toast } from \"sonner\";\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>;\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  return (\n    <Sonner\n      theme={\"system\" as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton: \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton: \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  );\n};\n\nexport { Toaster, toast };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/split-view.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/status-pill.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":45,"column":22,"nodeType":"Identifier","messageId":"namedExport","endLine":45,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { cn } from \"@/lib/utils\";\n\nconst statusPillVariants = cva(\n  \"inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary/10 text-primary border border-primary/20\",\n        success: \"bg-success/10 text-success border border-success/20\",\n        warning: \"bg-warning/10 text-warning border border-warning/20\",\n        error: \"bg-destructive/10 text-destructive border border-destructive/20\",\n        info: \"bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-500/20\",\n        neutral: \"bg-muted text-muted-foreground border border-border\",\n      },\n      size: {\n        sm: \"text-xs px-2 py-0.5\",\n        default: \"text-xs px-2.5 py-0.5\",\n        lg: \"text-sm px-3 py-1\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n);\n\nexport interface StatusPillProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof statusPillVariants> {\n  dot?: boolean;\n}\n\nfunction StatusPill({ className, variant, size, dot = true, children, ...props }: StatusPillProps) {\n  return (\n    <div className={cn(statusPillVariants({ variant, size }), className)} {...props}>\n      {dot && <span className=\"h-1.5 w-1.5 rounded-full bg-current\" />}\n      {children}\n    </div>\n  );\n}\n\nexport { StatusPill, statusPillVariants };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/table.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3770,3773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3770,3773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { ChevronUp, ChevronDown, ChevronsUpDown } from \"lucide-react\";\n\nconst Table = React.forwardRef<HTMLTableElement, React.HTMLAttributes<HTMLTableElement>>(\n  ({ className, ...props }, ref) => (\n    <div className=\"relative w-full overflow-auto\">\n      <table\n        ref={ref}\n        className={cn(\n          \"w-full caption-bottom text-sm border-collapse bg-[hsl(var(--table-background))] text-[hsl(var(--table-foreground))]\",\n          className,\n        )}\n        {...props}\n      />\n    </div>\n  ),\n);\nTable.displayName = \"Table\";\n\nconst TableHeader = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(\n  ({ className, ...props }, ref) => (\n    <thead\n      ref={ref}\n      className={cn(\n        \"bg-[hsl(var(--table-header-background))] border-y border-[hsl(var(--table-header-separator))] [&_th]:text-[hsl(var(--table-header-text))] [&_th]:border-l [&_th]:border-[hsl(var(--table-header-separator))] [&_th:first-child]:border-l-0\",\n        className,\n      )}\n      {...props}\n    />\n  ),\n);\nTableHeader.displayName = \"TableHeader\";\n\nconst TableBody = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(\n  ({ className, ...props }, ref) => (\n    <tbody ref={ref} className={cn(\"[&_tr:last-child]:border-0\", className)} {...props} />\n  ),\n);\nTableBody.displayName = \"TableBody\";\n\nconst TableFooter = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(\n  ({ className, ...props }, ref) => (\n    <tfoot ref={ref} className={cn(\"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\", className)} {...props} />\n  ),\n);\nTableFooter.displayName = \"TableFooter\";\n\nconst TableRow = React.forwardRef<HTMLTableRowElement, React.HTMLAttributes<HTMLTableRowElement>>(\n  ({ className, ...props }, ref) => (\n    <tr\n      ref={ref}\n      className={cn(\"border-b transition-all hover:bg-muted/50 hover:shadow-sm data-[state=selected]:bg-muted cursor-pointer\", className)}\n      {...props}\n    />\n  ),\n);\nTableRow.displayName = \"TableRow\";\n\nconst TableHead = React.forwardRef<HTMLTableCellElement, React.ThHTMLAttributes<HTMLTableCellElement>>(\n  ({ className, ...props }, ref) => (\n    <th\n      ref={ref}\n      className={cn(\n        \"h-11 px-4 text-left align-middle font-semibold text-sm text-foreground/70 bg-muted/30 border-b [&:has([role=checkbox])]:pr-0 first:rounded-tl-md last:rounded-tr-md\",\n        className,\n      )}\n      {...props}\n    />\n  ),\n);\nTableHead.displayName = \"TableHead\";\n\nconst TableCell = React.forwardRef<HTMLTableCellElement, React.TdHTMLAttributes<HTMLTableCellElement>>(\n  ({ className, ...props }, ref) => (\n    <td ref={ref} className={cn(\"p-4 align-middle text-sm [&:has([role=checkbox])]:pr-0\", className)} {...props} />\n  ),\n);\nTableCell.displayName = \"TableCell\";\n\nconst TableCaption = React.forwardRef<HTMLTableCaptionElement, React.HTMLAttributes<HTMLTableCaptionElement>>(\n  ({ className, ...props }, ref) => (\n    <caption ref={ref} className={cn(\"mt-4 text-sm text-muted-foreground\", className)} {...props} />\n  ),\n);\nTableCaption.displayName = \"TableCaption\";\n\ninterface SortableHeadProps extends React.ThHTMLAttributes<HTMLTableCellElement> {\n  field: string;\n  activeField?: string;\n  direction?: \"asc\" | \"desc\";\n  onSort: (field: string) => void;\n  label?: React.ReactNode;\n}\n\nconst SortableHead = React.forwardRef<HTMLTableCellElement, SortableHeadProps>(\n  ({ className, field, activeField, direction = \"asc\", onSort, label, children, ...props }, ref) => {\n    const isActive = activeField === field;\n    const ariaSort = isActive ? (direction === \"asc\" ? \"ascending\" : \"descending\") : \"none\";\n    return (\n      <TableHead ref={ref as any} className={cn(\"select-none\", className)} aria-sort={ariaSort} {...props}>\n        <button\n          type=\"button\"\n          className=\"flex items-center gap-2 w-full text-left hover:opacity-80\"\n          onClick={() => onSort(field)}\n          title={isActive ? (direction === \"asc\" ? \"Sorted ascending\" : \"Sorted descending\") : \"Click to sort\"}\n        >\n          <span className=\"truncate\">{label ?? children}</span>\n          <span className=\"inline-flex items-center\">\n            {isActive ? (\n              direction === \"asc\" ? (\n                <ChevronUp className=\"h-4 w-4\" />\n              ) : (\n                <ChevronDown className=\"h-4 w-4\" />\n              )\n            ) : (\n              <ChevronsUpDown className=\"h-4 w-4 opacity-40\" />\n            )}\n          </span>\n        </button>\n      </TableHead>\n    );\n  },\n);\nSortableHead.displayName = \"SortableHead\";\n\nexport { Table, TableHeader, TableBody, TableFooter, TableHead, TableRow, TableCell, TableCaption, SortableHead };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[75,159],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nexport interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[72px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  );\n});\nTextarea.displayName = \"Textarea\";\n\nexport { Textarea };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/title-strip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":37,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":37,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root ref={ref} className={cn(toggleVariants({ variant, size, className }))} {...props} />\n));\n\nToggle.displayName = TogglePrimitive.Root.displayName;\n\nexport { Toggle, toggleVariants };\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/components/ui/view-toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/config/navigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/config/object-groups.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/config/permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/domain/shipments/mapper.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3044,3047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3044,3047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { dbRowToAppShipment, appShipmentToDbInsert } from './mapper';\nimport type { DbShipmentRow, AppShipment } from './types';\n\ndescribe('Shipment Mapper', () => {\n  const mockDate = new Date().toISOString();\n  \n  const mockDbRow: DbShipmentRow = {\n    id: '123',\n    shipment_number: 'SH-001',\n    shipment_type: 'ocean',\n    quote_id: 'Q-001',\n    notes: 'Handle with care',\n    status: 'in_transit',\n    origin_location: { city: 'Shanghai', country: 'China' },\n    destination_location: { city: 'Los Angeles', country: 'USA' },\n    pickup_date: '2023-01-01',\n    estimated_delivery: '2023-02-01',\n    actual_delivery: null,\n    total_weight_kg: 1000,\n    total_cost: 5000,\n    currency: 'USD',\n    created_at: mockDate,\n    updated_at: mockDate,\n    owner_id: 'acc_123',\n    tenant_id: 'tenant_1',\n    carrier_id: 'carr_1',\n    franchise_id: 'fran_1',\n    created_by: 'user_1',\n    destination_warehouse_id: null,\n    origin_warehouse_id: null,\n    total_volume_cbm: 10,\n    delivery_date: null,\n    vehicle_id: null\n  };\n\n  const mockAppShipment: AppShipment = {\n    id: '123',\n    shipment_number: 'SH-001',\n    shipment_type: 'ocean',\n    reference_number: 'Q-001',\n    special_instructions: 'Handle with care',\n    status: 'in_transit',\n    origin_address: { city: 'Shanghai', country: 'China', state_province: null, postal_code: null, latitude: null, longitude: null },\n    destination_address: { city: 'Los Angeles', country: 'USA', state_province: null, postal_code: null, latitude: null, longitude: null },\n    pickup_date: '2023-01-01',\n    estimated_delivery_date: '2023-02-01',\n    actual_delivery_date: null,\n    total_weight_kg: 1000,\n    total_packages: null,\n    total_charges: 5000,\n    currency: 'USD',\n    current_location: null,\n    priority_level: null,\n    created_at: mockDate,\n    pod_received: false,\n    pod_received_at: null,\n    account_id: 'acc_123',\n    accounts: null\n  };\n\n  describe('dbRowToAppShipment', () => {\n    it('should correctly map a full DB row to App shipment', () => {\n      const result = dbRowToAppShipment(mockDbRow);\n      expect(result).toEqual(mockAppShipment);\n    });\n\n    it('should handle null values gracefully', () => {\n      const minimalRow: DbShipmentRow = {\n        ...mockDbRow,\n        quote_id: null,\n        notes: null,\n        origin_location: null,\n        destination_location: null,\n        total_weight_kg: null,\n        total_cost: null,\n        owner_id: null\n      };\n      \n      const result = dbRowToAppShipment(minimalRow);\n      \n      expect(result.reference_number).toBeNull();\n      expect(result.special_instructions).toBeNull();\n      expect(result.origin_address).toBeNull();\n      expect(result.destination_address).toBeNull();\n      expect(result.total_weight_kg).toBeNull();\n      expect(result.total_charges).toBeNull();\n      expect(result.account_id).toBeNull();\n    });\n\n    it('should normalize shipment types', () => {\n      const rowWithWeirdType = { ...mockDbRow, shipment_type: 'sea_freight' as any };\n      const result = dbRowToAppShipment(rowWithWeirdType);\n      expect(result.shipment_type).toBe('ocean');\n    });\n\n    it('should normalize status', () => {\n      const rowWithWeirdStatus = { ...mockDbRow, status: 'IN_TRANSIT' };\n      const result = dbRowToAppShipment(rowWithWeirdStatus);\n      expect(result.status).toBe('in_transit');\n    });\n  });\n\n  describe('appShipmentToDbInsert', () => {\n    it('should correctly map App shipment to partial DB row', () => {\n      const partialApp: Partial<AppShipment> = {\n        shipment_number: 'SH-002',\n        shipment_type: 'air',\n        reference_number: 'REF-002',\n        special_instructions: 'Fragile',\n        status: 'draft',\n        origin_address: { city: 'London', country: 'UK' },\n        total_weight_kg: 500,\n        total_charges: 2000,\n        account_id: 'acc_456'\n      };\n\n      const result = appShipmentToDbInsert(partialApp);\n\n      expect(result.shipment_number).toBe('SH-002');\n      expect(result.shipment_type).toBe('air');\n      expect(result.quote_id).toBe('REF-002');\n      expect(result.notes).toBe('Fragile');\n      expect(result.status).toBe('draft');\n      expect(result.origin_location).toEqual({ city: 'London', country: 'UK' });\n      expect(result.total_weight_kg).toBe(500);\n      expect(result.total_cost).toBe(2000);\n      expect(result.owner_id).toBe('acc_456');\n    });\n\n    it('should ignore undefined values', () => {\n      const result = appShipmentToDbInsert({ shipment_number: 'SH-003' });\n      expect(result).toEqual({ shipment_number: 'SH-003' });\n      expect(Object.keys(result)).toHaveLength(1);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/domain/shipments/mapper.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3664,3667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3664,3667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4007,4010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4007,4010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4133,4136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4133,4136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { DbShipmentRow } from \"./types\";\nimport type { AppShipment, AppShipmentType, AppShipmentStatus, AppAddress } from \"./types\";\n\nconst normalizeShipmentType = (name: string): AppShipmentType => {\n  const n = String(name || \"\").trim().toLowerCase();\n  const map: Record<string, AppShipmentType> = {\n    ocean: \"ocean\",\n    ocean_freight: \"ocean\",\n    sea: \"ocean\",\n    sea_freight: \"ocean\",\n    sea_cargo: \"ocean\",\n    air: \"air\",\n    air_freight: \"air\",\n    air_cargo: \"air\",\n    trucking: \"inland_trucking\",\n    inland_trucking: \"inland_trucking\",\n    road: \"inland_trucking\",\n    road_transport: \"inland_trucking\",\n    ground: \"inland_trucking\",\n    courier: \"courier\",\n    express: \"courier\",\n    express_delivery: \"courier\",\n    parcel: \"courier\",\n    moving: \"movers_packers\",\n    movers_packers: \"movers_packers\",\n    packers_and_movers: \"movers_packers\",\n    rail: \"rail\",\n    railway: \"rail\",\n    railway_transport: \"rail\",\n    rail_transport: \"rail\",\n  };\n  return map[n] || (String(name) as AppShipmentType);\n};\n\nconst normalizeStatus = (status: string | null): AppShipmentStatus => {\n  const allowed: AppShipmentStatus[] = [\n    \"draft\",\n    \"confirmed\",\n    \"in_transit\",\n    \"out_for_delivery\",\n    \"delivered\",\n    \"customs\",\n    \"cancelled\",\n    \"on_hold\",\n    \"returned\",\n  ];\n  const s = String(status || \"\").trim().toLowerCase();\n  return (allowed as string[]).includes(s) ? (s as AppShipmentStatus) : \"draft\";\n};\n\nconst toAddress = (json: unknown): AppAddress => {\n  if (!json || typeof json !== \"object\") return null;\n  const obj = json as Record<string, unknown>;\n  return {\n    city: (obj.city as string) ?? null,\n    country: (obj.country as string) ?? null,\n    state_province: (obj.state_province as string) ?? null,\n    postal_code: (obj.postal_code as string) ?? null,\n    latitude: (obj.latitude as number | string | null) ?? null,\n    longitude: (obj.longitude as number | string | null) ?? null,\n  };\n};\n\nexport const dbRowToAppShipment = (row: DbShipmentRow): AppShipment => {\n  return {\n    id: String(row.id),\n    shipment_number: String(row.shipment_number || row.id),\n    shipment_type: normalizeShipmentType(String(row.shipment_type || \"ocean\")),\n    reference_number: row.quote_id || null, // Mapping quote_id to reference_number as primary ref\n    special_instructions: row.notes || null, // Mapping notes to special_instructions\n    status: normalizeStatus(row.status || null),\n    origin_address: toAddress(row.origin_location || null),\n    destination_address: toAddress(row.destination_location || null),\n    pickup_date: row.pickup_date || null,\n    estimated_delivery_date: row.estimated_delivery || null, // mapped from estimated_delivery\n    actual_delivery_date: row.actual_delivery || null,\n    total_weight_kg: row.total_weight_kg ?? null,\n    total_packages: null, // Not present in DB row based on types\n    total_charges: row.total_cost ?? null, // Mapping total_cost to total_charges\n    currency: row.currency || null,\n    current_location: null, // Not present in DB row\n    priority_level: null, // Not present in DB row\n    created_at: String(row.created_at || new Date().toISOString()),\n    pod_received: false, // Not in DB schema\n    pod_received_at: null, // Not in DB schema\n    account_id: row.owner_id || null, // Mapping owner_id to account_id\n    accounts: null, // Join field, handled separately if needed\n  };\n};\n\nexport const appShipmentToDbInsert = (app: Partial<AppShipment>): Partial<DbShipmentRow> => {\n  const db: Partial<DbShipmentRow> = {};\n  \n  if (app.shipment_number) db.shipment_number = app.shipment_number;\n  if (app.shipment_type) db.shipment_type = app.shipment_type as any; // Cast as any to satisfy exact enum match if needed, though values align\n  if (app.reference_number) db.quote_id = app.reference_number;\n  if (app.special_instructions) db.notes = app.special_instructions;\n  if (app.status) db.status = app.status;\n  \n  if (app.origin_address) {\n    db.origin_location = app.origin_address as unknown as any; // Json type\n  }\n  \n  if (app.destination_address) {\n    db.destination_location = app.destination_address as unknown as any; // Json type\n  }\n  \n  if (app.pickup_date) db.pickup_date = app.pickup_date;\n  if (app.estimated_delivery_date) db.estimated_delivery = app.estimated_delivery_date;\n  if (app.actual_delivery_date) db.actual_delivery = app.actual_delivery_date;\n  \n  if (app.total_weight_kg !== undefined) db.total_weight_kg = app.total_weight_kg;\n  if (app.total_charges !== undefined) db.total_cost = app.total_charges;\n  if (app.currency) db.currency = app.currency;\n  \n  if (app.account_id) db.owner_id = app.account_id;\n  \n  // vehicle_id, carrier_id, tenant_id etc. would need to be passed if available in AppShipment or separate context\n  \n  return db;\n};\n\n\nexport const dbRowsToAppShipments = (rows: DbShipmentRow[]): AppShipment[] => {\n  return (rows || []).map(dbRowToAppShipment);\n};\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/domain/shipments/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/useAssignableUsers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2128,2131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2128,2131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from \"react\";\nimport { useCRM } from \"../hooks/useCRM\";\n\nexport type AssignableUser = {\n  id: string;\n  first_name: string | null;\n  last_name: string | null;\n  email: string | null;\n};\n\ntype FetchOptions = {\n  search?: string;\n  limit?: number;\n};\n\n/**\n * Hook to fetch assignable users scoped by the current user's role.\n * - Platform admins: global search across all tenants/franchises\n * - Tenant admins: users in their tenant (all franchises within tenant)\n * - Franchise admins & users: users in their franchise only\n */\nexport function useAssignableUsers() {\n  const { context, supabase } = useCRM();\n\n  const fetchAssignableUsers = useCallback(\n    async (opts: FetchOptions = {}) => {\n      const { search, limit = 25 } = opts;\n      const like = search ? `%${search}%` : undefined;\n\n      if (!supabase) return { data: [] as AssignableUser[], error: null };\n\n      // Platform admins: query profiles globally\n      if (context?.isPlatformAdmin) {\n        let query = supabase\n          .from(\"profiles\")\n          .select(\"id, first_name, last_name, email\")\n          .limit(limit);\n\n        if (like) {\n          // Match first_name OR last_name OR email\n          query = query.or(\n            `first_name.ilike.${like},last_name.ilike.${like},email.ilike.${like}`\n          );\n        }\n\n        const { data, error } = await query;\n        return { data: (data ?? []) as AssignableUser[], error };\n      }\n\n      // For tenant admin or franchise admin/users, find user_ids via user_roles then fetch profiles\n      const isTenantScope = !!context?.isTenantAdmin;\n      const scopeKey = isTenantScope ? \"tenant_id\" : \"franchise_id\";\n      const scopeValue = isTenantScope ? context?.tenantId : context?.franchiseId;\n\n      if (!scopeValue) return { data: [] as AssignableUser[], error: null };\n\n      const { data: roles, error: rolesError } = await supabase\n        .from(\"user_roles\")\n        .select(\"user_id\")\n        .eq(scopeKey, scopeValue)\n        .limit(1000);\n\n      if (rolesError) return { data: [] as AssignableUser[], error: rolesError };\n      const ids = (roles ?? []).map((r: any) => r.user_id).filter(Boolean);\n      if (ids.length === 0) return { data: [] as AssignableUser[], error: null };\n\n      let pQuery = supabase\n        .from(\"profiles\")\n        .select(\"id, first_name, last_name, email\")\n        .in(\"id\", ids)\n        .limit(limit);\n\n      if (like) {\n        pQuery = pQuery.or(\n          `first_name.ilike.${like},last_name.ilike.${like},email.ilike.${like}`\n        );\n      }\n\n      const { data, error } = await pQuery;\n      return { data: (data ?? []) as AssignableUser[], error };\n    },\n    [supabase, context]\n  );\n\n  const formatLabel = (u: AssignableUser) => {\n    const name = [u.first_name, u.last_name].filter(Boolean).join(\" \");\n    return name ? `${name} (${u.email ?? \"\"})` : u.email ?? u.id;\n  };\n\n  return { fetchAssignableUsers, formatLabel };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/useAuth.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1003,1006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1003,1006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1066,1069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1066,1069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1091,1094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1091,1094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2675,2678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2675,2678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5808,5811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5808,5811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":239,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":239,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState, useRef } from 'react';\nimport { User, Session } from '@supabase/supabase-js';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'sonner';\nimport { ROLE_PERMISSIONS, unionPermissions, type Permission } from '@/config/permissions';\n\ntype AppRole = 'platform_admin' | 'tenant_admin' | 'franchise_admin' | 'user';\n\ninterface UserRole {\n  role: AppRole;\n  tenant_id: string | null;\n  franchise_id: string | null;\n}\n\ninterface Profile {\n  id: string;\n  email: string;\n  first_name: string | null;\n  last_name: string | null;\n  phone: string | null;\n  avatar_url: string | null;\n  is_active: boolean;\n  must_change_password: boolean;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  session: Session | null;\n  profile: Profile | null;\n  roles: UserRole[];\n  permissions: Permission[];\n  loading: boolean;\n  signIn: (email: string, password: string) => Promise<{ error: any }>;\n  signUp: (email: string, password: string, metadata?: any) => Promise<{ error: any }>;\n  signOut: () => Promise<void>;\n  hasRole: (role: AppRole) => boolean;\n  hasPermission: (permission: Permission) => boolean;\n  isPlatformAdmin: () => boolean;\n  isTenantAdmin: () => boolean;\n  isFranchiseAdmin: () => boolean;\n  refreshProfile: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [session, setSession] = useState<Session | null>(null);\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [roles, setRoles] = useState<UserRole[]>([]);\n  const [permissions, setPermissions] = useState<Permission[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchUserRoles = async (userId: string) => {\n    const { data, error } = await supabase\n      .from('user_roles')\n      .select('role, tenant_id, franchise_id')\n      .eq('user_id', userId);\n\n    if (error) {\n      console.error('Error fetching roles:', error);\n      return [];\n    }\n    return data || [];\n  };\n\n  const fetchCustomPermissions = async (userId: string): Promise<{ granted: Permission[], denied: Permission[] }> => {\n    const { data, error } = await supabase\n      .rpc('get_user_custom_permissions', { check_user_id: userId });\n\n    if (error) {\n      console.error('Error fetching custom permissions:', error);\n      return { granted: [], denied: [] };\n    }\n    \n    const granted: Permission[] = [];\n    const denied: Permission[] = [];\n    \n    (data || []).forEach((row: any) => {\n      const perm = row.permission_key as Permission;\n      if (row.access_type === 'grant') {\n        granted.push(perm);\n      } else if (row.access_type === 'deny') {\n        denied.push(perm);\n      }\n    });\n    \n    return { granted, denied };\n  };\n\n  const fetchProfile = async (userId: string) => {\n    const { data, error } = await supabase\n      .from('profiles')\n      .select('*')\n      .eq('id', userId)\n      .single();\n\n    if (error) {\n      console.error('Error fetching profile:', error);\n      return null;\n    }\n    return data;\n  };\n\n  const refreshProfile = async () => {\n    if (user) {\n      const profileData = await fetchProfile(user.id);\n      setProfile(profileData);\n      const rolesData = await fetchUserRoles(user.id);\n      setRoles(rolesData);\n      \n      // Combine standard role permissions with custom role permissions\n      const standardPerms = unionPermissions(\n        ...rolesData.map(r => ROLE_PERMISSIONS[r.role])\n      );\n      const { granted, denied } = await fetchCustomPermissions(user.id);\n      \n      // Merge granted permissions with standard permissions\n      const mergedPerms = unionPermissions(standardPerms, granted);\n      \n      // Remove denied permissions (custom roles override)\n      const finalPerms = mergedPerms.filter(p => !denied.includes(p));\n      \n      setPermissions(finalPerms);\n    }\n  };\n\n  useEffect(() => {\n    // Set up auth state listener\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      (event, currentSession) => {\n        setSession(currentSession);\n        setUser(currentSession?.user ?? null);\n\n        if (currentSession?.user) {\n          setTimeout(() => {\n            fetchProfile(currentSession.user.id).then(setProfile);\n            fetchUserRoles(currentSession.user.id).then(async (rolesData) => {\n              setRoles(rolesData);\n              const standardPerms = unionPermissions(\n                ...rolesData.map((r) => ROLE_PERMISSIONS[r.role])\n              );\n              const { granted, denied } = await fetchCustomPermissions(currentSession.user.id);\n              const mergedPerms = unionPermissions(standardPerms, granted);\n              const finalPerms = mergedPerms.filter(p => !denied.includes(p));\n              setPermissions(finalPerms);\n              setLoading(false);\n            });\n          }, 0);\n        } else {\n          setProfile(null);\n          setRoles([]);\n          setPermissions([]);\n          setLoading(false);\n        }\n      }\n    );\n\n    // Check for existing session\n    supabase.auth.getSession().then(({ data: { session: currentSession } }) => {\n      setSession(currentSession);\n      setUser(currentSession?.user ?? null);\n      if (!currentSession?.user) {\n        setPermissions([]);\n        setLoading(false);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n\n  const signIn = async (email: string, password: string) => {\n    const { error } = await supabase.auth.signInWithPassword({\n      email,\n      password,\n    });\n    return { error };\n  };\n\n  const signUp = async (email: string, password: string, metadata?: any) => {\n    const redirectUrl = `${window.location.origin}/`;\n    const { error } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        emailRedirectTo: redirectUrl,\n        data: metadata\n      }\n    });\n    return { error };\n  };\n\n  const signOut = async () => {\n    await supabase.auth.signOut();\n    setUser(null);\n    setSession(null);\n    setProfile(null);\n    setRoles([]);\n    setPermissions([]);\n  };\n\n  const hasRole = (role: AppRole) => {\n    return roles.some(r => r.role === role);\n  };\n\n  const isPlatformAdmin = () => hasRole('platform_admin');\n  const isTenantAdmin = () => hasRole('tenant_admin');\n  const isFranchiseAdmin = () => hasRole('franchise_admin');\n\n  const hasPermission = (permission: Permission) => permissions.includes(permission);\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        session,\n        profile,\n      roles,\n      permissions,\n      loading,\n      signIn,\n      signUp,\n      signOut,\n      hasRole,\n      hasPermission,\n      isPlatformAdmin,\n      isTenantAdmin,\n      isFranchiseAdmin,\n      refreshProfile\n    }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/useCRM.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/usePagination.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'currentPage'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, totalPages]","fix":{"range":[844,856],"text":"[currentPage, totalPages]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo, useState, useEffect } from 'react';\n\nexport type PageSizeOption = number | 'ALL';\n\nexport interface UsePaginationOptions {\n  initialPageSize?: PageSizeOption;\n  pageSizeOptions?: PageSizeOption[];\n}\n\nexport function usePagination<T>(data: T[], opts: UsePaginationOptions = {}) {\n  const pageSizeOptions = opts.pageSizeOptions ?? [10, 20, 50, 100, 'ALL'];\n  const [pageSize, setPageSize] = useState<PageSizeOption>(opts.initialPageSize ?? 20);\n  const [currentPage, setCurrentPage] = useState<number>(1);\n\n  const sizeValue = pageSize === 'ALL' ? data.length || 1 : pageSize;\n  const totalPages = Math.max(1, Math.ceil((data.length || 0) / sizeValue));\n\n  useEffect(() => {\n    // Clamp page if data or size changes\n    if (currentPage > totalPages) setCurrentPage(totalPages);\n    if (currentPage < 1) setCurrentPage(1);\n  }, [totalPages]);\n\n  const pageItems = useMemo(() => {\n    if (pageSize === 'ALL') return data;\n    const start = (currentPage - 1) * sizeValue;\n    return data.slice(start, start + sizeValue);\n  }, [data, currentPage, pageSize, sizeValue]);\n\n  const nextPage = () => setCurrentPage((p) => Math.min(totalPages, p + 1));\n  const prevPage = () => setCurrentPage((p) => Math.max(1, p - 1));\n  const firstPage = () => setCurrentPage(1);\n  const lastPage = () => setCurrentPage(totalPages);\n\n  const canPrev = currentPage > 1;\n  const canNext = currentPage < totalPages;\n\n  return {\n    pageItems,\n    pageSize,\n    setPageSize,\n    pageSizeOptions,\n    currentPage,\n    setCurrentPage,\n    totalPages,\n    nextPage,\n    prevPage,\n    firstPage,\n    lastPage,\n    canPrev,\n    canNext,\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/useSort.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[229,232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[229,232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[288,291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[288,291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[399,402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[399,402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[407,410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[407,410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1463,1466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1463,1466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getValue'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [sortField, data, getValue, sortDirection]","fix":{"range":[1743,1775],"text":"[sortField, data, getValue, sortDirection]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo, useState } from 'react';\n\nexport type SortDirection = 'asc' | 'desc';\n\nexport interface UseSortOptions<T> {\n  initialField?: string;\n  initialDirection?: SortDirection;\n  accessors?: Record<string, (item: T) => any>;\n}\n\nfunction defaultAccessor<T extends Record<string, any>>(item: T, field?: string) {\n  if (!field) return item;\n  return item[field];\n}\n\nfunction compareValues(a: any, b: any) {\n  const an = a == null ? '' : a;\n  const bn = b == null ? '' : b;\n  if (typeof an === 'number' && typeof bn === 'number') return an - bn;\n  if (typeof an === 'boolean' && typeof bn === 'boolean') return (an ? 1 : 0) - (bn ? 1 : 0);\n  // Attempt date comparison\n  const ad = typeof an === 'string' && !isNaN(Date.parse(an)) ? Date.parse(an) : null;\n  const bd = typeof bn === 'string' && !isNaN(Date.parse(b)) ? Date.parse(b) : null;\n  if (ad !== null && bd !== null) return ad - bd;\n  const as = an.toString().toLowerCase();\n  const bs = bn.toString().toLowerCase();\n  return as.localeCompare(bs);\n}\n\nexport function useSort<T>(data: T[], options: UseSortOptions<T> = {}) {\n  const [sortField, setSortField] = useState<string | undefined>(options.initialField);\n  const [sortDirection, setSortDirection] = useState<SortDirection>(options.initialDirection || 'asc');\n\n  const getValue = (item: T) => {\n    const accessor = sortField && options.accessors && options.accessors[sortField];\n    return accessor ? accessor(item) : defaultAccessor(item as any, sortField);\n  };\n\n  const sorted = useMemo(() => {\n    if (!sortField) return data;\n    const arr = [...data];\n    arr.sort((a, b) => {\n      const cmp = compareValues(getValue(a), getValue(b));\n      return sortDirection === 'asc' ? cmp : -cmp;\n    });\n    return arr;\n  }, [data, sortField, sortDirection]);\n\n  const onSort = (field: string) => {\n    if (sortField === field) {\n      setSortDirection((d) => (d === 'asc' ? 'desc' : 'asc'));\n    } else {\n      setSortField(field);\n      setSortDirection('asc');\n    }\n  };\n\n  return { sorted, sortField, sortDirection, onSort, setSortField, setSortDirection };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/useTheme.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4178,4181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4178,4181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":177,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":177,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7772,7772],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'applyTheme' and 'toggleDark'. Either include them or remove the dependency array.","line":178,"column":6,"nodeType":"ArrayExpression","endLine":178,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [applyTheme, toggleDark]","fix":{"range":[7779,7781],"text":"[applyTheme, toggleDark]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8298,8301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8298,8301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8317,8320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8317,8320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9179,9182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9179,9182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9205,9208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9205,9208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9488,9491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9488,9491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10506,10509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10506,10509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'supabase'. Either include it or remove the dependency array.","line":249,"column":6,"nodeType":"ArrayExpression","endLine":249,"endColumn":104,"suggestions":[{"desc":"Update the dependencies array to be: [scope, context.userId, context.tenantId, context.franchiseId, applyTheme, themesFetchDisabled, supabase]","fix":{"range":[10805,10903],"text":"[scope, context.userId, context.tenantId, context.franchiseId, applyTheme, themesFetchDisabled, supabase]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12273,12276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12273,12276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12564,12567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12564,12567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":283,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":283,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[12617,12617],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12863,12866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12863,12866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12882,12885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12882,12885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":297,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":297,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[13198,13198],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13541,13544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13541,13544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13560,13563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13560,13563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13920,13923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13920,13923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13939,13942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13939,13942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":319,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":319,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[14299,14299],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'deleteTheme', 'saveTheme', and 'setActive'. Either include them or remove the dependency array.","line":323,"column":157,"nodeType":"ArrayExpression","endLine":323,"endColumn":213,"suggestions":[{"desc":"Update the dependencies array to be: [themes, activeThemeName, scope, applyTheme, saveTheme, deleteTheme, setActive, toggleDark]","fix":{"range":[14473,14529],"text":"[themes, activeThemeName, scope, applyTheme, saveTheme, deleteTheme, setActive, toggleDark]"}}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":328,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":328,"endColumn":22}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useMemo, useState, useCallback } from 'react';\nimport { THEME_PRESETS } from '@/theme/themes';\nimport { useCRM } from '@/hooks/useCRM';\n\nexport type SavedTheme = {\n  name: string;\n  start: string;\n  end: string;\n  primary?: string;\n  accent?: string;\n  titleStrip?: string;\n  tableHeaderText?: string;\n  tableHeaderSeparator?: string;\n  tableHeaderBackground?: string;\n  tableBackground?: string;\n  tableForeground?: string;\n  angle?: number; // gradient angle in degrees\n  radius?: string; // e.g., \"0.75rem\"\n  sidebarBackground?: string;\n  sidebarAccent?: string;\n  dark?: boolean;\n  // Main page background gradient overrides\n  bgStart?: string;\n  bgEnd?: string;\n  bgAngle?: number;\n  createdAt: string;\n};\n\ntype ThemeContextValue = {\n  themes: SavedTheme[];\n  activeThemeName: string | null;\n  scope: 'platform' | 'tenant' | 'franchise' | 'user';\n  setScope: (s: 'platform' | 'tenant' | 'franchise' | 'user') => void;\n  applyTheme: (t: { start: string; end: string; primary?: string; accent?: string; titleStrip?: string; tableHeaderText?: string; tableHeaderSeparator?: string; tableHeaderBackground?: string; tableBackground?: string; tableForeground?: string; angle?: number; radius?: string; sidebarBackground?: string; sidebarAccent?: string; dark?: boolean; bgStart?: string; bgEnd?: string; bgAngle?: number }) => void;\n  saveTheme: (t: { name: string; start: string; end: string; primary?: string; accent?: string; titleStrip?: string; tableHeaderText?: string; tableHeaderSeparator?: string; tableHeaderBackground?: string; tableBackground?: string; tableForeground?: string; angle?: number; radius?: string; sidebarBackground?: string; sidebarAccent?: string; dark?: boolean; bgStart?: string; bgEnd?: string; bgAngle?: number }) => Promise<void>;\n  deleteTheme: (name: string) => Promise<void>;\n  setActive: (name: string) => void;\n  toggleDark: (enabled: boolean) => void;\n};\n\nconst LS_THEMES_KEY = 'soslogicpro.themes';\nconst LS_ACTIVE_KEY = 'soslogicpro.activeThemeName';\n\nconst ThemeContext = createContext<ThemeContextValue | null>(null);\n\nexport const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [themes, setThemes] = useState<SavedTheme[]>([]);\n  const [activeThemeName, setActiveThemeName] = useState<string | null>(null);\n  const [scope, setScope] = useState<'platform' | 'tenant' | 'franchise' | 'user'>('user');\n  const [themesFetchDisabled, setThemesFetchDisabled] = useState(false);\n  const LS_DARK_KEY = 'soslogicpro.darkMode';\n  const { supabase, context } = useCRM();\n\n  // Define applyTheme before useEffect calls\n  const applyTheme = useCallback((t: { start: string; end: string; primary?: string; accent?: string; titleStrip?: string; tableHeaderText?: string; tableHeaderSeparator?: string; tableHeaderBackground?: string; tableBackground?: string; tableForeground?: string; angle?: number; radius?: string; sidebarBackground?: string; sidebarAccent?: string; dark?: boolean; bgStart?: string; bgEnd?: string; bgAngle?: number }) => {\n    const root = document.documentElement;\n    const angle = t.angle ?? 135;\n    root.style.setProperty('--gradient-primary', `linear-gradient(${angle}deg, hsl(${t.start}) 0%, hsl(${t.end}) 100%)`);\n    const bgAngle = t.bgAngle ?? angle;\n    const bgStart = t.bgStart ?? t.start;\n    const bgEnd = t.bgEnd ?? t.end;\n    root.style.setProperty('--app-background', `linear-gradient(${bgAngle}deg, hsl(${bgStart}) 0%, hsl(${bgEnd}) 100%)`);\n    if (t.primary) {\n      root.style.setProperty('--primary', t.primary);\n      root.style.setProperty('--sidebar-primary', t.primary);\n      root.style.setProperty('--ring', t.primary);\n    }\n    if (t.accent) {\n      root.style.setProperty('--accent', t.accent);\n      root.style.setProperty('--sidebar-accent', t.accent);\n    }\n    const titleStrip = t.titleStrip || t.accent || t.primary;\n    if (titleStrip) {\n      root.style.setProperty('--title-strip', titleStrip);\n    }\n    const isDark = typeof t.dark === 'boolean' ? t.dark : document.documentElement.classList.contains('dark');\n    \n    const parseHsl = (value?: string) => {\n      if (!value) return null as any;\n      const m = value.match(/^(\\s*\\d+(?:\\.\\d+)?)\\s+(\\d+(?:\\.\\d+)?)%\\s+(\\d+(?:\\.\\d+)?)%/);\n      if (!m) return null;\n      return { h: parseFloat(m[1]), s: parseFloat(m[2]), l: parseFloat(m[3]) };\n    };\n    const lighten = (hsl: { h: number; s: number; l: number }, amount: number) => {\n      const newL = Math.min(100, hsl.l + amount);\n      return `${hsl.h} ${hsl.s}% ${newL}%`;\n    };\n    const darken = (hsl: { h: number; s: number; l: number }, amount: number) => {\n      const newL = Math.max(0, hsl.l - amount);\n      return `${hsl.h} ${hsl.s}% ${newL}%`;\n    };\n    const primaryParsed = parseHsl(t.primary);\n    const accentParsed = parseHsl(t.accent);\n    let thText = t.tableHeaderText;\n    let thSep = t.tableHeaderSeparator;\n    let thBg = t.tableHeaderBackground;\n    let tableBg = t.tableBackground;\n    let tableFg = t.tableForeground;\n    if (!thText) {\n      thText = isDark ? '210 40% 98%' : '222.2 84% 4.9%';\n    }\n    if (!thSep && primaryParsed) {\n      thSep = isDark ? lighten(primaryParsed, 10) : darken(primaryParsed, 5);\n    }\n    if (!thBg) {\n      if (primaryParsed) {\n        thBg = isDark ? lighten(primaryParsed, 5) : lighten(primaryParsed, 45);\n      }\n    }\n    if (!tableBg) {\n      tableBg = isDark ? '222.2 84% 4.9%' : '0 0% 100%';\n    }\n    if (!tableFg) {\n      tableFg = isDark ? '210 40% 98%' : '222.2 84% 4.9%';\n    }\n    // Apply CSS variables used by table components\n    if (thText) root.style.setProperty('--table-header-text', thText);\n    if (thSep) root.style.setProperty('--table-header-separator', thSep);\n    if (thBg) root.style.setProperty('--table-header-background', thBg);\n    if (tableBg) root.style.setProperty('--table-background', tableBg);\n    if (tableFg) root.style.setProperty('--table-foreground', tableFg);\n    if (t.radius) {\n      root.style.setProperty('--radius', t.radius);\n    }\n    if (t.sidebarBackground) {\n      root.style.setProperty('--sidebar-background', t.sidebarBackground);\n    }\n    if (t.sidebarAccent) {\n      root.style.setProperty('--sidebar-accent', t.sidebarAccent);\n    }\n  }, []);\n\n  const toggleDark = useCallback((enabled: boolean) => {\n    const root = document.documentElement;\n    if (enabled) {\n      root.classList.add('dark');\n    } else {\n      root.classList.remove('dark');\n    }\n    localStorage.setItem(LS_DARK_KEY, String(enabled));\n  }, [LS_DARK_KEY]);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(LS_THEMES_KEY);\n      const active = localStorage.getItem(LS_ACTIVE_KEY);\n      const darkStored = localStorage.getItem(LS_DARK_KEY);\n      const parsed = raw ? (JSON.parse(raw) as SavedTheme[]) : [];\n      setThemes(parsed);\n      setActiveThemeName(active);\n      if (active) {\n        const found = parsed.find(t => t.name === active);\n        if (found) applyTheme(found);\n      } else {\n        // Apply Default Simple theme by default when no active theme is set\n        const preset = THEME_PRESETS.find(p => p.name === 'Default Simple');\n        if (preset) {\n          applyTheme({\n            start: preset.start,\n            end: preset.end,\n            primary: preset.primary,\n            accent: preset.accent,\n            angle: preset.angle,\n            radius: preset.radius,\n            sidebarBackground: preset.sidebarBackground,\n            sidebarAccent: preset.sidebarAccent,\n            dark: preset.dark,\n            bgStart: preset.bgStart,\n            bgEnd: preset.bgEnd,\n            bgAngle: preset.bgAngle,\n          });\n        }\n      }\n      if (darkStored) {\n        toggleDark(darkStored === 'true');\n      }\n    } catch {}\n  }, []);\n\n  // Choose default scope based on current context\n  useEffect(() => {\n    if (context?.franchiseId) setScope('franchise');\n    else if (context?.tenantId) setScope('tenant');\n    else setScope('user');\n  }, [context?.tenantId, context?.franchiseId]);\n\n  // Load scoped themes from Supabase when scope or context changes\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!supabase || themesFetchDisabled) return;\n        // Cast to any to avoid typed relation errors for ui_themes\n        let query: any = (supabase as any).from('ui_themes').select('name, tokens, is_default, scope');\n        if (scope === 'user' && context?.userId) {\n          query = query.eq('scope', 'user').eq('user_id', context.userId);\n        } else if (scope === 'franchise' && context?.franchiseId) {\n          query = query.eq('scope', 'franchise').eq('franchise_id', context.franchiseId);\n        } else if (scope === 'tenant' && context?.tenantId) {\n          query = query.eq('scope', 'tenant').eq('tenant_id', context.tenantId);\n        } else if (scope === 'platform') {\n          query = query.eq('scope', 'platform');\n        } else {\n          return; // insufficient context for scoped fetch\n        }\n        const { data, error } = await query;\n        if (error) {\n          // Silence noisy devtools network 404s by disabling future fetches until reload\n          const status = (error as any)?.status ?? (error as any)?.code;\n          if (status === 404 || String(error?.message || '').toLowerCase().includes('not found')) {\n            setThemesFetchDisabled(true);\n          }\n          return;\n        }\n        if (Array.isArray(data)) {\n          const mapped: SavedTheme[] = data.map((row: any) => ({\n            name: row.name,\n            start: row.tokens.start,\n            end: row.tokens.end,\n            primary: row.tokens.primary,\n            accent: row.tokens.accent,\n            titleStrip: row.tokens.titleStrip,\n            tableHeaderText: row.tokens.tableHeaderText,\n            tableHeaderSeparator: row.tokens.tableHeaderSeparator,\n            tableHeaderBackground: row.tokens.tableHeaderBackground,\n            tableBackground: row.tokens.tableBackground,\n            tableForeground: row.tokens.tableForeground,\n            angle: row.tokens.angle,\n            radius: row.tokens.radius,\n            sidebarBackground: row.tokens.sidebarBackground,\n            sidebarAccent: row.tokens.sidebarAccent,\n            dark: row.tokens.dark,\n            bgStart: row.tokens.bgStart,\n            bgEnd: row.tokens.bgEnd,\n            bgAngle: row.tokens.bgAngle,\n            createdAt: new Date().toISOString(),\n          }));\n          setThemes(mapped);\n          const def = data.find((row: any) => row.is_default);\n          if (def) {\n            setActiveThemeName(def.name);\n            const found = mapped.find(t => t.name === def.name);\n            if (found) applyTheme(found);\n          }\n        }\n      } catch {\n        // noop; keep local storage themes\n      }\n    })();\n  }, [scope, context?.userId, context?.tenantId, context?.franchiseId, applyTheme, themesFetchDisabled]);\n\n  const saveTheme = async (t: { name: string; start: string; end: string; primary?: string; accent?: string; titleStrip?: string; tableHeaderText?: string; tableHeaderSeparator?: string; tableHeaderBackground?: string; tableBackground?: string; tableForeground?: string; angle?: number; radius?: string; sidebarBackground?: string; sidebarAccent?: string; dark?: boolean; bgStart?: string; bgEnd?: string; bgAngle?: number }) => {\n    const saved: SavedTheme = { ...t, createdAt: new Date().toISOString() };\n    const next = [saved, ...themes.filter(x => x.name !== t.name)];\n    setThemes(next);\n    localStorage.setItem(LS_THEMES_KEY, JSON.stringify(next));\n    try {\n      if (!supabase) return;\n      const tokens = {\n        start: t.start,\n        end: t.end,\n        primary: t.primary,\n        accent: t.accent,\n        titleStrip: t.titleStrip,\n        tableHeaderText: t.tableHeaderText,\n        tableHeaderSeparator: t.tableHeaderSeparator,\n        tableHeaderBackground: t.tableHeaderBackground,\n        tableBackground: t.tableBackground,\n        tableForeground: t.tableForeground,\n        angle: t.angle,\n        radius: t.radius,\n        sidebarBackground: t.sidebarBackground,\n        sidebarAccent: t.sidebarAccent,\n        dark: t.dark,\n        bgStart: t.bgStart,\n        bgEnd: t.bgEnd,\n        bgAngle: t.bgAngle,\n      };\n      const payload: any = { name: t.name, tokens, scope, is_active: true };\n      if (scope === 'user') payload.user_id = context?.userId;\n      if (scope === 'franchise') payload.franchise_id = context?.franchiseId;\n      if (scope === 'tenant') payload.tenant_id = context?.tenantId;\n      await (supabase as any).from('ui_themes').upsert(payload);\n    } catch {}\n  };\n\n  const deleteTheme = async (name: string) => {\n    const next = themes.filter(x => x.name !== name);\n    setThemes(next);\n    localStorage.setItem(LS_THEMES_KEY, JSON.stringify(next));\n    try {\n      if (!supabase) return;\n      let q: any = (supabase as any).from('ui_themes').delete().eq('name', name).eq('scope', scope);\n      if (scope === 'user') q = q.eq('user_id', context?.userId);\n      if (scope === 'franchise') q = q.eq('franchise_id', context?.franchiseId);\n      if (scope === 'tenant') q = q.eq('tenant_id', context?.tenantId);\n      await q;\n    } catch {}\n  };\n\n  const setActive = (name: string) => {\n    setActiveThemeName(name);\n    localStorage.setItem(LS_ACTIVE_KEY, name);\n    const found = themes.find(t => t.name === name);\n    if (found) applyTheme(found);\n    // Mark default in Supabase for current scope\n    (async () => {\n      try {\n        if (!supabase) return;\n        let clear: any = (supabase as any).from('ui_themes').update({ is_default: false }).eq('scope', scope);\n        if (scope === 'user') clear = clear.eq('user_id', context?.userId);\n        if (scope === 'franchise') clear = clear.eq('franchise_id', context?.franchiseId);\n        if (scope === 'tenant') clear = clear.eq('tenant_id', context?.tenantId);\n        await clear;\n        let set: any = (supabase as any).from('ui_themes').update({ is_default: true }).eq('name', name).eq('scope', scope);\n        if (scope === 'user') set = set.eq('user_id', context?.userId);\n        if (scope === 'franchise') set = set.eq('franchise_id', context?.franchiseId);\n        if (scope === 'tenant') set = set.eq('tenant_id', context?.tenantId);\n        await set;\n      } catch {}\n    })();\n  };\n\n  const value = useMemo<ThemeContextValue>(() => ({ themes, activeThemeName, scope, setScope, applyTheme, saveTheme, deleteTheme, setActive, toggleDark }), [themes, activeThemeName, scope, applyTheme, toggleDark]);\n\n  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>;\n};\n\nexport const useTheme = () => {\n  const ctx = useContext(ThemeContext);\n  if (!ctx) throw new Error('useTheme must be used within ThemeProvider');\n  return ctx;\n};","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/useTransportModes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/hooks/useVersionStatus.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/integrations/supabase/carrierRatesActions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1578,1581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1578,1581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2064,2067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2064,2067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2992,2995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2992,2995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5303,5306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5303,5306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":186,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":186,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5690,5690],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5778,5781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5778,5781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6423,6426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6423,6426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6541,6544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6541,6544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6823,6826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6823,6826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6938,6941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6938,6941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7118,7121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7118,7121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7304,7307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7304,7307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":244,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7443,7446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7443,7446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7525,7528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7525,7528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":252,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":252,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7732,7732],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7901,7904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7901,7904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8218,8221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8218,8221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":270,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8400,8403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8400,8403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8531,8534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8531,8534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":279,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":279,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8743,8743],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8785,8788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8785,8788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":291,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":291,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9071,9071],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":305,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9601,9604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9601,9604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10063,10066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10063,10066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10802,10805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10802,10805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11001,11004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11001,11004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":360,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11418,11421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11418,11421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":367,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11601,11604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11601,11604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":398,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":398,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12283,12286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12283,12286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":25,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase as defaultClient } from '@/integrations/supabase/client';\n\ntype ChargeInput = {\n  type: string;\n  amount: number;\n  currency?: string;\n  note?: string;\n  basis?: string;\n  quantity?: number;\n};\n\ntype CarrierQuoteInput = {\n  // Optional when updating existing rates; present for upsert flows\n  carrier_rate_id?: string;\n  carrier_id: string;\n  mode?: string; // 'ocean' | 'air' | 'trucking' | 'courier' | 'moving' | 'railway_transport'\n  buying_charges: ChargeInput[];\n  selling_charges: ChargeInput[];\n};\n\ntype CreateRateParams = {\n  tenant_id: string;\n  carrier_id: string;\n  service_id?: string | null;\n  origin_port_id?: string | null;\n  destination_port_id?: string | null;\n  mode?: string | null;\n  currency?: string | null;\n  base_rate?: number | null;\n  rate_reference_id?: string | null; // e.g. quote id or number\n};\n\nconst chargeTypeMap = (mode: string | undefined, type: string): string => {\n  const t = String(type || '').toLowerCase();\n  switch (t) {\n    case 'freight':\n      return mode === 'air' ? 'AFT' : 'OFT';\n    case 'fuel':\n      return 'BAF';\n    case 'handling':\n    case 'origin':\n    case 'destination':\n      return 'THC';\n    case 'documentation':\n    case 'other':\n      return 'DOC';\n    case 'customs':\n      return 'ISF';\n    default:\n      return 'DOC';\n  }\n};\n\nexport async function createCarrierRate(params: CreateRateParams, client = defaultClient): Promise<string> {\n  // Pre-generate an ID so we can rely on it even if RLS prevents returning the inserted row\n  const preGeneratedId = crypto.randomUUID();\n  const payload: any = {\n    id: preGeneratedId,\n    tenant_id: params.tenant_id,\n    carrier_id: params.carrier_id,\n    service_id: params.service_id || null,\n    origin_port_id: params.origin_port_id || null,\n    destination_port_id: params.destination_port_id || null,\n    mode: params.mode || null,\n    currency: params.currency || 'USD',\n    base_rate: params.base_rate ?? 0,\n    rate_reference_id: params.rate_reference_id || null,\n    status: 'active',\n  };\n\n  const { data, error } = (client as any)\n    .from('carrier_rates')\n    .insert([payload])\n    .select('id');\n  if (error) throw error;\n\n  // Supabase may return an array or object depending on policies; if not, rely on preGeneratedId\n  const insertedId: string | undefined = Array.isArray(data) ? (data[0]?.id as string | undefined) : (data?.id as string | undefined);\n  return insertedId || preGeneratedId;\n}\n\nexport async function upsertChargesForRate(\n  tenant_id: string,\n  carrier_rate_id: string,\n  mode: string | undefined,\n  charges: ChargeInput[],\n  client = defaultClient,\n): Promise<void> {\n  if (!charges || charges.length === 0) return;\n  const rows = charges.map((c) => ({\n    tenant_id,\n    carrier_rate_id,\n    charge_type: chargeTypeMap(mode, c.type),\n    basis: c.basis || null,\n    quantity: c.quantity ?? 1,\n    amount: Number(c.amount || 0),\n    currency: c.currency || 'USD',\n    notes: c.note || null,\n  }));\n  const { error } = (client as any).from('carrier_rate_charges').insert(rows);\n  if (error) throw error;\n}\n\nexport async function createRatesAndChargesForQuote(\n  quoteId: string,\n  tenant_id: string,\n  service_id: string | null,\n  origin_port_id: string | null,\n  destination_port_id: string | null,\n  carrierQuotes: CarrierQuoteInput[],\n  client = defaultClient,\n): Promise<string[]> {\n  const rateIds: string[] = [];\n  for (const cq of carrierQuotes) {\n    if (!cq.carrier_id) continue;\n    const rateId = await createCarrierRate(\n      {\n        tenant_id,\n        carrier_id: cq.carrier_id,\n        service_id,\n        origin_port_id,\n        destination_port_id,\n        mode: cq.mode || null,\n        currency: 'USD',\n        base_rate: 0,\n        rate_reference_id: quoteId,\n      },\n      client,\n    );\n    await upsertChargesForRate(tenant_id, rateId, cq.mode, [...(cq.buying_charges || []), ...(cq.selling_charges || [])], client);\n    rateIds.push(rateId);\n  }\n  return rateIds;\n}\n\n// Upsert carrier rates and charges for a quote. If a carrier_rate_id is provided,\n// charges are replaced for that rate and minimal metadata is updated; otherwise a new rate is created.\n// Any existingRateIds not present in the provided carrierQuotes are deleted.\nexport async function upsertRatesAndChargesForQuote(\n  quoteId: string,\n  tenant_id: string,\n  service_id: string | null,\n  origin_port_id: string | null,\n  destination_port_id: string | null,\n  carrierQuotes: CarrierQuoteInput[],\n  existingRateIds: string[] = [],\n  client = defaultClient,\n): Promise<string[]> {\n  const finalRateIds: string[] = [];\n  const keptRateIds = new Set<string>();\n\n  for (const cq of (carrierQuotes || [])) {\n    if (!cq.carrier_id && !cq.carrier_rate_id) continue;\n    let rateId = cq.carrier_rate_id ? String(cq.carrier_rate_id) : undefined;\n\n    // Create new rate if none provided\n    if (!rateId) {\n      rateId = await createCarrierRate(\n        {\n          tenant_id,\n          carrier_id: cq.carrier_id,\n          service_id,\n          origin_port_id,\n          destination_port_id,\n          mode: cq.mode || null,\n          currency: 'USD',\n          base_rate: 0,\n          rate_reference_id: quoteId,\n        },\n        client,\n      );\n    } else {\n      // Best-effort metadata update for existing rate\n      try {\n        await (client as any)\n          .from('carrier_rates')\n          .update({\n            carrier_id: cq.carrier_id,\n            service_id: service_id || null,\n            origin_port_id: origin_port_id || null,\n            destination_port_id: destination_port_id || null,\n            mode: cq.mode || null,\n            rate_reference_id: quoteId,\n          })\n          .eq('id', rateId);\n      } catch {}\n    }\n\n    // Replace charges for this rate to avoid duplication\n    await (client as any)\n      .from('carrier_rate_charges')\n      .delete()\n      .eq('carrier_rate_id', rateId);\n\n    const mergedCharges: ChargeInput[] = [\n      ...((cq.buying_charges || []) as ChargeInput[]),\n      ...((cq.selling_charges || []) as ChargeInput[]),\n    ];\n    await upsertChargesForRate(tenant_id, rateId!, cq.mode, mergedCharges, client);\n\n    finalRateIds.push(rateId!);\n    keptRateIds.add(rateId!);\n  }\n\n  // Remove any rates that were previously saved but not included now\n  const toRemove = (existingRateIds || [])\n    .map((id) => String(id))\n    .filter((id) => !keptRateIds.has(id));\n\n  if (toRemove.length > 0) {\n    await (client as any)\n      .from('carrier_rate_charges')\n      .delete()\n      .in('carrier_rate_id', toRemove);\n    await (client as any)\n      .from('carrier_rates')\n      .delete()\n      .in('id', toRemove);\n  }\n\n  return finalRateIds;\n}\n\nexport async function listCarrierRatesForQuote(\n  quoteId: string,\n  client = defaultClient,\n): Promise<Array<{ id: string; carrier_id: string; mode: string | null; charges: any[] }>> {\n  // Primary: fetch by rate_reference_id = quoteId\n  const { data: byRef, error: refErr } = (client as any)\n    .from('carrier_rates')\n    .select('id, carrier_id, mode, charges:carrier_rate_charges(*)')\n    .eq('rate_reference_id', quoteId);\n  if (refErr) throw refErr;\n  let rows: any[] = byRef || [];\n\n  // Fallback 1: some older or mismatched saves might reference quote_number\n  if (!rows || rows.length === 0) {\n    try {\n      const { data: quote } = (client as any)\n        .from('quotes')\n        .select('quote_number')\n        .eq('id', quoteId)\n        .maybeSingle();\n      const qn = (quote as any)?.quote_number;\n      if (qn) {\n        const { data: byNumber } = (client as any)\n          .from('carrier_rates')\n          .select('id, carrier_id, mode, charges:carrier_rate_charges(*)')\n          .eq('rate_reference_id', qn);\n        rows = byNumber || rows;\n      }\n    } catch {}\n  }\n\n  // Fallback 2: if still empty, resolve via quotation versions/options\n  if (!rows || rows.length === 0) {\n    try {\n      const { data: versions } = (client as any)\n        .from('quotation_versions')\n        .select('id')\n        .eq('quote_id', quoteId)\n        .order('version_number', { ascending: false })\n        .limit(1);\n      const versionId = Array.isArray(versions) ? versions[0]?.id : versions?.id;\n      if (versionId) {\n        const { data: opts } = (client as any)\n          .from('quotation_version_options')\n          .select('carrier_rate_id')\n          .eq('quotation_version_id', versionId);\n        const rateIds = (opts || []).map((o: any) => String(o.carrier_rate_id)).filter(Boolean);\n        if (rateIds.length > 0) {\n          const { data: byIds } = (client as any)\n            .from('carrier_rates')\n            .select('id, carrier_id, mode, charges:carrier_rate_charges(*)')\n            .in('id', rateIds);\n          rows = byIds || rows;\n        }\n      }\n    } catch {}\n  }\n\n  const out = (rows || []).map((r: any) => ({\n    id: String(r.id),\n    carrier_id: String(r.carrier_id),\n    mode: r.mode || null,\n    charges: r.charges || [],\n  }));\n  if (import.meta.env.DEV) {\n    try {\n      console.debug('[hydrate:rates]', { quoteId, rows: (rows || []).length, mapped: out.length });\n    } catch {}\n  }\n  return out;\n}\n\nexport async function createQuotationVersionWithOptions(\n  tenant_id: string,\n  franchise_id: string,\n  quote_id: string,\n  carrier_rate_ids: string[],\n  opts: { major?: number; minor?: number; change_reason?: string; valid_until?: string; created_by?: string | null; version_number?: number; kind?: 'minor' | 'major' } = {},\n  client = defaultClient,\n): Promise<{ version_id: string; option_ids: string[] }> {\n  // Allow creating versions without carrier rates (can be added later)\n  const versionPayload: any = {\n    tenant_id,\n    franchise_id,\n    quote_id,\n    major: opts.major ?? 1,\n    minor: opts.minor ?? 0,\n    version_number: opts.version_number ?? 1,\n    kind: opts.kind ?? 'minor',\n    change_reason: opts.change_reason || null,\n    valid_until: opts.valid_until || null,\n    created_by: opts.created_by || null,\n  };\n  // Insert version and safely extract the returned id regardless of shape\n  const { data: versionData, error: vErr } = await (client as any)\n    .from('quotation_versions')\n    .insert(versionPayload)\n    .select('id');\n  if (vErr) throw vErr;\n  const version_id = Array.isArray(versionData)\n    ? (versionData[0]?.id as string | undefined)\n    : (versionData?.id as string | undefined);\n  if (!version_id) throw new Error('Version insert did not return id');\n\n  // Only create options if there are carrier rates to link\n  let option_ids: string[] = [];\n  if (carrier_rate_ids.length > 0) {\n    const optionRows = carrier_rate_ids.map((rid) => ({\n      tenant_id,\n      franchise_id,\n      quotation_version_id: version_id,\n      carrier_rate_id: rid,\n      recommended: false,\n      status: 'active',\n    }));\n    const { data: optionsData, error: oErr } = await (client as any)\n      .from('quotation_version_options')\n      .insert(optionRows)\n      .select('id');\n    if (oErr) throw oErr;\n    option_ids = Array.isArray(optionsData)\n      ? (optionsData || []).map((x: any) => x.id as string)\n      : optionsData?.id\n        ? [optionsData.id as string]\n        : [];\n  }\n  return { version_id, option_ids };\n}\n\nexport async function createBlankOption(\n  tenant_id: string,\n  franchise_id: string,\n  version_id: string,\n  client = defaultClient\n): Promise<string> {\n  // Generate option name using the database function\n  const { data: optionName, error: nameError } = await (client as any).rpc('generate_next_option_name', {\n    p_version_id: version_id\n  });\n\n  if (nameError) throw nameError;\n\n  // Create the blank option\n  const { data, error } = await (client as any)\n    .from('quotation_version_options')\n    .insert({\n      tenant_id,\n      franchise_id,\n      quotation_version_id: version_id,\n      option_name: optionName,\n      status: 'active',\n      recommended: false,\n      auto_margin_enabled: false,\n      buy_subtotal: 0,\n      sell_subtotal: 0,\n      margin_amount: 0,\n      total_amount: 0\n    })\n    .select('id')\n    .single();\n\n  if (error) throw error;\n  return data.id;\n}\n\nexport async function recordCustomerSelection(\n  tenant_id: string,\n  quote_id: string,\n  version_id: string,\n  option_id: string,\n  reason: string | null,\n  user_id: string,\n  client = defaultClient,\n): Promise<void> {\n  const { error } = (client as any).rpc('record_customer_selection', {\n    p_tenant_id: tenant_id,\n    p_quote_id: quote_id,\n    p_version_id: version_id,\n    p_option_id: option_id,\n    p_reason: reason,\n    p_user_id: user_id,\n  });\n  if (error) throw error;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/integrations/supabase/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/integrations/supabase/seedPortsLocations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/integrations/supabase/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/lib/import-export.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[578,581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[578,581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[620,623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[620,623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[659,662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[659,662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":122,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":125,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[706,709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[706,709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":140,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":143,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[724,727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[724,727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[874,877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[874,877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1341,1344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1341,1344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1781,1784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1781,1784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2136,2139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2136,2139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2533,2536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2533,2536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as XLSX from 'xlsx';\n\nexport const parseFileRows = async (file: File): Promise<string[][]> => {\n  const name = file.name.toLowerCase();\n  if (name.endsWith('.csv')) {\n    const text = await file.text();\n    return text.split(/\\r?\\n/).map(l => l.split(',')).filter(r => r.some(v => v && v.trim().length));\n  } else if (name.endsWith('.xlsx') || name.endsWith('.xls')) {\n    const buf = await file.arrayBuffer();\n    const wb = XLSX.read(buf, { type: 'array' });\n    const ws = wb.Sheets[wb.SheetNames[0]];\n    const json = XLSX.utils.sheet_to_json(ws, { header: 1 }) as any[];\n    return (json || []).filter((r: any) => Array.isArray(r) && r.some((v: any) => v && String(v).trim().length)).map((r: any) => r.map((v: any) => String(v)));\n  }\n  throw new Error('Unsupported file type');\n};\n\nexport const downloadErrorsCsv = (filename: string, headers: string[], rows: any[]) => {\n  if (!rows?.length) return;\n  const csv = [headers.join(','), ...rows.map(r => headers.map(h => JSON.stringify(r[h] ?? '')).join(','))].join('\\n');\n  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n};\n\nexport const exportCsv = (filename: string, headers: string[], rows: any[]) => {\n  const csv = [headers.join(','), ...rows.map(r => headers.map(h => JSON.stringify(r[h] ?? '')).join(','))].join('\\n');\n  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n};\n\nexport const exportExcel = (filename: string, headers: string[], rows: any[]) => {\n  const aoa = [headers, ...rows.map(r => headers.map(h => r[h] ?? ''))];\n  const ws = XLSX.utils.aoa_to_sheet(aoa);\n  const wb = XLSX.utils.book_new();\n  XLSX.utils.book_append_sheet(wb, ws, 'Export');\n  XLSX.writeFile(wb, filename);\n};\n\nexport const exportJsonTemplate = (filename: string, headers: string[]) => {\n  const obj: Record<string, any> = {};\n  headers.forEach(h => { obj[h] = ''; });\n  const data = [obj];\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n};\n\nexport const exportJson = (filename: string, rows: any[]) => {\n  const blob = new Blob([JSON.stringify(rows ?? [], null, 2)], { type: 'application/json;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n};","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/lib/logger.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[231,234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[231,234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403,406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403,406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[653,656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[653,656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[788,791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[788,791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1628,1631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1628,1631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1732,1735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1732,1735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1835,1838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1835,1838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1939,1942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1939,1942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Client-side Logger for React/Browser\nexport enum LogLevel {\n  DEBUG = 'debug',\n  INFO = 'info',\n  WARN = 'warn',\n  ERROR = 'error',\n}\n\nexport interface LogEntry {\n  level: LogLevel;\n  message: string;\n  context?: Record<string, any>;\n  timestamp: string;\n}\n\nconst isProduction = import.meta.env.PROD;\n\nclass LoggerService {\n  private static instance: LoggerService;\n  private context: Record<string, any> = {};\n\n  private constructor() {}\n\n  static getInstance(): LoggerService {\n    if (!LoggerService.instance) {\n      LoggerService.instance = new LoggerService();\n    }\n    return LoggerService.instance;\n  }\n\n  setContext(context: Record<string, any>) {\n    this.context = { ...this.context, ...context };\n  }\n\n  private log(level: LogLevel, message: string, data?: Record<string, any>) {\n    const entry: LogEntry = {\n      level,\n      message,\n      context: { ...this.context, ...data },\n      timestamp: new Date().toISOString(),\n    };\n\n    // In production, we might want to suppress DEBUG logs or send ERRORs to a monitoring service\n    if (isProduction && level === LogLevel.DEBUG) {\n      return;\n    }\n\n    const style = this.getStyle(level);\n    console.log(`%c[${level.toUpperCase()}] ${message}`, style, entry.context || '');\n  }\n\n  private getStyle(level: LogLevel): string {\n    switch (level) {\n      case LogLevel.DEBUG: return 'color: #9E9E9E';\n      case LogLevel.INFO: return 'color: #2196F3';\n      case LogLevel.WARN: return 'color: #FFC107';\n      case LogLevel.ERROR: return 'color: #F44336; font-weight: bold';\n      default: return '';\n    }\n  }\n\n  debug(message: string, data?: Record<string, any>) {\n    this.log(LogLevel.DEBUG, message, data);\n  }\n\n  info(message: string, data?: Record<string, any>) {\n    this.log(LogLevel.INFO, message, data);\n  }\n\n  warn(message: string, data?: Record<string, any>) {\n    this.log(LogLevel.WARN, message, data);\n  }\n\n  error(message: string, data?: Record<string, any>) {\n    this.log(LogLevel.ERROR, message, data);\n  }\n}\n\nexport const logger = LoggerService.getInstance();\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/lib/oauth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[378,381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[378,381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[671,674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[671,674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1645,1648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1645,1648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1925,1928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1925,1928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2227,2230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2227,2230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3532,3535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3532,3535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from \"@/integrations/supabase/client\";\n\ninterface OAuthConfig {\n  client_id: string;\n  client_secret: string;\n  tenant_id_provider?: string;\n  redirect_uri: string;\n}\n\nexport async function initiateGoogleOAuth(userId: string) {\n  try {\n    // Fetch OAuth configuration\n    const { data: config, error } = await supabase\n      .from(\"oauth_configurations\" as any)\n      .select(\"*\")\n      .eq(\"user_id\", userId)\n      .eq(\"provider\", \"gmail\")\n      .eq(\"is_active\", true)\n      .single();\n\n    if (error || !config) {\n      throw new Error(\"Gmail OAuth not configured. Please configure OAuth settings first.\");\n    }\n\n    const oauthConfig = config as any as OAuthConfig;\n\n    // Generate state parameter for security\n    const state = crypto.randomUUID();\n    sessionStorage.setItem(\"oauth_state\", state);\n    sessionStorage.setItem(\"oauth_provider\", \"gmail\");\n\n    // Build Google OAuth URL\n    const params = new URLSearchParams({\n      client_id: oauthConfig.client_id,\n      redirect_uri: oauthConfig.redirect_uri,\n      response_type: \"code\",\n      scope: [\n        \"https://www.googleapis.com/auth/gmail.readonly\",\n        \"https://www.googleapis.com/auth/gmail.send\",\n        \"https://www.googleapis.com/auth/gmail.modify\",\n        \"https://www.googleapis.com/auth/userinfo.email\",\n        \"https://www.googleapis.com/auth/userinfo.profile\",\n      ].join(\" \"),\n      access_type: \"offline\",\n      prompt: \"consent\",\n      state,\n    });\n\n    const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;\n    \n    // Redirect to Google OAuth\n    window.location.href = authUrl;\n  } catch (error: any) {\n    throw new Error(error.message || \"Failed to initiate Google OAuth\");\n  }\n}\n\nexport async function initiateMicrosoftOAuth(userId: string) {\n  try {\n    // Fetch OAuth configuration\n    const { data: config, error } = await supabase\n      .from(\"oauth_configurations\" as any)\n      .select(\"*\")\n      .eq(\"user_id\", userId)\n      .eq(\"provider\", \"office365\")\n      .eq(\"is_active\", true)\n      .single();\n\n    if (error || !config) {\n      throw new Error(\"Office 365 OAuth not configured. Please configure OAuth settings first.\");\n    }\n\n    const oauthConfig = config as any as OAuthConfig;\n\n    // Generate state parameter for security\n    const state = crypto.randomUUID();\n    sessionStorage.setItem(\"oauth_state\", state);\n    sessionStorage.setItem(\"oauth_provider\", \"office365\");\n\n  // Determine tenant based on email hint to avoid tenant mismatch on token exchange\n  const hintEmail = sessionStorage.getItem(\"oauth_hint_email\") || \"\";\n  const lowerEmail = hintEmail.toLowerCase();\n  const isMSA = /@(hotmail|outlook|live|msn)\\.com$/.test(lowerEmail);\n  const tenantId = isMSA ? \"consumers\" : (oauthConfig.tenant_id_provider || \"common\");\n\n  // Build Microsoft OAuth URL\n  const params = new URLSearchParams({\n    client_id: oauthConfig.client_id,\n    redirect_uri: oauthConfig.redirect_uri,\n    response_type: \"code\",\n    scope: [\n      \"https://graph.microsoft.com/Mail.Read\",\n      \"https://graph.microsoft.com/Mail.Send\",\n      \"https://graph.microsoft.com/Mail.ReadWrite\",\n      \"offline_access\",\n      \"openid\",\n      \"profile\",\n      \"email\",\n    ].join(\" \"),\n    prompt: \"consent\",\n    state,\n  });\n\n  if (hintEmail) {\n    params.set(\"login_hint\", hintEmail);\n  }\n\n  const authUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/authorize?${params.toString()}`;\n  \n  // Redirect to Microsoft OAuth\n  window.location.href = authUrl;\n  } catch (error: any) {\n    throw new Error(error.message || \"Failed to initiate Microsoft OAuth\");\n  }\n}\n\nexport async function handleOAuthCallback() {\n  const params = new URLSearchParams(window.location.search);\n  const code = params.get(\"code\");\n  const state = params.get(\"state\");\n  const error = params.get(\"error\");\n\n  if (error) {\n    throw new Error(`OAuth error: ${error}`);\n  }\n\n  // Verify state parameter\n  const savedState = sessionStorage.getItem(\"oauth_state\");\n  const provider = sessionStorage.getItem(\"oauth_provider\");\n\n  if (!code || !state || state !== savedState) {\n    throw new Error(\"Invalid OAuth callback\");\n  }\n\n  // Clean up session storage\n  sessionStorage.removeItem(\"oauth_state\");\n  sessionStorage.removeItem(\"oauth_provider\");\n\n  return {\n    code,\n    provider: provider as \"gmail\" | \"office365\",\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/lib/posthog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/lib/sentry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/lib/utils.test.ts","messages":[{"ruleId":"no-constant-binary-expression","severity":2,"message":"Unexpected constant truthiness on the left-hand side of a `&&` expression.","line":11,"column":31,"nodeType":"Literal","messageId":"constantShortCircuit","endLine":11,"endColumn":36}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { cn, matchText } from './utils';\n\ndescribe('utils', () => {\n  describe('cn', () => {\n    it('should merge class names correctly', () => {\n      expect(cn('bg-red-500', 'text-white')).toBe('bg-red-500 text-white');\n    });\n\n    it('should handle conditional classes', () => {\n      expect(cn('bg-red-500', false && 'text-white', 'p-4')).toBe('bg-red-500 p-4');\n    });\n\n    it('should resolve tailwind conflicts', () => {\n      expect(cn('bg-red-500', 'bg-blue-500')).toBe('bg-blue-500');\n    });\n  });\n\n  describe('matchText', () => {\n    it('should match contains by default', () => {\n      expect(matchText('Hello World', 'World')).toBe(true);\n      expect(matchText('Hello World', 'Foo')).toBe(false);\n    });\n\n    it('should match equals', () => {\n      expect(matchText('Hello', 'hello', 'equals')).toBe(true);\n      expect(matchText('Hello', 'Hello World', 'equals')).toBe(false);\n    });\n\n    it('should match startsWith', () => {\n      expect(matchText('Hello World', 'Hell', 'startsWith')).toBe(true);\n      expect(matchText('Hello World', 'World', 'startsWith')).toBe(false);\n    });\n\n    it('should match endsWith', () => {\n      expect(matchText('Hello World', 'World', 'endsWith')).toBe(true);\n      expect(matchText('Hello World', 'Hello', 'endsWith')).toBe(false);\n    });\n\n    it('should handle null/undefined values', () => {\n      expect(matchText(null, 'foo')).toBe(false);\n      expect(matchText(undefined, 'foo')).toBe(false);\n    });\n\n    it('should return true for empty query', () => {\n      expect(matchText('Hello', '')).toBe(true);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/Auth.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1065,1068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1065,1068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2524,2527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2524,2527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAuth } from '@/hooks/useAuth';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { toast } from 'sonner';\nimport { Loader2 } from 'lucide-react';\nimport { z } from 'zod';\nimport sosLogo from '@/assets/sos-logo.png';\n\nconst loginSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(8, 'Password must be at least 8 characters')\n});\n\nexport default function Auth() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const { signIn, user } = useAuth();\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  const from = (location.state as any)?.from?.pathname || '/dashboard';\n\n  useEffect(() => {\n    if (user) {\n      navigate(from, { replace: true });\n    }\n  }, [user, navigate, from]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    try {\n      loginSchema.parse({ email, password });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        toast.error(error.errors[0].message);\n        return;\n      }\n    }\n\n    setLoading(true);\n\n    const { error } = await signIn(email, password);\n\n    if (error) {\n      // If initial admin credentials fail, attempt to auto-seed the admin account\n      const isAdminEmail = email.trim().toLowerCase() === 'bahuguna.vimal@gmail.com';\n      if (error.message.includes('Invalid login credentials') && isAdminEmail) {\n        try {\n          const { data, error: seedError } = await supabase.functions.invoke('seed-platform-admin', {\n            body: { email, password }\n          });\n\n          if (seedError) {\n            // Fall back to guidance if seeding fails\n            toast.error('Admin account not found. Use Setup to create it.');\n          } else if (data?.success) {\n            toast.success('Admin created. Signing you in...');\n            const { error: retryError } = await signIn(email, password);\n            if (!retryError) {\n              navigate(from, { replace: true });\n              setLoading(false);\n              return;\n            }\n          }\n        } catch (e: any) {\n          // Edge function may not be deployed; guide the user\n          toast.error('Setup required. Please run Platform Setup.');\n        }\n      } else if (error.message.includes('Email not confirmed')) {\n        toast.error('Please verify your email address');\n      } else {\n        toast.error(error.message);\n      }\n      setLoading(false);\n      return;\n    }\n\n    toast.success('Welcome back!');\n    navigate(from, { replace: true });\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-primary/5 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1 text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <img src={sosLogo} alt=\"SOS Logistic Pro Enterprise\" className=\"h-20 w-20\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold\">SOS Logistic Pro Enterprise</CardTitle>\n          <CardDescription>\n            Sign in to your account to continue\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"admin@example.com\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                disabled={loading}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                disabled={loading}\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n              {loading ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Signing in...\n                </>\n              ) : (\n                'Sign In'\n              )}\n            </Button>\n            <div className=\"pt-2 text-center text-sm text-muted-foreground\">\n              First time setup? <a href=\"/setup-admin\" className=\"text-primary underline\">Create Platform Admin</a>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/Dashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchDashboardStats'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchDashboardStats]","fix":{"range":[955,957],"text":"[fetchDashboardStats]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1693,1696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1693,1696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Building2, Users, UserPlus, CheckSquare } from 'lucide-react';\nimport { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { KanbanDashboard } from '@/components/dashboard/KanbanDashboard';\n\ninterface DashboardStats {\n  accounts: number;\n  leads: number;\n  contacts: number;\n  activities: number;\n}\n\nexport default function Dashboard() {\n  const navigate = useNavigate();\n  const [stats, setStats] = useState<DashboardStats>({\n    accounts: 0,\n    leads: 0,\n    contacts: 0,\n    activities: 0\n  });\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    fetchDashboardStats();\n  }, []);\n\n  const fetchDashboardStats = async () => {\n    try {\n      setLoading(true);\n      \n      const [accountsResult, leadsResult, contactsResult, activitiesResult] = await Promise.all([\n        supabase.from('accounts').select('*', { count: 'exact', head: true }),\n        supabase.from('leads').select('*', { count: 'exact', head: true }),\n        supabase.from('contacts').select('*', { count: 'exact', head: true }),\n        supabase.from('activities').select('*', { count: 'exact', head: true })\n      ]);\n\n      setStats({\n        accounts: accountsResult.count || 0,\n        leads: leadsResult.count || 0,\n        contacts: contactsResult.count || 0,\n        activities: activitiesResult.count || 0\n      });\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: 'Failed to load dashboard statistics',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const statCards = [\n    {\n      title: 'Total Accounts',\n      value: loading ? '-' : stats.accounts.toString(),\n      icon: Building2,\n      change: '+0%',\n      trend: 'up',\n      path: '/dashboard/accounts'\n    },\n    {\n      title: 'Active Leads',\n      value: loading ? '-' : stats.leads.toString(),\n      icon: UserPlus,\n      change: '+0%',\n      trend: 'up',\n      path: '/dashboard/leads'\n    },\n    {\n      title: 'Contacts',\n      value: loading ? '-' : stats.contacts.toString(),\n      icon: Users,\n      change: '+0%',\n      trend: 'up',\n      path: '/dashboard/contacts'\n    },\n    {\n      title: 'Activities',\n      value: loading ? '-' : stats.activities.toString(),\n      icon: CheckSquare,\n      change: '+0%',\n      trend: 'up',\n      path: '/dashboard/activities'\n    }\n  ];\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Dashboard</h1>\n          <p className=\"text-muted-foreground\">Welcome to SOSLogicPro CRM</p>\n        </div>\n\n        {/* Kanban Dashboard Overview */}\n        <KanbanDashboard />\n\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          {statCards.map((stat) => {\n            const Icon = stat.icon;\n            return (\n              <Card \n                key={stat.title} \n                className=\"cursor-pointer hover:shadow-lg transition-shadow\"\n                onClick={() => navigate(stat.path)}\n              >\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">\n                    {stat.title}\n                  </CardTitle>\n                  <Icon className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{stat.value}</div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    <span className={stat.trend === 'up' ? 'text-green-500' : 'text-red-500'}>\n                      {stat.change}\n                    </span>{' '}\n                    from last month\n                  </p>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Recent Activities</CardTitle>\n              <CardDescription>Your latest CRM activities</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground text-center py-8\">\n                No recent activities\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Pipeline Overview</CardTitle>\n              <CardDescription>Sales pipeline status</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground text-center py-8\">\n                No pipeline data\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/Index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/Landing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/OAuthCallback.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2319,2322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2319,2322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { handleOAuthCallback } from \"@/lib/oauth\";\nimport { Loader2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function OAuthCallback() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [status, setStatus] = useState<\"processing\" | \"success\" | \"error\">(\"processing\");\n\n  useEffect(() => {\n    const processCallback = async () => {\n      try {\n        // Get the authorization code from URL\n        const { code, provider } = await handleOAuthCallback();\n\n        // Get current user\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n          throw new Error(\"User not authenticated\");\n        }\n\n        // Pull optional hints from session storage\n        const emailAddress = sessionStorage.getItem(\"oauth_hint_email\") || undefined;\n        const displayName = sessionStorage.getItem(\"oauth_hint_name\") || undefined;\n        const isPrimary = sessionStorage.getItem(\"oauth_hint_is_primary\") === \"true\" || undefined;\n        const accountIdHint = sessionStorage.getItem(\"oauth_account_id\") || undefined;\n\n        // Exchange code for tokens\n        const { data, error } = await supabase.functions.invoke(\"exchange-oauth-token\", {\n          body: {\n            code,\n            provider,\n            userId: user.id,\n            emailAddress,\n            displayName,\n            isPrimary,\n            accountIdHint,\n          },\n        });\n\n        if (error) throw error;\n\n        setStatus(\"success\");\n        toast({\n          title: \"Account Connected\",\n          description: `Your ${provider === \"gmail\" ? \"Gmail\" : \"Office 365\"} account has been successfully connected.`,\n        });\n\n        // Clean hints to avoid leaking between attempts\n        sessionStorage.removeItem(\"oauth_hint_email\");\n        sessionStorage.removeItem(\"oauth_hint_name\");\n        sessionStorage.removeItem(\"oauth_hint_is_primary\");\n        sessionStorage.removeItem(\"oauth_account_id\");\n\n        // Redirect to email management page after a short delay\n        setTimeout(() => {\n          navigate(\"/dashboard/email-management\");\n        }, 1200);\n      } catch (error: any) {\n        console.error(\"OAuth callback error:\", error);\n        setStatus(\"error\");\n        toast({\n          title: \"Connection Failed\",\n          description: error.message || \"Failed to connect your email account. Please try again.\",\n          variant: \"destructive\",\n        });\n\n        // Redirect back after error\n        setTimeout(() => {\n          navigate(\"/dashboard/email-management\");\n        }, 3000);\n      }\n    };\n\n    processCallback();\n  }, [navigate, toast]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background\">\n      <div className=\"text-center space-y-4\">\n        {status === \"processing\" && (\n          <>\n            <Loader2 className=\"w-12 h-12 animate-spin mx-auto text-primary\" />\n            <h2 className=\"text-2xl font-semibold\">Connecting Your Account</h2>\n            <p className=\"text-muted-foreground\">Please wait while we complete the authorization...</p>\n          </>\n        )}\n        {status === \"success\" && (\n          <>\n            <div className=\"w-12 h-12 mx-auto rounded-full bg-green-500 flex items-center justify-center\">\n              <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n              </svg>\n            </div>\n            <h2 className=\"text-2xl font-semibold\">Successfully Connected!</h2>\n            <p className=\"text-muted-foreground\">Redirecting you back...</p>\n          </>\n        )}\n        {status === \"error\" && (\n          <>\n            <div className=\"w-12 h-12 mx-auto rounded-full bg-red-500 flex items-center justify-center\">\n              <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </div>\n            <h2 className=\"text-2xl font-semibold\">Connection Failed</h2>\n            <p className=\"text-muted-foreground\">Redirecting you back...</p>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/SetupAdmin.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1076,1079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1076,1079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { toast } from 'sonner';\nimport { Loader2, Shield } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\n\nexport default function SetupAdmin() {\n  const [loading, setLoading] = useState(false);\n  const [created, setCreated] = useState(false);\n\n  const handleSetup = async () => {\n    setLoading(true);\n\n    try {\n      const { data, error } = await supabase.functions.invoke('seed-platform-admin', {\n        body: {\n          email: 'Bahuguna.vimal@gmail.com',\n          password: 'Vimal@1234'\n        }\n      });\n\n      if (error) throw error;\n\n      if (data?.success) {\n        toast.success('Platform admin created successfully!');\n        setCreated(true);\n      } else {\n        toast.error(data?.error || 'Failed to create admin');\n      }\n    } catch (error: any) {\n      console.error('Setup error:', error);\n      toast.error(error.message || 'Failed to create platform admin');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-primary/5 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1 text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center\">\n              <Shield className=\"h-8 w-8 text-primary\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-2xl font-bold\">Platform Setup</CardTitle>\n          <CardDescription>\n            Create the platform administrator account\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {created ? (\n            <div className=\"space-y-4\">\n              <div className=\"p-4 rounded-lg bg-primary/10 text-center\">\n                <p className=\"font-medium mb-2\"> Admin Created Successfully</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Email: Bahuguna.vimal@gmail.com\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Password: Vimal@1234\n                </p>\n                <p className=\"text-xs text-muted-foreground mt-2\">\n                   Please change password on first login\n                </p>\n              </div>\n              <Button \n                className=\"w-full\" \n                onClick={() => window.location.href = '/auth'}\n              >\n                Go to Login\n              </Button>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              <div className=\"p-4 rounded-lg bg-muted/50 space-y-2\">\n                <p className=\"text-sm font-medium\">Platform Admin Details:</p>\n                <div className=\"space-y-1 text-sm text-muted-foreground\">\n                  <p> Email: Bahuguna.vimal@gmail.com</p>\n                  <p> Password: Vimal@1234</p>\n                  <p className=\"text-xs pt-2 text-amber-600\">\n                     You will be required to change this password on first login\n                  </p>\n                </div>\n              </div>\n              <Button \n                onClick={handleSetup} \n                className=\"w-full\" \n                disabled={loading}\n              >\n                {loading ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Creating Platform Admin...\n                  </>\n                ) : (\n                  'Create Platform Admin'\n                )}\n              </Button>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/Unauthorized.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/AccountDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1156,1159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1156,1159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1393,1396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1393,1396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1454,1457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1454,1457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1519,1522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1519,1522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1584,1587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1584,1587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAccount'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccount, id]","fix":{"range":[1830,1834],"text":"[fetchAccount, id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2602,2605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2602,2605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4046,4049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4046,4049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4147,4150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4147,4150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5085,5088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5085,5088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5486,5489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5486,5489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { AccountForm } from '@/components/crm/AccountForm';\nimport { ArrowLeft, Edit, Trash2, Building2, Phone, Mail, Globe, DollarSign, Users } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\n\nexport default function AccountDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const [account, setAccount] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [isEditing, setIsEditing] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [relatedContacts, setRelatedContacts] = useState<any[]>([]);\n  const [relatedOpps, setRelatedOpps] = useState<any[]>([]);\n  const [parentAccount, setParentAccount] = useState<any>(null);\n  const [childAccounts, setChildAccounts] = useState<any[]>([]);\n  const [tab, setTab] = useState<'details' | 'related' | 'news'>('details');\n\n  useEffect(() => {\n    // Reset UI state when navigating between accounts\n    setIsEditing(false);\n    setTab('details');\n    if (id) fetchAccount();\n  }, [id]);\n\n  const fetchAccount = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('accounts')\n        .select('*')\n        .eq('id', id)\n        .maybeSingle();\n\n      if (error) throw error;\n      setAccount(data);\n      \n      // Fetch parent account if exists\n      if (data?.parent_account_id) {\n        const { data: parentData } = await supabase\n          .from('accounts')\n          .select('id, name')\n          .eq('id', data.parent_account_id)\n          .maybeSingle();\n        if (parentData) setParentAccount(parentData);\n      }\n      \n      await Promise.all([\n        fetchRelatedContacts(id as string),\n        fetchRelatedOpportunities(id as string),\n        fetchChildAccounts(id as string),\n      ]);\n    } catch (error: any) {\n      toast.error('Failed to load account');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchRelatedContacts = async (accountId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('contacts')\n        .select('id, first_name, last_name, email, phone')\n        .eq('account_id', accountId)\n        .limit(5);\n      if (error) throw error;\n      setRelatedContacts(data || []);\n    } catch (err) {\n      console.error('Failed to load related contacts', err);\n    }\n  };\n\n  const fetchRelatedOpportunities = async (accountId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('opportunities')\n        .select('id, name, stage, amount, close_date')\n        .eq('account_id', accountId)\n        .limit(5);\n      if (error) throw error;\n      setRelatedOpps(data || []);\n    } catch (err) {\n      console.error('Failed to load related opportunities', err);\n    }\n  };\n\n  const fetchChildAccounts = async (accountId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('accounts')\n        .select('id, name, account_type, status')\n        .eq('parent_account_id', accountId)\n        .order('name');\n      if (error) throw error;\n      setChildAccounts(data || []);\n    } catch (err) {\n      console.error('Failed to load child accounts', err);\n    }\n  };\n\n  const handleUpdate = async (formData: any) => {\n    try {\n      // Normalize and avoid overwriting with empty strings\n      const payload: any = {\n        ...formData,\n        parent_account_id:\n          formData.parent_account_id === 'none' || formData.parent_account_id === ''\n            ? null\n            : formData.parent_account_id || null,\n        annual_revenue: formData.annual_revenue ? parseFloat(formData.annual_revenue) : null,\n        employee_count: formData.employee_count ? parseInt(formData.employee_count) : null,\n      };\n\n      // Remove empty string fields so we don't try to set invalid UUIDs or empty values\n      ['tenant_id', 'franchise_id', 'website', 'phone', 'email', 'industry', 'description'].forEach((key) => {\n        if (payload[key] === '') delete payload[key];\n      });\n\n      const { error } = await supabase\n        .from('accounts')\n        .update(payload)\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Account updated successfully');\n      setIsEditing(false);\n      fetchAccount();\n    } catch (error: any) {\n      toast.error('Failed to update account');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const { error } = await supabase\n        .from('accounts')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Account deleted successfully');\n      navigate('/dashboard/accounts');\n    } catch (error: any) {\n      toast.error('Failed to delete account');\n      console.error('Error:', error);\n    }\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Loading account...</p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!account) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Account not found</p>\n          <Button onClick={() => navigate('/dashboard/accounts')} className=\"mt-4\">\n            Back to Accounts\n          </Button>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/accounts')}>\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">{account.name}</h1>\n              <p className=\"text-muted-foreground\">Account Details</p>\n            </div>\n          </div>\n          {!isEditing && (\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" onClick={() => setIsEditing(true)}>\n                <Edit className=\"mr-2 h-4 w-4\" />\n                Edit\n              </Button>\n              <Button variant=\"destructive\" onClick={() => setShowDeleteDialog(true)}>\n                <Trash2 className=\"mr-2 h-4 w-4\" />\n                Delete\n              </Button>\n            </div>\n          )}\n        </div>\n\n        {isEditing ? (\n          <Card>\n            <CardHeader>\n              <CardTitle>Edit Account</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <AccountForm\n                initialData={account}\n                onSubmit={handleUpdate}\n                onCancel={() => setIsEditing(false)}\n              />\n            </CardContent>\n          </Card>\n        ) : (\n          <Tabs value={tab} onValueChange={(v) => setTab(v as 'details' | 'related' | 'news')} key={id}>\n            <TabsList>\n              <TabsTrigger value=\"details\">Details</TabsTrigger>\n              <TabsTrigger value=\"related\">Related</TabsTrigger>\n              <TabsTrigger value=\"news\">News</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"details\">\n              <div className=\"grid gap-6 md:grid-cols-2\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Building2 className=\"h-5 w-5\" />\n                      Basic Information\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    {parentAccount && (\n                      <div className=\"p-3 bg-muted rounded-lg\">\n                        <p className=\"text-sm font-medium text-muted-foreground\">Parent Account</p>\n                        <Button\n                          variant=\"link\"\n                          className=\"p-0 h-auto text-primary\"\n                          onClick={() => navigate(`/dashboard/accounts/${parentAccount.id}`)}\n                        >\n                          {parentAccount.name}\n                        </Button>\n                      </div>\n                    )}\n                    <div>\n                      <p className=\"text-sm font-medium text-muted-foreground\">Type</p>\n                      <Badge className=\"mt-1\">{account.account_type}</Badge>\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium text-muted-foreground\">Status</p>\n                      <Badge className=\"mt-1\">{account.status}</Badge>\n                    </div>\n                    {account.industry && (\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">Industry</p>\n                        <p className=\"text-sm\">{account.industry}</p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Contact Information</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    {account.phone && (\n                      <div className=\"flex items-center gap-2\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-sm\">{account.phone}</span>\n                      </div>\n                    )}\n                    {account.email && (\n                      <div className=\"flex items-center gap-2\">\n                        <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-sm\">{account.email}</span>\n                      </div>\n                    )}\n                    {account.website && (\n                      <div className=\"flex items-center gap-2\">\n                        <Globe className=\"h-4 w-4 text-muted-foreground\" />\n                        <a href={account.website} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline\">\n                          {account.website}\n                        </a>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Company Details</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    {account.annual_revenue && (\n                      <div className=\"flex items-center gap-2\">\n                        <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n                        <div>\n                          <p className=\"text-sm font-medium text-muted-foreground\">Annual Revenue</p>\n                          <p className=\"text-sm\">${parseFloat(account.annual_revenue).toLocaleString()}</p>\n                        </div>\n                      </div>\n                    )}\n                    {account.employee_count && (\n                      <div className=\"flex items-center gap-2\">\n                        <Users className=\"h-4 w-4 text-muted-foreground\" />\n                        <div>\n                          <p className=\"text-sm font-medium text-muted-foreground\">Employees</p>\n                          <p className=\"text-sm\">{account.employee_count}</p>\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {account.description && (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle>Description</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">{account.description}</p>\n                    </CardContent>\n                  </Card>\n                )}\n\n                <Card className=\"md:col-span-2\">\n                  <CardHeader>\n                    <CardTitle>Metadata</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm text-muted-foreground\">\n                    <div>Created: {format(new Date(account.created_at), 'PPpp')}</div>\n                    <div>Last Updated: {format(new Date(account.updated_at), 'PPpp')}</div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"related\">\n              <div className=\"grid gap-6 md:grid-cols-2\">\n                {childAccounts.length > 0 && (\n                  <Card className=\"md:col-span-2\">\n                    <CardHeader>\n                      <CardTitle>Child Accounts</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-2\">\n                        {childAccounts.map((child) => (\n                          <div key={child.id} className=\"flex items-center justify-between p-2 hover:bg-muted rounded-lg\">\n                            <div>\n                              <p className=\"font-medium\">{child.name}</p>\n                              <p className=\"text-sm text-muted-foreground\">\n                                {child.account_type}  {child.status}\n                              </p>\n                            </div>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => navigate(`/dashboard/accounts/${child.id}`)}\n                            >\n                              View\n                            </Button>\n                          </div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                <Card className=\"md:col-span-2\">\n                  <CardHeader>\n                    <CardTitle>Duplicates</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-sm text-muted-foreground\">We found no potential duplicates of this Account.</p>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"flex items-center justify-between\">\n                    <CardTitle>Contacts</CardTitle>\n                    <Button size=\"sm\" onClick={() => navigate('/dashboard/contacts/new')}>New</Button>\n                  </CardHeader>\n                  <CardContent>\n                    {relatedContacts.length === 0 ? (\n                      <p className=\"text-sm text-muted-foreground\">No contacts yet</p>\n                    ) : (\n                      <div className=\"space-y-2\">\n                        {relatedContacts.map((c) => (\n                          <div key={c.id} className=\"flex items-center justify-between\">\n                            <div>\n                              <p className=\"font-medium\">{c.first_name} {c.last_name}</p>\n                              <p className=\"text-sm text-muted-foreground\">{c.email || c.phone || '-'}</p>\n                            </div>\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate(`/dashboard/contacts/${c.id}`)}>View</Button>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"flex items-center justify-between\">\n                    <CardTitle>Opportunities</CardTitle>\n                    <Button size=\"sm\" onClick={() => navigate('/dashboard/opportunities/new')}>New</Button>\n                  </CardHeader>\n                  <CardContent>\n                    {relatedOpps.length === 0 ? (\n                      <p className=\"text-sm text-muted-foreground\">No opportunities yet</p>\n                    ) : (\n                      <div className=\"space-y-2\">\n                        {relatedOpps.map((o) => (\n                          <div key={o.id} className=\"flex items-center justify-between\">\n                            <div>\n                              <p className=\"font-medium\">{o.name}</p>\n                              <p className=\"text-sm text-muted-foreground\">Stage: {o.stage}  Amount: {o.amount ?? '-'}  Close: {o.close_date ? new Date(o.close_date).toLocaleDateString() : '-'}</p>\n                            </div>\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate(`/dashboard/opportunities/${o.id}`)}>View</Button>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"news\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>News</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-muted-foreground\">Company/industry news will appear here.</p>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        )}\n\n        <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Delete Account</AlertDialogTitle>\n              <AlertDialogDescription>\n                Are you sure you want to delete this account? This action cannot be undone.\n                All related contacts and activities will also be affected.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel>Cancel</AlertDialogCancel>\n              <AlertDialogAction onClick={handleDelete} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n                Delete\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/AccountNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[581,584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[581,584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1588,1591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1588,1591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { AccountForm } from '@/components/crm/AccountForm';\nimport { ArrowLeft } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nexport default function AccountNew() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n\n  const handleCreate = async (formData: any) => {\n    try {\n      // For platform admins, use the tenant_id from form, otherwise use context\n      const tenantId = context.isPlatformAdmin \n        ? (formData.tenant_id || null)\n        : context.tenantId;\n\n      if (!tenantId) {\n        toast.error('Please select a tenant');\n        return;\n      }\n\n      const { data, error } = await supabase\n        .from('accounts')\n        .insert({\n          ...formData,\n          tenant_id: tenantId,\n          franchise_id: context.franchiseId,\n          parent_account_id: formData.parent_account_id === 'none' ? null : (formData.parent_account_id || null),\n          annual_revenue: formData.annual_revenue ? parseFloat(formData.annual_revenue) : null,\n          employee_count: formData.employee_count ? parseInt(formData.employee_count) : null,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      toast.success('Account created successfully');\n      navigate(`/dashboard/accounts/${data.id}`);\n    } catch (error: any) {\n      toast.error('Failed to create account');\n      console.error('Error:', error);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/accounts')}>\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">New Account</h1>\n            <p className=\"text-muted-foreground\">Create a new company account</p>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Account Information</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <AccountForm\n              onSubmit={handleCreate}\n              onCancel={() => navigate('/dashboard/accounts')}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Accounts.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAccounts'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccounts]","fix":{"range":[1377,1379],"text":"[fetchAccounts]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Plus, Search, Building2, Phone, Mail, Globe } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport TitleStrip from '@/components/ui/title-strip';\nimport { Badge } from '@/components/ui/badge';\nimport { Table, TableBody, TableCell, TableHeader, TableRow, SortableHead } from '@/components/ui/table';\nimport { useSort } from '@/hooks/useSort';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { useCRM } from '@/hooks/useCRM';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Link } from 'react-router-dom';\nimport { toast } from 'sonner';\n\ninterface Account {\n  id: string;\n  name: string;\n  account_type: string;\n  status: string;\n  industry: string | null;\n  phone: string | null;\n  email: string | null;\n  website: string | null;\n  created_at: string;\n}\n\nexport default function Accounts() {\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [viewMode, setViewMode] = useState<ViewMode>('card');\n  const { supabase } = useCRM();\n\n  useEffect(() => {\n    fetchAccounts();\n  }, []);\n\n  const fetchAccounts = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('accounts')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setAccounts(data || []);\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to load accounts');\n      console.error('Error:', message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredAccounts = accounts.filter(account =>\n    account.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    account.industry?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const { sorted: sortedAccounts, sortField, sortDirection, onSort } = useSort<Account>(filteredAccounts, {\n    accessors: {\n      name: (a: Account) => a.name,\n      type: (a: Account) => a.account_type ?? '',\n      status: (a: Account) => a.status ?? '',\n      industry: (a: Account) => a.industry ?? '',\n      phone: (a: Account) => a.phone ?? '',\n      email: (a: Account) => a.email ?? '',\n    },\n  });\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active': return 'bg-green-500/10 text-green-500';\n      case 'inactive': return 'bg-gray-500/10 text-gray-500';\n      case 'pending': return 'bg-yellow-500/10 text-yellow-500';\n      default: return 'bg-gray-500/10 text-gray-500';\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'customer': return 'bg-blue-500/10 text-blue-500';\n      case 'prospect': return 'bg-purple-500/10 text-purple-500';\n      case 'partner': return 'bg-teal-500/10 text-teal-500';\n      case 'vendor': return 'bg-orange-500/10 text-orange-500';\n      default: return 'bg-gray-500/10 text-gray-500';\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Accounts</h1>\n          <p className=\"text-muted-foreground\">Manage your company accounts</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <ViewToggle value={viewMode} onChange={setViewMode} />\n          <Button asChild variant=\"outline\">\n            <Link to=\"/dashboard/accounts/pipeline\">Pipeline View</Link>\n          </Button>\n          <Button asChild>\n            <Link to=\"/dashboard/accounts/new\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New Account\n            </Link>\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search accounts...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n      </div>\n\n      {loading ? (\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Loading accounts...</p>\n        </div>\n      ) : filteredAccounts.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Building2 className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No accounts found</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {searchQuery ? 'Try adjusting your search' : 'Get started by creating your first account'}\n            </p>\n            {!searchQuery && (\n              <Button asChild>\n                <Link to=\"/dashboard/accounts/new\">\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Create Account\n                </Link>\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : (\n        viewMode === 'list' ? (\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <TitleStrip label=\"All Accounts\" />\n            </CardHeader>\n            <CardContent>\n              <Table>\n              <TableHeader className=\"bg-[hsl(var(--title-strip))] [&_th]:text-white [&_th]:font-semibold [&_th]:text-xs [&_th]:px-3 [&_th]:py-2 [&_th]:border-l [&_th]:border-white/60\">\n                <TableRow className=\"border-b-2\" style={{ borderBottomColor: 'hsl(var(--title-strip))' }}>\n                  <SortableHead field=\"name\" activeField={sortField} direction={sortDirection} onSort={onSort}>Name</SortableHead>\n                  <SortableHead field=\"type\" activeField={sortField} direction={sortDirection} onSort={onSort}>Type</SortableHead>\n                  <SortableHead field=\"status\" activeField={sortField} direction={sortDirection} onSort={onSort}>Status</SortableHead>\n                  <SortableHead field=\"industry\" activeField={sortField} direction={sortDirection} onSort={onSort}>Industry</SortableHead>\n                  <SortableHead field=\"phone\" activeField={sortField} direction={sortDirection} onSort={onSort}>Phone</SortableHead>\n                  <SortableHead field=\"email\" activeField={sortField} direction={sortDirection} onSort={onSort}>Email</SortableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {sortedAccounts.map((account) => (\n                    <TableRow key={account.id} className=\"cursor-pointer\" onClick={() => {}}>\n                      <TableCell>\n                        <Link className=\"font-medium hover:underline\" to={`/dashboard/accounts/${account.id}`}>{account.name}</Link>\n                      </TableCell>\n                      <TableCell>{account.account_type}</TableCell>\n                      <TableCell>\n                        <Badge className={getStatusColor(account.status)}>{account.status}</Badge>\n                      </TableCell>\n                      <TableCell>{account.industry || '-'}</TableCell>\n                      <TableCell>{account.phone || '-'}</TableCell>\n                      <TableCell>{account.email || '-'}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        ) : viewMode === 'grid' ? (\n          <div className=\"space-y-2\">\n            <TitleStrip label=\"All Accounts\" />\n            <div className=\"grid gap-3 grid-cols-2 md:grid-cols-3 lg:grid-cols-4\">\n              {filteredAccounts.map((account) => (\n                <Link key={account.id} to={`/dashboard/accounts/${account.id}`}>\n                  <Card className=\"hover:shadow transition-shadow cursor-pointer\">\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-base truncate\">{account.name}</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"flex items-center justify-between\">\n                      <Badge className={getTypeColor(account.account_type)}>{account.account_type}</Badge>\n                      <Badge className={getStatusColor(account.status)}>{account.status}</Badge>\n                    </CardContent>\n                  </Card>\n                </Link>\n              ))}\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            <TitleStrip label=\"All Accounts\" />\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {filteredAccounts.map((account) => (\n                <Link key={account.id} to={`/dashboard/accounts/${account.id}`}>\n                  <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <Building2 className=\"h-10 w-10 text-primary\" />\n                        <div className=\"flex gap-2\">\n                          <Badge className={getStatusColor(account.status)}>\n                            {account.status}\n                          </Badge>\n                          <Badge className={getTypeColor(account.account_type)}>\n                            {account.account_type}\n                          </Badge>\n                        </div>\n                      </div>\n                      <CardTitle className=\"mt-4\">{account.name}</CardTitle>\n                      {account.industry && (\n                        <CardDescription>{account.industry}</CardDescription>\n                      )}\n                    </CardHeader>\n                    <CardContent className=\"space-y-2\">\n                      {account.phone && (\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Phone className=\"h-4 w-4\" />\n                          <span>{account.phone}</span>\n                        </div>\n                      )}\n                      {account.email && (\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Mail className=\"h-4 w-4\" />\n                          <span className=\"truncate\">{account.email}</span>\n                        </div>\n                      )}\n                      {account.website && (\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Globe className=\"h-4 w-4\" />\n                          <span className=\"truncate\">{account.website}</span>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                </Link>\n              ))}\n            </div>\n          </div>\n        )\n      )}\n    </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/AccountsPipeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAccounts'. Either include it or remove the dependency array.","line":100,"column":6,"nodeType":"ArrayExpression","endLine":100,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccounts]","fix":{"range":[3954,3956],"text":"[fetchAccounts]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'searchParams'. Either include it or remove the dependency array.","line":233,"column":6,"nodeType":"ArrayExpression","endLine":233,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams]","fix":{"range":[9316,9318],"text":"[searchParams]"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'searchParams' and 'setSearchParams'. Either include them or remove the dependency array.","line":228,"column":6,"nodeType":"ArrayExpression","endLine":228,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams, selectedStages, setSearchParams]","fix":{"range":[9189,9205],"text":"[searchParams, selectedStages, setSearchParams]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { ArrowLeft, Search, Filter, Layers, Settings, CheckSquare, Square, AlertCircle, LayoutGrid } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DndContext, DragEndEvent, DragOverlay, DragStartEvent, PointerSensor, useSensor, useSensors } from \"@dnd-kit/core\";\nimport { Droppable } from \"@/components/kanban/Droppable\";\nimport { Draggable } from \"@/components/kanban/Draggable\";\nimport { SwimLane } from \"@/components/kanban/SwimLane\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { KanbanFunnel } from \"@/components/kanban/KanbanFunnel\";\n\ntype AccountStage = 'new_account' | 'kyc_pending' | 'active' | 'vip' | 'payment_issues' | 'inactive' | 'blocked';\ntype AccountType = 'prospect' | 'customer' | 'partner' | 'vendor';\ntype AccountStatusDB = 'active' | 'inactive' | 'pending';\n\ninterface Account {\n  id: string;\n  name: string;\n  account_type: AccountType | null;\n  status: AccountStatusDB | null;\n  industry: string | null;\n  phone: string | null;\n  email: string | null;\n  created_at: string;\n  franchise_id: string | null;\n}\n\nconst stageLabels: Record<AccountStage, string> = {\n  new_account: ' New Account',\n  kyc_pending: ' KYC Pending',\n  active: ' Active',\n  vip: ' VIP/Premium',\n  payment_issues: ' Payment Issues',\n  inactive: ' Inactive',\n  blocked: ' Blocked',\n};\n\nconst stageColors: Record<AccountStage, string> = {\n  new_account: 'bg-blue-500/10 text-blue-700 dark:text-blue-300',\n  kyc_pending: 'bg-yellow-500/10 text-yellow-700 dark:text-yellow-300',\n  active: 'bg-green-500/10 text-green-700 dark:text-green-300',\n  vip: 'bg-purple-500/10 text-purple-700 dark:text-purple-300',\n  payment_issues: 'bg-orange-500/10 text-orange-700 dark:text-orange-300',\n  inactive: 'bg-gray-500/10 text-gray-700 dark:text-gray-300',\n  blocked: 'bg-red-500/10 text-red-700 dark:text-red-300',\n};\n\nconst stages: AccountStage[] = ['new_account','kyc_pending','active','vip','payment_issues','inactive','blocked'];\n\nexport default function AccountsPipeline() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { context } = useCRM();\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const [groupBy, setGroupBy] = useState<'none' | 'type'>('none');\n  const [franchiseFilter, setFranchiseFilter] = useState<string>('all');\n\n  const [wipLimits, setWipLimits] = useState<Record<AccountStage, number>>({\n    new_account: 50,\n    kyc_pending: 50,\n    active: 999,\n    vip: 999,\n    payment_issues: 999,\n    inactive: 999,\n    blocked: 999,\n  });\n\n  const [showFields, setShowFields] = useState({\n    industry: true,\n    phone: true,\n    email: true,\n  });\n\n  const [selected, setSelected] = useState<Set<string>>(new Set());\n  const [bulkMode, setBulkMode] = useState(false);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: { distance: 8 },\n    })\n  );\n\n  useEffect(() => {\n    fetchAccounts();\n  }, []);\n\n  const fetchAccounts = async () => {\n    try {\n      setLoading(true);\n      let query = supabase\n        .from(\"accounts\")\n        .select(\"*\")\n        .order(\"created_at\", { ascending: false });\n\n      if (!context.isPlatformAdmin) {\n        if (context.franchiseId) query = query.eq(\"franchise_id\", context.franchiseId);\n        else if (context.tenantId) query = query.eq(\"tenant_id\", context.tenantId as string);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setAccounts((data || []) as Account[]);\n    } catch (error) {\n      toast({ title: \"Error\", description: \"Failed to fetch accounts\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const computeStage = (a: Account): AccountStage => {\n    const status = (a.status || '').toLowerCase();\n    const type = (a.account_type || '').toLowerCase();\n    if (status === 'suspended') return 'blocked';\n    if (status === 'inactive') return 'inactive';\n    if (status === 'active' && type === 'customer') return 'active';\n    if (status === 'active' && type === 'prospect') return 'active';\n    if (status === 'pending' && type === 'prospect') return 'new_account';\n    if (status === 'pending') return 'kyc_pending';\n    return 'new_account';\n  };\n\n  const filtered = accounts.filter((a) => {\n    const s = searchQuery.toLowerCase();\n    const matchesSearch = !searchQuery || a.name.toLowerCase().includes(s) || (a.industry || '').toLowerCase().includes(s);\n    const matchesType = typeFilter === 'all' || (a.account_type || '') === typeFilter;\n    const matchesFranchise = franchiseFilter === 'all' || a.franchise_id === franchiseFilter;\n    return matchesSearch && matchesType && matchesFranchise;\n  });\n\n  const grouped: Record<AccountStage, Account[]> = stages.reduce((acc, stage) => {\n    acc[stage] = filtered.filter((a) => computeStage(a) === stage);\n    return acc;\n  }, {} as Record<AccountStage, Account[]>);\n\n  const toggleSelection = (id: string) => {\n    setSelected((prev) => {\n      const next = new Set(prev);\n      if (next.has(id)) next.delete(id); else next.add(id);\n      return next;\n    });\n  };\n\n  const handleStageChange = async (accountId: string, newStage: AccountStage) => {\n    const updates: { status: AccountStatusDB } = { status: 'pending' };\n    if (newStage === 'blocked' || newStage === 'inactive') updates.status = 'inactive';\n    else if (newStage === 'active' || newStage === 'vip') updates.status = 'active';\n    else updates.status = 'pending';\n    try {\n      const { error } = await supabase.from('accounts').update(updates).eq('id', accountId);\n      if (error) throw error;\n      setAccounts((prev) => prev.map((a) => a.id === accountId ? { ...a, ...updates } : a));\n      toast({ title: 'Success', description: 'Account stage updated' });\n    } catch (error) {\n      toast({ title: 'Error', description: 'Failed to update account', variant: 'destructive' });\n    }\n  };\n\n  const handleDragStart = (e: DragStartEvent) => {\n    setActiveId(e.active.id as string);\n  };\n\n  const handleDragEnd = (e: DragEndEvent) => {\n    const { active, over } = e;\n    setActiveId(null);\n    if (!over) return;\n    const id = active.id as string;\n    const newStage = over.id as AccountStage;\n    const a = accounts.find((x) => x.id === id);\n    if (!a) return;\n    const currentStage = computeStage(a);\n    if (currentStage === newStage) return;\n    handleStageChange(id, newStage);\n  };\n\n  const activeAccount = activeId ? accounts.find((a) => a.id === activeId) : null;\n\n  const getSwimLanes = () => {\n    if (groupBy === 'none') return [{ id: 'all', title: 'All Accounts', items: filtered }];\n    if (groupBy === 'type') {\n      const prospect = filtered.filter(a => (a.account_type || '').toLowerCase() === 'prospect');\n      const customer = filtered.filter(a => (a.account_type || '').toLowerCase() === 'customer');\n      const partner = filtered.filter(a => (a.account_type || '').toLowerCase() === 'partner');\n      const vendor = filtered.filter(a => (a.account_type || '').toLowerCase() === 'vendor');\n      return [\n        { id: 'prospect', title: 'Prospect', items: prospect },\n        { id: 'customer', title: 'Customer', items: customer },\n        { id: 'partner', title: 'Partner', items: partner },\n        { id: 'vendor', title: 'Vendor', items: vendor },\n      ].filter(l => l.items.length > 0);\n    }\n    return [{ id: 'all', title: 'All Accounts', items: filtered }];\n  };\n\n  const lanes = getSwimLanes();\n\n  // Multi-stage selection with deep-linking via `stage` query param\n  const [searchParams, setSearchParams] = useSearchParams();\n  const initialStagesParam = searchParams.get('stage');\n  const initialSelectedStages = (initialStagesParam ? initialStagesParam.split(',') : [])\n    .filter((s): s is AccountStage => (stages as string[]).includes(s));\n  const [selectedStages, setSelectedStages] = useState<AccountStage[]>(initialSelectedStages);\n\n  useEffect(() => {\n    const next = new URLSearchParams(searchParams);\n    if (selectedStages.length > 0) {\n      next.set('stage', selectedStages.join(','));\n    } else {\n      next.delete('stage');\n    }\n    setSearchParams(next);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedStages]);\n\n  useEffect(() => {\n    const fr = searchParams.get('franchise');\n    if (fr) setFranchiseFilter(fr);\n  }, []);\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Accounts Pipeline</h1>\n            <p className=\"text-muted-foreground\">\n              Lifecycle stages for customer accounts\n              {(() => {\n                const selectedTotal = selectedStages.length\n                  ? selectedStages.reduce((acc, s) => acc + (grouped[s]?.length || 0), 0)\n                  : filtered.length;\n                const fullTotal = filtered.length;\n                return (\n                  <span className=\"ml-2 text-xs\">\n                    {selectedStages.length > 0 ? `Selected: ${selectedTotal} of ${fullTotal}` : `Total: ${fullTotal}`}\n                  </span>\n                );\n              })()}\n            </p>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate(\"/dashboard/accounts\")}> \n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to List\n          </Button>\n        </div>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-4\">\n              {(() => {\n                const labelMap: Record<AccountStage, string> = Object.fromEntries(\n                  stages.map((s) => [s, stageLabels[s]])\n                ) as Record<AccountStage, string>;\n                const colorMap: Record<AccountStage, string> = Object.fromEntries(\n                  stages.map((s) => [s, stageColors[s]])\n                ) as Record<AccountStage, string>;\n                const baseCountMap: Record<AccountStage, number> = Object.fromEntries(\n                  stages.map((s) => [s, (grouped[s]?.length || 0)])\n                ) as Record<AccountStage, number>;\n                const countMap: Record<AccountStage, number> = selectedStages.length > 0\n                  ? Object.fromEntries(stages.map((s) => [s, selectedStages.includes(s) ? baseCountMap[s] : 0])) as Record<AccountStage, number>\n                  : baseCountMap;\n                const totalCount = selectedStages.length > 0\n                  ? selectedStages.reduce((acc, s) => acc + baseCountMap[s], 0)\n                  : filtered.length;\n\n                return (\n                  <KanbanFunnel\n                    stages={stages}\n                    labels={labelMap}\n                    colors={colorMap}\n                    counts={countMap}\n                    total={totalCount}\n                    activeStages={selectedStages}\n                    onStageClick={(s) => {\n                      setSelectedStages((prev) => {\n                        const exists = prev.includes(s);\n                        const nextSel = exists ? prev.filter((x) => x !== s) : [...prev, s];\n                        return nextSel.sort((a, b) => stages.indexOf(a) - stages.indexOf(b));\n                      });\n                    }}\n                    onClearStage={() => setSelectedStages([])}\n                  />\n                );\n              })()}\n              <div className=\"flex flex-col md:flex-row gap-4\">\n                <div className=\"flex-1 relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input placeholder=\"Search accounts...\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className=\"pl-9\" />\n                </div>\n                <Select value={typeFilter} onValueChange={setTypeFilter}>\n                  <SelectTrigger className=\"w-full md:w-[200px]\">\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Types</SelectItem>\n                    <SelectItem value=\"prospect\">Prospect</SelectItem>\n                    <SelectItem value=\"customer\">Customer</SelectItem>\n                    <SelectItem value=\"partner\">Partner</SelectItem>\n                    <SelectItem value=\"vendor\">Vendor</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Select value={groupBy} onValueChange={(v) => setGroupBy(v as typeof groupBy)}>\n                  <SelectTrigger className=\"w-full md:w-[200px]\">\n                    <Layers className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Group By\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">No Grouping</SelectItem>\n                    <SelectItem value=\"type\">By Type</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"flex items-center justify-between pt-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Button variant={bulkMode ? \"default\" : \"outline\"} size=\"sm\" onClick={() => { setBulkMode(!bulkMode); setSelected(new Set()); }}>\n                    <CheckSquare className=\"h-4 w-4 mr-2\" />\n                    {bulkMode ? \"Cancel Selection\" : \"Bulk Select\"}\n                  </Button>\n                </div>\n\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\">\n                      <Settings className=\"h-4 w-4 mr-2\" />\n                      Customize Cards\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-80\">\n                    <div className=\"space-y-4\">\n                      <h4 className=\"font-medium\">Card Fields</h4>\n                      <div className=\"space-y-3\">\n                        {Object.entries(showFields).map(([field, show]) => (\n                          <div key={field} className=\"flex items-center space-x-2\">\n                            <Checkbox id={field} checked={show} onCheckedChange={(checked) => setShowFields(prev => ({ ...prev, [field]: !!checked }))} />\n                            <Label htmlFor={field} className=\"capitalize\">{field}</Label>\n                          </div>\n                        ))}\n                      </div>\n                      <Separator />\n                      <h4 className=\"font-medium\">WIP Limits</h4>\n                      <div className=\"space-y-2\">\n{(selectedStages.length ? selectedStages : stages).map(stage => (\n                          <div key={stage} className=\"flex items-center justify-between\">\n                            <Label className=\"text-xs\">{stageLabels[stage]}</Label>\n                            <Input type=\"number\" min=\"0\" value={wipLimits[stage]} onChange={(e) => setWipLimits(prev => ({ ...prev, [stage]: parseInt(e.target.value) || 0 }))} className=\"w-20 h-8\" />\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </PopoverContent>\n                </Popover>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {loading ? (\n          <div className=\"text-center py-12\">Loading accounts...</div>\n        ) : (\n          <DndContext sensors={sensors} onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n            <div className=\"space-y-4\">\n              {lanes.map(lane => {\n                const laneGrouped = stages.reduce((acc, stage) => {\n                  acc[stage] = lane.items.filter(a => computeStage(a) === stage);\n                  return acc;\n                }, {} as Record<AccountStage, Account[]>);\n\n                return (\n                  <SwimLane key={lane.id} id={lane.id} title={lane.title} count={lane.items.length}>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-4\">\n{(selectedStages.length ? selectedStages : stages).map((stage) => (\n                        <Droppable key={stage} id={stage}>\n                          <Card className=\"h-full transition-all duration-200 hover:shadow-md\">\n                            <CardHeader className=\"pb-3\">\n                              <CardTitle className=\"text-sm font-medium flex items-center justify-between\">\n                                <span>{stageLabels[stage]}</span>\n                                <div className=\"flex items-center gap-2\">\n                                  <Badge variant=\"secondary\" className={`${stageColors[stage]} transition-all duration-200`}>{laneGrouped[stage].length}</Badge>\n                                  {wipLimits[stage] < 999 && laneGrouped[stage].length >= wipLimits[stage] && (\n                                    <AlertCircle className=\"h-4 w-4 text-destructive\" />\n                                  )}\n                                </div>\n                              </CardTitle>\n                              {wipLimits[stage] < 999 && (\n                                <div className=\"text-xs text-muted-foreground\">Limit: {wipLimits[stage]} {laneGrouped[stage].length > wipLimits[stage] && (<span className=\"text-destructive ml-1\">(+{laneGrouped[stage].length - wipLimits[stage]} over)</span>)}\n                                </div>\n                              )}\n                            </CardHeader>\n                            <CardContent className=\"space-y-2 min-h-[200px]\">\n                              {laneGrouped[stage].map((a) => (\n                                <Draggable key={a.id} id={a.id}>\n                                  <Card className=\"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1 animate-fade-in relative\" onClick={() => navigate(`/dashboard/accounts/${a.id}`)}>\n                                    <CardContent className=\"p-3 space-y-2\">\n                                      <div className=\"font-medium text-sm\">{a.name}</div>\n                                      {showFields.industry && a.industry && (<div className=\"text-xs text-muted-foreground\">{a.industry}</div>)}\n                                      {showFields.email && a.email && (<div className=\"text-xs text-muted-foreground\">{a.email}</div>)}\n                                      {showFields.phone && a.phone && (<div className=\"text-xs text-muted-foreground\">{a.phone}</div>)}\n                                    </CardContent>\n                                  </Card>\n                                </Draggable>\n                              ))}\n                              {laneGrouped[stage].length === 0 && (\n                                <div className=\"text-xs text-muted-foreground text-center py-4\">No accounts in this stage</div>\n                              )}\n                            </CardContent>\n                          </Card>\n                        </Droppable>\n                      ))}\n                    </div>\n                  </SwimLane>\n                );\n              })}\n            </div>\n            <DragOverlay>\n              {activeAccount ? (\n                <Card className=\"w-64 shadow-2xl rotate-3 scale-105 border-2 border-primary animate-scale-in\">\n                  <CardContent className=\"p-3 space-y-2 bg-gradient-to-br from-background to-muted\">\n                    <div className=\"font-medium text-sm\">{activeAccount.name}</div>\n                    {activeAccount.industry && (<div className=\"text-xs text-muted-foreground\">{activeAccount.industry}</div>)}\n                  </CardContent>\n                </Card>\n              ) : null}\n            </DragOverlay>\n          </DndContext>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Activities.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchActivities'. Either include it or remove the dependency array.","line":66,"column":6,"nodeType":"ArrayExpression","endLine":66,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchActivities]","fix":{"range":[3476,3478],"text":"[fetchActivities]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'clearActions' and 'setActions'. Either include them or remove the dependency array.","line":287,"column":8,"nodeType":"ArrayExpression","endLine":287,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [clearActions, items, setActions]","fix":{"range":[10965,10972],"text":"[clearActions, items, setActions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Plus, Search, Phone, Mail, Calendar, CheckSquare, FileText, Clock, AlertCircle, CheckCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport TitleStrip from '@/components/ui/title-strip';\nimport { Table, TableBody, TableCell, TableHeader, TableRow, SortableHead } from '@/components/ui/table';\nimport { useSort } from '@/hooks/useSort';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Pagination, PaginationContent, PaginationItem, PaginationPrevious, PaginationNext, PaginationFirst, PaginationLast, PaginationLink } from '@/components/ui/pagination';\nimport { usePagination } from '@/hooks/usePagination';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAssignableUsers, AssignableUser } from '@/hooks/useAssignableUsers';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { useStickyActions } from '@/components/layout/StickyActionsContext';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { toast } from 'sonner';\nimport { format, isToday, isFuture, isPast, startOfDay } from 'date-fns';\nimport { matchText, TextOp } from '@/lib/utils';\n\ninterface Activity {\n  id: string;\n  activity_type: string;\n  status: string;\n  priority: string;\n  subject: string;\n  description: string | null;\n  due_date: string | null;\n  completed_at: string | null;\n  created_at: string;\n  account_id: string | null;\n  contact_id: string | null;\n  lead_id: string | null;\n  assigned_to: string | null;\n}\n\nexport default function Activities() {\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [activeTab, setActiveTab] = useState('all');\n  const { supabase, context } = useCRM();\n  const { fetchAssignableUsers, formatLabel } = useAssignableUsers();\n  const [typeFilter, setTypeFilter] = useState<'any' | 'email' | 'call' | 'task' | 'meeting' | 'note'>('any');\n  const [ownerFilter, setOwnerFilter] = useState<'any' | 'unassigned' | 'me' | string>('any');\n  const [assignableUsers, setAssignableUsers] = useState<AssignableUser[]>([]);\n  const [showHelp, setShowHelp] = useState(false);\n  const [leadNamesById, setLeadNamesById] = useState<Record<string, string>>({});\n  const [viewMode, setViewMode] = useState<ViewMode>('card');\n  const navigate = useNavigate();\n\n  // Advanced per-column filters\n  const [subjectQuery, setSubjectQuery] = useState('');\n  const [subjectOp, setSubjectOp] = useState<TextOp>('contains');\n  const [descriptionQuery, setDescriptionQuery] = useState('');\n  const [descriptionOp, setDescriptionOp] = useState<TextOp>('contains');\n  const [statusAdv, setStatusAdv] = useState<'any' | 'planned' | 'in_progress' | 'completed' | 'cancelled'>('any');\n  const [priorityAdv, setPriorityAdv] = useState<'any' | 'low' | 'medium' | 'high' | 'urgent'>('any');\n  const [dueStart, setDueStart] = useState<string>('');\n  const [dueEnd, setDueEnd] = useState<string>('');\n  useEffect(() => {\n    fetchActivities();\n  }, []);\n\n  useEffect(() => {\n    const fetchUsers = async () => {\n      const { data } = await fetchAssignableUsers({\n        search: '',\n        limit: 100,\n      });\n      setAssignableUsers(data || []);\n    };\n    fetchUsers();\n  }, [fetchAssignableUsers]);\n\n  useEffect(() => {\n    const firstTimeKey = 'activitiesHelpShown';\n    const hasSeen = localStorage.getItem(firstTimeKey);\n    if (!hasSeen) {\n      setShowHelp(true);\n    }\n  }, []);\n\n  const fetchActivities = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('activities')\n        .select('*')\n        .order('due_date', { ascending: true, nullsFirst: false });\n\n      if (error) throw error;\n      setActivities(data || []);\n\n      // Fetch lead names referenced by activities for grouping headers\n      const leadIds = Array.from(\n        new Set(\n          ((data || []) as Array<{ lead_id: string | null }>)\n            .map((a) => a.lead_id)\n            .filter((id): id is string => !!id)\n        )\n      );\n      if (leadIds.length > 0) {\n        const { data: leadRefs, error: leadErr } = await supabase\n          .from('leads')\n          .select('id, first_name, last_name, company')\n          .in('id', leadIds);\n        if (!leadErr && leadRefs) {\n          const map: Record<string, string> = {};\n          for (const l of leadRefs) {\n            const fullName = [l.first_name, l.last_name].filter(Boolean).join(' ').trim();\n            map[l.id] = fullName || l.company || 'Lead';\n          }\n          setLeadNamesById(map);\n        }\n      } else {\n        setLeadNamesById({});\n      }\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : String(error);\n      toast.error('Failed to load activities', { description: message });\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleMarkComplete = async (activityId: string) => {\n    try {\n      const { error } = await supabase\n        .from('activities')\n        .update({\n          status: 'completed',\n          completed_at: new Date().toISOString(),\n        })\n        .eq('id', activityId);\n\n      if (error) throw error;\n\n      toast.success('Activity marked as completed');\n      fetchActivities();\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : String(error);\n      toast.error('Failed to update activity', { description: message });\n      console.error('Error:', error);\n    }\n  };\n\n  const assignActivityOwner = async (\n    activityId: string,\n    newOwnerId: string | 'none'\n  ) => {\n    try {\n      const assigned_to = newOwnerId === 'none' ? null : newOwnerId;\n      const { error } = await supabase\n        .from('activities')\n        .update({ assigned_to })\n        .eq('id', activityId);\n      if (error) throw error;\n      // Optimistically update local list\n      setActivities((prev) => prev.map((a) => (a.id === activityId ? { ...a, assigned_to } : a)));\n      toast.success('Assignment updated');\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error(err);\n      toast.error(message || 'Failed to update assignment');\n    }\n  };\n\n  const filterActivitiesByTab = (activities: Activity[]) => {\n    const now = startOfDay(new Date());\n    \n    switch (activeTab) {\n      case 'overdue':\n        return activities.filter(\n          a => a.status !== 'completed' && a.status !== 'cancelled' && \n          a.due_date && isPast(new Date(a.due_date)) && !isToday(new Date(a.due_date))\n        );\n      case 'today':\n        return activities.filter(\n          a => a.status !== 'completed' && a.status !== 'cancelled' &&\n          a.due_date && isToday(new Date(a.due_date))\n        );\n      case 'upcoming':\n        return activities.filter(\n          a => a.status !== 'completed' && a.status !== 'cancelled' &&\n          a.due_date && isFuture(new Date(a.due_date)) && !isToday(new Date(a.due_date))\n        );\n      case 'completed':\n        return activities.filter(a => a.status === 'completed');\n      default:\n        return activities;\n    }\n  };\n\n  const filteredActivities = filterActivitiesByTab(activities)\n    .filter(activity => activity.subject.toLowerCase().includes(searchQuery.toLowerCase()))\n    .filter(activity => typeFilter === 'any' ? true : activity.activity_type === typeFilter)\n    .filter(activity => {\n      if (ownerFilter === 'any') return true;\n      if (ownerFilter === 'unassigned') return activity.assigned_to === null;\n      if (ownerFilter === 'me') return activity.assigned_to === (context?.userId || null);\n      return activity.assigned_to === ownerFilter;\n    });\n\n  const filteredActivitiesAdvanced = filteredActivities\n    .filter((activity) => matchText(activity.subject ?? '', subjectQuery, subjectOp))\n    .filter((activity) => matchText(activity.description ?? '', descriptionQuery, descriptionOp))\n    .filter((activity) => (statusAdv === 'any' ? true : activity.status === statusAdv))\n    .filter((activity) => (priorityAdv === 'any' ? true : activity.priority === priorityAdv))\n    .filter((activity) => {\n      if (!dueStart && !dueEnd) return true;\n      if (!activity.due_date) return false;\n      const due = new Date(activity.due_date);\n      const startOk = dueStart ? due >= new Date(dueStart) : true;\n      const endOk = dueEnd ? due <= new Date(dueEnd) : true;\n      return startOk && endOk;\n    });\n\n  const { sorted: sortedActivities, sortField, sortDirection, onSort } = useSort<Activity>(\n    filteredActivitiesAdvanced,\n    {\n      initialField: 'due_date',\n      initialDirection: 'asc',\n      accessors: {\n        subject: (a) => a.subject || '',\n        activity_type: (a) => a.activity_type || '',\n        status: (a) => a.status || '',\n        priority: (a) => a.priority || '',\n        due_date: (a) => (a.due_date ? new Date(a.due_date).getTime() : 0),\n      },\n    }\n  );\n\n  const {\n    pageItems: pagedActivities,\n    pageSize,\n    setPageSize,\n    pageSizeOptions,\n    currentPage,\n    totalPages,\n    nextPage,\n    prevPage,\n    firstPage,\n    lastPage,\n    canPrev,\n    canNext,\n  } = usePagination(sortedActivities, { initialPageSize: 20 });\n\n  const downloadCSV = () => {\n    const header = ['Subject','Type','Status','Priority','Due Date'];\n    const rows = pagedActivities.map(a => [\n      JSON.stringify(a.subject ?? ''),\n      a.activity_type ?? '',\n      a.status ?? '',\n      a.priority ?? '',\n      a.due_date ? new Date(a.due_date).toLocaleString() : ''\n    ]);\n    const csv = [header, ...rows].map(r => r.join(',')).join('\\n');\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'activities.csv';\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const downloadPDF = () => {\n    // Basic print of current page content\n    window.print();\n  };\n\n  // Register sticky actions from within the layout subtree to ensure provider ancestry\n  const StickyActionsRegister = ({ items }: { items: Activity[] }) => {\n    const { setActions, clearActions } = useStickyActions();\n    useEffect(() => {\n      setActions({\n        right: [\n          (<Button key=\"export\" variant=\"outline\" onClick={downloadCSV}>Export</Button>),\n          (<Button key=\"export-pdf\" variant=\"outline\" onClick={downloadPDF}>Export.PDF</Button>),\n        ],\n      });\n      return () => clearActions();\n    }, [items]);\n    return null;\n  };\n\n  const getTabCounts = () => {\n    const now = startOfDay(new Date());\n    return {\n      all: activities.length,\n      overdue: activities.filter(\n        a => a.status !== 'completed' && a.status !== 'cancelled' &&\n        a.due_date && isPast(new Date(a.due_date)) && !isToday(new Date(a.due_date))\n      ).length,\n      today: activities.filter(\n        a => a.status !== 'completed' && a.status !== 'cancelled' &&\n        a.due_date && isToday(new Date(a.due_date))\n      ).length,\n      upcoming: activities.filter(\n        a => a.status !== 'completed' && a.status !== 'cancelled' &&\n        a.due_date && isFuture(new Date(a.due_date)) && !isToday(new Date(a.due_date))\n      ).length,\n      completed: activities.filter(a => a.status === 'completed').length,\n    };\n  };\n\n  const counts = getTabCounts();\n\n  const getActivityIcon = (type: string) => {\n    type IconComponent = typeof Phone;\n    const icons: Record<string, IconComponent> = {\n      call: Phone,\n      email: Mail,\n      meeting: Calendar,\n      task: CheckSquare,\n      note: FileText,\n    };\n    return icons[type] || CheckSquare;\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      planned: 'bg-blue-500/10 text-blue-500',\n      in_progress: 'bg-yellow-500/10 text-yellow-500',\n      completed: 'bg-green-500/10 text-green-500',\n      cancelled: 'bg-red-500/10 text-red-500',\n    };\n    return colors[status] || 'bg-gray-500/10 text-gray-500';\n  };\n\n  const getPriorityColor = (priority: string) => {\n    const colors: Record<string, string> = {\n      urgent: 'bg-red-500/10 text-red-500',\n      high: 'bg-orange-500/10 text-orange-500',\n      medium: 'bg-blue-500/10 text-blue-500',\n      low: 'bg-gray-500/10 text-gray-500',\n    };\n    return colors[priority] || 'bg-gray-500/10 text-gray-500';\n  };\n\n  return (\n    <DashboardLayout>\n      <StickyActionsRegister items={pagedActivities} />\n      <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Activities</h1>\n          <p className=\"text-muted-foreground\">Manage your tasks and activities</p>\n        </div>\n        <div className=\"flex gap-2 flex-wrap items-center\">\n          <ViewToggle value={viewMode} onChange={setViewMode} />\n          <Button asChild variant=\"outline\" size=\"sm\">\n            <Link to=\"/dashboard/activities/new?type=email\">\n              <Mail className=\"mr-2 h-4 w-4\" />\n              Email\n            </Link>\n          </Button>\n          <Button asChild variant=\"outline\" size=\"sm\">\n            <Link to=\"/dashboard/activities/new?type=call\">\n              <Phone className=\"mr-2 h-4 w-4\" />\n              Call\n            </Link>\n          </Button>\n          <Button asChild variant=\"outline\" size=\"sm\">\n            <Link to=\"/dashboard/activities/new?type=task\">\n              <CheckSquare className=\"mr-2 h-4 w-4\" />\n              Task\n            </Link>\n          </Button>\n          <Button asChild variant=\"outline\" size=\"sm\">\n            <Link to=\"/dashboard/activities/new?type=event\">\n              <Calendar className=\"mr-2 h-4 w-4\" />\n              Event\n            </Link>\n          </Button>\n          <Button asChild variant=\"outline\" size=\"sm\">\n            <Link to=\"/dashboard/activities/new?type=note\">\n              <FileText className=\"mr-2 h-4 w-4\" />\n              Note\n            </Link>\n          </Button>\n          <Button asChild>\n            <Link to=\"/dashboard/activities/new\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New\n            </Link>\n          </Button>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n            <div className=\"relative flex-1 max-w-md\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search activities...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-40\">\n                <div className=\"text-xs text-muted-foreground mb-1\">Type</div>\n                <Select value={typeFilter} onValueChange={(v) => setTypeFilter(v as 'any' | 'email' | 'call' | 'task' | 'meeting' | 'note')}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"any\">Any Type</SelectItem>\n                    <SelectItem value=\"email\">Email</SelectItem>\n                    <SelectItem value=\"call\">Call</SelectItem>\n                    <SelectItem value=\"task\">Task</SelectItem>\n                    <SelectItem value=\"meeting\">Event</SelectItem>\n                    <SelectItem value=\"note\">Note</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"w-56\">\n                <div className=\"text-xs text-muted-foreground mb-1\">Owner</div>\n                <Select value={ownerFilter} onValueChange={(v) => setOwnerFilter(v as 'any' | 'unassigned' | 'me' | string)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Owner\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"any\">Any Owner</SelectItem>\n                    <SelectItem value=\"me\">My Activities</SelectItem>\n                    <SelectItem value=\"unassigned\">Unassigned</SelectItem>\n                    {assignableUsers.map((u) => (\n                      <SelectItem key={u.id} value={u.id}>{formatLabel(u)}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </div>\n          <div className=\"mt-3 flex items-center justify-between gap-3\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"text-xs text-muted-foreground\">Cards per page</div>\n              <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Cards\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {pageSizeOptions.map((opt) => (\n                    <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <Pagination className=\"justify-end\">\n              <PaginationContent>\n                <PaginationItem>\n                  <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n              </PaginationContent>\n            </Pagination>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {showHelp && (\n            <div className=\"mb-4 rounded-md border p-3 bg-muted/30 flex items-start gap-3\">\n              <AlertCircle className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n              <div className=\"flex-1\">\n                <div className=\"text-sm font-medium\">Tip: Quickly manage activities</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Use the <span className=\"font-medium\">Type</span> and <span className=\"font-medium\">Owner</span> filters to refine the list. \n                  Use the quick <span className=\"font-medium\">New</span> buttons to instantly create Email, Call, Task, Event, or Note.\n                </div>\n              </div>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => {\n                  localStorage.setItem('activitiesHelpShown', '1');\n                  setShowHelp(false);\n                }}\n              >\n                Got it\n          </Button>\n        </div>\n      )}\n      <div className=\"flex flex-wrap gap-3 mb-3\">\n        <div className=\"flex items-center gap-2\">\n          <Select value={subjectOp} onValueChange={(v) => setSubjectOp(v as TextOp)}>\n            <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Subject op\" /></SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"contains\">Contains</SelectItem>\n              <SelectItem value=\"equals\">Equals</SelectItem>\n              <SelectItem value=\"startsWith\">Starts With</SelectItem>\n              <SelectItem value=\"endsWith\">Ends With</SelectItem>\n            </SelectContent>\n          </Select>\n          <Input\n            placeholder=\"Subject\"\n            value={subjectQuery}\n            onChange={(e) => setSubjectQuery(e.target.value)}\n            className=\"w-[220px]\"\n          />\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Select value={descriptionOp} onValueChange={(v) => setDescriptionOp(v as TextOp)}>\n            <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Description op\" /></SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"contains\">Contains</SelectItem>\n              <SelectItem value=\"equals\">Equals</SelectItem>\n              <SelectItem value=\"startsWith\">Starts With</SelectItem>\n              <SelectItem value=\"endsWith\">Ends With</SelectItem>\n            </SelectContent>\n          </Select>\n          <Input\n            placeholder=\"Description\"\n            value={descriptionQuery}\n            onChange={(e) => setDescriptionQuery(e.target.value)}\n            className=\"w-[260px]\"\n          />\n        </div>\n\n        <div className=\"w-[180px]\">\n          <div className=\"text-xs text-muted-foreground mb-1\">Status</div>\n          <Select value={statusAdv} onValueChange={(v) => setStatusAdv(v as 'any' | 'planned' | 'in_progress' | 'completed' | 'cancelled')}>\n            <SelectTrigger>\n              <SelectValue placeholder=\"Status\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"any\">Any</SelectItem>\n              <SelectItem value=\"planned\">Planned</SelectItem>\n              <SelectItem value=\"in_progress\">In Progress</SelectItem>\n              <SelectItem value=\"completed\">Completed</SelectItem>\n              <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"w-[180px]\">\n          <div className=\"text-xs text-muted-foreground mb-1\">Priority</div>\n          <Select value={priorityAdv} onValueChange={(v) => setPriorityAdv(v as 'any' | 'low' | 'medium' | 'high' | 'urgent')}>\n            <SelectTrigger>\n              <SelectValue placeholder=\"Priority\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"any\">Any</SelectItem>\n              <SelectItem value=\"low\">Low</SelectItem>\n              <SelectItem value=\"medium\">Medium</SelectItem>\n              <SelectItem value=\"high\">High</SelectItem>\n              <SelectItem value=\"urgent\">Urgent</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Input\n            type=\"date\"\n            placeholder=\"Due from\"\n            value={dueStart}\n            onChange={(e) => setDueStart(e.target.value)}\n            className=\"w-[170px]\"\n          />\n          <Input\n            type=\"date\"\n            placeholder=\"Due to\"\n            value={dueEnd}\n            onChange={(e) => setDueEnd(e.target.value)}\n            className=\"w-[170px]\"\n          />\n        </div>\n      </div>\n          <Tabs value={activeTab} onValueChange={setActiveTab}>\n            <TabsList className=\"grid w-full grid-cols-5\">\n              <TabsTrigger value=\"all\" className=\"relative\">\n                All\n                {counts.all > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2 px-1.5 py-0 text-xs\">\n                    {counts.all}\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"overdue\" className=\"relative\">\n                <AlertCircle className=\"h-4 w-4 mr-1\" />\n                Overdue\n                {counts.overdue > 0 && (\n                  <Badge variant=\"destructive\" className=\"ml-2 px-1.5 py-0 text-xs\">\n                    {counts.overdue}\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"today\" className=\"relative\">\n                <Clock className=\"h-4 w-4 mr-1\" />\n                Today\n                {counts.today > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2 px-1.5 py-0 text-xs\">\n                    {counts.today}\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"upcoming\" className=\"relative\">\n                Upcoming\n                {counts.upcoming > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2 px-1.5 py-0 text-xs\">\n                    {counts.upcoming}\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"completed\" className=\"relative\">\n                <CheckCircle className=\"h-4 w-4 mr-1\" />\n                Completed\n                {counts.completed > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2 px-1.5 py-0 text-xs\">\n                    {counts.completed}\n                  </Badge>\n                )}\n              </TabsTrigger>\n            </TabsList>\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      {loading ? (\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Loading activities...</p>\n        </div>\n      ) : filteredActivitiesAdvanced.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <CheckSquare className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No activities found</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {searchQuery ? 'Try adjusting your search' : 'Stay organized by adding your first activity'}\n            </p>\n            {!searchQuery && (\n              <Button asChild>\n                <Link to=\"/dashboard/activities/new\">\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Add Activity\n                </Link>\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : viewMode === 'list' ? (\n        <Card>\n          <CardHeader>\n            <TitleStrip label=\"All Activities\" />\n          </CardHeader>\n          <CardContent>\n              <Table>\n                <TableHeader className=\"bg-[hsl(var(--title-strip))] [&_th]:text-white [&_th]:font-semibold [&_th]:text-xs [&_th]:px-3 [&_th]:py-2 [&_th]:border-l [&_th]:border-white/60\">\n                  <TableRow className=\"border-b-2\" style={{ borderBottomColor: 'hsl(var(--title-strip))' }}>\n                    <SortableHead label=\"Subject\" field=\"subject\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Type\" field=\"activity_type\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Status\" field=\"status\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Priority\" field=\"priority\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Due Date\" field=\"due_date\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                  </TableRow>\n                </TableHeader>\n              <TableBody>\n                {pagedActivities.map((activity) => (\n                  <TableRow\n                    key={activity.id}\n                    className=\"cursor-pointer hover:bg-muted/50\"\n                    onClick={() => navigate(`/dashboard/activities/${activity.id}`)}\n                  >\n                    <TableCell className=\"font-medium\">{activity.subject}</TableCell>\n                    <TableCell className=\"capitalize\">{activity.activity_type}</TableCell>\n                    <TableCell>\n                      <Badge className={getStatusColor(activity.status)}>\n                        {activity.status.replace('_', ' ')}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <Badge className={getPriorityColor(activity.priority)}>\n                        {activity.priority}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      {activity.due_date ? (\n                        format(new Date(activity.due_date), 'MMM dd, yyyy HH:mm')\n                      ) : (\n                        '-'\n                      )}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n            <div className=\"mt-3 flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"text-xs text-muted-foreground\">Rows per page</div>\n                <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                  <SelectTrigger className=\"w-[140px]\">\n                    <SelectValue placeholder=\"Rows\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {pageSizeOptions.map((opt) => (\n                      <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <Pagination className=\"justify-end\">\n                <PaginationContent>\n                  <PaginationItem>\n                    <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                </PaginationContent>\n              </Pagination>\n            </div>\n          </CardContent>\n        </Card>\n      ) : viewMode === 'grid' ? (\n        <div className=\"space-y-2\">\n          <TitleStrip label=\"All Activities\" />\n          <div className=\"grid gap-3 grid-cols-2 md:grid-cols-3 lg:grid-cols-4\">\n            {pagedActivities.map((activity) => {\n            const Icon = getActivityIcon(activity.activity_type);\n            const isOverdue = activity.status !== 'completed' && activity.status !== 'cancelled' &&\n              activity.due_date && isPast(new Date(activity.due_date)) && !isToday(new Date(activity.due_date));\n            return (\n              <Card\n                key={activity.id}\n                className=\"hover:shadow transition-shadow cursor-pointer\"\n                onClick={() => navigate(`/dashboard/activities/${activity.id}`)}\n              >\n                <CardHeader className=\"pb-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-base truncate\">{activity.subject}</CardTitle>\n                    <Badge className={getStatusColor(activity.status)}>{activity.status.replace('_', ' ')}</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"text-sm text-muted-foreground flex items-center justify-between\">\n                  <span className=\"flex items-center gap-2 truncate\">\n                    <Icon className=\"h-4 w-4\" />\n                    {activity.activity_type}\n                  </span>\n                  <span>\n                    {activity.due_date ? (\n                      format(new Date(activity.due_date), 'MMM dd, yyyy HH:mm')\n                    ) : (\n                      'No due date'\n                    )}\n                  </span>\n                </CardContent>\n              </Card>\n            );\n            })}\n          </div>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          <TitleStrip label=\"All Activities\" />\n          {Object.entries(\n            sortedActivities.reduce<Record<string, Activity[]>>((acc, a) => {\n              const key = a.lead_id ?? 'none';\n              (acc[key] ||= []).push(a);\n              return acc;\n            }, {})\n          ).map(([groupId, items]) => {\n            const isNone = groupId === 'none';\n            const headerLabel = isNone ? 'No Lead' : (leadNamesById[groupId] ?? 'Lead');\n            return (\n              <div key={groupId} className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"text-sm text-muted-foreground\">\n                    {isNone ? (\n                      headerLabel\n                    ) : (\n                      <Link to={`/dashboard/leads/${groupId}`} className=\"hover:underline\">\n                        {headerLabel}\n                      </Link>\n                    )}\n                  </div>\n                </div>\n                <ul className=\"space-y-3\">\n                  {items.map((activity) => {\n                    const Icon = getActivityIcon(activity.activity_type);\n                    const isOverdue = activity.status !== 'completed' && activity.status !== 'cancelled' &&\n                      activity.due_date && isPast(new Date(activity.due_date)) && !isToday(new Date(activity.due_date));\n                    return (\n                      <Card \n                        key={activity.id} \n                        className=\"hover:shadow-md transition-shadow cursor-pointer\"\n                        onClick={() => navigate(`/dashboard/activities/${activity.id}`)}\n                      >\n                        <CardHeader>\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-start gap-4\">\n                              <div className=\"p-2 rounded-lg bg-primary/10\">\n                                <Icon className=\"h-5 w-5 text-primary\" />\n                              </div>\n                              <div className=\"space-y-1 flex-1\">\n                                <div className=\"flex items-center gap-2\">\n                                  <CardTitle className=\"text-lg\">{activity.subject}</CardTitle>\n                                  {isOverdue && (\n                                    <Badge variant=\"destructive\" className=\"text-xs\">\n                                      <AlertCircle className=\"h-3 w-3 mr-1\" />\n                                      Overdue\n                                    </Badge>\n                                  )}\n                                </div>\n                                {activity.description && (\n                                  <CardDescription className=\"line-clamp-2\">\n                                    {activity.description}\n                                  </CardDescription>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"flex gap-2 flex-wrap justify-end items-center\">\n                              <Badge className={getStatusColor(activity.status)}>\n                                {activity.status.replace('_', ' ')}\n                              </Badge>\n                              <Badge className={getPriorityColor(activity.priority)}>\n                                {activity.priority}\n                              </Badge>\n                              <div onClick={(e) => e.stopPropagation()}>\n                                <Select\n                                  onValueChange={(v) => assignActivityOwner(activity.id, v as string | 'none')}\n                                  defaultValue={activity.assigned_to ?? 'none'}\n                                >\n                                  <SelectTrigger className=\"w-[200px]\">\n                                    <SelectValue placeholder=\"Assign To\" />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"none\">Unassigned</SelectItem>\n                                    {assignableUsers.map((u) => (\n                                      <SelectItem key={u.id} value={u.id}>{formatLabel(u)}</SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                              <div className=\"flex items-center gap-1\">\n                                <Calendar className=\"h-4 w-4\" />\n                                {activity.due_date ? (\n                                  <span>{format(new Date(activity.due_date), 'MMM dd, yyyy HH:mm')}</span>\n                                ) : (\n                                  <span>No due date</span>\n                                )}\n                              </div>\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                {activity.activity_type}\n                              </Badge>\n                            </div>\n                            {activity.status !== 'completed' && activity.status !== 'cancelled' && (\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  handleMarkComplete(activity.id);\n                                }}\n                              >\n                                <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                Mark Complete\n                              </Button>\n                            )}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </ul>\n              </div>\n            );\n          })}\n        </div>\n      )}\n    </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ActivityDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[920,923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[920,923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchActivity'. Either include it or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchActivity, id]","fix":{"range":[1049,1053],"text":"[fetchActivity, id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1316,1319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1316,1319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1500,1503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1500,1503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3126,3129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3126,3129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4223,4226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4223,4226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4630,4633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4630,4633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ActivityForm } from '@/components/crm/ActivityForm';\nimport { ArrowLeft, Trash2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog';\n\nexport default function ActivityDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const [activity, setActivity] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (id) {\n      fetchActivity();\n    }\n  }, [id]);\n\n  const fetchActivity = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('activities')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      setActivity(data);\n    } catch (error: any) {\n      toast.error('Failed to load activity');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUpdate = async (formData: any) => {\n    try {\n      let tenantId = context.tenantId || activity?.tenant_id || null;\n      let franchiseId = context.franchiseId || activity?.franchise_id || null;\n\n      // For platform admins, get tenant_id from related entity\n      if (!tenantId) {\n        if (formData.lead_id && formData.lead_id !== 'none') {\n          const { data: lead } = await supabase\n            .from('leads')\n            .select('tenant_id, franchise_id')\n            .eq('id', formData.lead_id)\n            .single();\n          if (lead) {\n            tenantId = lead.tenant_id;\n            franchiseId = lead.franchise_id;\n          }\n        } else if (formData.account_id && formData.account_id !== 'none') {\n          const { data: account } = await supabase\n            .from('accounts')\n            .select('tenant_id, franchise_id')\n            .eq('id', formData.account_id)\n            .single();\n          if (account) {\n            tenantId = account.tenant_id;\n            franchiseId = account.franchise_id;\n          }\n        } else if (formData.contact_id && formData.contact_id !== 'none') {\n          const { data: contact } = await supabase\n            .from('contacts')\n            .select('tenant_id, franchise_id')\n            .eq('id', formData.contact_id)\n            .single();\n          if (contact) {\n            tenantId = contact.tenant_id;\n            franchiseId = contact.franchise_id;\n          }\n        }\n      }\n\n      // Extract extras for custom_fields\n      const { service_id, attachments, ...rest } = formData;\n      const attachmentNames = Array.isArray(attachments)\n        ? attachments.map((f: any) => (typeof f?.name === 'string' ? f.name : '')).filter(Boolean)\n        : [];\n      const mergedCustom = {\n        ...(activity?.custom_fields || {}),\n        ...(service_id ? { service_id } : {}),\n        ...(attachmentNames.length ? { attachments_names: attachmentNames } : {}),\n      };\n\n      // Normalize payload to avoid NOT NULL and type errors\n      const normalized = {\n        ...rest,\n        tenant_id: tenantId,\n        franchise_id: franchiseId,\n        account_id: rest.account_id === 'none' ? null : (rest.account_id || null),\n        contact_id: rest.contact_id === 'none' ? null : (rest.contact_id || null),\n        lead_id: rest.lead_id === 'none' ? null : (rest.lead_id || null),\n        due_date: rest.due_date ? new Date(rest.due_date).toISOString() : null,\n        custom_fields: mergedCustom,\n      };\n\n      const { error } = await supabase\n        .from('activities')\n        .update(normalized)\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Activity updated successfully');\n      navigate('/dashboard/activities');\n    } catch (error: any) {\n      toast.error('Failed to update activity');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const { error } = await supabase\n        .from('activities')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Activity deleted successfully');\n      navigate('/dashboard/activities');\n    } catch (error: any) {\n      toast.error('Failed to delete activity');\n      console.error('Error:', error);\n    }\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center min-h-[400px]\">\n          <p className=\"text-muted-foreground\">Loading activity...</p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!activity) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center min-h-[400px]\">\n          <p className=\"text-muted-foreground\">Activity not found</p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/activities')}>\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">Edit Activity</h1>\n              <p className=\"text-muted-foreground\">Update activity details</p>\n            </div>\n          </div>\n          <AlertDialog>\n            <AlertDialogTrigger asChild>\n              <Button variant=\"destructive\" size=\"sm\">\n                <Trash2 className=\"mr-2 h-4 w-4\" />\n                Delete\n              </Button>\n            </AlertDialogTrigger>\n            <AlertDialogContent>\n              <AlertDialogHeader>\n                <AlertDialogTitle>Delete Activity</AlertDialogTitle>\n                <AlertDialogDescription>\n                  Are you sure you want to delete this activity? This action cannot be undone.\n                </AlertDialogDescription>\n              </AlertDialogHeader>\n              <AlertDialogFooter>\n                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                <AlertDialogAction onClick={handleDelete}>Delete</AlertDialogAction>\n              </AlertDialogFooter>\n            </AlertDialogContent>\n          </AlertDialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Activity Details</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ActivityForm\n              initialData={activity}\n              onSubmit={handleUpdate}\n              onCancel={() => navigate('/dashboard/activities')}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ActivityNew.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Campaigns.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/CargoDetails.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7931,7934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7931,7934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [context.tenantId, fetchData]","fix":{"range":[2448,2466],"text":"[context.tenantId, fetchData]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Plus, Pencil, Trash2, PackageCheck } from \"lucide-react\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { toast } from \"sonner\";\nimport { CargoDetailsForm } from \"@/components/logistics/CargoDetailsForm\";\nimport type { Database } from \"@/integrations/supabase/types\";\n\ntype CargoDetail = Database[\"public\"][\"Tables\"][\"cargo_details\"][\"Row\"];\n\nexport default function CargoDetails() {\n  const { supabase, context } = useCRM();\n  const [details, setDetails] = useState<CargoDetail[]>([]);\n  type ServiceRow = Pick<Database[\"public\"][\"Tables\"][\"services\"][\"Row\"], \"id\" | \"service_name\" | \"service_type\" | \"service_code\">;\n  type CargoTypeRow = Pick<Database[\"public\"][\"Tables\"][\"cargo_types\"][\"Row\"], \"id\" | \"name\">;\n  const [services, setServices] = useState<ServiceRow[]>([]);\n  const [cargoTypes, setCargoTypes] = useState<CargoTypeRow[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [open, setOpen] = useState(false);\n  const [editOpen, setEditOpen] = useState(false);\n  const [editItem, setEditItem] = useState<CargoDetail | null>(null);\n\n  async function fetchData() {\n    if (!context.tenantId) return;\n    setLoading(true);\n    try {\n      const [{ data: cd }, { data: svc }, { data: ct }] = await Promise.all([\n        supabase.from(\"cargo_details\").select(\"*\").eq(\"tenant_id\", context.tenantId),\n        supabase.from(\"services\").select(\"id, service_name, service_type, service_code\").eq(\"tenant_id\", context.tenantId),\n        supabase.from(\"cargo_types\").select(\"id, name\").eq(\"tenant_id\", context.tenantId),\n      ]);\n      setDetails((cd || []) as CargoDetail[]);\n      setServices(svc || []);\n      setCargoTypes(ct || []);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : \"Unknown error\";\n      toast.error(message || \"Failed to load cargo details\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    fetchData();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [context.tenantId]);\n\n  const serviceMap = useMemo(() => {\n    const m: Record<string, string> = {};\n    services.forEach((s) => {\n      m[String(s.id)] = `${s.service_name}${s.service_code ? ` (${s.service_code})` : ''}`;\n    });\n    return m;\n  }, [services]);\n\n  const cargoTypeMap = useMemo(() => {\n    const m: Record<string, string> = {};\n    cargoTypes.forEach((c) => {\n      m[String(c.id)] = c.name;\n    });\n    return m;\n  }, [cargoTypes]);\n\n  async function handleDelete(id: string) {\n    try {\n      const { error } = await supabase.from(\"cargo_details\").delete().eq(\"id\", id);\n      if (error) throw error;\n      toast.success(\"Cargo details deleted\");\n      fetchData();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : \"Unknown error\";\n      toast.error(message || \"Failed to delete\");\n    }\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Cargo Details</h1>\n            <p className=\"text-muted-foreground\">Configure cargo details by service type and service</p>\n          </div>\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                New Cargo Details\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Create Cargo Details</DialogTitle>\n              </DialogHeader>\n              <CargoDetailsForm onSuccess={() => { setOpen(false); fetchData(); }} />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Configured Cargo Details</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"text-center py-8 text-muted-foreground\">Loading cargo details...</div>\n            ) : details.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">No cargo details found. Create your first record to get started.</div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Service Type</TableHead>\n                    <TableHead>Service</TableHead>\n                    <TableHead>Cargo Type</TableHead>\n                    <TableHead>Weight (kg)</TableHead>\n                    <TableHead>Volume (cbm)</TableHead>\n                    <TableHead>Hazmat</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {details.map((d) => (\n                    <TableRow key={d.id}>\n                      <TableCell className=\"capitalize\">{d.service_type?.replace(/_/g, \" \")}</TableCell>\n                      <TableCell>{serviceMap[String(d.service_id)] || d.service_id}</TableCell>\n                      <TableCell>{d.cargo_type_id ? cargoTypeMap[String(d.cargo_type_id)] : '-'}</TableCell>\n                      <TableCell>{d.weight_kg ?? '-'}</TableCell>\n                      <TableCell>{d.volume_cbm ?? '-'}</TableCell>\n                      <TableCell>{d.is_hazardous ? 'Yes' : 'No'}</TableCell>\n                      <TableCell>{d.is_active ? 'Active' : 'Inactive'}</TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-2\">\n                          <Button variant=\"ghost\" size=\"icon\" onClick={() => { setEditItem(d); setEditOpen(true); }}>\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(d.id)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={editOpen} onOpenChange={setEditOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Edit Cargo Details</DialogTitle>\n            </DialogHeader>\n            {editItem && (\n              <CargoDetailsForm\n                initialData={{\n                  id: editItem.id,\n                  service_type: editItem.service_type || \"\",\n                  service_id: editItem.service_id || \"\",\n                  cargo_type_id: editItem.cargo_type_id || \"\",\n                  commodity_description: editItem.commodity_description || \"\",\n                  hs_code: editItem.hs_code || \"\",\n                  total_weight_kg: editItem.weight_kg ?? undefined,\n                  total_volume_cbm: editItem.volume_cbm ?? undefined,\n                  is_hazardous: !!editItem.is_hazardous,\n                  hazmat_class: editItem.hazmat_class || \"\",\n                  temperature_controlled: !!editItem.temperature_controlled,\n                  notes: editItem.notes || \"\",\n                  is_active: editItem.is_active ?? true,\n                  dimensions: (editItem as any).dimensions_cm ?? {},\n                }}\n                onSuccess={() => { setEditOpen(false); setEditItem(null); fetchData(); }}\n              />\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/CargoTypes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Carriers.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1141,1144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1141,1144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1435,1438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1435,1438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchCarriers' and 'fetchTenants'. Either include them or remove the dependency array.","line":183,"column":6,"nodeType":"ArrayExpression","endLine":183,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, context.tenantId, fetchCarriers, fetchTenants, roles]","fix":{"range":[6196,6246],"text":"[context.isPlatformAdmin, context.tenantId, fetchCarriers, fetchTenants, roles]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6604,6607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6604,6607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6700,6703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6700,6703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7699,7702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7699,7702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8427,8430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8427,8430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Plus, ArrowUp, ArrowDown } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from 'sonner';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { CarrierForm } from '@/components/logistics/CarrierForm';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\n\nexport default function Carriers() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const { roles } = useAuth();\n  const [carriers, setCarriers] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [editCarrierId, setEditCarrierId] = useState<string | null>(null);\n  const [tenants, setTenants] = useState<any[]>([]);\n  const [tenantNameById, setTenantNameById] = useState<Record<string, string>>({});\n  const [searchTerm, setSearchTerm] = useState('');\n  const [sortConfig, setSortConfig] = useState({ key: 'carrier_name', direction: 'ascending' });\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(10);\n\n  const requestSort = (key: string) => {\n    let direction = 'ascending';\n    if (sortConfig.key === key && sortConfig.direction === 'ascending') {\n      direction = 'descending';\n    }\n    setSortConfig({ key, direction });\n  };\n\n  const filteredCarriers = carriers.filter(carrier => {\n    const searchTerms = searchTerm.toLowerCase().split(' ').filter(term => term.trim() !== '');\n    if (searchTerms.length === 0) {\n      return true;\n    }\n\n    return searchTerms.every(term => {\n      const values = [\n        carrier.carrier_name,\n        context.isPlatformAdmin && (tenantNameById[carrier.tenant_id] || carrier.tenant_id),\n        carrier.carrier_code,\n        carrier.carrier_type,\n        carrier.contact_person,\n        carrier.contact_email,\n        carrier.rating?.toString(),\n        carrier.is_active ? 'active' : 'inactive',\n      ];\n      return values.some((val) =>\n        val?.toString().toLowerCase().includes(term)\n      );\n    });\n  });\n\n  const sortedAndFilteredCarriers = [...filteredCarriers].sort((a, b) => {\n    const aValue = a[sortConfig.key];\n    const bValue = b[sortConfig.key];\n\n    if (sortConfig.key === 'tenant_id') {\n      const aTenantName = tenantNameById[a.tenant_id] || '';\n      const bTenantName = tenantNameById[b.tenant_id] || '';\n      if (aTenantName < bTenantName) {\n        return sortConfig.direction === 'ascending' ? -1 : 1;\n      }\n      if (aTenantName > bTenantName) {\n        return sortConfig.direction === 'ascending' ? 1 : -1;\n      }\n      return 0;\n    }\n\n    if (aValue === null || aValue === undefined) return 1;\n    if (bValue === null || bValue === undefined) return -1;\n\n    if (typeof aValue === 'string' && typeof bValue === 'string') {\n      const comparison = aValue.localeCompare(bValue, undefined, { numeric: true, sensitivity: 'base' });\n      return sortConfig.direction === 'ascending' ? comparison : -comparison;\n    }\n\n    if (aValue < bValue) {\n      return sortConfig.direction === 'ascending' ? -1 : 1;\n    }\n    if (aValue > bValue) {\n      return sortConfig.direction === 'ascending' ? 1 : -1;\n    }\n    return 0;\n  });\n\n  const totalPages = Math.ceil(sortedAndFilteredCarriers.length / itemsPerPage);\n  const paginatedCarriers = sortedAndFilteredCarriers.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage\n  );\n\n  const handlePageChange = (page: number) => {\n    setCurrentPage(page);\n  };\n\n  const handleItemsPerPageChange = (value: string) => {\n    setItemsPerPage(parseInt(value, 10));\n    setCurrentPage(1);\n  };\n\n  const PaginationControls = () => (\n    <div className=\"flex items-center gap-2\">\n      <span className=\"text-sm text-muted-foreground\">\n        {sortedAndFilteredCarriers.length} carriers\n      </span>\n      <Select value={itemsPerPage.toString()} onValueChange={handleItemsPerPageChange}>\n        <SelectTrigger className=\"w-24\">\n          <SelectValue />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"10\">10 per page</SelectItem>\n          <SelectItem value=\"20\">20 per page</SelectItem>\n          <SelectItem value=\"50\">50 per page</SelectItem>\n          <SelectItem value=\"100\">100 per page</SelectItem>\n          <SelectItem value={sortedAndFilteredCarriers.length.toString()}>All</SelectItem>\n        </SelectContent>\n      </Select>\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={() => handlePageChange(1)}\n        disabled={currentPage === 1}\n      >\n        First\n      </Button>\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={() => handlePageChange(currentPage - 1)}\n        disabled={currentPage === 1}\n      >\n        Previous\n      </Button>\n      <span className=\"text-sm\">\n        Page {currentPage} of {totalPages}\n      </span>\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={() => handlePageChange(currentPage + 1)}\n        disabled={currentPage === totalPages}\n      >\n        Next\n      </Button>\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={() => handlePageChange(totalPages)}\n        disabled={currentPage === totalPages}\n      >\n        Last\n      </Button>\n    </div>\n  );\n\n  useEffect(() => {\n    if (context.isPlatformAdmin) {\n      fetchTenants();\n    }\n    if (context.isPlatformAdmin || context.tenantId || roles?.[0]?.tenant_id) {\n      fetchCarriers();\n    } else {\n      setLoading(false);\n    }\n  }, [context.isPlatformAdmin, context.tenantId, roles]);\n\n  const fetchTenants = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tenants')\n        .select('id, name')\n        .eq('is_active', true)\n        .order('name');\n      if (error) throw error;\n      const rows = data || [];\n      setTenants(rows);\n      const map: Record<string, string> = {};\n      rows.forEach((t: any) => {\n        map[t.id] = t.name;\n      });\n      setTenantNameById(map);\n    } catch (err: any) {\n      console.warn('Failed to fetch tenants:', err?.message || err);\n    }\n  };\n\n  const fetchCarriers = async () => {\n    const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n    const isPlatform = context.isPlatformAdmin;\n    if (!isPlatform && !tenantId) {\n      setLoading(false);\n      return;\n    }\n\n    // Platform admins see all carriers if no tenant is selected\n\n    try {\n      let query = supabase\n        .from('carriers')\n        .select('*');\n      if (!isPlatform) {\n        // Tenant users: always scope by tenant\n        query = query.eq('tenant_id', tenantId as string);\n      } else if (tenantId) {\n        // Platform admin with tenant selected: scope by selected tenant\n        query = query.eq('tenant_id', tenantId as string);\n      } // else platform admin without tenant filter: show all\n      const { data, error } = await query.order('carrier_name');\n\n      if (error) throw error;\n      const rows = data || [];\n      setCarriers(rows);\n    } catch (error: any) {\n      toast.error('Failed to load carriers', {\n        description: error.message,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSuccess = () => {\n    setDialogOpen(false);\n    setEditDialogOpen(false);\n    setEditCarrierId(null);\n    fetchCarriers();\n  };\n\n  const handleEdit = (id: string) => {\n    setEditCarrierId(id);\n    setEditDialogOpen(true);\n  };\n\n  const handleDeleteCarrier = async (id: string) => {\n    if (!confirm('Delete this carrier? This action cannot be undone.')) return;\n    try {\n      const { error } = await supabase.from('carriers').delete().eq('id', id);\n      if (error) throw error;\n      toast.success('Carrier deleted');\n      fetchCarriers();\n    } catch (e: any) {\n      toast.error('Failed to delete carrier', { description: e.message });\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Carriers</h1>\n            <p className=\"text-muted-foreground\">Manage shipping carriers and service providers</p>\n          </div>\n          <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                New Carrier\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Add New Carrier</DialogTitle>\n              </DialogHeader>\n              <CarrierForm onSuccess={handleSuccess} />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <CardTitle>All Carriers</CardTitle>\n            <PaginationControls />\n          </CardHeader>\n          <CardContent>\n            <div className=\"mb-4\">\n              <Input\n                placeholder=\"Search carriers (e.g., name:Maersk type:ocean status:active)\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n            {loading ? (\n              <div className=\"text-center py-8 text-muted-foreground\">Loading carriers...</div>\n            ) : sortedAndFilteredCarriers.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No carriers found.\n              </div>\n            ) : (\n              <>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"cursor-pointer\" onClick={() => requestSort('carrier_name')}>\n                      Carrier Name\n                      {sortConfig.key === 'carrier_name' && (sortConfig.direction === 'ascending' ? <ArrowUp className=\"inline h-4 w-4 ml-1\" /> : <ArrowDown className=\"inline h-4 w-4 ml-1\" />)}\n                    </TableHead>\n                    {context.isPlatformAdmin && <TableHead className=\"cursor-pointer\" onClick={() => requestSort('tenant_id')}>\n                      Tenant\n                      {sortConfig.key === 'tenant_id' && (sortConfig.direction === 'ascending' ? <ArrowUp className=\"inline h-4 w-4 ml-1\" /> : <ArrowDown className=\"inline h-4 w-4 ml-1\" />)}\n                      </TableHead>}\n                    <TableHead className=\"cursor-pointer\" onClick={() => requestSort('carrier_type')}>\n                      Type\n                      {sortConfig.key === 'carrier_type' && (sortConfig.direction === 'ascending' ? <ArrowUp className=\"inline h-4 w-4 ml-1\" /> : <ArrowDown className=\"inline h-4 w-4 ml-1\" />)}\n                      </TableHead>\n                    <TableHead>\n                      Contact\n                      </TableHead>\n                    <TableHead className=\"cursor-pointer\" onClick={() => requestSort('rating')}>\n                      Rating\n                      {sortConfig.key === 'rating' && (sortConfig.direction === 'ascending' ? <ArrowUp className=\"inline h-4 w-4 ml-1\" /> : <ArrowDown className=\"inline h-4 w-4 ml-1\" />)}\n                      </TableHead>\n                    <TableHead className=\"cursor-pointer\" onClick={() => requestSort('is_active')}>\n                      Status\n                      {sortConfig.key === 'is_active' && (sortConfig.direction === 'ascending' ? <ArrowUp className=\"inline h-4 w-4 ml-1\" /> : <ArrowDown className=\"inline h-4 w-4 ml-1\" />)}\n                      </TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {paginatedCarriers.map((carrier) => (\n                    <TableRow key={carrier.id}>\n                      <TableCell className=\"font-medium\">{carrier.carrier_name}</TableCell>\n                      {context.isPlatformAdmin && (\n                        <TableCell>{tenantNameById[carrier.tenant_id] || carrier.tenant_id || ''}</TableCell>\n                      )}\n                      <TableCell>\n                        {carrier.carrier_type && (\n                          <Badge variant=\"outline\">\n                            {carrier.carrier_type.replace('_', ' ').toUpperCase()}\n                          </Badge>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {carrier.contact_person && (\n                          <div className=\"text-sm\">\n                            <div>{carrier.contact_person}</div>\n                            {carrier.contact_email && (\n                              <div className=\"text-muted-foreground\">{carrier.contact_email}</div>\n                            )}\n                          </div>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {carrier.rating ? (\n                          <span>{carrier.rating} / 5.0</span>\n                        ) : (\n                          'N/A'\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={carrier.is_active ? 'default' : 'secondary'}>\n                          {carrier.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-2\">\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleEdit(carrier.id)}>Edit</Button>\n                          <Button variant=\"destructive\" size=\"sm\" onClick={() => handleDeleteCarrier(carrier.id)}>Delete</Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              <div className=\"flex items-center justify-end mt-4\">\n                <PaginationControls />\n              </div>\n              </>\n            )}\n          </CardContent>\n        </Card>\n        <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Edit Carrier</DialogTitle>\n            </DialogHeader>\n            {editCarrierId && (\n              <CarrierForm carrierId={editCarrierId} onSuccess={handleSuccess} />\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ChargeBases.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[522,525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[522,525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1041,1044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1041,1044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableHeader, TableRow, TableCell, TableBody } from '@/components/ui/table';\nimport { supabase } from '@/integrations/supabase/client';\n\nexport default function ChargeBases() {\n  const [items, setItems] = useState<any[]>([]);\n  const [newItem, setNewItem] = useState({ name: '', code: '', description: '' });\n\n  const load = async () => {\n    const { data } = await supabase.from('charge_bases').select('*').order('name');\n    setItems(data ?? []);\n  };\n\n  useEffect(() => { load(); }, []);\n\n  const add = async () => {\n    if (!newItem.name) return;\n    await supabase.from('charge_bases').insert({ ...newItem });\n    setNewItem({ name: '', code: '', description: '' });\n    load();\n  };\n\n  const update = async (id: string, patch: any) => {\n    await supabase.from('charge_bases').update(patch).eq('id', id);\n    load();\n  };\n\n  const remove = async (id: string) => {\n    await supabase.from('charge_bases').delete().eq('id', id);\n    load();\n  };\n\n  return (\n    <DashboardLayout>\n      <Card>\n        <CardHeader><CardTitle>Charge Bases</CardTitle></CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <Input placeholder=\"Name\" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} />\n            <Input placeholder=\"Code\" value={newItem.code} onChange={e => setNewItem({ ...newItem, code: e.target.value })} />\n            <Input placeholder=\"Description\" value={newItem.description} onChange={e => setNewItem({ ...newItem, description: e.target.value })} />\n            <Button onClick={add}>Add</Button>\n          </div>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableCell>Name</TableCell>\n                <TableCell>Code</TableCell>\n                <TableCell>Description</TableCell>\n                <TableCell>Active</TableCell>\n                <TableCell />\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map(it => (\n                <TableRow key={it.id}>\n                  <TableCell><Input value={it.name ?? ''} onChange={e => update(it.id, { name: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.code ?? ''} onChange={e => update(it.id, { code: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.description ?? ''} onChange={e => update(it.id, { description: e.target.value })} /></TableCell>\n                  <TableCell>\n                    <Button variant=\"outline\" onClick={() => update(it.id, { is_active: !it.is_active })}>\n                      {it.is_active ? 'Active' : 'Inactive'}\n                    </Button>\n                  </TableCell>\n                  <TableCell><Button variant=\"destructive\" onClick={() => remove(it.id)}>Delete</Button></TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ChargeCategories.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[527,530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[527,530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableHeader, TableRow, TableCell, TableBody } from '@/components/ui/table';\nimport { supabase } from '@/integrations/supabase/client';\n\nexport default function ChargeCategories() {\n  const [items, setItems] = useState<any[]>([]);\n  const [newItem, setNewItem] = useState({ name: '', code: '', description: '' });\n\n  const load = async () => {\n    const { data } = await supabase.from('charge_categories').select('*').order('name');\n    setItems(data ?? []);\n  };\n\n  useEffect(() => { load(); }, []);\n\n  const add = async () => {\n    if (!newItem.name) return;\n    await supabase.from('charge_categories').insert({ ...newItem });\n    setNewItem({ name: '', code: '', description: '' });\n    load();\n  };\n\n  const update = async (id: string, patch: any) => {\n    await supabase.from('charge_categories').update(patch).eq('id', id);\n    load();\n  };\n\n  const remove = async (id: string) => {\n    await supabase.from('charge_categories').delete().eq('id', id);\n    load();\n  };\n\n  return (\n    <DashboardLayout>\n      <Card>\n        <CardHeader><CardTitle>Charge Categories</CardTitle></CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <Input placeholder=\"Name\" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} />\n            <Input placeholder=\"Code\" value={newItem.code} onChange={e => setNewItem({ ...newItem, code: e.target.value })} />\n            <Input placeholder=\"Description\" value={newItem.description} onChange={e => setNewItem({ ...newItem, description: e.target.value })} />\n            <Button onClick={add}>Add</Button>\n          </div>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableCell>Name</TableCell>\n                <TableCell>Code</TableCell>\n                <TableCell>Description</TableCell>\n                <TableCell>Active</TableCell>\n                <TableCell />\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map(it => (\n                <TableRow key={it.id}>\n                  <TableCell><Input value={it.name ?? ''} onChange={e => update(it.id, { name: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.code ?? ''} onChange={e => update(it.id, { code: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.description ?? ''} onChange={e => update(it.id, { description: e.target.value })} /></TableCell>\n                  <TableCell>\n                    <Button variant=\"outline\" onClick={() => update(it.id, { is_active: !it.is_active })}>\n                      {it.is_active ? 'Active' : 'Inactive'}\n                    </Button>\n                  </TableCell>\n                  <TableCell><Button variant=\"destructive\" onClick={() => remove(it.id)}>Delete</Button></TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ChargeSides.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[522,525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[522,525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1024,1027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1024,1027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableHeader, TableRow, TableCell, TableBody } from '@/components/ui/table';\nimport { supabase } from '@/integrations/supabase/client';\n\nexport default function ChargeSides() {\n  const [items, setItems] = useState<any[]>([]);\n  const [newItem, setNewItem] = useState({ name: '', code: '' });\n\n  const load = async () => {\n    const { data } = await supabase.from('charge_sides').select('*').order('name');\n    setItems(data ?? []);\n  };\n\n  useEffect(() => { load(); }, []);\n\n  const add = async () => {\n    if (!newItem.name || !newItem.code) return;\n    await supabase.from('charge_sides').insert({ ...newItem });\n    setNewItem({ name: '', code: '' });\n    load();\n  };\n\n  const update = async (id: string, patch: any) => {\n    await supabase.from('charge_sides').update(patch).eq('id', id);\n    load();\n  };\n\n  const remove = async (id: string) => {\n    await supabase.from('charge_sides').delete().eq('id', id);\n    load();\n  };\n\n  return (\n    <DashboardLayout>\n      <Card>\n        <CardHeader><CardTitle>Charge Sides</CardTitle></CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <Input placeholder=\"Name\" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} />\n            <Input placeholder=\"Code (buy/sell)\" value={newItem.code} onChange={e => setNewItem({ ...newItem, code: e.target.value })} />\n            <Button onClick={add}>Add</Button>\n          </div>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableCell>Name</TableCell>\n                <TableCell>Code</TableCell>\n                <TableCell>Active</TableCell>\n                <TableCell />\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map(it => (\n                <TableRow key={it.id}>\n                  <TableCell><Input value={it.name ?? ''} onChange={e => update(it.id, { name: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.code ?? ''} onChange={e => update(it.id, { code: e.target.value })} /></TableCell>\n                  <TableCell>\n                    <Button variant=\"outline\" onClick={() => update(it.id, { is_active: !it.is_active })}>\n                      {it.is_active ? 'Active' : 'Inactive'}\n                    </Button>\n                  </TableCell>\n                  <TableCell><Button variant=\"destructive\" onClick={() => remove(it.id)}>Delete</Button></TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Chatter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Consignees.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1155,1158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1155,1158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchConsignees'. Either include it or remove the dependency array.","line":45,"column":6,"nodeType":"ArrayExpression","endLine":45,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, context.tenantId, fetchConsignees, roles]","fix":{"range":[1919,1969],"text":"[context.isPlatformAdmin, context.tenantId, fetchConsignees, roles]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4019,4022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4019,4022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4216,4219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4216,4219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4939,4942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4939,4942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8093,8096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8093,8096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Plus, Pencil, Trash2, Search } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from 'sonner';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { ConsigneeForm } from '@/components/logistics/ConsigneeForm';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\n\nexport default function Consignees() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const { roles } = useAuth();\n  const [consignees, setConsignees] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [editingConsigneeId, setEditingConsigneeId] = useState<string | undefined>(undefined);\n  const [filterName, setFilterName] = useState('');\n  const [filterContact, setFilterContact] = useState('');\n  const [filterTaxId, setFilterTaxId] = useState('');\n  const [filterCustomsId, setFilterCustomsId] = useState('');\n  const [filterStatus, setFilterStatus] = useState<'all' | 'active' | 'inactive'>('all');\n\n  useEffect(() => {\n    if (context.isPlatformAdmin || context.tenantId || roles?.[0]?.tenant_id) {\n      fetchConsignees();\n    } else {\n      setLoading(false);\n    }\n  }, [context.isPlatformAdmin, context.tenantId, roles]);\n\n  const fetchConsignees = async () => {\n    const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n    const isPlatform = context.isPlatformAdmin;\n    if (!isPlatform && !tenantId) {\n      setLoading(false);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from('consignees')\n        .select('*');\n      if (!isPlatform) {\n        query = query.eq('tenant_id', tenantId as string);\n      }\n      const { data, error } = await query.order('company_name');\n\n      if (error) throw error;\n      const rows = data || [];\n      // Dev-only: auto-seed demo consignees if none exist (only when tenant scoped)\n      if (!isPlatform && rows.length === 0 && import.meta.env.DEV) {\n        try {\n          await supabase.from('consignees').insert([\n            {\n              tenant_id: tenantId,\n              company_name: 'Acme Imports',\n              contact_person: 'Jamie Rivera',\n              contact_email: 'jamie@acme-imports.example',\n              tax_id: 'ACM-12345',\n              customs_id: 'CUS-98765',\n              is_active: true,\n            },\n            {\n              tenant_id: tenantId,\n              company_name: 'Global Retail Ltd',\n              contact_person: 'Priya Singh',\n              contact_email: 'priya@globalretail.example',\n              tax_id: 'GRL-67890',\n              customs_id: 'CUS-24680',\n              is_active: true,\n            },\n            {\n              tenant_id: tenantId,\n              company_name: 'Pacific Pharmaceuticals',\n              contact_person: 'Ethan Wu',\n              contact_email: 'ethan@pacpharma.example',\n              tax_id: 'PPH-11223',\n              customs_id: 'CUS-13579',\n              is_active: false,\n            },\n          ]);\n          toast.success('Seeded demo consignees');\n          const { data: seeded } = await supabase\n            .from('consignees')\n            .select('*')\n            .eq('tenant_id', tenantId as string)\n            .order('company_name');\n          setConsignees(seeded || []);\n        } catch (seedErr: any) {\n          console.warn('Consignee seed failed:', seedErr?.message || seedErr);\n          setConsignees([]);\n        }\n      } else {\n        setConsignees(rows);\n      }\n    } catch (error: any) {\n      toast.error('Failed to load consignees', {\n        description: error.message,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSuccess = () => {\n    setDialogOpen(false);\n    fetchConsignees();\n  };\n\n  const handleEditSuccess = () => {\n    setEditDialogOpen(false);\n    setEditingConsigneeId(undefined);\n    fetchConsignees();\n  };\n\n  const onEdit = (id: string) => {\n    setEditingConsigneeId(id);\n    setEditDialogOpen(true);\n  };\n\n  const onDelete = async (id: string) => {\n    try {\n      const { error } = await supabase.from('consignees').delete().eq('id', id);\n      if (error) throw error;\n      toast.success('Consignee deleted');\n      fetchConsignees();\n    } catch (e: any) {\n      toast.error(e.message || 'Failed to delete consignee');\n    }\n  };\n\n  const filteredConsignees = consignees.filter((c) => {\n    const nameMatch = !filterName || (c.company_name || '').toLowerCase().includes(filterName.toLowerCase());\n    const contactMatch = !filterContact || ((c.contact_person || '') + ' ' + (c.contact_email || '')).toLowerCase().includes(filterContact.toLowerCase());\n    const taxMatch = !filterTaxId || (c.tax_id || '').toLowerCase().includes(filterTaxId.toLowerCase());\n    const customsMatch = !filterCustomsId || (c.customs_id || '').toLowerCase().includes(filterCustomsId.toLowerCase());\n    const statusMatch = filterStatus === 'all' || (filterStatus === 'active' ? !!c.is_active : !c.is_active);\n    return nameMatch && contactMatch && taxMatch && customsMatch && statusMatch;\n  });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Consignees</h1>\n            <p className=\"text-muted-foreground\">Manage shipping consignees and receivers</p>\n          </div>\n          <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                New Consignee\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Add New Consignee</DialogTitle>\n              </DialogHeader>\n              <ConsigneeForm onSuccess={handleSuccess} />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Filters</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-5 gap-3\">\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Company Name</label>\n                <Input placeholder=\"Search name\" value={filterName} onChange={(e) => setFilterName(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Contact/Email</label>\n                <Input placeholder=\"Search contact\" value={filterContact} onChange={(e) => setFilterContact(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Tax ID</label>\n                <Input placeholder=\"Search tax id\" value={filterTaxId} onChange={(e) => setFilterTaxId(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Customs ID</label>\n                <Input placeholder=\"Search customs id\" value={filterCustomsId} onChange={(e) => setFilterCustomsId(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Status</label>\n                <Select value={filterStatus} onValueChange={(v) => setFilterStatus(v as any)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All</SelectItem>\n                    <SelectItem value=\"active\">Active</SelectItem>\n                    <SelectItem value=\"inactive\">Inactive</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>All Consignees</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"text-center py-8 text-muted-foreground\">Loading consignees...</div>\n            ) : filteredConsignees.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No consignees found. Create your first consignee to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Company Name</TableHead>\n                    <TableHead>Contact</TableHead>\n                    <TableHead>Tax ID</TableHead>\n                    <TableHead>Customs ID</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredConsignees.map((consignee) => (\n                    <TableRow key={consignee.id}>\n                      <TableCell className=\"font-medium\">{consignee.company_name}</TableCell>\n                      <TableCell>\n                        {consignee.contact_person && (\n                          <div className=\"text-sm\">\n                            <div>{consignee.contact_person}</div>\n                            {consignee.contact_email && (\n                              <div className=\"text-muted-foreground\">{consignee.contact_email}</div>\n                            )}\n                          </div>\n                        )}\n                      </TableCell>\n                      <TableCell>{consignee.tax_id || 'N/A'}</TableCell>\n                      <TableCell>{consignee.customs_id || 'N/A'}</TableCell>\n                      <TableCell>\n                        <Badge variant={consignee.is_active ? 'default' : 'secondary'}>\n                          {consignee.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-2\">\n                          <Button variant=\"outline\" size=\"icon\" onClick={() => onEdit(consignee.id)}>\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button variant=\"destructive\" size=\"icon\" onClick={() => onDelete(consignee.id)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Edit Consignee</DialogTitle>\n            </DialogHeader>\n            {editingConsigneeId && (\n              <ConsigneeForm consigneeId={editingConsigneeId} onSuccess={handleEditSuccess} />\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ContactDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[995,998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[995,998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchContact'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchContact, id]","fix":{"range":[1229,1233],"text":"[fetchContact, id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1508,1511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1508,1511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1691,1694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1691,1694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2056,2059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2056,2059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2457,2460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2457,2460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { ContactForm } from '@/components/crm/ContactForm';\nimport { ArrowLeft, Edit, Trash2, User, Phone, Mail, Building2, Linkedin } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\n\nexport default function ContactDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { supabase } = useCRM();\n  const [contact, setContact] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [isEditing, setIsEditing] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n\n  useEffect(() => {\n    if (id) fetchContact();\n  }, [id]);\n\n  const fetchContact = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('contacts')\n        .select('*, accounts(name)')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      setContact(data);\n    } catch (error: any) {\n      toast.error('Failed to load contact');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUpdate = async (formData: any) => {\n    try {\n      const { error } = await supabase\n        .from('contacts')\n        .update({\n          ...formData,\n          account_id: formData.account_id || null,\n        })\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Contact updated successfully');\n      setIsEditing(false);\n      fetchContact();\n    } catch (error: any) {\n      toast.error('Failed to update contact');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const { error } = await supabase\n        .from('contacts')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Contact deleted successfully');\n      navigate('/dashboard/contacts');\n    } catch (error: any) {\n      toast.error('Failed to delete contact');\n      console.error('Error:', error);\n    }\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Loading contact...</p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!contact) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Contact not found</p>\n          <Button onClick={() => navigate('/dashboard/contacts')} className=\"mt-4\">\n            Back to Contacts\n          </Button>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/contacts')}>\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">{contact.first_name} {contact.last_name}</h1>\n              <p className=\"text-muted-foreground\">Contact Details</p>\n            </div>\n          </div>\n          {!isEditing && (\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" onClick={() => setIsEditing(true)}>\n                <Edit className=\"mr-2 h-4 w-4\" />\n                Edit\n              </Button>\n              <Button variant=\"destructive\" onClick={() => setShowDeleteDialog(true)}>\n                <Trash2 className=\"mr-2 h-4 w-4\" />\n                Delete\n              </Button>\n            </div>\n          )}\n        </div>\n\n        {isEditing ? (\n          <Card>\n            <CardHeader>\n              <CardTitle>Edit Contact</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ContactForm\n                initialData={contact}\n                onSubmit={handleUpdate}\n                onCancel={() => setIsEditing(false)}\n              />\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <User className=\"h-5 w-5\" />\n                  Basic Information\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {contact.title && (\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">Title</p>\n                    <p className=\"text-sm\">{contact.title}</p>\n                  </div>\n                )}\n                {contact.accounts && (\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">Account</p>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                      <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"text-sm\">{contact.accounts.name}</span>\n                    </div>\n                  </div>\n                )}\n                {contact.is_primary && (\n                  <Badge variant=\"outline\">Primary Contact</Badge>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Contact Information</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {contact.email && (\n                  <div className=\"flex items-center gap-2\">\n                    <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                    <a href={`mailto:${contact.email}`} className=\"text-sm text-primary hover:underline\">\n                      {contact.email}\n                    </a>\n                  </div>\n                )}\n                {contact.phone && (\n                  <div className=\"flex items-center gap-2\">\n                    <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                    <a href={`tel:${contact.phone}`} className=\"text-sm\">{contact.phone}</a>\n                  </div>\n                )}\n                {contact.mobile && (\n                  <div className=\"flex items-center gap-2\">\n                    <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"text-sm\">{contact.mobile} (Mobile)</span>\n                  </div>\n                )}\n                {contact.linkedin_url && (\n                  <div className=\"flex items-center gap-2\">\n                    <Linkedin className=\"h-4 w-4 text-muted-foreground\" />\n                    <a href={contact.linkedin_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline\">\n                      LinkedIn Profile\n                    </a>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {contact.notes && (\n              <Card className=\"md:col-span-2\">\n                <CardHeader>\n                  <CardTitle>Notes</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">{contact.notes}</p>\n                </CardContent>\n              </Card>\n            )}\n\n            <Card className=\"md:col-span-2\">\n              <CardHeader>\n                <CardTitle>Metadata</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2 text-sm text-muted-foreground\">\n                <div>Created: {format(new Date(contact.created_at), 'PPpp')}</div>\n                <div>Last Updated: {format(new Date(contact.updated_at), 'PPpp')}</div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Delete Contact</AlertDialogTitle>\n              <AlertDialogDescription>\n                Are you sure you want to delete this contact? This action cannot be undone.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel>Cancel</AlertDialogCancel>\n              <AlertDialogAction onClick={handleDelete} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n                Delete\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ContactNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[581,584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[581,584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1288,1291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1288,1291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ContactForm } from '@/components/crm/ContactForm';\nimport { ArrowLeft } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nexport default function ContactNew() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n\n  const handleCreate = async (formData: any) => {\n    try {\n      const tenant_id = context.isPlatformAdmin ? formData.tenant_id : context.tenantId;\n      \n      if (!tenant_id) {\n        toast.error('Tenant is required');\n        return;\n      }\n\n      const { data, error } = await supabase\n        .from('contacts')\n        .insert({\n          ...formData,\n          tenant_id,\n          franchise_id: formData.franchise_id || context.franchiseId,\n          account_id: formData.account_id === 'none' ? null : (formData.account_id || null),\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      toast.success('Contact created successfully');\n      navigate(`/dashboard/contacts/${data.id}`);\n    } catch (error: any) {\n      toast.error('Failed to create contact');\n      console.error('Error:', error);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/contacts')}>\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">New Contact</h1>\n            <p className=\"text-muted-foreground\">Add a new contact to your CRM</p>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Contact Information</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ContactForm\n              onSubmit={handleCreate}\n              onCancel={() => navigate('/dashboard/contacts')}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Contacts.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchContacts'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchContacts]","fix":{"range":[1398,1400],"text":"[fetchContacts]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Plus, Search, User, Mail, Phone, Building2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport TitleStrip from '@/components/ui/title-strip';\nimport { Badge } from '@/components/ui/badge';\nimport { Table, TableBody, TableCell, TableHeader, TableRow, SortableHead } from '@/components/ui/table';\nimport { useSort } from '@/hooks/useSort';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { useCRM } from '@/hooks/useCRM';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Link } from 'react-router-dom';\nimport { toast } from 'sonner';\n\ninterface Contact {\n  id: string;\n  first_name: string;\n  last_name: string;\n  title: string | null;\n  email: string | null;\n  phone: string | null;\n  account_id: string | null;\n  accounts: { name: string } | null;\n  created_at: string;\n}\n\nexport default function Contacts() {\n  const [contacts, setContacts] = useState<Contact[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [viewMode, setViewMode] = useState<ViewMode>('card');\n  const { supabase } = useCRM();\n\n  useEffect(() => {\n    fetchContacts();\n  }, []);\n\n  const fetchContacts = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('contacts')\n        .select('*, accounts(name)')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setContacts(data || []);\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to load contacts');\n      console.error('Error:', message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredContacts = contacts.filter(contact =>\n    `${contact.first_name} ${contact.last_name}`.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    contact.email?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const { sorted: sortedContacts, sortField, sortDirection, onSort } = useSort<Contact>(filteredContacts, {\n    accessors: {\n      name: (c: Contact) => `${c.first_name} ${c.last_name}`,\n      title: (c: Contact) => c.title ?? '',\n      account: (c: Contact) => c.accounts?.name ?? '',\n      email: (c: Contact) => c.email ?? '',\n      phone: (c: Contact) => c.phone ?? '',\n    },\n  });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Contacts</h1>\n          <p className=\"text-muted-foreground\">Manage your business contacts</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <ViewToggle value={viewMode} onChange={setViewMode} />\n          <Button asChild variant=\"outline\">\n            <Link to=\"/dashboard/contacts/pipeline\">Pipeline View</Link>\n          </Button>\n          <Button asChild>\n            <Link to=\"/dashboard/contacts/new\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New Contact\n            </Link>\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"relative max-w-md\">\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search contacts...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          className=\"pl-10\"\n        />\n      </div>\n\n      {loading ? (\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Loading contacts...</p>\n        </div>\n      ) : filteredContacts.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <User className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No contacts found</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {searchQuery ? 'Try adjusting your search' : 'Get started by adding your first contact'}\n            </p>\n            {!searchQuery && (\n              <Button asChild>\n                <Link to=\"/dashboard/contacts/new\">\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Add Contact\n                </Link>\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : (\n        viewMode === 'list' ? (\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <TitleStrip label=\"All Contacts\" />\n            </CardHeader>\n            <CardContent>\n              <Table>\n              <TableHeader className=\"bg-[hsl(var(--title-strip))] [&_th]:text-white [&_th]:font-semibold [&_th]:text-xs [&_th]:px-3 [&_th]:py-2 [&_th]:border-l [&_th]:border-white/60\">\n                <TableRow className=\"border-b-2\" style={{ borderBottomColor: 'hsl(var(--title-strip))' }}>\n                  <SortableHead field=\"name\" activeField={sortField} direction={sortDirection} onSort={onSort}>Name</SortableHead>\n                  <SortableHead field=\"title\" activeField={sortField} direction={sortDirection} onSort={onSort}>Title</SortableHead>\n                  <SortableHead field=\"account\" activeField={sortField} direction={sortDirection} onSort={onSort}>Account</SortableHead>\n                  <SortableHead field=\"email\" activeField={sortField} direction={sortDirection} onSort={onSort}>Email</SortableHead>\n                  <SortableHead field=\"phone\" activeField={sortField} direction={sortDirection} onSort={onSort}>Phone</SortableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {sortedContacts.map((contact) => (\n                    <TableRow key={contact.id} className=\"cursor-pointer\" onClick={() => {}}>\n                      <TableCell>\n                        <Link className=\"font-medium hover:underline\" to={`/dashboard/contacts/${contact.id}`}>\n                          {contact.first_name} {contact.last_name}\n                        </Link>\n                      </TableCell>\n                      <TableCell>{contact.title || '-'}</TableCell>\n                      <TableCell>{contact.accounts?.name || '-'}</TableCell>\n                      <TableCell>{contact.email || '-'}</TableCell>\n                      <TableCell>{contact.phone || '-'}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        ) : viewMode === 'grid' ? (\n          <div className=\"space-y-2\">\n            <TitleStrip label=\"All Contacts\" />\n            <div className=\"grid gap-3 grid-cols-2 md:grid-cols-3 lg:grid-cols-4\">\n              {filteredContacts.map((contact) => (\n                <Link key={contact.id} to={`/dashboard/contacts/${contact.id}`}>\n                  <Card className=\"hover:shadow transition-shadow cursor-pointer\">\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-base truncate\">\n                        {contact.first_name} {contact.last_name}\n                      </CardTitle>\n                      {contact.title && (\n                        <CardDescription className=\"truncate\">{contact.title}</CardDescription>\n                      )}\n                    </CardHeader>\n                    <CardContent className=\"text-sm text-muted-foreground\">\n                      {contact.accounts?.name || '-'}\n                    </CardContent>\n                  </Card>\n                </Link>\n              ))}\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            <TitleStrip label=\"All Contacts\" />\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {filteredContacts.map((contact) => (\n                <Link key={contact.id} to={`/dashboard/contacts/${contact.id}`}>\n                  <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <User className=\"h-10 w-10 text-primary\" />\n                      </div>\n                      <CardTitle className=\"mt-4\">\n                        {contact.first_name} {contact.last_name}\n                      </CardTitle>\n                      {contact.title && (\n                        <CardDescription>{contact.title}</CardDescription>\n                      )}\n                    </CardHeader>\n                    <CardContent className=\"space-y-2\">\n                      {contact.accounts && (\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Building2 className=\"h-4 w-4\" />\n                          <span>{contact.accounts.name}</span>\n                        </div>\n                      )}\n                      {contact.email && (\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Mail className=\"h-4 w-4\" />\n                          <span className=\"truncate\">{contact.email}</span>\n                        </div>\n                      )}\n                      {contact.phone && (\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Phone className=\"h-4 w-4\" />\n                          <span>{contact.phone}</span>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                </Link>\n              ))}\n            </div>\n          </div>\n        )\n      )}\n    </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ContactsPipeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[3317,3319],"text":"[fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useNavigate } from \"react-router-dom\";\nimport { ArrowLeft, Search, Filter, Layers, Settings, AlertCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DndContext, DragEndEvent, DragOverlay, DragStartEvent, PointerSensor, useSensor, useSensors } from \"@dnd-kit/core\";\nimport { Droppable } from \"@/components/kanban/Droppable\";\nimport { Draggable } from \"@/components/kanban/Draggable\";\nimport { SwimLane } from \"@/components/kanban/SwimLane\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\n\ntype ContactStage = 'new_contact' | 'verified' | 'key_decision_maker' | 'active' | 'inactive' | 'bounced_invalid';\n\ninterface Contact {\n  id: string;\n  account_id: string | null;\n  first_name: string;\n  last_name: string;\n  title: string | null;\n  email: string | null;\n  phone: string | null;\n  is_primary: boolean | null;\n  created_at: string;\n}\n\ninterface Activity {\n  id: string;\n  contact_id: string | null;\n  created_at: string;\n}\n\nconst stageLabels: Record<ContactStage, string> = {\n  new_contact: ' New Contact',\n  verified: ' Verified',\n  key_decision_maker: ' Key Decision Maker',\n  active: ' Active',\n  inactive: ' Inactive',\n  bounced_invalid: ' Bounced/Invalid',\n};\n\nconst stageColors: Record<ContactStage, string> = {\n  new_contact: 'bg-blue-500/10 text-blue-700 dark:text-blue-300',\n  verified: 'bg-green-500/10 text-green-700 dark:text-green-300',\n  key_decision_maker: 'bg-purple-500/10 text-purple-700 dark:text-purple-300',\n  active: 'bg-teal-500/10 text-teal-700 dark:text-teal-300',\n  inactive: 'bg-gray-500/10 text-gray-700 dark:text-gray-300',\n  bounced_invalid: 'bg-red-500/10 text-red-700 dark:text-red-300',\n};\n\nconst stages: ContactStage[] = ['new_contact','verified','key_decision_maker','active','inactive','bounced_invalid'];\n\nexport default function ContactsPipeline() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const sensors = useSensors(useSensor(PointerSensor, { activationConstraint: { distance: 8 } }));\n  const [contacts, setContacts] = useState<Contact[]>([]);\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [groupBy, setGroupBy] = useState<'none' | 'account'>('none');\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const [wipLimits, setWipLimits] = useState<Record<ContactStage, number>>({\n    new_contact: 999, verified: 999, key_decision_maker: 999, active: 999, inactive: 999, bounced_invalid: 999,\n  });\n  const [showFields, setShowFields] = useState({ email: true, phone: true, title: true });\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    try {\n      setLoading(true);\n      const { data: c, error: ce } = await supabase.from('contacts').select('*').order('created_at', { ascending: false });\n      if (ce) throw ce;\n      setContacts((c || []) as Contact[]);\n      const { data: a, error: ae } = await supabase.from('activities').select('id, contact_id, created_at').order('created_at', { ascending: false }).limit(1000);\n      if (ae) throw ae;\n      setActivities((a || []) as Activity[]);\n    } catch (error) {\n      toast({ title: 'Error', description: 'Failed to fetch contacts', variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const latestActivityByContact = useMemo(() => {\n    const m: Record<string, number> = {};\n    for (const act of activities) {\n      if (!act.contact_id) continue;\n      const ts = new Date(act.created_at).getTime();\n      if (!m[act.contact_id] || ts > m[act.contact_id]) m[act.contact_id] = ts;\n    }\n    return m;\n  }, [activities]);\n\n  const computeStage = (c: Contact): ContactStage => {\n    const createdTs = new Date(c.created_at).getTime();\n    const daysSinceCreate = (Date.now() - createdTs) / (1000 * 60 * 60 * 24);\n    const hasEmail = !!c.email && c.email.includes('@');\n    const hasPhone = !!c.phone && c.phone.length > 0;\n    const title = (c.title || '').toLowerCase();\n    const lastActTs = latestActivityByContact[c.id];\n    const daysSinceAct = lastActTs ? (Date.now() - lastActTs) / (1000 * 60 * 60 * 24) : Infinity;\n    if (hasEmail && c.email!.toLowerCase().includes('bounce')) return 'bounced_invalid';\n    if (title.includes('director') || title.includes('vp') || title.includes('head') || title.includes('owner') || title.includes('manager') || c.is_primary) return 'key_decision_maker';\n    if (hasEmail && hasPhone) return 'verified';\n    if (daysSinceAct <= 30) return 'active';\n    if (daysSinceCreate <= 30) return 'new_contact';\n    return 'inactive';\n  };\n\n  const filtered = contacts.filter((c) => {\n    const s = searchQuery.toLowerCase();\n    return !searchQuery || `${c.first_name} ${c.last_name}`.toLowerCase().includes(s) || (c.email || '').toLowerCase().includes(s);\n  });\n\n  const grouped: Record<ContactStage, Contact[]> = stages.reduce((acc, stage) => {\n    acc[stage] = filtered.filter((c) => computeStage(c) === stage);\n    return acc;\n  }, {} as Record<ContactStage, Contact[]>);\n\n  const handleDragStart = (e: DragStartEvent) => setActiveId(e.active.id as string);\n  const handleDragEnd = (e: DragEndEvent) => setActiveId(null);\n\n  const activeContact = activeId ? contacts.find(c => c.id === activeId) : null;\n\n  const getSwimLanes = () => {\n    if (groupBy === 'none') return [{ id: 'all', title: 'All Contacts', items: filtered }];\n    const accounts = new Map<string, Contact[]>();\n    for (const c of filtered) {\n      const key = c.account_id || 'unassigned';\n      if (!accounts.has(key)) accounts.set(key, []);\n      accounts.get(key)!.push(c);\n    }\n    return Array.from(accounts.entries()).map(([id, items]) => ({ id, title: id === 'unassigned' ? 'Unassigned' : `Account ${id.slice(0,8)}`, items }));\n  };\n\n  const lanes = getSwimLanes();\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Contacts Pipeline</h1>\n            <p className=\"text-muted-foreground\">Engagement lifecycle for contacts</p>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate('/dashboard/contacts')}>\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to List\n          </Button>\n        </div>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"flex flex-col md:flex-row gap-4\">\n                <div className=\"flex-1 relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input placeholder=\"Search contacts...\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className=\"pl-9\" />\n                </div>\n                <Select value={groupBy} onValueChange={(v) => setGroupBy(v as 'none' | 'account')}>\n                  <SelectTrigger className=\"w-full md:w-[200px]\">\n                    <Layers className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Group By\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">No Grouping</SelectItem>\n                    <SelectItem value=\"account\">By Account</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"flex items-center justify-between pt-2\">\n                <div />\n                <div className=\"flex items-center gap-2\">\n                  <Button variant=\"outline\" size=\"sm\">\n                    <Settings className=\"h-4 w-4 mr-2\" />\n                    Customize Cards\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {loading ? (\n          <div className=\"text-center py-12\">Loading contacts...</div>\n        ) : (\n          <DndContext sensors={sensors} onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n            <div className=\"space-y-4\">\n              {lanes.map(lane => {\n                const laneGrouped = stages.reduce((acc, stage) => {\n                  acc[stage] = lane.items.filter(c => computeStage(c) === stage);\n                  return acc;\n                }, {} as Record<ContactStage, Contact[]>);\n\n                return (\n                  <SwimLane key={lane.id} id={lane.id} title={lane.title} count={lane.items.length}>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4\">\n                      {stages.map((stage) => (\n                        <Droppable key={stage} id={stage}>\n                          <Card className=\"h-full transition-all duration-200 hover:shadow-md\">\n                            <CardHeader className=\"pb-3\">\n                              <CardTitle className=\"text-sm font-medium flex items-center justify-between\">\n                                <span>{stageLabels[stage]}</span>\n                                <Badge variant=\"secondary\" className={`${stageColors[stage]} transition-all duration-200`}>{laneGrouped[stage].length}</Badge>\n                              </CardTitle>\n                            </CardHeader>\n                            <CardContent className=\"space-y-2 min-h-[200px]\">\n                              {laneGrouped[stage].map((c) => (\n                                <Draggable key={c.id} id={c.id}>\n                                  <Card className=\"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1 animate-fade-in\" onClick={() => navigate(`/dashboard/contacts/${c.id}`)}>\n                                    <CardContent className=\"p-3 space-y-2\">\n                                      <div className=\"font-medium text-sm\">{c.first_name} {c.last_name}</div>\n                                      {showFields.title && c.title && (<div className=\"text-xs text-muted-foreground\">{c.title}</div>)}\n                                      {showFields.email && c.email && (<div className=\"text-xs text-muted-foreground\">{c.email}</div>)}\n                                      {showFields.phone && c.phone && (<div className=\"text-xs text-muted-foreground\">{c.phone}</div>)}\n                                    </CardContent>\n                                  </Card>\n                                </Draggable>\n                              ))}\n                              {laneGrouped[stage].length === 0 && (\n                                <div className=\"text-xs text-muted-foreground text-center py-4\">No contacts in this stage</div>\n                              )}\n                            </CardContent>\n                          </Card>\n                        </Droppable>\n                      ))}\n                    </div>\n                  </SwimLane>\n                );\n              })}\n            </div>\n            <DragOverlay>\n              {activeContact ? (\n                <Card className=\"w-64 shadow-2xl rotate-3 scale-105 border-2 border-primary animate-scale-in\">\n                  <CardContent className=\"p-3 space-y-2 bg-gradient-to-br from-background to-muted\">\n                    <div className=\"font-medium text-sm\">{activeContact.first_name} {activeContact.last_name}</div>\n                    {activeContact.title && (<div className=\"text-xs text-muted-foreground\">{activeContact.title}</div>)}\n                  </CardContent>\n                </Card>\n              ) : null}\n            </DragOverlay>\n          </DndContext>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ContainerSizes.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[525,528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[525,528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[967,970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[967,970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1213,1216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1213,1216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableHeader, TableRow, TableCell, TableBody } from '@/components/ui/table';\nimport { supabase } from '@/integrations/supabase/client';\n\nexport default function ContainerSizes() {\n  const [items, setItems] = useState<any[]>([]);\n  const [newItem, setNewItem] = useState({ name: '', code: '', description: '' });\n\n  const load = async () => {\n    const { data } = await supabase.from('container_sizes').select('*').order('name');\n    setItems(data ?? []);\n  };\n\n  useEffect(() => { load(); }, []);\n\n  const add = async () => {\n    if (!newItem.name) return;\n    const { data: userData } = await supabase.auth.getUser();\n    const tenantId = (userData?.user as any)?.user_metadata?.tenant_id ?? null;\n    await supabase.from('container_sizes').insert({ ...newItem, tenant_id: tenantId });\n    setNewItem({ name: '', code: '', description: '' });\n    load();\n  };\n\n  const update = async (id: string, patch: any) => {\n    await supabase.from('container_sizes').update(patch).eq('id', id);\n    load();\n  };\n\n  const remove = async (id: string) => {\n    await supabase.from('container_sizes').delete().eq('id', id);\n    load();\n  };\n\n  return (\n    <DashboardLayout>\n      <Card>\n        <CardHeader><CardTitle>Container Sizes</CardTitle></CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <Input placeholder=\"Name\" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} />\n            <Input placeholder=\"Code\" value={newItem.code} onChange={e => setNewItem({ ...newItem, code: e.target.value })} />\n            <Input placeholder=\"Description\" value={newItem.description} onChange={e => setNewItem({ ...newItem, description: e.target.value })} />\n            <Button onClick={add}>Add</Button>\n          </div>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableCell>Name</TableCell>\n                <TableCell>Code</TableCell>\n                <TableCell>Description</TableCell>\n                <TableCell>Active</TableCell>\n                <TableCell />\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map(it => (\n                <TableRow key={it.id}>\n                  <TableCell><Input value={it.name ?? ''} onChange={e => update(it.id, { name: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.code ?? ''} onChange={e => update(it.id, { code: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.description ?? ''} onChange={e => update(it.id, { description: e.target.value })} /></TableCell>\n                  <TableCell>\n                    <Button variant=\"outline\" onClick={() => update(it.id, { is_active: !it.is_active })}>\n                      {it.is_active ? 'Active' : 'Inactive'}\n                    </Button>\n                  </TableCell>\n                  <TableCell><Button variant=\"destructive\" onClick={() => remove(it.id)}>Delete</Button></TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ContainerTypes.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":20,"column":32,"nodeType":"ArrayExpression","endLine":20,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [load]","fix":{"range":[988,990],"text":"[load]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableHeader, TableRow, TableCell, TableBody } from '@/components/ui/table';\nimport { supabase } from '@/integrations/supabase/client';\nimport type { Database } from '@/integrations/supabase/types';\n\nexport default function ContainerTypes() {\n  type ContainerType = Database['public']['Tables']['container_types']['Row'];\n  const [items, setItems] = useState<ContainerType[]>([]);\n  const [newItem, setNewItem] = useState<{ name: string; code: string }>({ name: '', code: '' });\n\n  const load = async () => {\n    const { data } = await supabase.from('container_types').select('*').order('name');\n    setItems((data ?? []) as ContainerType[]);\n  };\n\n  useEffect(() => { load(); }, []);\n\n  const add = async () => {\n    if (!newItem.name) return;\n    const { data: userData } = await supabase.auth.getUser();\n    const meta = userData?.user?.user_metadata as Record<string, unknown> | undefined;\n    const tenantId = typeof meta?.tenant_id === 'string' ? meta.tenant_id : null;\n    await supabase.from('container_types').insert({ ...newItem, tenant_id: tenantId });\n    setNewItem({ name: '', code: '' });\n    load();\n  };\n\n  const update = async (id: string, patch: Partial<Pick<ContainerType, 'name' | 'code' | 'is_active'>>) => {\n    await supabase.from('container_types').update(patch).eq('id', id);\n    load();\n  };\n\n  const remove = async (id: string) => {\n    await supabase.from('container_types').delete().eq('id', id);\n    load();\n  };\n\n  return (\n    <DashboardLayout>\n      <Card>\n        <CardHeader><CardTitle>Container Types</CardTitle></CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <Input placeholder=\"Name\" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} />\n            <Input placeholder=\"Code\" value={newItem.code} onChange={e => setNewItem({ ...newItem, code: e.target.value })} />\n            <Button onClick={add}>Add</Button>\n          </div>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableCell>Name</TableCell>\n                <TableCell>Code</TableCell>\n                <TableCell>Active</TableCell>\n                <TableCell />\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map(it => (\n                <TableRow key={it.id}>\n                  <TableCell><Input value={it.name ?? ''} onChange={e => update(it.id, { name: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.code ?? ''} onChange={e => update(it.id, { code: e.target.value })} /></TableCell>\n                  <TableCell>\n                    <Button variant=\"outline\" onClick={() => update(it.id, { is_active: !it.is_active })}>\n                      {it.is_active ? 'Active' : 'Inactive'}\n                    </Button>\n                  </TableCell>\n                  <TableCell><Button variant=\"destructive\" onClick={() => remove(it.id)}>Delete</Button></TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Currencies.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[521,524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[521,524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1026,1029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1026,1029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableHeader, TableRow, TableCell, TableBody } from '@/components/ui/table';\nimport { supabase } from '@/integrations/supabase/client';\n\nexport default function Currencies() {\n  const [items, setItems] = useState<any[]>([]);\n  const [newItem, setNewItem] = useState({ code: '', name: '', symbol: '' });\n\n  const load = async () => {\n    const { data } = await supabase.from('currencies').select('*').order('code');\n    setItems(data ?? []);\n  };\n\n  useEffect(() => { load(); }, []);\n\n  const add = async () => {\n    if (!newItem.code) return;\n    await supabase.from('currencies').insert({ ...newItem });\n    setNewItem({ code: '', name: '', symbol: '' });\n    load();\n  };\n\n  const update = async (id: string, patch: any) => {\n    await supabase.from('currencies').update(patch).eq('id', id);\n    load();\n  };\n\n  const remove = async (id: string) => {\n    await supabase.from('currencies').delete().eq('id', id);\n    load();\n  };\n\n  return (\n    <DashboardLayout>\n      <Card>\n        <CardHeader><CardTitle>Currencies</CardTitle></CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <Input placeholder=\"Code\" value={newItem.code} onChange={e => setNewItem({ ...newItem, code: e.target.value })} />\n            <Input placeholder=\"Name\" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} />\n            <Input placeholder=\"Symbol\" value={newItem.symbol} onChange={e => setNewItem({ ...newItem, symbol: e.target.value })} />\n            <Button onClick={add}>Add</Button>\n          </div>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableCell>Code</TableCell>\n                <TableCell>Name</TableCell>\n                <TableCell>Symbol</TableCell>\n                <TableCell>Active</TableCell>\n                <TableCell />\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map(it => (\n                <TableRow key={it.id}>\n                  <TableCell><Input value={it.code ?? ''} onChange={e => update(it.id, { code: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.name ?? ''} onChange={e => update(it.id, { name: e.target.value })} /></TableCell>\n                  <TableCell><Input value={it.symbol ?? ''} onChange={e => update(it.id, { symbol: e.target.value })} /></TableCell>\n                  <TableCell>\n                    <Button variant=\"outline\" onClick={() => update(it.id, { is_active: !it.is_active })}>\n                      {it.is_active ? 'Active' : 'Inactive'}\n                    </Button>\n                  </TableCell>\n                  <TableCell><Button variant=\"destructive\" onClick={() => remove(it.id)}>Delete</Button></TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/CustomRoles.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1007,1010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1007,1010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1137,1140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1137,1140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2007,2010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2007,2010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2120,2123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2120,2123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2218,2221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2218,2221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4528,4531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4528,4531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Edit, Trash2, Shield } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { CustomRoleDialog } from \"@/components/roles/CustomRoleDialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nexport default function CustomRoles() {\n  const { profile } = useAuth();\n  const queryClient = useQueryClient();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [selectedRole, setSelectedRole] = useState<any>(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [roleToDelete, setRoleToDelete] = useState<any>(null);\n\n  const { data: roles, isLoading } = useQuery({\n    queryKey: [\"custom_roles\"],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from(\"custom_roles\")\n        .select(`\n          *,\n          custom_role_permissions(permission_key)\n        `)\n        .order(\"created_at\", { ascending: false });\n\n      if (error) throw error;\n      return data;\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (roleId: string) => {\n      const { error } = await supabase\n        .from(\"custom_roles\")\n        .delete()\n        .eq(\"id\", roleId);\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"custom_roles\"] });\n      toast.success(\"Role deleted successfully\");\n      setDeleteDialogOpen(false);\n      setRoleToDelete(null);\n    },\n    onError: (error: any) => {\n      toast.error(error.message || \"Failed to delete role\");\n    },\n  });\n\n  const handleEdit = (role: any) => {\n    setSelectedRole(role);\n    setDialogOpen(true);\n  };\n\n  const handleDelete = (role: any) => {\n    setRoleToDelete(role);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleCreateNew = () => {\n    setSelectedRole(null);\n    setDialogOpen(true);\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-7xl\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">Custom Roles</h1>\n          <p className=\"text-muted-foreground\">\n            Create and manage custom roles with specific permissions\n          </p>\n        </div>\n        <Button onClick={handleCreateNew}>\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Create Role\n        </Button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardHeader>\n                <div className=\"h-6 bg-muted rounded w-3/4\" />\n                <div className=\"h-4 bg-muted rounded w-full mt-2\" />\n              </CardHeader>\n            </Card>\n          ))}\n        </div>\n      ) : roles && roles.length > 0 ? (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {roles.map((role) => (\n            <Card key={role.id} className=\"hover:shadow-lg transition-shadow\">\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Shield className=\"w-5 h-5 text-primary\" />\n                    <CardTitle className=\"text-lg\">{role.name}</CardTitle>\n                  </div>\n                  <Badge variant={role.is_active ? \"default\" : \"secondary\"}>\n                    {role.is_active ? \"Active\" : \"Inactive\"}\n                  </Badge>\n                </div>\n                <CardDescription>{role.description || \"No description\"}</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <p className=\"text-sm font-medium mb-2\">Permissions:</p>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {role.custom_role_permissions?.length > 0 ? (\n                        role.custom_role_permissions.slice(0, 3).map((perm: any, idx: number) => (\n                          <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                            {perm.permission_key}\n                          </Badge>\n                        ))\n                      ) : (\n                        <span className=\"text-xs text-muted-foreground\">No permissions</span>\n                      )}\n                      {role.custom_role_permissions?.length > 3 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          +{role.custom_role_permissions.length - 3} more\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                  {!role.is_system_role && (\n                    <div className=\"flex gap-2 pt-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleEdit(role)}\n                        className=\"flex-1\"\n                      >\n                        <Edit className=\"w-4 h-4 mr-1\" />\n                        Edit\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleDelete(role)}\n                        className=\"flex-1\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-1\" />\n                        Delete\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Shield className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <p className=\"text-lg font-medium mb-2\">No custom roles yet</p>\n            <p className=\"text-muted-foreground mb-4\">\n              Create your first custom role to get started\n            </p>\n            <Button onClick={handleCreateNew}>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Create Role\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n\n      <CustomRoleDialog\n        open={dialogOpen}\n        onOpenChange={setDialogOpen}\n        role={selectedRole}\n      />\n\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Custom Role</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{roleToDelete?.name}\"? This action cannot be\n              undone and will remove all role assignments.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => roleToDelete && deleteMutation.mutate(roleToDelete.id)}\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/CustomsClearancePipeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":97,"column":6,"nodeType":"ArrayExpression","endLine":97,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[3576,3578],"text":"[fetchData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3993,3996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3993,3996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8596,8599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8596,8599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useNavigate } from \"react-router-dom\";\nimport { ArrowLeft, Search, Filter, Layers, AlertCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DndContext, DragOverlay, PointerSensor, useSensor, useSensors } from \"@dnd-kit/core\";\nimport { Droppable } from \"@/components/kanban/Droppable\";\nimport { Draggable } from \"@/components/kanban/Draggable\";\nimport { SwimLane } from \"@/components/kanban/SwimLane\";\n\ntype CustomsStage =\n  | 'documents_pending'\n  | 'documents_received'\n  | 'review_entry_prep'\n  | 'filed_with_customs'\n  | 'awaiting_clearance'\n  | 'examination_required'\n  | 'cleared'\n  | 'released_for_delivery';\n\ninterface Shipment {\n  id: string;\n  shipment_number: string | null;\n  customer_name: string | null;\n  service_type: string | null;\n  origin: string | null;\n  destination: string | null;\n  customs_required: boolean | null;\n}\n\ninterface TrackingEvent {\n  id: string;\n  shipment_id: string;\n  event_type: string;\n  created_at: string;\n  notes: string | null;\n}\n\ninterface CustomsDocument {\n  id: string;\n  shipment_id: string;\n}\n\nconst stageLabels: Record<CustomsStage, string> = {\n  documents_pending: ' Documents Pending',\n  documents_received: ' Documents Received',\n  review_entry_prep: ' Review & Entry Prep',\n  filed_with_customs: ' Filed with Customs',\n  awaiting_clearance: ' Awaiting Clearance',\n  examination_required: ' Examination Required',\n  cleared: ' Cleared',\n  released_for_delivery: ' Released for Delivery',\n};\n\nconst stageColors: Record<CustomsStage, string> = {\n  documents_pending: 'bg-yellow-500/10 text-yellow-700 dark:text-yellow-300',\n  documents_received: 'bg-blue-500/10 text-blue-700 dark:text-blue-300',\n  review_entry_prep: 'bg-indigo-500/10 text-indigo-700 dark:text-indigo-300',\n  filed_with_customs: 'bg-purple-500/10 text-purple-700 dark:text-purple-300',\n  awaiting_clearance: 'bg-orange-500/10 text-orange-700 dark:text-orange-300',\n  examination_required: 'bg-red-500/10 text-red-700 dark:text-red-300',\n  cleared: 'bg-green-500/10 text-green-700 dark:text-green-300',\n  released_for_delivery: 'bg-teal-500/10 text-teal-700 dark:text-teal-300',\n};\n\nconst stages: CustomsStage[] = [\n  'documents_pending',\n  'documents_received',\n  'review_entry_prep',\n  'filed_with_customs',\n  'awaiting_clearance',\n  'examination_required',\n  'cleared',\n  'released_for_delivery',\n];\n\nexport default function CustomsClearancePipeline() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const sensors = useSensors(useSensor(PointerSensor, { activationConstraint: { distance: 8 } }));\n  const [shipments, setShipments] = useState<Shipment[]>([]);\n  const [events, setEvents] = useState<TrackingEvent[]>([]);\n  const [docs, setDocs] = useState<CustomsDocument[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [groupBy, setGroupBy] = useState<'none' | 'service_type'>('none');\n  const [activeId, setActiveId] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    try {\n      setLoading(true);\n      const { data: s, error: se } = await supabase\n        .from('shipments')\n        .select('id, shipment_number, account_id, service_level, origin_address, destination_address, customs_required')\n        .order('shipment_number', { ascending: false })\n        .limit(500);\n      if (se) throw se;\n      const mapped = (s || []).map((ship: any) => ({\n        id: ship.id,\n        shipment_number: ship.shipment_number,\n        customer_name: null,\n        service_type: ship.service_level,\n        origin: null,\n        destination: null,\n        customs_required: ship.customs_required\n      }));\n      setShipments(mapped);\n      const { data: e, error: ee } = await supabase\n        .from('tracking_events')\n        .select('id, shipment_id, event_type, created_at, notes')\n        .order('created_at', { ascending: false })\n        .limit(5000);\n      if (ee) throw ee;\n      setEvents((e || []) as TrackingEvent[]);\n      const { data: d, error: de } = await supabase\n        .from('customs_documents')\n        .select('id, shipment_id')\n        .limit(5000);\n      if (de) throw de;\n      setDocs((d || []) as CustomsDocument[]);\n    } catch (error) {\n      toast({ title: 'Error', description: 'Failed to fetch customs data', variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const eventsByShipment = useMemo(() => {\n    const m = new Map<string, TrackingEvent[]>();\n    for (const e of events) {\n      const arr = m.get(e.shipment_id) || [];\n      arr.push(e);\n      m.set(e.shipment_id, arr);\n    }\n    for (const [id, arr] of m.entries()) arr.sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\n    return m;\n  }, [events]);\n\n  const hasDocs = (shipmentId: string) => docs.some(d => d.shipment_id === shipmentId);\n\n  const latestEventOf = (shipmentId: string, type: string) => {\n    const arr = eventsByShipment.get(shipmentId) || [];\n    for (let i = arr.length - 1; i >= 0; i--) {\n      if (arr[i].event_type === type) return arr[i];\n    }\n    return null;\n  };\n\n  const hasEvent = (shipmentId: string, type: string) => !!latestEventOf(shipmentId, type);\n\n  const computeStage = (s: Shipment): CustomsStage => {\n    if (!s.customs_required) return 'released_for_delivery';\n    const exam = eventsByShipment.get(s.id)?.find(e => e.event_type === 'exception' && (e.notes || '').toLowerCase().includes('exam'));\n    if (!hasDocs(s.id)) return 'documents_pending';\n    if (!hasEvent(s.id, 'customs_clearance')) return 'review_entry_prep';\n    if (exam) return 'examination_required';\n    if (hasEvent(s.id, 'customs_clearance') && !hasEvent(s.id, 'customs_released')) return 'awaiting_clearance';\n    if (hasEvent(s.id, 'customs_released') && !hasEvent(s.id, 'out_for_delivery')) return 'cleared';\n    if (hasEvent(s.id, 'out_for_delivery')) return 'released_for_delivery';\n    return 'filed_with_customs';\n  };\n\n  const filtered = shipments.filter((s) => {\n    const q = searchQuery.toLowerCase();\n    const str = `${s.shipment_number || ''} ${s.customer_name || ''} ${s.origin || ''} ${s.destination || ''}`.toLowerCase();\n    return !searchQuery || str.includes(q);\n  });\n\n  const grouped: Record<CustomsStage, Shipment[]> = stages.reduce((acc, stage) => {\n    acc[stage] = filtered.filter((s) => computeStage(s) === stage);\n    return acc;\n  }, {} as Record<CustomsStage, Shipment[]>);\n\n  const getSwimLanes = () => {\n    if (groupBy === 'none') return [{ id: 'all', title: 'All Shipments', items: filtered }];\n    const st = new Map<string, Shipment[]>();\n    for (const s of filtered) {\n      const key = s.service_type || 'unknown';\n      if (!st.has(key)) st.set(key, []);\n      st.get(key)!.push(s);\n    }\n    return Array.from(st.entries()).map(([id, items]) => ({ id, title: id.toUpperCase(), items }));\n  };\n\n  const lanes = getSwimLanes();\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Customs Clearance</h1>\n            <p className=\"text-muted-foreground\">Pipeline for shipments requiring customs</p>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate('/dashboard/shipments')}>\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Shipments\n          </Button>\n        </div>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"flex flex-col md:flex-row gap-4\">\n                <div className=\"flex-1 relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input placeholder=\"Search shipments...\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className=\"pl-9\" />\n                </div>\n                <Select value={groupBy} onValueChange={(v) => setGroupBy(v as any)}>\n                  <SelectTrigger className=\"w-full md:w-[200px]\">\n                    <Layers className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Group By\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">No Grouping</SelectItem>\n                    <SelectItem value=\"service_type\">By Service Type</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {loading ? (\n          <div className=\"text-center py-12\">Loading shipments...</div>\n        ) : (\n          <DndContext sensors={sensors}>\n            <div className=\"space-y-4\">\n              {lanes.map(lane => {\n                const laneGrouped = stages.reduce((acc, stage) => {\n                  acc[stage] = lane.items.filter(s => computeStage(s) === stage);\n                  return acc;\n                }, {} as Record<CustomsStage, Shipment[]>);\n\n                return (\n                  <SwimLane key={lane.id} id={lane.id} title={lane.title} count={lane.items.length}>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-8 gap-4\">\n                      {stages.map((stage) => (\n                        <Droppable key={stage} id={stage}>\n                          <Card className=\"h-full transition-all duration-200 hover:shadow-md\">\n                            <CardHeader className=\"pb-3\">\n                              <CardTitle className=\"text-sm font-medium flex items-center justify-between\">\n                                <span>{stageLabels[stage]}</span>\n                                <Badge variant=\"secondary\" className={`${stageColors[stage]} transition-all duration-200`}>{laneGrouped[stage].length}</Badge>\n                              </CardTitle>\n                            </CardHeader>\n                            <CardContent className=\"space-y-2 min-h-[200px]\">\n                              {laneGrouped[stage].map((s) => (\n                                <Draggable key={s.id} id={s.id}>\n                                  <Card className=\"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1 animate-fade-in\" onClick={() => navigate(`/dashboard/shipments/${s.id}`)}>\n                                    <CardContent className=\"p-3 space-y-2\">\n                                      <div className=\"font-medium text-sm\">{s.shipment_number || 'N/A'}</div>\n                                      <div className=\"text-xs text-muted-foreground\">{s.origin || ''}  {s.destination || ''}</div>\n                                      {s.customer_name && (<div className=\"text-xs text-muted-foreground\">{s.customer_name}</div>)}\n                                    </CardContent>\n                                  </Card>\n                                </Draggable>\n                              ))}\n                              {laneGrouped[stage].length === 0 && (\n                                <div className=\"text-xs text-muted-foreground text-center py-4\">No shipments in this stage</div>\n                              )}\n                            </CardContent>\n                          </Card>\n                        </Droppable>\n                      ))}\n                    </div>\n                  </SwimLane>\n                );\n              })}\n            </div>\n            <DragOverlay />\n          </DndContext>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Dashboards.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1663,1666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1663,1666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'leadQuery' is never reassigned. Use 'const' instead.","line":68,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":68,"endColumn":22,"fix":{"range":[2578,2817],"text":"const leadQuery = supabase\n          .from('leads')\n          .select('id, first_name, last_name, company, status, owner_id')\n          .eq('owner_id', context.userId)\n          .order('created_at', { ascending: false })\n          .limit(6);"}},{"ruleId":"prefer-const","severity":2,"message":"'actQuery' is never reassigned. Use 'const' instead.","line":82,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":82,"endColumn":21,"fix":{"range":[3103,3413],"text":"const actQuery = supabase\n          .from('activities')\n          .select('id, activity_type, subject, due_date, status, assigned_to, lead_id')\n          .eq('assigned_to', context.userId)\n          .or('status.is.null,status.neq.completed')\n          .order('due_date', { ascending: true })\n          .limit(6);"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5511,5514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5511,5514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10655,10658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10655,10658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { Phone, Calendar, CheckSquare, Mail, StickyNote } from 'lucide-react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { useCRM } from '@/hooks/useCRM';\nimport { Link } from 'react-router-dom';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useAssignableUsers, AssignableUser } from '@/hooks/useAssignableUsers';\nimport { toast } from 'sonner';\n\ninterface LeadItem {\n  id: string;\n  first_name: string;\n  last_name: string;\n  company: string | null;\n  status: string;\n  owner_id: string | null;\n}\n\ninterface ActivityItem {\n  id: string;\n  activity_type: string;\n  subject: string | null;\n  due_date: string | null;\n  status: string | null;\n  assigned_to: string | null;\n  lead_id: string | null;\n}\n\nexport default function Dashboards() {\n  const { supabase, context } = useCRM();\n  const { fetchAssignableUsers, formatLabel } = useAssignableUsers();\n  const [loading, setLoading] = useState(true);\n  const [myLeads, setMyLeads] = useState<LeadItem[]>([]);\n  const [myActivities, setMyActivities] = useState<ActivityItem[]>([]);\n  const [leadNamesById, setLeadNamesById] = useState<Record<string, string>>({});\n  const [assignableUsers, setAssignableUsers] = useState<AssignableUser[]>([]);\n\n  const renderTypeBadge = (t: string | null) => {\n    const type = (t || '').toLowerCase();\n    const map: Record<string, { label: string; icon?: any }> = {\n      task: { label: 'Task', icon: CheckSquare },\n      call: { label: 'Call', icon: Phone },\n      meeting: { label: 'Meeting', icon: Calendar },\n      email: { label: 'Email', icon: Mail },\n      note: { label: 'Note', icon: StickyNote },\n    };\n    const meta = map[type];\n    const label = meta?.label || (type ? type.charAt(0).toUpperCase() + type.slice(1) : 'Activity');\n    const Icon = meta?.icon;\n    return (\n      <Badge variant=\"outline\" className=\"ml-2 text-xs\">\n        {Icon ? <Icon className=\"mr-1 h-3 w-3\" /> : null}\n        {label}\n      </Badge>\n    );\n  };\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        // Fetch assignable users for inline assignment control\n        const { data: users } = await fetchAssignableUsers({ search: '', limit: 50 });\n        setAssignableUsers((users ?? []) as AssignableUser[]);\n        // My Leads: assigned to me\n        let leadQuery = supabase\n          .from('leads')\n          .select('id, first_name, last_name, company, status, owner_id')\n          .eq('owner_id', context.userId)\n          .order('created_at', { ascending: false })\n          .limit(6);\n\n        // Rely on RLS for scoping; avoid extra filters that can exclude rows\n\n        const { data: leads, error: leadsErr } = await leadQuery;\n        if (leadsErr) throw leadsErr;\n        setMyLeads(leads || []);\n\n        // My Activities: assigned to me and not completed\n        let actQuery = supabase\n          .from('activities')\n          .select('id, activity_type, subject, due_date, status, assigned_to, lead_id')\n          .eq('assigned_to', context.userId)\n          .or('status.is.null,status.neq.completed')\n          .order('due_date', { ascending: true })\n          .limit(6);\n        // Rely on RLS for scoping; avoid extra filters that can exclude rows\n\n        const { data: activities, error: actErr } = await actQuery;\n        if (actErr) throw actErr;\n        const acts = (activities || []) as ActivityItem[];\n        setMyActivities(acts);\n\n        // Fetch lead names for referenced activities to use as group headers\n        const leadIds = Array.from(\n          new Set(\n            acts\n              .map((a) => a.lead_id)\n              .filter((id): id is string => !!id)\n          )\n        );\n        if (leadIds.length > 0) {\n          const { data: leadRefs, error: leadRefsErr } = await supabase\n            .from('leads')\n            .select('id, first_name, last_name, company')\n            .in('id', leadIds);\n          if (!leadRefsErr && leadRefs) {\n            const map: Record<string, string> = {};\n            for (const l of leadRefs) {\n              const fullName = [l.first_name, l.last_name].filter(Boolean).join(' ').trim();\n              map[l.id] = fullName || l.company || 'Lead';\n            }\n            setLeadNamesById(map);\n          }\n        } else {\n          setLeadNamesById({});\n        }\n      } catch (e) {\n        console.error('Dashboard fetch error:', e);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [supabase, context.userId, context.tenantId, context.franchiseId, fetchAssignableUsers]);\n\n  const assignActivityOwner = async (activityId: string, newOwnerId: string | 'none') => {\n    try {\n      const assigned_to = newOwnerId === 'none' ? null : newOwnerId;\n      const { error } = await supabase\n        .from('activities')\n        .update({ assigned_to })\n        .eq('id', activityId);\n      if (error) throw error;\n      // Optimistically update local state; remove items reassigned away from me\n      setMyActivities((prev) => {\n        const updated = prev.map((a) => (a.id === activityId ? { ...a, assigned_to } : a));\n        return updated.filter((a) => a.assigned_to === context.userId);\n      });\n      toast.success('Activity assignment updated');\n    } catch (err: any) {\n      console.error(err);\n      toast.error(err?.message || 'Failed to update assignment');\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Dashboards</h1>\n          <p className=\"text-muted-foreground\">Your work at a glance</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <Card>\n            <CardHeader className=\"flex-row items-center justify-between\">\n              <CardTitle>My Leads</CardTitle>\n              <Button variant=\"link\" className=\"p-0\" asChild>\n                <Link to=\"/dashboard/leads\">View all</Link>\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {loading ? (\n                <p className=\"text-sm text-muted-foreground\">Loading...</p>\n              ) : myLeads.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">No assigned leads yet</p>\n              ) : (\n                <ul className=\"space-y-3\">\n                  {myLeads.map((l) => (\n                    <li key={l.id} className=\"flex items-center justify-between\">\n                      <div>\n                        <Link to={`/dashboard/leads/${l.id}`} className=\"font-medium hover:underline\">\n                          {l.first_name} {l.last_name}\n                        </Link>\n                        {l.company && (\n                          <span className=\"ml-2 text-sm text-muted-foreground\"> {l.company}</span>\n                        )}\n                      </div>\n                      <Badge variant=\"secondary\">{l.status}</Badge>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex-row items-center justify-between\">\n              <CardTitle>My Activities</CardTitle>\n              <Button variant=\"link\" className=\"p-0\" asChild>\n                <Link to=\"/dashboard/activities\">View all</Link>\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {loading ? (\n                <p className=\"text-sm text-muted-foreground\">Loading...</p>\n              ) : myActivities.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">No upcoming tasks</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {Object.entries(\n                    myActivities.reduce<Record<string, ActivityItem[]>>((acc, a) => {\n                      const key = a.lead_id ?? 'none';\n                      if (!acc[key]) acc[key] = [];\n                      acc[key].push(a);\n                      return acc;\n                    }, {})\n                  ).map(([groupId, items]) => {\n                    const isNone = groupId === 'none';\n                    const headerLabel = isNone\n                      ? 'No Lead'\n                      : (leadNamesById[groupId] ?? 'Lead');\n                    return (\n                      <div key={groupId} className=\"space-y-2\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"text-sm text-muted-foreground\">\n                            {isNone ? (\n                              headerLabel\n                            ) : (\n                              <Link to={`/dashboard/leads/${groupId}`} className=\"hover:underline\">\n                                {headerLabel}\n                              </Link>\n                            )}\n                          </div>\n                        </div>\n                        <ul className=\"space-y-3\">\n                          {items.map((a) => {\n                            const overdue = a.due_date ? new Date(a.due_date) < new Date() : false;\n                            return (\n                              <li key={a.id} className=\"flex items-center justify-between\">\n                                <div>\n                                  <Link to={`/dashboard/activities/${a.id}`} className=\"font-medium hover:underline\">\n                                    {a.subject || a.activity_type}\n                                  </Link>\n                                  {/* Show activity type label */}\n                                  {renderTypeBadge(a.activity_type)}\n                                  {a.due_date && (\n                                    <span className={`ml-2 text-sm ${overdue ? 'text-red-600' : 'text-muted-foreground'}`}>\n                                      {new Date(a.due_date).toLocaleDateString()}\n                                    </span>\n                                  )}\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                  <Badge variant={overdue ? 'destructive' : 'secondary'}>\n                                    {overdue ? 'Overdue' : (a.status ?? 'planned')}\n                                  </Badge>\n                                  <Select\n                                    onValueChange={(v) => assignActivityOwner(a.id, v as any)}\n                                    defaultValue={a.assigned_to ?? 'none'}\n                                  >\n                                    <SelectTrigger className=\"w-[180px]\">\n                                      <SelectValue placeholder=\"Assign To\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      <SelectItem value=\"none\">Unassigned</SelectItem>\n                                      {assignableUsers.map((u) => (\n                                        <SelectItem key={u.id} value={u.id}>{formatLabel(u)}</SelectItem>\n                                      ))}\n                                    </SelectContent>\n                                  </Select>\n                                </div>\n                              </li>\n                            );\n                          })}\n                        </ul>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/DataManagement.stub.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/DataManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1531,1534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1531,1534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3601,3604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3601,3604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3672,3675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3672,3675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4003,4006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4003,4006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Download, Loader2, Upload } from 'lucide-react';\nimport { toast } from 'sonner';\nimport TenantConfigForm from './data-management/TenantConfigForm';\nimport FranchiseConfigForm from './data-management/FranchiseConfigForm';\nimport SequencesAndPreview from './data-management/SequencesAndPreview';\nimport { useCRM } from '@/hooks/useCRM';\n\nexport default function DataManagement() {\n  const { supabase, context } = useCRM();\n  const [tenants, setTenants] = useState<Array<{ id: string; name: string }>>([]);\n  const [franchises, setFranchises] = useState<Array<{ id: string; name: string }>>([]);\n  const [tenantId, setTenantId] = useState<string | undefined>(context?.tenantId || undefined);\n  const [franchiseId, setFranchiseId] = useState<string | undefined>(context?.franchiseId || undefined);\n  const [isExporting, setIsExporting] = useState(false);\n  const [isImporting, setIsImporting] = useState(false);\n  const [importFile, setImportFile] = useState<File | null>(null);\n  const [importResult, setImportResult] = useState<{ restored?: number; errors?: number; details?: any } | null>(null);\n\n  useEffect(() => {\n    const loadTenants = async () => {\n      const { data } = await supabase.from('tenants').select('id,name').eq('is_active', true).order('name');\n      setTenants(data || []);\n    };\n    loadTenants();\n  }, [supabase]);\n\n  useEffect(() => {\n    const loadFranchises = async () => {\n      if (!tenantId) { setFranchises([]); return; }\n      const { data } = await supabase\n        .from('franchises')\n        .select('id,name')\n        .eq('tenant_id', tenantId)\n        .eq('is_active', true)\n        .order('name');\n      setFranchises(data || []);\n    };\n    loadFranchises();\n  }, [supabase, tenantId]);\n\n  const onTenantChange = (id: string) => {\n    setTenantId(id);\n    // Reset franchise when tenant changes\n    setFranchiseId(undefined);\n  };\n\n  const onFranchiseChange = (id: string) => setFranchiseId(id);\n\n  const handleExportData = async () => {\n    setIsExporting(true);\n    try {\n      const { data, error } = await supabase.functions.invoke('export-data');\n      \n      if (error) {\n        throw error;\n      }\n\n      // Create a blob and download\n      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `database-export-${new Date().toISOString().split('T')[0]}.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n\n      toast.success('Database exported successfully');\n    } catch (error) {\n      console.error('Export failed:', error);\n      toast.error('Failed to export database');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const handleImportData = async (file: File | null) => {\n    if (!file) {\n      toast.message('No file selected', { description: 'Choose a JSON export file first' });\n      return;\n    }\n    setIsImporting(true);\n    setImportResult(null);\n    try {\n      const text = await file.text();\n      let payload: any;\n      try {\n        payload = JSON.parse(text);\n      } catch (e: any) {\n        toast.error('Invalid file', { description: 'Expected JSON content' });\n        return;\n      }\n      const { data, error } = await supabase.functions.invoke('import-data', { body: payload });\n      if (error) throw error;\n      setImportResult(data || null);\n      toast.success('Import completed');\n    } catch (e: any) {\n      console.error('Import failed:', e);\n      toast.error('Failed to import data');\n    } finally {\n      setIsImporting(false);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Data Management Options</h1>\n          <p className=\"text-muted-foreground\">Configure quote numbering and preview sequences</p>\n        </div>\n\n        {/* Context selectors to operate when implicit context is unavailable */}\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <div>\n            <div className=\"text-sm font-medium mb-2\">Tenant</div>\n            <Select onValueChange={onTenantChange} value={tenantId}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select tenant\" />\n              </SelectTrigger>\n              <SelectContent>\n                {tenants.map((t) => (\n                  <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div>\n            <div className=\"text-sm font-medium mb-2\">Franchise (optional)</div>\n            <Select onValueChange={onFranchiseChange} value={franchiseId}>\n              <SelectTrigger>\n                <SelectValue placeholder={tenantId ? 'Select franchise' : 'Select tenant first'} />\n              </SelectTrigger>\n              <SelectContent>\n                {franchises.map((f) => (\n                  <SelectItem key={f.id} value={f.id}>{f.name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"tenant\">\n          <TabsList>\n            <TabsTrigger value=\"tenant\">Tenant Config</TabsTrigger>\n            <TabsTrigger value=\"franchise\">Franchise Config</TabsTrigger>\n            <TabsTrigger value=\"preview\">Sequences & Preview</TabsTrigger>\n            <TabsTrigger value=\"export\">Export Data</TabsTrigger>\n          </TabsList>\n          <TabsContent value=\"tenant\" className=\"mt-4\">\n            <TenantConfigForm tenantIdOverride={tenantId} />\n          </TabsContent>\n          <TabsContent value=\"franchise\" className=\"mt-4\">\n            <FranchiseConfigForm tenantIdOverride={tenantId} franchiseIdOverride={franchiseId} />\n          </TabsContent>\n          <TabsContent value=\"preview\" className=\"mt-4\">\n            <SequencesAndPreview tenantIdOverride={tenantId} franchiseIdOverride={franchiseId} />\n          </TabsContent>\n          <TabsContent value=\"export\" className=\"mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Export Database</CardTitle>\n                <CardDescription>\n                  Download all your database tables and auth users as a JSON file for backup or migration purposes.\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Button \n                  onClick={handleExportData} \n                  disabled={isExporting}\n                  size=\"lg\"\n                  className=\"w-full sm:w-auto\"\n                >\n                  {isExporting ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Exporting...\n                    </>\n                  ) : (\n                    <>\n                      <Download className=\"mr-2 h-4 w-4\" />\n                      Export All Data\n                    </>\n                  )}\n                </Button>\n                <p className=\"text-sm text-muted-foreground mt-4\">\n                  This will export all tables including: tenants, franchises, profiles, leads, opportunities, quotes, shipments, and more.\n                </p>\n\n                <div className=\"mt-6 space-y-3\">\n                  <div className=\"text-sm font-medium\">Import to current database</div>\n                  <div className=\"flex flex-col sm:flex-row gap-3 items-start sm:items-center\">\n                    <input type=\"file\" accept=\"application/json\" onChange={(e) => setImportFile(e.target.files?.[0] || null)} />\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => handleImportData(importFile)} disabled={!importFile || isImporting}>\n                      <Upload className=\"mr-2 h-4 w-4\" />\n                      Import Selected JSON\n                    </Button>\n                  </div>\n                  {isImporting && (\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      Importing...\n                    </div>\n                  )}\n                  {importResult && (\n                    <div className=\"text-xs text-muted-foreground\">\n                      Restored: {Number(importResult.restored || 0)}  Errors: {Number(importResult.errors || 0)}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/EmailManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Files.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/FranchiseDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[956,959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[956,959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFranchise'. Either include it or remove the dependency array.","line":31,"column":6,"nodeType":"ArrayExpression","endLine":31,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFranchise, id]","fix":{"range":[1064,1068],"text":"[fetchFranchise, id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1333,1336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1333,1336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1862,1865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1862,1865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { FranchiseForm } from '@/components/admin/FranchiseForm';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Store, Trash2, ArrowLeft } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog';\n\nexport default function FranchiseDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [franchise, setFranchise] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchFranchise();\n  }, [id]);\n\n  const fetchFranchise = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('franchises')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      setFranchise(data);\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const { error } = await supabase\n        .from('franchises')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast({\n        title: 'Success',\n        description: 'Franchise deleted successfully',\n      });\n      navigate('/dashboard/franchises');\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    }\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8\">Loading...</div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!franchise) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8\">Franchise not found</div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/franchises')}>\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">{franchise.name}</h1>\n              <p className=\"text-muted-foreground\">Edit franchise details</p>\n            </div>\n          </div>\n          <AlertDialog>\n            <AlertDialogTrigger asChild>\n              <Button variant=\"destructive\" size=\"icon\">\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </AlertDialogTrigger>\n            <AlertDialogContent>\n              <AlertDialogHeader>\n                <AlertDialogTitle>Delete Franchise</AlertDialogTitle>\n                <AlertDialogDescription>\n                  Are you sure you want to delete this franchise? This action cannot be undone.\n                </AlertDialogDescription>\n              </AlertDialogHeader>\n              <AlertDialogFooter>\n                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                <AlertDialogAction onClick={handleDelete}>Delete</AlertDialogAction>\n              </AlertDialogFooter>\n            </AlertDialogContent>\n          </AlertDialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Store className=\"h-5 w-5\" />\n              Franchise Information\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <FranchiseForm franchise={franchise} onSuccess={fetchFranchise} />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/FranchiseNew.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Franchises.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[819,822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[819,822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFranchises'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFranchises]","fix":{"range":[928,930],"text":"[fetchFranchises]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1620,1623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1620,1623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Plus, Store } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCRM } from '@/hooks/useCRM';\n\nexport default function Franchises() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { context } = useCRM();\n  const [franchises, setFranchises] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchFranchises();\n  }, []);\n\n  const fetchFranchises = async () => {\n    try {\n      let query = supabase\n        .from('franchises')\n        // Disambiguate embed: direct FK franchises.tenant_id -> tenants.id\n        // Avoid PostgREST error: more than one relationship between franchises and tenants\n        .select('*, tenants:tenants!franchises_tenant_id_fkey(name)');\n\n      // Filter by tenant if not platform_admin\n      if (!context.isPlatformAdmin && context.tenantId) {\n        query = query.eq('tenant_id', context.tenantId);\n      }\n\n      const { data, error } = await query.order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setFranchises(data || []);\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Franchises</h1>\n            <p className=\"text-muted-foreground\">Manage franchise locations</p>\n          </div>\n          <Button onClick={() => navigate('/dashboard/franchises/new')}>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Franchise\n          </Button>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Store className=\"h-5 w-5\" />\n              All Franchises\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"text-center py-8\">Loading...</div>\n            ) : franchises.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No franchises found. Create your first franchise to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Code</TableHead>\n                    <TableHead>Tenant</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Created</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {franchises.map((franchise) => (\n                    <TableRow\n                      key={franchise.id}\n                      className=\"cursor-pointer\"\n                      onClick={() => navigate(`/dashboard/franchises/${franchise.id}`)}\n                    >\n                      <TableCell className=\"font-medium\">{franchise.name}</TableCell>\n                      <TableCell>{franchise.code}</TableCell>\n                      <TableCell>{franchise.tenants?.name || '-'}</TableCell>\n                      <TableCell>\n                        <Badge variant={franchise.is_active ? 'default' : 'secondary'}>\n                          {franchise.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {new Date(franchise.created_at).toLocaleDateString()}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Groups.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Incoterms.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[725,728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[725,728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchIncoterms'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, context.tenantId, fetchIncoterms]","fix":{"range":[891,934],"text":"[context.isPlatformAdmin, context.tenantId, fetchIncoterms]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2784,2787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2784,2787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { IncotermForm } from \"@/components/logistics/IncotermForm\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\n\nexport default function Incoterms() {\n  const { supabase, context } = useCRM();\n  const [incoterms, setIncoterms] = useState<any[]>([]);\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    if (context.isPlatformAdmin || context.tenantId) {\n      fetchIncoterms();\n    }\n  }, [context.isPlatformAdmin, context.tenantId]);\n\n  const fetchIncoterms = async () => {\n    const isPlatform = context.isPlatformAdmin;\n    const tenantId = context.tenantId;\n    if (!isPlatform && !tenantId) return;\n\n    let query = supabase.from(\"incoterms\").select(\"*\");\n    if (!isPlatform) {\n      query = query.eq(\"tenant_id\", tenantId as string);\n    }\n    const { data, error } = await query.order(\"incoterm_code\");\n\n    if (error) {\n      console.error(\"Error fetching incoterms:\", error);\n      return;\n    }\n\n    const rows = data || [];\n    // Dev-only: auto-seed demo incoterms if none exist (only when tenant scoped)\n    if (!isPlatform && rows.length === 0 && import.meta.env.DEV) {\n      try {\n        await supabase.from(\"incoterms\").insert([\n          {\n            tenant_id: tenantId,\n            incoterm_code: \"FOB\",\n            incoterm_name: \"Free On Board\",\n            description: \"Seller delivers goods on board the vessel at the named port of shipment.\",\n            is_active: true,\n          },\n          {\n            tenant_id: tenantId,\n            incoterm_code: \"CIF\",\n            incoterm_name: \"Cost, Insurance and Freight\",\n            description: \"Seller covers cost, insurance, and freight to port of destination.\",\n            is_active: true,\n          },\n          {\n            tenant_id: tenantId,\n            incoterm_code: \"EXW\",\n            incoterm_name: \"Ex Works\",\n            description: \"Buyer bears all costs and risks involved in taking goods from seller's premises to desired destination.\",\n            is_active: false,\n          },\n        ]);\n        toast.success(\"Seeded demo incoterms\");\n        const { data: seeded } = await supabase\n          .from(\"incoterms\")\n          .select(\"*\")\n          .eq(\"tenant_id\", tenantId as string)\n          .order(\"incoterm_code\");\n        setIncoterms(seeded || []);\n      } catch (seedErr: any) {\n        console.warn(\"Incoterms seed failed:\", seedErr?.message || seedErr);\n        setIncoterms([]);\n      }\n    } else {\n      setIncoterms(rows);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Incoterms</h1>\n          <p className=\"text-muted-foreground\">Manage international commercial terms for quotations</p>\n        </div>\n        <div className=\"space-y-4\">\n        <div className=\"flex justify-end\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Add Incoterm\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Create Incoterm</DialogTitle>\n              </DialogHeader>\n              <IncotermForm\n                onSuccess={() => {\n                  setOpen(false);\n                  fetchIncoterms();\n                }}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Code</TableHead>\n              <TableHead>Name</TableHead>\n              <TableHead>Description</TableHead>\n              <TableHead>Status</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {incoterms.map((incoterm) => (\n              <TableRow key={incoterm.id}>\n                <TableCell className=\"font-medium\">{incoterm.incoterm_code}</TableCell>\n                <TableCell>{incoterm.incoterm_name}</TableCell>\n                <TableCell className=\"max-w-md truncate\">{incoterm.description}</TableCell>\n                <TableCell>\n                  <Badge variant={incoterm.is_active ? \"default\" : \"secondary\"}>\n                    {incoterm.is_active ? \"Active\" : \"Inactive\"}\n                  </Badge>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/LeadAssignment.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStats'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchStats]","fix":{"range":[1433,1435],"text":"[fetchStats]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3083,3086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3083,3086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Users, MapPin, Settings, History, BarChart3, \n  Play, Pause, RefreshCw, UserPlus \n} from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { AssignmentRules } from '@/components/assignment/AssignmentRules';\nimport { TerritoryManagement } from '@/components/assignment/TerritoryManagement';\nimport { UserCapacity } from '@/components/assignment/UserCapacity';\nimport { AssignmentQueue } from '@/components/assignment/AssignmentQueue';\nimport { AssignmentHistory } from '@/components/assignment/AssignmentHistory';\nimport { AssignmentAnalytics } from '@/components/assignment/AssignmentAnalytics';\n\nexport default function LeadAssignment() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const [stats, setStats] = useState({\n    pendingQueue: 0,\n    assignedToday: 0,\n    activeRules: 0,\n    territories: 0,\n  });\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchStats();\n  }, []);\n\n  const fetchStats = async () => {\n    try {\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n\n      // Fetch queue count\n      const { count: queueCount } = await supabase\n        .from('lead_assignment_queue')\n        .select('*', { count: 'exact', head: true })\n        .eq('status', 'pending');\n\n      // Fetch assignments today\n      const { count: assignedCount } = await supabase\n        .from('lead_assignment_history')\n        .select('*', { count: 'exact', head: true })\n        .gte('assigned_at', today.toISOString());\n\n      // Fetch active rules\n      const { count: rulesCount } = await supabase\n        .from('lead_assignment_rules')\n        .select('*', { count: 'exact', head: true })\n        .eq('is_active', true);\n\n      // Fetch territories\n      const { count: territoriesCount } = await supabase\n        .from('territories')\n        .select('*', { count: 'exact', head: true })\n        .eq('is_active', true);\n\n      setStats({\n        pendingQueue: queueCount || 0,\n        assignedToday: assignedCount || 0,\n        activeRules: rulesCount || 0,\n        territories: territoriesCount || 0,\n      });\n    } catch (error) {\n      console.error('Error fetching stats:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleProcessQueue = async () => {\n    try {\n      toast.info('Processing assignment queue...');\n      // Trigger edge function to process queue\n      const { error } = await supabase.functions.invoke('process-lead-assignments');\n      \n      if (error) throw error;\n      \n      toast.success('Queue processing initiated');\n      fetchStats();\n    } catch (error: any) {\n      toast.error('Failed to process queue');\n      console.error('Error:', error);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Lead Assignment</h1>\n            <p className=\"text-muted-foreground\">\n              Manage automated lead distribution and assignment workflows\n            </p>\n          </div>\n          <Button onClick={handleProcessQueue}>\n            <Play className=\"mr-2 h-4 w-4\" />\n            Process Queue\n          </Button>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Pending Queue</CardTitle>\n              <RefreshCw className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.pendingQueue}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Leads waiting for assignment\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Assigned Today</CardTitle>\n              <UserPlus className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.assignedToday}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Leads assigned today\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Active Rules</CardTitle>\n              <Settings className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.activeRules}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Assignment rules enabled\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Territories</CardTitle>\n              <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.territories}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Active territories\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Tabs for different sections */}\n        <Tabs defaultValue=\"rules\" className=\"space-y-4\">\n          <TabsList>\n            <TabsTrigger value=\"rules\">\n              <Settings className=\"mr-2 h-4 w-4\" />\n              Assignment Rules\n            </TabsTrigger>\n            <TabsTrigger value=\"territories\">\n              <MapPin className=\"mr-2 h-4 w-4\" />\n              Territories\n            </TabsTrigger>\n            <TabsTrigger value=\"capacity\">\n              <Users className=\"mr-2 h-4 w-4\" />\n              User Capacity\n            </TabsTrigger>\n            <TabsTrigger value=\"queue\">\n              <RefreshCw className=\"mr-2 h-4 w-4\" />\n              Queue\n            </TabsTrigger>\n            <TabsTrigger value=\"history\">\n              <History className=\"mr-2 h-4 w-4\" />\n              History\n            </TabsTrigger>\n            <TabsTrigger value=\"analytics\">\n              <BarChart3 className=\"mr-2 h-4 w-4\" />\n              Analytics\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"rules\" className=\"space-y-4\">\n            <AssignmentRules onUpdate={fetchStats} />\n          </TabsContent>\n\n          <TabsContent value=\"territories\" className=\"space-y-4\">\n            <TerritoryManagement />\n          </TabsContent>\n\n          <TabsContent value=\"capacity\" className=\"space-y-4\">\n            <UserCapacity />\n          </TabsContent>\n\n          <TabsContent value=\"queue\" className=\"space-y-4\">\n            <AssignmentQueue onUpdate={fetchStats} />\n          </TabsContent>\n\n          <TabsContent value=\"history\" className=\"space-y-4\">\n            <AssignmentHistory />\n          </TabsContent>\n\n          <TabsContent value=\"analytics\" className=\"space-y-4\">\n            <AssignmentAnalytics />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/LeadDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/LeadNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[572,575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[572,575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1091,1094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1091,1094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1932,1935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1932,1935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { LeadForm } from '@/components/crm/LeadForm';\nimport { ArrowLeft } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nexport default function LeadNew() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n\n  const handleCreate = async (formData: any) => {\n    try {\n      const tenantId = context.isPlatformAdmin \n        ? formData.tenant_id \n        : context.tenantId;\n\n      if (!tenantId) {\n        toast.error('Please select a tenant');\n        return;\n      }\n\n      // Extract non-column extras and persist them into custom_fields\n      const { service_id, attachments, ...rest } = formData || {};\n      const attachmentNames = Array.isArray(attachments)\n        ? attachments.map((f: File) => f.name)\n        : [];\n      const customFields: Record<string, any> = {\n        ...(rest?.custom_fields || {}),\n        ...(service_id ? { service_id } : {}),\n        ...(attachmentNames.length ? { attachments_names: attachmentNames } : {}),\n      };\n\n      const { data, error } = await supabase\n        .from('leads')\n        .insert({\n          ...rest,\n          tenant_id: tenantId,\n          franchise_id: formData.franchise_id || context.franchiseId,\n          estimated_value: formData.estimated_value ? parseFloat(formData.estimated_value) : null,\n          expected_close_date: formData.expected_close_date || null,\n          custom_fields: Object.keys(customFields).length ? customFields : null,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      toast.success('Lead created successfully');\n      navigate(`/dashboard/leads/${data.id}`);\n    } catch (error: any) {\n      toast.error('Failed to create lead');\n      console.error('Error:', error);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/leads')}>\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">New Lead</h1>\n            <p className=\"text-muted-foreground\">Create a new sales lead</p>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Lead Information</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <LeadForm\n              onSubmit={handleCreate}\n              onCancel={() => navigate('/dashboard/leads')}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/LeadRouting.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[855,858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[855,858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1128,1131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1128,1131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchRules' and 'fetchUsers'. Either include them or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRules, fetchUsers]","fix":{"range":[1430,1432],"text":"[fetchRules, fetchUsers]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1758,1761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1758,1761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2158,2161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2158,2161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3158,3161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3158,3161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3643,3646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3643,3646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4052,4055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4052,4055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Plus, Trash2, ArrowUpDown, Info } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ninterface AssignmentRule {\n  id: string;\n  rule_name: string;\n  priority: number;\n  criteria: any;\n  assigned_to: string | null;\n  is_active: boolean;\n}\n\nexport default function LeadRouting() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const [rules, setRules] = useState<AssignmentRule[]>([]);\n  const [users, setUsers] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [newRule, setNewRule] = useState({\n    rule_name: '',\n    priority: 0,\n    criteria_type: 'source',\n    criteria_value: '',\n    assigned_to: '',\n    is_active: true,\n  });\n\n  useEffect(() => {\n    fetchRules();\n    fetchUsers();\n  }, []);\n\n  const fetchRules = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('lead_assignment_rules')\n        .select('*')\n        .eq('tenant_id', context.tenantId)\n        .order('priority', { ascending: false });\n\n      if (error) throw error;\n      setRules(data || []);\n    } catch (error: any) {\n      toast.error('Failed to load assignment rules');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchUsers = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('id, first_name, last_name, email');\n\n      if (error) throw error;\n      setUsers(data || []);\n    } catch (error: any) {\n      console.error('Error fetching users:', error);\n    }\n  };\n\n  const handleCreateRule = async () => {\n    if (!newRule.rule_name || !newRule.assigned_to) {\n      toast.error('Please fill in all required fields');\n      return;\n    }\n\n    try {\n      const { error } = await supabase\n        .from('lead_assignment_rules')\n        .insert({\n          rule_name: newRule.rule_name,\n          priority: newRule.priority,\n          criteria: {\n            type: newRule.criteria_type,\n            value: newRule.criteria_value,\n          },\n          assigned_to: newRule.assigned_to,\n          is_active: newRule.is_active,\n          tenant_id: context.tenantId,\n        });\n\n      if (error) throw error;\n\n      toast.success('Assignment rule created successfully');\n      setNewRule({\n        rule_name: '',\n        priority: 0,\n        criteria_type: 'source',\n        criteria_value: '',\n        assigned_to: '',\n        is_active: true,\n      });\n      fetchRules();\n    } catch (error: any) {\n      toast.error('Failed to create assignment rule');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleToggleRule = async (ruleId: string, isActive: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('lead_assignment_rules')\n        .update({ is_active: isActive })\n        .eq('id', ruleId);\n\n      if (error) throw error;\n\n      toast.success(`Rule ${isActive ? 'activated' : 'deactivated'}`);\n      fetchRules();\n    } catch (error: any) {\n      toast.error('Failed to update rule');\n      console.error('Error:', error);\n    }\n  };\n\n  const handleDeleteRule = async (ruleId: string) => {\n    try {\n      const { error } = await supabase\n        .from('lead_assignment_rules')\n        .delete()\n        .eq('id', ruleId);\n\n      if (error) throw error;\n\n      toast.success('Assignment rule deleted');\n      fetchRules();\n    } catch (error: any) {\n      toast.error('Failed to delete rule');\n      console.error('Error:', error);\n    }\n  };\n\n  if (!context.isPlatformAdmin && !context.isTenantAdmin) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">You don't have permission to access this page</p>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Lead Routing</h1>\n          <p className=\"text-muted-foreground\">Configure automatic lead assignment rules</p>\n        </div>\n\n        <Alert>\n          <Info className=\"h-4 w-4\" />\n          <AlertDescription>\n            Looking for advanced assignment features? Check out the new{' '}\n            <Button\n              variant=\"link\"\n              className=\"p-0 h-auto font-semibold\"\n              onClick={() => navigate('/dashboard/lead-assignment')}\n            >\n              Lead Assignment\n            </Button>\n            {' '}module with territories, capacity management, and automated workflows.\n          </AlertDescription>\n        </Alert>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Create Assignment Rule</CardTitle>\n            <CardDescription>Automatically route leads to team members based on criteria</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"ruleName\">Rule Name *</Label>\n                <Input\n                  id=\"ruleName\"\n                  placeholder=\"e.g., Route referrals to John\"\n                  value={newRule.rule_name}\n                  onChange={(e) => setNewRule({ ...newRule, rule_name: e.target.value })}\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"priority\">Priority</Label>\n                <Input\n                  id=\"priority\"\n                  type=\"number\"\n                  placeholder=\"0\"\n                  value={newRule.priority}\n                  onChange={(e) => setNewRule({ ...newRule, priority: parseInt(e.target.value) || 0 })}\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"criteriaType\">Criteria Type</Label>\n                <Select\n                  value={newRule.criteria_type}\n                  onValueChange={(value) => setNewRule({ ...newRule, criteria_type: value })}\n                >\n                  <SelectTrigger id=\"criteriaType\">\n                    <SelectValue placeholder=\"Select criteria\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"source\">Source</SelectItem>\n                    <SelectItem value=\"status\">Status</SelectItem>\n                    <SelectItem value=\"estimated_value\">Estimated Value</SelectItem>\n                    <SelectItem value=\"location\">Location</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"criteriaValue\">Criteria Value</Label>\n                <Input\n                  id=\"criteriaValue\"\n                  placeholder=\"e.g., referral, website, etc.\"\n                  value={newRule.criteria_value}\n                  onChange={(e) => setNewRule({ ...newRule, criteria_value: e.target.value })}\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"assignedTo\">Assign To *</Label>\n                <Select\n                  value={newRule.assigned_to}\n                  onValueChange={(value) => setNewRule({ ...newRule, assigned_to: value })}\n                >\n                  <SelectTrigger id=\"assignedTo\">\n                    <SelectValue placeholder=\"Select user\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {users.map((user) => (\n                      <SelectItem key={user.id} value={user.id}>\n                        {user.first_name} {user.last_name} ({user.email})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2 flex items-end\">\n                <div className=\"flex items-center space-x-2\">\n                  <Switch\n                    id=\"isActive\"\n                    checked={newRule.is_active}\n                    onCheckedChange={(checked) => setNewRule({ ...newRule, is_active: checked })}\n                  />\n                  <Label htmlFor=\"isActive\">Active</Label>\n                </div>\n              </div>\n            </div>\n\n            <Button onClick={handleCreateRule}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Create Rule\n            </Button>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Assignment Rules</CardTitle>\n            <CardDescription>Manage your lead routing rules (ordered by priority)</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"text-center py-8\">\n                <p className=\"text-muted-foreground\">Loading rules...</p>\n              </div>\n            ) : rules.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <ArrowUpDown className=\"mx-auto h-12 w-12 text-muted-foreground mb-3\" />\n                <p className=\"text-muted-foreground\">No assignment rules configured yet</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {rules.map((rule) => {\n                  const assignedUser = users.find(u => u.id === rule.assigned_to);\n                  return (\n                    <div\n                      key={rule.id}\n                      className=\"flex items-center justify-between p-4 border rounded-lg\"\n                    >\n                      <div className=\"flex-1 space-y-1\">\n                        <div className=\"flex items-center gap-3\">\n                          <span className=\"font-medium\">{rule.rule_name}</span>\n                          <span className=\"text-xs bg-muted px-2 py-1 rounded\">\n                            Priority: {rule.priority}\n                          </span>\n                          {!rule.is_active && (\n                            <span className=\"text-xs bg-yellow-500/10 text-yellow-600 px-2 py-1 rounded\">\n                              Inactive\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          When {rule.criteria?.type} = \"{rule.criteria?.value}\"  Assign to{' '}\n                          {assignedUser ? `${assignedUser.first_name} ${assignedUser.last_name}` : 'Unknown'}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch\n                          checked={rule.is_active}\n                          onCheckedChange={(checked) => handleToggleRule(rule.id, checked)}\n                        />\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleDeleteRule(rule.id)}\n                        >\n                          <Trash2 className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>How Lead Routing Works</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-sm text-muted-foreground\">\n            <div>\n              <p className=\"font-medium text-foreground mb-1\">1. Lead Generation</p>\n              <p>New leads are captured through web forms, imports, or manual entry</p>\n            </div>\n            <div>\n              <p className=\"font-medium text-foreground mb-1\">2. Automatic Scoring</p>\n              <p>Each lead receives an AI-powered score based on status, value, activity, and source</p>\n            </div>\n            <div>\n              <p className=\"font-medium text-foreground mb-1\">3. Rule Matching</p>\n              <p>Assignment rules are evaluated in priority order (highest first)</p>\n            </div>\n            <div>\n              <p className=\"font-medium text-foreground mb-1\">4. Lead Assignment</p>\n              <p>The first matching active rule assigns the lead to the specified team member</p>\n            </div>\n            <div>\n              <p className=\"font-medium text-foreground mb-1\">5. Qualification & Nurturing</p>\n              <p>Assigned reps engage with leads, track activities, and move them through the pipeline</p>\n            </div>\n            <div>\n              <p className=\"font-medium text-foreground mb-1\">6. Conversion</p>\n              <p>Qualified leads are converted to accounts, contacts, and opportunities</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Leads.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLeads'. Either include it or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchLeads]","fix":{"range":[2787,2789],"text":"[fetchLeads]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Plus, Search, UserPlus, DollarSign, Calendar, Filter, TrendingUp, Upload, Users as UsersIcon } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport TitleStrip from '@/components/ui/title-strip';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { useCRM } from '@/hooks/useCRM';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Link } from 'react-router-dom';\nimport { toast } from 'sonner';\nimport { matchText, TextOp } from '@/lib/utils';\n\nimport { Lead, LeadStatus, stages, statusConfig } from './leads-data';\n\nexport default function Leads() {\n  const navigate = useNavigate();\n  const [leads, setLeads] = useState<Lead[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [scoreFilter, setScoreFilter] = useState<string>('all');\n  const [ownerFilter, setOwnerFilter] = useState<'any' | 'unassigned' | 'me'>('any');\n  const [viewMode, setViewMode] = useState<ViewMode>('card');\n  const { supabase, context } = useCRM();\n\n  // Advanced per-column filters\n  const [nameQuery, setNameQuery] = useState('');\n  const [nameOp, setNameOp] = useState<TextOp>('contains');\n  const [companyQuery, setCompanyQuery] = useState('');\n  const [companyOp, setCompanyOp] = useState<TextOp>('contains');\n  const [emailQuery, setEmailQuery] = useState('');\n  const [emailOp, setEmailOp] = useState<TextOp>('contains');\n  const [phoneQuery, setPhoneQuery] = useState('');\n  const [phoneOp, setPhoneOp] = useState<TextOp>('contains');\n  const [sourceQuery, setSourceQuery] = useState('');\n  const [sourceOp, setSourceOp] = useState<TextOp>('contains');\n  const [qualificationQuery, setQualificationQuery] = useState('');\n  const [qualificationOp, setQualificationOp] = useState<TextOp>('contains');\n  const [scoreMin, setScoreMin] = useState<string>('');\n  const [scoreMax, setScoreMax] = useState<string>('');\n  const [valueMin, setValueMin] = useState<string>('');\n  const [valueMax, setValueMax] = useState<string>('');\n  const [createdStart, setCreatedStart] = useState<string>('');\n  const [createdEnd, setCreatedEnd] = useState<string>('');\n\n  useEffect(() => {\n    fetchLeads();\n  }, []);\n\n  const fetchLeads = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('leads')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      // Validate and cast data\n      const safeLeads = (data || []).map(d => ({\n        ...d,\n        status: stages.includes(d.status as LeadStatus) ? (d.status as LeadStatus) : 'new'\n      })) as Lead[];\n\n      setLeads(safeLeads);\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to load leads');\n      console.error('Error:', message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredLeads = leads.filter(lead => {\n    const matchesSearch = `${lead.first_name} ${lead.last_name}`.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      lead.company?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    const matchesStatus = statusFilter === 'all' || lead.status === statusFilter;\n    \n    const matchesScore = scoreFilter === 'all' || \n      (scoreFilter === 'high' && (lead.lead_score || 0) >= 70) ||\n      (scoreFilter === 'medium' && (lead.lead_score || 0) >= 40 && (lead.lead_score || 0) < 70) ||\n      (scoreFilter === 'low' && (lead.lead_score || 0) < 40);\n    \n    const matchesOwner =\n      ownerFilter === 'any'\n        ? true\n        : ownerFilter === 'unassigned'\n        ? !lead.owner_id\n        : lead.owner_id === (context?.userId || null);\n\n    // Advanced per-column text filters\n    const fullName = `${lead.first_name} ${lead.last_name}`.trim();\n    const matchesName = matchText(fullName, nameQuery, nameOp);\n    const matchesCompany = matchText(lead.company ?? '', companyQuery, companyOp);\n    const matchesEmail = matchText(lead.email ?? '', emailQuery, emailOp);\n    const matchesPhone = matchText(lead.phone ?? '', phoneQuery, phoneOp);\n    const matchesSource = matchText(lead.source ?? '', sourceQuery, sourceOp);\n    const matchesQualification = matchText(lead.qualification_status ?? '', qualificationQuery, qualificationOp);\n\n    // Numeric ranges (inclusive)\n    const scoreVal = lead.lead_score ?? undefined;\n    const sMin = scoreMin ? Number(scoreMin) : undefined;\n    const sMax = scoreMax ? Number(scoreMax) : undefined;\n    const matchesScoreRange = (\n      (sMin === undefined || (scoreVal !== undefined && scoreVal >= sMin)) &&\n      (sMax === undefined || (scoreVal !== undefined && scoreVal <= sMax))\n    );\n\n    const valueVal = lead.estimated_value ?? undefined;\n    const vMin = valueMin ? Number(valueMin) : undefined;\n    const vMax = valueMax ? Number(valueMax) : undefined;\n    const matchesValueRange = (\n      (vMin === undefined || (valueVal !== undefined && valueVal >= vMin)) &&\n      (vMax === undefined || (valueVal !== undefined && valueVal <= vMax))\n    );\n\n    // Date range (created_at)\n    const created = lead.created_at ? new Date(lead.created_at) : null;\n    const cStart = createdStart ? new Date(createdStart) : null;\n    const cEnd = createdEnd ? new Date(createdEnd) : null;\n    const matchesCreatedRange = (\n      (!cStart || (created && created >= cStart)) &&\n      (!cEnd || (created && created <= cEnd))\n    );\n\n    return (\n      matchesSearch &&\n      matchesStatus &&\n      matchesScore &&\n      matchesOwner &&\n      matchesName &&\n      matchesCompany &&\n      matchesEmail &&\n      matchesPhone &&\n      matchesSource &&\n      matchesQualification &&\n      matchesScoreRange &&\n      matchesValueRange &&\n      matchesCreatedRange\n    );\n  });\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      new: 'bg-blue-500/10 text-blue-500',\n      contacted: 'bg-purple-500/10 text-purple-500',\n      qualified: 'bg-teal-500/10 text-teal-500',\n      proposal: 'bg-yellow-500/10 text-yellow-500',\n      negotiation: 'bg-orange-500/10 text-orange-500',\n      won: 'bg-green-500/10 text-green-500',\n      lost: 'bg-red-500/10 text-red-500',\n    };\n    return colors[status] || 'bg-gray-500/10 text-gray-500';\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Leads</h1>\n          <p className=\"text-muted-foreground\">Track and convert potential customers</p>\n        </div>\n        <div className=\"flex gap-2 items-center\">\n          <ViewToggle\n            value={viewMode}\n            modes={['pipeline','card','grid','list']}\n            onChange={(v) => v === 'pipeline' ? navigate('/dashboard/leads/pipeline') : setViewMode(v)}\n          />\n          {/* Removed standalone Pipeline View button; use ViewToggle with Pipeline first */}\n          <Button variant=\"outline\" onClick={() => navigate('/dashboard/lead-assignment')}>\n            <UsersIcon className=\"mr-2 h-4 w-4\" />\n            Lead Assignment\n          </Button>\n          <Button variant=\"outline\" onClick={() => navigate('/dashboard/leads/import-export')}>\n            <Upload className=\"mr-2 h-4 w-4\" />\n            Import / Export\n          </Button>\n          <Button asChild>\n            <Link to=\"/dashboard/leads/new\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New Lead\n            </Link>\n          </Button>\n        </div>\n      </div>\n\n      {/* Advanced per-column filters */}\n      <div className=\"flex flex-wrap gap-3 mb-2\">\n        <div className=\"flex items-center gap-2\">\n          <Select value={nameOp} onValueChange={(v) => setNameOp(v as TextOp)}>\n            <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Name op\" /></SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"contains\">Contains</SelectItem>\n              <SelectItem value=\"equals\">Equals</SelectItem>\n              <SelectItem value=\"startsWith\">Starts With</SelectItem>\n              <SelectItem value=\"endsWith\">Ends With</SelectItem>\n            </SelectContent>\n          </Select>\n          <Input\n            placeholder=\"Name\"\n            value={nameQuery}\n            onChange={(e) => setNameQuery(e.target.value)}\n            className=\"w-[180px]\"\n          />\n        </div>\n      </div>\n\n      <div className=\"flex flex-wrap gap-4\">\n        <div className=\"relative flex-1 min-w-[300px]\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search leads...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n        \n        <Select value={statusFilter} onValueChange={setStatusFilter}>\n          <SelectTrigger className=\"w-[180px]\">\n            <Filter className=\"mr-2 h-4 w-4\" />\n            <SelectValue placeholder=\"Status\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Statuses</SelectItem>\n            <SelectItem value=\"new\">New</SelectItem>\n            <SelectItem value=\"contacted\">Contacted</SelectItem>\n            <SelectItem value=\"qualified\">Qualified</SelectItem>\n            <SelectItem value=\"proposal\">Proposal</SelectItem>\n            <SelectItem value=\"negotiation\">Negotiation</SelectItem>\n            <SelectItem value=\"won\">Won</SelectItem>\n            <SelectItem value=\"lost\">Lost</SelectItem>\n          </SelectContent>\n        </Select>\n\n        <Select value={scoreFilter} onValueChange={setScoreFilter}>\n          <SelectTrigger className=\"w-[180px]\">\n            <TrendingUp className=\"mr-2 h-4 w-4\" />\n            <SelectValue placeholder=\"Score\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Scores</SelectItem>\n            <SelectItem value=\"high\">High (70+)</SelectItem>\n            <SelectItem value=\"medium\">Medium (40-69)</SelectItem>\n            <SelectItem value=\"low\">Low (&lt;40)</SelectItem>\n          </SelectContent>\n        </Select>\n\n        <Select value={ownerFilter} onValueChange={(v) => setOwnerFilter(v as 'any' | 'unassigned' | 'me')}>\n          <SelectTrigger className=\"w-[180px]\">\n            <UsersIcon className=\"mr-2 h-4 w-4\" />\n            <SelectValue placeholder=\"Owner\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"any\">Any Owner</SelectItem>\n            <SelectItem value=\"me\">Assigned to Me</SelectItem>\n            <SelectItem value=\"unassigned\">Unassigned</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"flex flex-wrap gap-2 mb-2\">\n        <div className=\"flex items-center gap-2\">\n          <Input\n            type=\"number\"\n            placeholder=\"Score min\"\n            value={scoreMin}\n            onChange={(e) => setScoreMin(e.target.value)}\n            className=\"w-[130px]\"\n          />\n          <Input\n            type=\"number\"\n            placeholder=\"Score max\"\n            value={scoreMax}\n            onChange={(e) => setScoreMax(e.target.value)}\n            className=\"w-[130px]\"\n          />\n        </div>\n      </div>\n\n      <div className=\"flex flex-wrap gap-2 mb-2\">\n        <div className=\"flex items-center gap-2\">\n          <Input\n            type=\"number\"\n            placeholder=\"Value min\"\n            value={valueMin}\n            onChange={(e) => setValueMin(e.target.value)}\n            className=\"w-[140px]\"\n          />\n          <Input\n            type=\"number\"\n            placeholder=\"Value max\"\n            value={valueMax}\n            onChange={(e) => setValueMax(e.target.value)}\n            className=\"w-[140px]\"\n          />\n        </div>\n      </div>\n\n      <div className=\"flex flex-wrap gap-2 mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <Input\n            type=\"date\"\n            placeholder=\"Created from\"\n            value={createdStart}\n            onChange={(e) => setCreatedStart(e.target.value)}\n            className=\"w-[170px]\"\n          />\n          <Input\n            type=\"date\"\n            placeholder=\"Created to\"\n            value={createdEnd}\n            onChange={(e) => setCreatedEnd(e.target.value)}\n            className=\"w-[170px]\"\n          />\n        </div>\n      </div>\n\n      <div className=\"flex flex-wrap gap-3 mb-2\">\n        <div className=\"flex items-center gap-2\">\n          <Select value={companyOp} onValueChange={(v) => setCompanyOp(v as TextOp)}>\n            <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Company op\" /></SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"contains\">Contains</SelectItem>\n              <SelectItem value=\"equals\">Equals</SelectItem>\n              <SelectItem value=\"startsWith\">Starts With</SelectItem>\n              <SelectItem value=\"endsWith\">Ends With</SelectItem>\n            </SelectContent>\n          </Select>\n          <Input\n            placeholder=\"Company\"\n            value={companyQuery}\n            onChange={(e) => setCompanyQuery(e.target.value)}\n            className=\"w-[180px]\"\n          />\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Select value={emailOp} onValueChange={(v) => setEmailOp(v as TextOp)}>\n            <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Email op\" /></SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"contains\">Contains</SelectItem>\n              <SelectItem value=\"equals\">Equals</SelectItem>\n              <SelectItem value=\"startsWith\">Starts With</SelectItem>\n              <SelectItem value=\"endsWith\">Ends With</SelectItem>\n            </SelectContent>\n          </Select>\n          <Input\n            placeholder=\"Email\"\n            value={emailQuery}\n            onChange={(e) => setEmailQuery(e.target.value)}\n            className=\"w-[200px]\"\n          />\n        </div>\n      </div>\n\n      {loading ? (\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">Loading leads...</p>\n        </div>\n      ) : filteredLeads.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <UserPlus className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No leads found</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {searchQuery ? 'Try adjusting your search' : 'Start building your sales pipeline'}\n            </p>\n            {!searchQuery && (\n              <Button asChild>\n                <Link to=\"/dashboard/leads/new\">\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Add Lead\n                </Link>\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : viewMode === 'list' ? (\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <TitleStrip label=\"All Leads\" />\n          </CardHeader>\n              <Table>\n                <TableHeader className=\"bg-[hsl(var(--title-strip))] [&_th]:text-white [&_th]:font-semibold [&_th]:text-xs [&_th]:px-3 [&_th]:py-2 [&_th]:border-l [&_th]:border-white/60\">\n                  <TableRow className=\"border-b-2\" style={{ borderBottomColor: 'hsl(var(--title-strip))' }}>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Company</TableHead>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Phone</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Source</TableHead>\n                    <TableHead>Score</TableHead>\n                    <TableHead>Value</TableHead>\n                  </TableRow>\n                </TableHeader>\n            <TableBody>\n              {filteredLeads.map((lead) => (\n                <TableRow \n                  key={lead.id} \n                  className=\"cursor-pointer hover:bg-muted/50\"\n                  onClick={() => navigate(`/dashboard/leads/${lead.id}`)}\n                >\n                  <TableCell className=\"font-medium\">\n                    {lead.first_name} {lead.last_name}\n                  </TableCell>\n                  <TableCell>{lead.company || '-'}</TableCell>\n                  <TableCell>{lead.email || '-'}</TableCell>\n                  <TableCell>{lead.phone || '-'}</TableCell>\n                  <TableCell>\n                    <Badge className={getStatusColor(lead.status)}>\n                      {lead.status}\n                    </Badge>\n                  </TableCell>\n                  <TableCell>\n                    <Badge variant=\"outline\">{lead.source}</Badge>\n                  </TableCell>\n                  <TableCell>\n                    {lead.lead_score !== null ? (\n                      <div className=\"flex items-center gap-1\">\n                        <TrendingUp className=\"h-4 w-4 text-primary\" />\n                        {lead.lead_score}\n                      </div>\n                    ) : '-'}\n                  </TableCell>\n                  <TableCell>\n                    {lead.estimated_value ? (\n                      <div className=\"flex items-center gap-1 text-green-600\">\n                        <DollarSign className=\"h-4 w-4\" />\n                        ${lead.estimated_value.toLocaleString()}\n                      </div>\n                    ) : '-'}\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </Card>\n      ) : (\n        <div className=\"space-y-2\">\n          <TitleStrip label=\"All Leads\" />\n          <div className={viewMode === 'grid' ? 'grid gap-4 md:grid-cols-2 lg:grid-cols-4' : 'grid gap-4 md:grid-cols-2 lg:grid-cols-3'}>\n            {filteredLeads.map((lead) => (\n              <Link key={lead.id} to={`/dashboard/leads/${lead.id}`}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <UserPlus className=\"h-10 w-10 text-primary\" />\n                      <Badge className={getStatusColor(lead.status)}>\n                        {lead.status}\n                      </Badge>\n                    </div>\n                    <CardTitle className=\"mt-4\">\n                      {lead.first_name} {lead.last_name}\n                    </CardTitle>\n                    {lead.company && (\n                      <CardDescription>{lead.company}</CardDescription>\n                    )}\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      {lead.estimated_value && (\n                        <div className=\"flex items-center gap-2 text-sm font-medium text-green-600\">\n                          <DollarSign className=\"h-4 w-4\" />\n                          <span>${lead.estimated_value.toLocaleString()}</span>\n                        </div>\n                      )}\n                      {lead.lead_score !== null && (\n                        <div className=\"flex items-center gap-1 text-sm font-medium\">\n                          <TrendingUp className=\"h-4 w-4 text-primary\" />\n                          <span>{lead.lead_score}</span>\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {lead.source}\n                      </Badge>\n                      {lead.qualification_status && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {lead.qualification_status}\n                        </Badge>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </Link>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/LeadsImportExport.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2294,2297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2294,2297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2572,2575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2572,2575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2983,2986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2983,2986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3464,3467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3464,3467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4556,4559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4556,4559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6943,6946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6943,6946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":202,"column":120,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":123,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7985,7988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7985,7988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9586,9589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9586,9589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":121,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":124,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9775,9778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9775,9778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport Papa from 'papaparse';\nimport * as XLSX from 'xlsx';\nimport { Download, Upload, FileText, AlertCircle, CheckCircle2 } from 'lucide-react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Progress } from '@/components/ui/progress';\nimport { Separator } from '@/components/ui/separator';\nimport { Badge } from '@/components/ui/badge';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ninterface ImportResult {\n  success: number;\n  failed: number;\n  errors: string[];\n}\n\nexport default function LeadsImportExport() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const [importing, setImporting] = useState(false);\n  const [exporting, setExporting] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [importResult, setImportResult] = useState<ImportResult | null>(null);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n    const isCsv = file.type === 'text/csv' || file.name.toLowerCase().endsWith('.csv');\n    const isXlsx = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' || file.name.toLowerCase().endsWith('.xlsx');\n    if (isCsv || isXlsx) {\n      setSelectedFile(file);\n      setImportResult(null);\n    } else {\n      toast.error('Please select a valid CSV or Excel (.xlsx) file');\n    }\n  };\n\n  const handleImport = async () => {\n    if (!selectedFile) {\n      toast.error('Please select a file first');\n      return;\n    }\n\n    setImporting(true);\n    setProgress(0);\n    const result: ImportResult = { success: 0, failed: 0, errors: [] };\n\n    const isCsv = selectedFile.type === 'text/csv' || selectedFile.name.toLowerCase().endsWith('.csv');\n    const parseCsv = () => new Promise<any[]>((resolve, reject) => {\n      Papa.parse(selectedFile!, {\n        header: true,\n        skipEmptyLines: true,\n        complete: (results) => resolve(results.data as any[]),\n        error: (error) => reject(error),\n      });\n    });\n    const parseXlsx = () => new Promise<any[]>((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        try {\n          const data = new Uint8Array(e.target?.result as ArrayBuffer);\n          const wb = XLSX.read(data, { type: 'array' });\n          const sheetName = wb.SheetNames[0];\n          const ws = wb.Sheets[sheetName];\n          const rows = XLSX.utils.sheet_to_json(ws);\n          resolve(rows as any[]);\n        } catch (err) {\n          reject(err);\n        }\n      };\n      reader.onerror = () => reject(new Error('Failed to read Excel file'));\n      reader.readAsArrayBuffer(selectedFile!);\n    });\n\n    try {\n      const rows = isCsv ? await parseCsv() : await parseXlsx();\n      const total = rows.length;\n\n      for (let i = 0; i < rows.length; i++) {\n        const row = rows[i];\n        \n        try {\n            // Extract standard fields\n            const leadData: any = {\n              first_name: row.first_name || row.firstName,\n              last_name: row.last_name || row.lastName,\n              email: row.email,\n              phone: row.phone,\n              company: row.company,\n              title: row.title,\n              status: row.status || 'new',\n              source: row.source || 'other',\n              estimated_value: row.estimated_value ? parseFloat(row.estimated_value) : null,\n              expected_close_date: row.expected_close_date || null,\n              description: row.description,\n              notes: row.notes,\n              tenant_id: context.tenantId,\n              franchise_id: context.franchiseId,\n            };\n\n            // Extract custom fields (any field not in standard schema)\n            const standardFields = ['first_name', 'firstName', 'last_name', 'lastName', 'email', 'phone', \n              'company', 'title', 'status', 'source', 'estimated_value', 'expected_close_date', \n              'description', 'notes', 'tenant_id', 'franchise_id'];\n            \n            const customFields: Record<string, any> = {};\n            Object.keys(row).forEach(key => {\n              if (!standardFields.includes(key) && row[key]) {\n                customFields[key] = row[key];\n              }\n            });\n\n            if (Object.keys(customFields).length > 0) {\n              leadData.custom_fields = customFields;\n            }\n\n            // Basic validation rules\n            const rowErrors: string[] = [];\n            if (!leadData.first_name || !leadData.last_name) {\n              rowErrors.push('first_name and last_name are required');\n            }\n            const hasContact = !!(leadData.email && String(leadData.email).trim()) || !!(leadData.phone && String(leadData.phone).trim());\n            if (!hasContact) {\n              rowErrors.push('At least one contact (email or phone) is required');\n            }\n            const allowedStatus = ['new','contacted','qualified','proposal','negotiation','won','lost'];\n            if (leadData.status && !allowedStatus.includes(String(leadData.status).toLowerCase())) {\n              rowErrors.push(`Invalid status '${leadData.status}'`);\n            }\n            const allowedSource = ['website','referral','email','phone','social','event','other'];\n            if (leadData.source && !allowedSource.includes(String(leadData.source).toLowerCase())) {\n              rowErrors.push(`Invalid source '${leadData.source}'`);\n            }\n            if (rowErrors.length > 0) {\n              result.failed++;\n              result.errors.push(`Row ${i + 1}: ${rowErrors.join('; ')}`);\n              setProgress(((i + 1) / total) * 100);\n              continue;\n            }\n\n            const { error } = await supabase.from('leads').insert(leadData);\n\n            if (error) {\n              result.failed++;\n              result.errors.push(`Row ${i + 1}: ${error.message}`);\n            } else {\n              result.success++;\n            }\n          } catch (err) {\n            result.failed++;\n            result.errors.push(`Row ${i + 1}: ${err instanceof Error ? err.message : 'Unknown error'}`);\n          }\n\n          setProgress(((i + 1) / total) * 100);\n        }\n\n      setImportResult(result);\n      setImporting(false);\n      if (result.success > 0) toast.success(`Successfully imported ${result.success} leads`);\n      if (result.failed > 0) toast.error(`Failed to import ${result.failed} leads`);\n    } catch (error: any) {\n      console.error('Import parsing error:', error);\n      toast.error(`Import parsing error: ${error?.message || 'Unknown error'}`);\n      setImporting(false);\n    }\n  };\n\n  const handleExport = async () => {\n    setExporting(true);\n    \n    try {\n      let query = supabase.from('leads').select('*');\n\n      // Apply filters based on user context\n      if (context.franchiseId) {\n        query = query.eq('franchise_id', context.franchiseId);\n      } else if (context.tenantId) {\n        query = query.eq('tenant_id', context.tenantId);\n      }\n\n      const { data: leads, error } = await query;\n\n      if (error) throw error;\n\n      if (!leads || leads.length === 0) {\n        toast.error('No leads found to export');\n        setExporting(false);\n        return;\n      }\n\n      // Flatten data for CSV export\n      const exportData = leads.map(lead => {\n        const { custom_fields, ...standardFields } = lead;\n        const customFieldsObj = (custom_fields && typeof custom_fields === 'object') ? custom_fields as Record<string, any> : {};\n        return {\n          ...standardFields,\n          ...customFieldsObj\n        };\n      });\n\n      // Generate CSV\n      const csv = Papa.unparse(exportData);\n      \n      // Download file\n      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n      const link = document.createElement('a');\n      const url = URL.createObjectURL(blob);\n      link.setAttribute('href', url);\n      link.setAttribute('download', `leads_export_${new Date().toISOString().split('T')[0]}.csv`);\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n\n      toast.success(`Exported ${leads.length} leads successfully`);\n    } catch (error) {\n      console.error('Export error:', error);\n      toast.error('Failed to export leads');\n    } finally {\n      setExporting(false);\n    }\n  };\n\n  // Export leads to Excel (.xlsx)\n  const handleExportExcel = async () => {\n    setExporting(true);\n    try {\n      let query = supabase.from('leads').select('*');\n\n      // Apply filters based on user context\n      if (context.franchiseId) {\n        query = query.eq('franchise_id', context.franchiseId);\n      } else if (context.tenantId) {\n        query = query.eq('tenant_id', context.tenantId);\n      }\n\n      const { data: leads, error } = await query;\n      if (error) throw error;\n\n      if (!leads || leads.length === 0) {\n        toast.error('No leads found to export');\n        setExporting(false);\n        return;\n      }\n\n      // Flatten custom fields for export\n      const exportData = leads.map((lead: any) => {\n        const { custom_fields, ...standardFields } = lead;\n        const customFieldsObj = (custom_fields && typeof custom_fields === 'object') ? (custom_fields as Record<string, any>) : {};\n        return {\n          ...standardFields,\n          ...customFieldsObj,\n        };\n      });\n\n      // Build workbook and download\n      const ws = XLSX.utils.json_to_sheet(exportData);\n      const wb = XLSX.utils.book_new();\n      XLSX.utils.book_append_sheet(wb, ws, 'Leads');\n      XLSX.writeFile(wb, `leads_export_${new Date().toISOString().split('T')[0]}.xlsx`);\n\n      toast.success(`Exported ${leads.length} leads to Excel`);\n    } catch (err) {\n      console.error('Export Excel error:', err);\n      toast.error('Failed to export Excel');\n    } finally {\n      setExporting(false);\n    }\n  };\n\n  const downloadTemplate = () => {\n    const template = [\n      {\n        first_name: 'John',\n        last_name: 'Doe',\n        email: 'john.doe@example.com',\n        phone: '+1234567890',\n        company: 'Example Corp',\n        title: 'CEO',\n        status: 'new',\n        source: 'website',\n        estimated_value: '50000',\n        expected_close_date: '2025-12-31',\n        description: 'Potential high-value client',\n        notes: 'Met at conference',\n        custom_field_1: 'Custom Value 1',\n        custom_field_2: 'Custom Value 2'\n      }\n    ];\n\n    const csv = Papa.unparse(template);\n    const blobCsv = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n    const linkCsv = document.createElement('a');\n    const urlCsv = URL.createObjectURL(blobCsv);\n    linkCsv.setAttribute('href', urlCsv);\n    linkCsv.setAttribute('download', 'leads_import_template.csv');\n    linkCsv.style.visibility = 'hidden';\n    document.body.appendChild(linkCsv);\n    linkCsv.click();\n    document.body.removeChild(linkCsv);\n\n    // Excel template\n    const ws = XLSX.utils.json_to_sheet(template);\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, 'Template');\n    XLSX.writeFile(wb, 'leads_import_template.xlsx');\n\n    toast.success('Template downloaded');\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Import / Export Leads</h1>\n            <p className=\"text-muted-foreground mt-1\">\n              Bulk manage your lead data with CSV files\n            </p>\n          </div>\n          <Button variant=\"outline\" onClick={() => navigate('/dashboard/leads')}>\n            Back to Leads\n          </Button>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          {/* Import Section */}\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <Upload className=\"h-5 w-5\" />\n                <CardTitle>Import Leads</CardTitle>\n              </div>\n              <CardDescription>\n                Upload a CSV file to import multiple leads at once\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"csv-file\">Select CSV File</Label>\n                <Input\n                  id=\"csv-file\"\n                  type=\"file\"\n                  accept=\".csv\"\n                  onChange={handleFileSelect}\n                  disabled={importing}\n                />\n                {selectedFile && (\n                  <p className=\"text-sm text-muted-foreground\">\n                    Selected: {selectedFile.name}\n                  </p>\n                )}\n              </div>\n\n              {importing && (\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span>Importing...</span>\n                    <span>{Math.round(progress)}%</span>\n                  </div>\n                  <Progress value={progress} />\n                </div>\n              )}\n\n              {importResult && (\n                <Alert>\n                  <CheckCircle2 className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    <div className=\"space-y-1\">\n                      <p className=\"font-medium\">Import Complete</p>\n                      <div className=\"flex gap-4 text-sm\">\n                        <Badge variant=\"default\">Success: {importResult.success}</Badge>\n                        <Badge variant=\"destructive\">Failed: {importResult.failed}</Badge>\n                      </div>\n                      {importResult.errors.length > 0 && (\n                        <details className=\"mt-2\">\n                          <summary className=\"cursor-pointer text-sm\">\n                            View errors ({importResult.errors.length})\n                          </summary>\n                          <ul className=\"mt-2 space-y-1 text-xs\">\n                            {importResult.errors.slice(0, 10).map((error, i) => (\n                              <li key={i} className=\"text-destructive\">{error}</li>\n                            ))}\n                            {importResult.errors.length > 10 && (\n                              <li>...and {importResult.errors.length - 10} more</li>\n                            )}\n                          </ul>\n                        </details>\n                      )}\n                    </div>\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <div className=\"flex gap-2\">\n                <Button\n                  onClick={handleImport}\n                  disabled={!selectedFile || importing}\n                  className=\"flex-1\"\n                >\n                  {importing ? 'Importing...' : 'Import Leads'}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={downloadTemplate}\n                  disabled={importing}\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  Template\n                </Button>\n              </div>\n\n              <Alert>\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertDescription className=\"text-xs\">\n                  <strong>CSV Format:</strong> Your file should include columns like first_name, \n                  last_name, email, phone, company, title, status, source, etc. \n                  Any additional columns will be stored as custom fields.\n                </AlertDescription>\n              </Alert>\n            </CardContent>\n          </Card>\n\n          {/* Export Section */}\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <Download className=\"h-5 w-5\" />\n                <CardTitle>Export Leads</CardTitle>\n              </div>\n              <CardDescription>\n                Download all your leads as a CSV file\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-4\">\n                <p className=\"text-sm text-muted-foreground\">\n                  Export all leads with their standard and custom fields to a CSV file.\n                  The export will include all leads you have access to based on your role.\n                </p>\n\n                <Separator />\n\n                <div className=\"space-y-2\">\n                  <h4 className=\"font-medium text-sm\">What's included:</h4>\n                  <ul className=\"text-sm text-muted-foreground space-y-1\">\n                    <li> All standard lead fields</li>\n                    <li> Custom fields data</li>\n                    <li> Lead scores and status</li>\n                    <li> Contact information</li>\n                    <li> Activity timestamps</li>\n                  </ul>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <Button\n                    onClick={handleExport}\n                    disabled={exporting}\n                    className=\"w-full\"\n                    size=\"lg\"\n                  >\n                    {exporting ? (\n                      'Exporting...'\n                    ) : (\n                      <>\n                        <Download className=\"h-4 w-4 mr-2\" />\n                        Export CSV\n                      </>\n                    )}\n                  </Button>\n                  <Button\n                    onClick={handleExportExcel}\n                    disabled={exporting}\n                    className=\"w-full\"\n                    size=\"lg\"\n                  >\n                    {exporting ? (\n                      'Exporting...'\n                    ) : (\n                      <>\n                        <Download className=\"h-4 w-4 mr-2\" />\n                        Export Excel\n                      </>\n                    )}\n                  </Button>\n                </div>\n\n                <Alert>\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertDescription className=\"text-xs\">\n                    The exported CSV can be edited and re-imported. Make sure to keep \n                    the column headers unchanged for successful re-import.\n                  </AlertDescription>\n                </Alert>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Custom Fields Info */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Custom Fields Support</CardTitle>\n            <CardDescription>\n              Flexibly manage additional lead data beyond standard fields\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-4 md:grid-cols-3\">\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">During Import</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Any columns in your CSV that don't match standard fields will automatically \n                  be stored as custom fields for each lead.\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">During Export</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  All custom fields are included in the export alongside standard fields, \n                  making it easy to maintain your custom data structure.\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">Data Flexibility</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Store any additional information like industry codes, lead scores, \n                  qualification notes, or any custom metrics your business needs.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/LeadsPipeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLeads'. Either include it or remove the dependency array.","line":136,"column":6,"nodeType":"ArrayExpression","endLine":136,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchLeads, supabase]","fix":{"range":[4763,4773],"text":"[fetchLeads, supabase]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useMemo } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Search, ArrowLeft, Filter, RefreshCw, Calendar, Tag } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { KanbanBoard, ColumnType } from '@/components/kanban/KanbanBoard';\nimport { KanbanItem } from '@/components/kanban/KanbanCard';\nimport { KanbanFunnel } from '@/components/kanban/KanbanFunnel';\nimport { KanbanFilters, FilterOption } from '@/components/kanban/KanbanFilters';\nimport { PipelineAnalytics } from '@/components/analytics/PipelineAnalytics';\nimport { toast } from 'sonner';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { LayoutGrid, BarChart3 } from \"lucide-react\";\nimport { Lead, LeadStatus, stages, statusConfig } from './leads-data';\n\nexport default function LeadsPipeline() {\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const { supabase, context } = useCRM();\n  \n  const [leads, setLeads] = useState<Lead[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // URL State\n  const searchQuery = searchParams.get('q') || '';\n  const selectedStages = useMemo(() => {\n    const s = searchParams.get('status');\n    return s ? (s.split(',') as LeadStatus[]).filter(x => stages.includes(x)) : [];\n  }, [searchParams]);\n  const currentView = searchParams.get('view') || 'board'; // 'board' | 'analytics'\n\n  const handleSearchChange = (val: string) => {\n    setSearchParams(prev => {\n        const newParams = new URLSearchParams(prev);\n        if (val) newParams.set('q', val);\n        else newParams.delete('q');\n        return newParams;\n    }, { replace: true });\n  };\n\n  const handleViewChange = (view: string) => {\n    setSearchParams(prev => {\n        const newParams = new URLSearchParams(prev);\n        newParams.set('view', view);\n        return newParams;\n    });\n  };\n\n  const handleStageFilterChange = (values: string[]) => {\n      setSearchParams(prev => {\n        const newParams = new URLSearchParams(prev);\n        if (values.length > 0) newParams.set('status', values.join(','));\n        else newParams.delete('status');\n        return newParams;\n      });\n  };\n\n  const fetchLeads = async () => {\n    setLoading(true);\n    try {\n      const { data, error } = await supabase\n        .from('leads')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      \n      // Validate and cast data\n      const safeLeads = (data || []).map(d => ({\n        ...d,\n        status: stages.includes(d.status as LeadStatus) ? (d.status as LeadStatus) : 'new'\n      })) as Lead[];\n\n      setLeads(safeLeads);\n    } catch (error) {\n      console.error('Error fetching leads:', error);\n      toast.error('Failed to load leads');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchLeads();\n\n    // Real-time subscription\n    const channel = supabase\n      .channel('leads-pipeline-changes')\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'leads',\n        },\n        (payload) => {\n          console.log('Realtime update:', payload);\n          \n          if (payload.eventType === 'INSERT') {\n            const newLead = payload.new as Lead;\n            // Validate status\n            const safeLead: Lead = {\n               ...newLead,\n               status: stages.includes(newLead.status) ? newLead.status : 'new'\n            };\n            setLeads((prev) => [safeLead, ...prev]);\n            toast.info(`New lead: ${newLead.first_name} ${newLead.last_name}`);\n          } \n          else if (payload.eventType === 'UPDATE') {\n            const updatedLead = payload.new as Lead;\n            // Validate status\n            const safeLead: Lead = {\n               ...updatedLead,\n               status: stages.includes(updatedLead.status) ? updatedLead.status : 'new'\n            };\n            \n            setLeads((prev) => prev.map((l) => \n                l.id === safeLead.id ? safeLead : l\n            ));\n          } \n          else if (payload.eventType === 'DELETE') {\n             setLeads((prev) => prev.filter((l) => l.id !== payload.old.id));\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [supabase]);\n\n  const handleStatusChange = async (leadId: string, newStatus: LeadStatus) => {\n    // Optimistic update\n    setLeads(prev => prev.map(l => l.id === leadId ? { ...l, status: newStatus } : l));\n\n    try {\n      const { error } = await supabase\n        .from('leads')\n        .update({ status: newStatus })\n        .eq('id', leadId);\n\n      if (error) throw error;\n      toast.success(`Lead moved to ${statusConfig[newStatus].label}`);\n    } catch (error) {\n      console.error('Error updating status:', error);\n      toast.error('Failed to update status');\n      fetchLeads(); // Revert on error\n    }\n  };\n\n  const handleItemUpdate = async (id: string, updates: Partial<KanbanItem>) => {\n    // Map KanbanItem fields back to Lead fields\n    const leadUpdates: Partial<Lead> = {};\n    \n    if (updates.title) {\n        // Assume title is \"First Last\", try to split\n        const parts = updates.title.split(' ');\n        if (parts.length > 0) {\n            leadUpdates.first_name = parts[0];\n            leadUpdates.last_name = parts.slice(1).join(' ') || '';\n        }\n    }\n\n    if (updates.value !== undefined) {\n        leadUpdates.estimated_value = updates.value;\n    }\n\n    // Optimistic Update\n    setLeads(prev => prev.map(l => {\n        if (l.id === id) {\n            return { ...l, ...leadUpdates };\n        }\n        return l;\n    }));\n\n    try {\n        const { error } = await supabase\n            .from('leads')\n            .update(leadUpdates)\n            .eq('id', id);\n\n        if (error) throw error;\n        toast.success(\"Lead updated\");\n    } catch (error) {\n        console.error('Error updating lead:', error);\n        toast.error('Failed to update lead');\n        fetchLeads(); // Revert\n    }\n  };\n\n  const onDragEnd = (activeId: string, overId: string, newStatus: string) => {\n    // The KanbanBoard passes the column ID as newStatus.\n    // We check if it's a valid LeadStatus before updating.\n    if (stages.includes(newStatus as LeadStatus)) {\n      handleStatusChange(activeId, newStatus as LeadStatus);\n    }\n  };\n\n  // Filter logic\n  const filteredLeads = useMemo(() => {\n    return leads.filter(lead => {\n      const matchesSearch = \n        searchQuery === '' || \n        `${lead.first_name} ${lead.last_name}`.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        (lead.company || '').toLowerCase().includes(searchQuery.toLowerCase());\n      \n      const matchesStage = selectedStages.length === 0 || selectedStages.includes(lead.status);\n\n      return matchesSearch && matchesStage;\n    });\n  }, [leads, searchQuery, selectedStages]);\n\n  // Funnel Data Preparation\n  const funnelData = useMemo(() => {\n    const labelMap: Record<LeadStatus, string> = Object.fromEntries(\n      stages.map((s) => [s, statusConfig[s].label])\n    ) as Record<LeadStatus, string>;\n    \n    const colorMap: Record<LeadStatus, string> = Object.fromEntries(\n      stages.map((s) => [s, statusConfig[s].color])\n    ) as Record<LeadStatus, string>;\n    \n    const counts = stages.reduce((acc, stage) => {\n      acc[stage] = leads.filter(l => l.status === stage).length;\n      return acc;\n    }, {} as Record<LeadStatus, number>);\n\n    return { labelMap, colorMap, counts };\n  }, [leads]);\n\n  // Kanban Data Preparation\n  const columns: ColumnType[] = useMemo(() => {\n    const visibleStages = selectedStages.length > 0 ? selectedStages : stages;\n    return visibleStages.map(stage => ({\n      id: stage,\n      title: statusConfig[stage].label,\n      color: statusConfig[stage].color,\n    }));\n  }, [selectedStages]);\n\n  const items: KanbanItem[] = useMemo(() => {\n    return filteredLeads.map(lead => ({\n      id: lead.id,\n      title: `${lead.first_name} ${lead.last_name}`,\n      subtitle: lead.company || undefined,\n      status: lead.status,\n      priority: (lead.lead_score || 0) >= 70 ? 'high' : (lead.lead_score || 0) < 40 ? 'low' : 'medium',\n      value: lead.estimated_value || undefined,\n      updatedAt: lead.created_at,\n      assignee: lead.owner_id ? { name: \"User\" } : undefined,\n      tags: [lead.email].filter(Boolean) as string[],\n    }));\n  }, [filteredLeads]);\n\n  // Debug Logs\n  if (process.env.NODE_ENV === 'development') {\n    console.log('Current View:', currentView);\n    console.log('Filtered Leads:', filteredLeads.length);\n    console.log('Kanban Items:', items.length);\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"flex flex-col h-[calc(100vh-140px)] gap-6\">\n        \n        {/* Header */}\n        <div className=\"flex-none\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold tracking-tight\">Leads Pipeline</h1>\n              <p className=\"text-muted-foreground\">Manage and track your lead progression</p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n               <Button variant=\"outline\" size=\"sm\" onClick={fetchLeads} disabled={loading}>\n                <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n                Refresh\n              </Button>\n              <Button variant=\"secondary\" size=\"sm\" onClick={() => navigate(\"/dashboard/leads\")}>\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                List View\n              </Button>\n            </div>\n          </div>\n\n          {/* Funnel */}\n          <div className={currentView === 'analytics' ? 'hidden' : 'block'}>\n            <KanbanFunnel\n              stages={stages}\n              labels={funnelData.labelMap}\n              colors={funnelData.colorMap}\n              counts={funnelData.counts}\n              total={leads.length}\n              activeStages={selectedStages}\n              onStageClick={(s) => {\n                const exists = selectedStages.includes(s as LeadStatus);\n                const nextSel = exists \n                  ? selectedStages.filter((x) => x !== s) \n                  : [...selectedStages, s as LeadStatus];\n                handleStageFilterChange(nextSel);\n              }}\n              onClearStage={() => handleStageFilterChange([])}\n            />\n          </div>\n        </div>\n\n        {/* View Toggle */}\n        <div className=\"flex-none px-1\">\n          <Tabs value={currentView} onValueChange={handleViewChange} className=\"w-full\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <TabsList>\n                <TabsTrigger value=\"board\" className=\"flex items-center gap-2\">\n                  <LayoutGrid className=\"h-4 w-4\" />\n                  Kanban Board\n                </TabsTrigger>\n                <TabsTrigger value=\"analytics\" className=\"flex items-center gap-2\">\n                  <BarChart3 className=\"h-4 w-4\" />\n                  Analytics\n                </TabsTrigger>\n              </TabsList>\n            </div>\n            \n            {/* Analytics Content */}\n            <TabsContent value=\"analytics\" className=\"mt-0\">\n               <PipelineAnalytics leads={filteredLeads} />\n            </TabsContent>\n\n            {/* Board Content */}\n            <TabsContent value=\"board\" className=\"mt-0 flex flex-col gap-6 h-full\">\n               {/* Filters */}\n                <div className=\"flex-none\">\n                  <Card className=\"rounded-md border-muted\">\n                    <CardContent className=\"p-2\">\n                      <KanbanFilters\n                          searchQuery={searchQuery}\n                          onSearchChange={handleSearchChange}\n                          filters={{ status: selectedStages }}\n                          onFilterChange={(key, values) => {\n                            if (key === 'status') handleStageFilterChange(values);\n                          }}\n                          availableFilters={[\n                            {\n                              id: 'status',\n                              label: 'Status',\n                              options: stages.map(s => ({\n                                label: statusConfig[s].label,\n                                value: s,\n                              }))\n                            }\n                          ]}\n                      />\n                      <div className=\"flex items-center gap-2 text-xs text-muted-foreground px-2 pb-1\">\n                          <Filter className=\"h-3 w-3\" />\n                          <span>{filteredLeads.length} leads found</span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Kanban Board */}\n                <div className=\"flex-1 min-h-[500px] overflow-hidden bg-muted/20 rounded-lg border\">\n                  {loading && items.length === 0 ? (\n                    <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                      Loading pipeline...\n                    </div>\n                  ) : (\n                    <KanbanBoard \n                      columns={columns} \n                      items={items} \n                      onDragEnd={onDragEnd} \n                      onItemUpdate={handleItemUpdate}\n                      onItemClick={(id) => navigate(`/dashboard/leads/${id}`)}\n                    />\n                  )}\n                </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/MasterDataGeography.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1481,1484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1481,1484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1538,1541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1538,1541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1589,1592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1589,1592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1640,1643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1640,1643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1859,1862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1859,1862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2048,2051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2048,2051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2280,2283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2280,2283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2466,2469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2466,2469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2712,2715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2712,2715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2863,2866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2863,2866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3045,3048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3045,3048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3199,3202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3199,3202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3870,3873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3870,3873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3943,3946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3943,3946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4014,4017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4014,4017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4239,4242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4239,4242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4311,4314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4311,4314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4382,4385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4382,4385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4450,4453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4450,4453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4684,4687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4684,4687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":81,"column":36,"nodeType":"ArrayExpression","endLine":81,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [loadData]","fix":{"range":[4900,4902],"text":"[loadData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4932,4935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4932,4935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5075,5078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5075,5078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5138,5141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5138,5141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5313,5316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5313,5316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5510,5513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5510,5513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5573,5576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5573,5576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5761,5764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5761,5764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6008,6011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6008,6011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6190,6193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6190,6193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10585,10588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10585,10588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10925,10928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10925,10928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13537,13540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13537,13540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14389,14392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14389,14392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":368,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22488,22491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22488,22491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":369,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":369,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22600,22603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22600,22603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":382,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23714,23717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23714,23717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":388,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":388,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24141,24144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24141,24144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":438,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":438,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27402,27405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27402,27405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":440,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":440,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27632,27635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27632,27635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":453,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28459,28462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28459,28462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":455,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":455,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28689,28692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28689,28692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":591,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":591,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37842,37845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37842,37845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":592,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":592,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37945,37948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37945,37948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":603,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":603,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38830,38833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38830,38833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":609,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":609,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39255,39258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39255,39258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":659,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":659,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42451,42454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42451,42454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":661,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":661,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42659,42662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42659,42662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":674,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":674,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43446,43449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43446,43449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":676,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":676,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43654,43657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43654,43657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":831,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":831,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54006,54009],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54006,54009],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":832,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":832,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54156,54159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54156,54159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":833,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":833,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54287,54290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54287,54290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":850,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":850,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55967,55970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55967,55970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":856,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":856,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56394,56397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56394,56397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":905,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":905,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59675,59678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59675,59678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":906,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":906,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59813,59816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59813,59816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":908,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":908,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60054,60057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60054,60057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":921,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":921,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60959,60962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60959,60962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":922,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":922,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61097,61100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61097,61100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":924,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":924,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61338,61341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61338,61341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":61,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useRef } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport * as XLSX from 'xlsx';\nimport { parseFileRows, downloadErrorsCsv, exportCsv, exportExcel, exportJsonTemplate } from '@/lib/import-export';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Info } from 'lucide-react';\nimport ActionsToolbar from '@/components/ui/ActionsToolbar';\nimport { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip';\nimport { Plus, Upload, Download, FileText, AlertCircle } from 'lucide-react';\n\nexport default function MasterDataGeography() {\n  const { toast } = useToast();\n  const [tab, setTab] = useState('continents');\n  const [continents, setContinents] = useState<any[]>([]);\n  const [countries, setCountries] = useState<any[]>([]);\n  const [states, setStates] = useState<any[]>([]);\n  const [cities, setCities] = useState<any[]>([]);\n  const [search, setSearch] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [showEditState, setShowEditState] = useState(false);\n  const [editStateForm, setEditStateForm] = useState<any>({ id: '', name: '', country_id: '', iso: '', nat: '', is_active: true });\n  const [showEditCity, setShowEditCity] = useState(false);\n  const [editCityForm, setEditCityForm] = useState<any>({ id: '', name: '', country_id: '', state_id: '', nat: '', lat: '', lng: '', is_active: true });\n  const [showEditContinent, setShowEditContinent] = useState(false);\n  const [editContinentForm, setEditContinentForm] = useState<any>({ id: '', name: '', intl: '', nat: '', is_active: true });\n  const [showEditCountry, setShowEditCountry] = useState(false);\n  const [editCountryForm, setEditCountryForm] = useState<any>({ id: '', name: '', continent_id: '', iso2: '', iso3: '', nat: '', phone: '', is_active: true });\n  // Modal form states\n  const [showAddContinent, setShowAddContinent] = useState(false);\n  const [continentForm, setContinentForm] = useState<any>({ name: '', intl: '', nat: '' });\n  const [showAddCountry, setShowAddCountry] = useState(false);\n  const [countryForm, setCountryForm] = useState<any>({ name: '', continent_id: '', iso2: '', iso3: '', nat: '', phone: '' });\n  const [showAddState, setShowAddState] = useState(false);\n  const [stateForm, setStateForm] = useState<any>({ name: '', country_id: '', iso: '', nat: '' });\n  const [showAddCity, setShowAddCity] = useState(false);\n  const [cityForm, setCityForm] = useState<any>({ name: '', country_id: '', state_id: '', nat: '', lat: '', lng: '' });\n  // Bulk import\n  const contFileRef = useRef<HTMLInputElement>(null);\n  const countryFileRef = useRef<HTMLInputElement>(null);\n  const stateFileRef = useRef<HTMLInputElement>(null);\n  const cityFileRef = useRef<HTMLInputElement>(null);\n  const [bulkContFile, setBulkContFile] = useState<File | null>(null);\n  const [bulkCountryFile, setBulkCountryFile] = useState<File | null>(null);\n  const [bulkStateFile, setBulkStateFile] = useState<File | null>(null);\n  const [bulkCityFile, setBulkCityFile] = useState<File | null>(null);\n  const [countryImportErrors, setCountryImportErrors] = useState<any[]>([]);\n  const [stateImportErrors, setStateImportErrors] = useState<any[]>([]);\n  const [cityImportErrors, setCityImportErrors] = useState<any[]>([]);\n\n  // Import/Export helpers moved to shared module\n\n  const loadData = async () => {\n    setLoading(true);\n    try {\n      const [contRes, countryRes, stateRes, cityRes] = await Promise.all([\n        (supabase as any).from('continents').select('*').order('name'),\n        (supabase as any).from('countries').select('*').order('name'),\n        (supabase as any).from('states').select('*').order('name'),\n        (supabase as any).from('cities').select('*').order('name'),\n      ]);\n      setContinents(contRes.data || []);\n      setCountries(countryRes.data || []);\n      setStates(stateRes.data || []);\n      setCities(cityRes.data || []);\n    } catch (err: any) {\n      toast({ title: 'Load failed', description: err?.message || 'Error loading master data', variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => { loadData(); }, []);\n\n  const filtered = (rows: any[]) => rows.filter(r => String(r.name || '').toLowerCase().includes(search.toLowerCase()));\n\n  const addRow = async (table: string, values: any) => {\n    try {\n      const { error } = await (supabase as any).from(table).insert(values);\n      if (error) throw error;\n      toast({ title: 'Created', description: 'Row created successfully' });\n      loadData();\n    } catch (err: any) {\n      toast({ title: 'Create failed', description: err?.message || 'Error creating row', variant: 'destructive' });\n    }\n  };\n\n  const updateRow = async (table: string, id: string, values: any) => {\n    try {\n      const { error } = await (supabase as any).from(table).update(values).eq('id', id);\n      if (error) throw error;\n      toast({ title: 'Updated', description: 'Row updated successfully' });\n      loadData();\n    } catch (err: any) {\n      toast({ title: 'Update failed', description: err?.message || 'Error updating row', variant: 'destructive' });\n    }\n  };\n\n  const deleteRow = async (table: string, id: string) => {\n    try {\n      const { error } = await (supabase as any).from(table).delete().eq('id', id);\n      if (error) throw error;\n      toast({ title: 'Deleted', description: 'Row deleted successfully' });\n      loadData();\n    } catch (err: any) {\n      toast({ title: 'Delete failed', description: err?.message || 'Error deleting row', variant: 'destructive' });\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Master Data Management</h1>\n          <p className=\"text-muted-foreground\">Manage geographical demographic data</p>\n        </div>\n\n        <Tabs value={tab} onValueChange={setTab}>\n          <TabsList>\n            <TabsTrigger value=\"continents\">Continents</TabsTrigger>\n            <TabsTrigger value=\"countries\">Countries</TabsTrigger>\n            <TabsTrigger value=\"states\">States</TabsTrigger>\n            <TabsTrigger value=\"cities\">Cities</TabsTrigger>\n          </TabsList>\n\n          <div className=\"flex items-center gap-2 mt-4\">\n            <Input placeholder=\"Search by name\" value={search} onChange={(e) => setSearch(e.target.value)} />\n            <Button variant=\"outline\" onClick={loadData} disabled={loading}>Refresh</Button>\n          </div>\n\n          <TabsContent value=\"continents\" className=\"mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Continents</CardTitle>\n                <CardDescription>International and national codes</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ActionsToolbar>\n                  <Dialog open={showAddContinent} onOpenChange={setShowAddContinent}>\n                    <DialogTrigger asChild>\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <Button size=\"sm\"><Plus className=\"mr-1 h-4 w-4\" /> Add Continent</Button>\n                        </TooltipTrigger>\n                        <TooltipContent>Add a single continent</TooltipContent>\n                      </Tooltip>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Add Continent</DialogTitle>\n                      </DialogHeader>\n                      <div className=\"grid grid-cols-3 gap-2\">\n                        <Input placeholder=\"Name\" value={continentForm.name} onChange={e => setContinentForm({ ...continentForm, name: e.target.value })} />\n                        <Input placeholder=\"International Code\" value={continentForm.intl} onChange={e => setContinentForm({ ...continentForm, intl: e.target.value })} />\n                        <Input placeholder=\"National Code\" value={continentForm.nat} onChange={e => setContinentForm({ ...continentForm, nat: e.target.value })} />\n                      </div>\n                      <div className=\"flex justify-end gap-2 mt-3\">\n                        <Button variant=\"outline\" onClick={() => setShowAddContinent(false)}>Cancel</Button>\n                        <Button onClick={() => {\n                          const name = String(continentForm.name || '').trim();\n                          const intl = String(continentForm.intl || '').trim();\n                          const nat = String(continentForm.nat || '').trim();\n                          if (!name) return toast({ title: 'Name required', variant: 'destructive' });\n                          if (intl && intl.length !== 2) return toast({ title: 'International code must be 2 characters', variant: 'destructive' });\n                          addRow('continents', { name, code_international: intl ? intl.toUpperCase() : null, code_national: nat || null });\n                          setShowAddContinent(false);\n                          setContinentForm({ name: '', intl: '', nat: '' });\n                        }}>Save</Button>\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                  <input ref={contFileRef} type=\"file\" accept=\".csv,.xlsx\" className=\"hidden\" onChange={async (e) => {\n                    const file = e.target.files?.[0];\n                    if (!file) return;\n                    try {\n                      const rows = await parseFileRows(file);\n                      const payload = rows.map(r => ({ name: r[0]?.trim(), code_international: r[1]?.trim() || null, code_national: r[2]?.trim() || null })).filter(p => p.name);\n                      if (payload.length === 0) return toast({ title: 'No valid rows found', variant: 'destructive' });\n                      const { error } = await (supabase as any).from('continents').insert(payload);\n                      if (error) throw error;\n                      toast({ title: 'Imported', description: `Imported ${payload.length} continents` });\n                      if (contFileRef.current) contFileRef.current.value = '';\n                      loadData();\n                    } catch (err: any) {\n                      toast({ title: 'Import failed', description: err?.message || 'Error importing data', variant: 'destructive' });\n                    }\n                  }} />\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => contFileRef.current?.click()}>\n                        <Upload className=\"mr-1 h-4 w-4\" /> Import CSV/Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Import continents via CSV or Excel</TooltipContent>\n                  </Tooltip>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"ghost\" size=\"icon\" aria-label=\"Import help\"><Info className=\"h-4 w-4\" /></Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-64\" align=\"start\">\n                      <div className=\"text-sm\">\n                        <div className=\"font-semibold mb-1\">Expected columns</div>\n                        <div>name, international_code, national_code</div>\n                        <div className=\"font-semibold mt-2\">Sample CSV</div>\n                        <pre className=\"text-xs bg-muted p-2 rounded\">{`name,international_code,national_code\\nEurope,EU,N/A`}</pre>\n                        <div className=\"mt-2\">\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => exportCsv('continents_template.csv', ['name','international_code','national_code'], [])}>\n                            Download CSV Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportExcel('continents_template.xlsx', ['name','international_code','national_code'], [])}>\n                            Download XLSX Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportJsonTemplate('continents_template.json', ['name','international_code','national_code'])}>\n                            Download JSON Template\n                          </Button>\n                        </div>\n                      </div>\n                    </PopoverContent>\n                  </Popover>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                    const headers = ['id','name','code_international','code_national','is_active'];\n                    const rows = filtered(continents).map((r: any) => ({\n                      id: r.id, name: r.name, code_international: r.code_international || '', code_national: r.code_national || '', is_active: r.is_active ? 'true' : 'false'\n                    }));\n                      exportCsv('continents.csv', headers, rows);\n                    }}>\n                        <Download className=\"mr-1 h-4 w-4\" /> Export CSV\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to CSV</TooltipContent>\n                  </Tooltip>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                    const headers = ['id','name','code_international','code_national','is_active'];\n                    const rows = filtered(continents).map((r: any) => ({\n                      id: r.id, name: r.name, code_international: r.code_international || '', code_national: r.code_national || '', is_active: r.is_active ? 'true' : 'false'\n                    }));\n                      exportExcel('continents.xlsx', headers, rows);\n                    }}>\n                        <FileText className=\"mr-1 h-4 w-4\" /> Export Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to Excel</TooltipContent>\n                  </Tooltip>\n                </ActionsToolbar>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Name</TableHead>\n                      <TableHead>International Code</TableHead>\n                      <TableHead>National Code</TableHead>\n                      <TableHead>Active</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filtered(continents).map((r) => (\n                      <TableRow key={r.id}>\n                        <TableCell>{r.name}</TableCell>\n                        <TableCell>{r.code_international || '-'}</TableCell>\n                        <TableCell>{r.code_national || '-'}</TableCell>\n                        <TableCell>{r.is_active ? 'Yes' : 'No'}</TableCell>\n                        <TableCell className=\"space-x-2\">\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => {\n                            setEditContinentForm({ id: r.id, name: r.name || '', intl: r.code_international || '', nat: r.code_national || '', is_active: !!r.is_active });\n                            setShowEditContinent(true);\n                          }}>Edit</Button>\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => updateRow('continents', r.id, { is_active: !r.is_active })}>{r.is_active ? 'Disable' : 'Enable'}</Button>\n                          <Button size=\"sm\" variant=\"destructive\" onClick={() => deleteRow('continents', r.id)}>Delete</Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                {/* Inline add retained if you prefer quick adds; modal provided above */}\n                {/* Edit Continent Modal */}\n                <Dialog open={showEditContinent} onOpenChange={setShowEditContinent}>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>Edit Continent</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      <Input placeholder=\"Name\" value={editContinentForm.name} onChange={e => setEditContinentForm({ ...editContinentForm, name: e.target.value })} />\n                      <Input placeholder=\"International Code\" value={editContinentForm.intl} onChange={e => setEditContinentForm({ ...editContinentForm, intl: e.target.value })} />\n                      <Input placeholder=\"National Code\" value={editContinentForm.nat} onChange={e => setEditContinentForm({ ...editContinentForm, nat: e.target.value })} />\n                    </div>\n                    <div className=\"flex justify-end gap-2 mt-3\">\n                      <Button variant=\"outline\" onClick={() => setShowEditContinent(false)}>Cancel</Button>\n                      <Button onClick={() => {\n                        const name = String(editContinentForm.name || '').trim();\n                        const intl = String(editContinentForm.intl || '').trim();\n                        const nat = String(editContinentForm.nat || '').trim();\n                        if (!name) return toast({ title: 'Name required', variant: 'destructive' });\n                        if (intl && intl.length !== 2) return toast({ title: 'International code must be 2 characters', variant: 'destructive' });\n                        updateRow('continents', editContinentForm.id, { name, code_international: intl ? intl.toUpperCase() : null, code_national: nat || null });\n                        setShowEditContinent(false);\n                      }}>Save</Button>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n                \n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"countries\" className=\"mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Countries</CardTitle>\n                <CardDescription>ISO2, ISO3 and national codes</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ActionsToolbar>\n                  <Dialog open={showAddCountry} onOpenChange={setShowAddCountry}>\n                    <DialogTrigger asChild>\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <Button size=\"sm\"><Plus className=\"mr-1 h-4 w-4\" /> Add Country</Button>\n                        </TooltipTrigger>\n                        <TooltipContent>Add a single country</TooltipContent>\n                      </Tooltip>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Add Country</DialogTitle>\n                      </DialogHeader>\n                      <div className=\"grid grid-cols-3 gap-2\">\n                        <Input placeholder=\"Name\" value={countryForm.name} onChange={e => setCountryForm({ ...countryForm, name: e.target.value })} />\n                        <Select onValueChange={(v) => setCountryForm({ ...countryForm, continent_id: v })}>\n                          <SelectTrigger><SelectValue placeholder=\"Continent\" /></SelectTrigger>\n                          <SelectContent>\n                            {continents.map(c => <SelectItem key={c.id} value={String(c.id)}>{c.name}</SelectItem>)}\n                          </SelectContent>\n                        </Select>\n                        <Input placeholder=\"ISO2\" value={countryForm.iso2} onChange={e => setCountryForm({ ...countryForm, iso2: e.target.value })} />\n                        <Input placeholder=\"ISO3\" value={countryForm.iso3} onChange={e => setCountryForm({ ...countryForm, iso3: e.target.value })} />\n                        <Input placeholder=\"National Code\" value={countryForm.nat} onChange={e => setCountryForm({ ...countryForm, nat: e.target.value })} />\n                        <Input placeholder=\"Phone Code\" value={countryForm.phone} onChange={e => setCountryForm({ ...countryForm, phone: e.target.value })} />\n                      </div>\n                      <div className=\"flex justify-end gap-2 mt-3\">\n                        <Button variant=\"outline\" onClick={() => setShowAddCountry(false)}>Cancel</Button>\n                        <Button onClick={() => {\n                          const name = String(countryForm.name || '').trim();\n                          if (!name) return toast({ title: 'Name required', variant: 'destructive' });\n                          addRow('countries', { name, continent_id: countryForm.continent_id || null, code_iso2: countryForm.iso2 || null, code_iso3: countryForm.iso3 || null, code_national: countryForm.nat || null, phone_code: countryForm.phone || null });\n                          setShowAddCountry(false);\n                          setCountryForm({ name: '', continent_id: '', iso2: '', iso3: '', nat: '', phone: '' });\n                        }}>Save</Button>\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                  <input ref={countryFileRef} type=\"file\" accept=\".csv,.xlsx\" className=\"hidden\" onChange={async (e) => {\n                    const file = e.target.files?.[0];\n                    if (!file) return;\n                    try {\n                      const rows = await parseFileRows(file);\n                      const indexCont = new Map<string, string>(continents.map((c: any) => [String(c.code_international || '').toUpperCase(), String(c.id)]));\n                      const errors: any[] = [];\n                      const payload = rows.map((r, idx) => {\n                        const name = r[0]?.trim();\n                        const iso2 = r[1]?.trim();\n                        const iso3 = r[2]?.trim();\n                        const phone = r[3]?.trim();\n                        const cont = (r[4]?.trim() || '').toUpperCase();\n                        const continent_id = indexCont.get(cont) || null;\n                        if (!name) { errors.push({ row: idx + 1, reason: 'Missing name', name, iso2, iso3, phone, cont }); return null; }\n                        if (!iso2 || iso2.length !== 2) { errors.push({ row: idx + 1, reason: 'ISO2 must be 2 characters', name, iso2, iso3, phone, cont }); return null; }\n                        return { name, code_iso2: iso2.toUpperCase(), code_iso3: iso3 ? iso3.toUpperCase() : null, phone_code: phone || null, continent_id };\n                      }).filter(Boolean);\n                      if (payload.length === 0) return toast({ title: 'No valid rows found', variant: 'destructive' });\n                      const { error } = await (supabase as any).from('countries').upsert(payload, { onConflict: 'code_iso2' });\n                      if (error) throw error;\n                      toast({ title: 'Imported', description: `Imported ${payload.length} countries` });\n                      setCountryImportErrors(errors);\n                      if (countryFileRef.current) countryFileRef.current.value = '';\n                      loadData();\n                    } catch (err: any) {\n                      toast({ title: 'Import failed', description: err?.message || 'Error importing countries', variant: 'destructive' });\n                    }\n                  }} />\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => countryFileRef.current?.click()}>\n                        <Upload className=\"mr-1 h-4 w-4\" /> Import CSV/Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Import countries via CSV or Excel</TooltipContent>\n                  </Tooltip>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"ghost\" size=\"icon\" aria-label=\"Import help\"><Info className=\"h-4 w-4\" /></Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-72\" align=\"start\">\n                      <div className=\"text-sm\">\n                        <div className=\"font-semibold mb-1\">Expected columns</div>\n                        <div>name, iso2, iso3, phone_code, continent_code</div>\n                        <div className=\"font-semibold mt-2\">Sample CSV</div>\n                        <pre className=\"text-xs bg-muted p-2 rounded\">{`name,iso2,iso3,phone_code,continent_code\\nUnited States,US,USA,1,NA`}</pre>\n                        <div className=\"mt-2\">\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => exportCsv('countries_template.csv', ['name','iso2','iso3','phone_code','continent_code'], [])}>\n                            Download CSV Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportExcel('countries_template.xlsx', ['name','iso2','iso3','phone_code','continent_code'], [])}>\n                            Download XLSX Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportJsonTemplate('countries_template.json', ['name','iso2','iso3','phone_code','continent_code'])}>\n                            Download JSON Template\n                          </Button>\n                        </div>\n                      </div>\n                    </PopoverContent>\n                  </Popover>\n                  {countryImportErrors.length > 0 && (\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <Button variant=\"outline\" onClick={() => downloadErrorsCsv('country_import_errors.csv', ['row','reason','name','iso2','iso3','phone','cont'], countryImportErrors)}>\n                          <AlertCircle className=\"mr-1 h-4 w-4\" /> Errors ({countryImportErrors.length})\n                        </Button>\n                      </TooltipTrigger>\n                      <TooltipContent>Download rejected rows</TooltipContent>\n                    </Tooltip>\n                  )}\n                  {/* Export buttons for countries */}\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                    const contIndex = new Map<string, string>(continents.map((c: any) => [String(c.id), String(c.code_international || '')]));\n                    const headers = ['id','name','continent_code','iso2','iso3','phone_code','is_active'];\n                    const rows = filtered(countries).map((r: any) => ({\n                      id: r.id, name: r.name, continent_code: contIndex.get(String(r.continent_id)) || '', iso2: r.code_iso2 || '', iso3: r.code_iso3 || '', phone_code: r.phone_code || '', is_active: r.is_active ? 'true' : 'false'\n                    }));\n                      exportCsv('countries.csv', headers, rows);\n                    }}>\n                        <Download className=\"mr-1 h-4 w-4\" /> Export CSV\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to CSV</TooltipContent>\n                  </Tooltip>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                    const contIndex = new Map<string, string>(continents.map((c: any) => [String(c.id), String(c.code_international || '')]));\n                    const headers = ['id','name','continent_code','iso2','iso3','phone_code','is_active'];\n                    const rows = filtered(countries).map((r: any) => ({\n                      id: r.id, name: r.name, continent_code: contIndex.get(String(r.continent_id)) || '', iso2: r.code_iso2 || '', iso3: r.code_iso3 || '', phone_code: r.phone_code || '', is_active: r.is_active ? 'true' : 'false'\n                    }));\n                      exportExcel('countries.xlsx', headers, rows);\n                    }}>\n                        <FileText className=\"mr-1 h-4 w-4\" /> Export Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to Excel</TooltipContent>\n                  </Tooltip>\n                </ActionsToolbar>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Name</TableHead>\n                      <TableHead>Continent</TableHead>\n                      <TableHead>ISO2</TableHead>\n                      <TableHead>ISO3</TableHead>\n                      <TableHead>National Code</TableHead>\n                      <TableHead>Phone Code</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filtered(countries).map((r) => (\n                      <TableRow key={r.id}>\n                        <TableCell>{r.name}</TableCell>\n                        <TableCell>{continents.find(c => c.id === r.continent_id)?.name || '-'}</TableCell>\n                        <TableCell>{r.code_iso2 || '-'}</TableCell>\n                        <TableCell>{r.code_iso3 || '-'}</TableCell>\n                        <TableCell>{r.code_national || '-'}</TableCell>\n                        <TableCell>{r.phone_code || '-'}</TableCell>\n                        <TableCell className=\"space-x-2\">\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => {\n                            setEditCountryForm({ id: r.id, name: r.name || '', continent_id: r.continent_id || '', iso2: r.code_iso2 || '', iso3: r.code_iso3 || '', nat: r.code_national || '', phone: r.phone_code || '', is_active: !!r.is_active });\n                            setShowEditCountry(true);\n                          }}>Edit</Button>\n                          <Button size=\"sm\" variant=\"destructive\" onClick={() => deleteRow('countries', r.id)}>Delete</Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                {/* Inline add removed in favor of modal above for better UX */}\n                {/* Edit Country Modal */}\n                <Dialog open={showEditCountry} onOpenChange={setShowEditCountry}>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>Edit Country</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      <Input placeholder=\"Name\" value={editCountryForm.name} onChange={e => setEditCountryForm({ ...editCountryForm, name: e.target.value })} />\n                      <Select value={String(editCountryForm.continent_id || '')} onValueChange={(v) => setEditCountryForm({ ...editCountryForm, continent_id: v })}>\n                        <SelectTrigger><SelectValue placeholder=\"Continent\" /></SelectTrigger>\n                        <SelectContent>\n                          {continents.map(c => <SelectItem key={c.id} value={String(c.id)}>{c.name}</SelectItem>)}\n                        </SelectContent>\n                      </Select>\n                      <Input placeholder=\"ISO2\" value={editCountryForm.iso2} onChange={e => setEditCountryForm({ ...editCountryForm, iso2: e.target.value })} />\n                      <Input placeholder=\"ISO3\" value={editCountryForm.iso3} onChange={e => setEditCountryForm({ ...editCountryForm, iso3: e.target.value })} />\n                      <Input placeholder=\"National Code\" value={editCountryForm.nat} onChange={e => setEditCountryForm({ ...editCountryForm, nat: e.target.value })} />\n                      <Input placeholder=\"Phone Code\" value={editCountryForm.phone} onChange={e => setEditCountryForm({ ...editCountryForm, phone: e.target.value })} />\n                    </div>\n                    <div className=\"flex justify-end gap-2 mt-3\">\n                      <Button variant=\"outline\" onClick={() => setShowEditCountry(false)}>Cancel</Button>\n                      <Button onClick={() => {\n                        const name = String(editCountryForm.name || '').trim();\n                        const iso2 = String(editCountryForm.iso2 || '').trim().toUpperCase();\n                        const iso3 = String(editCountryForm.iso3 || '').trim().toUpperCase();\n                        if (!name) return toast({ title: 'Name required', variant: 'destructive' });\n                        if (iso2 && iso2.length !== 2) return toast({ title: 'ISO2 must be 2 letters', variant: 'destructive' });\n                        if (iso3 && iso3.length !== 3) return toast({ title: 'ISO3 must be 3 letters', variant: 'destructive' });\n                        updateRow('countries', editCountryForm.id, { name, continent_id: editCountryForm.continent_id || null, code_iso2: iso2 || null, code_iso3: iso3 || null, code_national: editCountryForm.nat || null, phone_code: editCountryForm.phone || null });\n                        setShowEditCountry(false);\n                      }}>Save</Button>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n                {/* Countries bottom import block removed; import is now in top Actions toolbar */}\n                </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"states\" className=\"mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>States / Provinces</CardTitle>\n                <CardDescription>ISO-3166-2 / national codes</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {/* Unified Actions toolbar for States */}\n                <ActionsToolbar>\n                  {/* Add State placed immediately after Actions label */}\n                  <Dialog open={showAddState} onOpenChange={setShowAddState}>\n                    <DialogTrigger asChild>\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <Button size=\"sm\"><Plus className=\"mr-1 h-4 w-4\" /> Add State</Button>\n                        </TooltipTrigger>\n                        <TooltipContent>Add a single state</TooltipContent>\n                      </Tooltip>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Add State / Province</DialogTitle>\n                      </DialogHeader>\n                      <div className=\"grid grid-cols-3 gap-2\">\n                        <Input placeholder=\"Name\" value={stateForm.name} onChange={e => setStateForm({ ...stateForm, name: e.target.value })} />\n                        <Select onValueChange={(v) => setStateForm({ ...stateForm, country_id: v })}>\n                          <SelectTrigger><SelectValue placeholder=\"Country\" /></SelectTrigger>\n                          <SelectContent>\n                            {countries.map(c => <SelectItem key={c.id} value={String(c.id)}>{c.name}</SelectItem>)}\n                          </SelectContent>\n                        </Select>\n                        <Input placeholder=\"ISO Code\" value={stateForm.iso} onChange={e => setStateForm({ ...stateForm, iso: e.target.value })} />\n                      </div>\n                      <div className=\"flex justify-end gap-2 mt-3\">\n                        <Button variant=\"outline\" onClick={() => setShowAddState(false)}>Cancel</Button>\n                        <Button onClick={() => {\n                          const name = String(stateForm.name || '').trim();\n                          const country_id = String(stateForm.country_id || '').trim();\n                          const iso = String(stateForm.iso || '').trim();\n                          if (!name || !country_id) return toast({ title: 'Name and country required', variant: 'destructive' });\n                          if (iso && iso.length > 5) return toast({ title: 'ISO code too long', variant: 'destructive' });\n                          addRow('states', { name, country_id, code_iso: iso || null });\n                          setShowAddState(false);\n                          setStateForm({ name: '', country_id: '', iso: '', nat: '' });\n                        }}>Save</Button>\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                  <input ref={stateFileRef} type=\"file\" accept=\".csv,.xlsx\" className=\"hidden\" onChange={async (e) => {\n                    const file = e.target.files?.[0];\n                    if (!file) return;\n                    try {\n                      const rows = await parseFileRows(file);\n                      const indexCountry = new Map<string, string>(countries.map((c: any) => [String(c.code_iso2 || '').toUpperCase(), String(c.id)]));\n                      const errors: any[] = [];\n                      const payload = rows.map((r, idx) => {\n                        const name = r[0]?.trim();\n                        const iso = r[1]?.trim();\n                        const ciso2 = (r[2]?.trim() || '').toUpperCase();\n                        const country_id = indexCountry.get(ciso2) || null;\n                        if (!name) { errors.push({ row: idx + 1, reason: 'Missing name', name, iso, ciso2 }); return null; }\n                        if (!country_id) { errors.push({ row: idx + 1, reason: 'Unknown country ISO2', name, iso, ciso2 }); return null; }\n                        return { name, country_id, code_iso: iso || null };\n                      }).filter(Boolean);\n                      if (payload.length === 0) return toast({ title: 'No valid rows found', variant: 'destructive' });\n                      const { error } = await (supabase as any).from('states').upsert(payload, { onConflict: 'country_id,code_iso' });\n                      if (error) throw error;\n                      toast({ title: 'Imported', description: `Imported ${payload.length} states` });\n                      setStateImportErrors(errors);\n                      if (stateFileRef.current) stateFileRef.current.value = '';\n                      loadData();\n                    } catch (err: any) {\n                      toast({ title: 'Import failed', description: err?.message || 'Error importing states', variant: 'destructive' });\n                    }\n                  }} />\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => stateFileRef.current?.click()}>\n                        <Upload className=\"mr-1 h-4 w-4\" /> Import CSV/Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Import states via CSV or Excel</TooltipContent>\n                  </Tooltip>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"ghost\" size=\"icon\" aria-label=\"Import help\"><Info className=\"h-4 w-4\" /></Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-72\" align=\"start\">\n                      <div className=\"text-sm\">\n                        <div className=\"font-semibold mb-1\">Expected columns</div>\n                        <div>name, state_code_iso, country_iso2</div>\n                        <div className=\"font-semibold mt-2\">Sample CSV</div>\n                        <pre className=\"text-xs bg-muted p-2 rounded\">{`name,state_code_iso,country_iso2\\nCalifornia,CA,US`}</pre>\n                        <div className=\"mt-2\">\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => exportCsv('states_template.csv', ['name','state_code_iso','country_iso2'], [])}>\n                            Download CSV Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportExcel('states_template.xlsx', ['name','state_code_iso','country_iso2'], [])}>\n                            Download XLSX Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportJsonTemplate('states_template.json', ['name','state_code_iso','country_iso2'])}>\n                            Download JSON Template\n                          </Button>\n                        </div>\n                      </div>\n                    </PopoverContent>\n                  </Popover>\n                  {stateImportErrors.length > 0 && (\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <Button variant=\"outline\" onClick={() => downloadErrorsCsv('state_import_errors.csv', ['row','reason','name','iso','ciso2'], stateImportErrors)}>\n                          <AlertCircle className=\"mr-1 h-4 w-4\" /> Errors ({stateImportErrors.length})\n                        </Button>\n                      </TooltipTrigger>\n                      <TooltipContent>Download rejected rows</TooltipContent>\n                    </Tooltip>\n                  )}\n                  {/* Export actions moved after Import and Errors for consistency */}\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                        const countryIndex = new Map<string, string>(countries.map((c: any) => [String(c.id), String(c.code_iso2 || '')]));\n                        const headers = ['id','name','country_iso2','code_iso','is_active'];\n                        const rows = filtered(states).map((r: any) => ({\n                          id: r.id, name: r.name, country_iso2: countryIndex.get(String(r.country_id)) || '', code_iso: r.code_iso || '', is_active: r.is_active ? 'true' : 'false'\n                        }));\n                        exportCsv('states.csv', headers, rows);\n                      }}>\n                        <Download className=\"mr-1 h-4 w-4\" /> Export CSV\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to CSV</TooltipContent>\n                  </Tooltip>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                        const countryIndex = new Map<string, string>(countries.map((c: any) => [String(c.id), String(c.code_iso2 || '')]));\n                        const headers = ['id','name','country_iso2','code_iso','is_active'];\n                        const rows = filtered(states).map((r: any) => ({\n                          id: r.id, name: r.name, country_iso2: countryIndex.get(String(r.country_id)) || '', code_iso: r.code_iso || '', is_active: r.is_active ? 'true' : 'false'\n                        }));\n                        exportExcel('states.xlsx', headers, rows);\n                      }}>\n                        <FileText className=\"mr-1 h-4 w-4\" /> Export Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to Excel</TooltipContent>\n                  </Tooltip>\n                </ActionsToolbar>\n                {/* Removed duplicate bottom quick-add grid in States */}\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Name</TableHead>\n                      <TableHead>Country</TableHead>\n                      <TableHead>ISO Code</TableHead>\n                      <TableHead>National Code</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filtered(states).map((r) => (\n                      <TableRow key={r.id}>\n                        <TableCell>{r.name}</TableCell>\n                        <TableCell>{countries.find(c => c.id === r.country_id)?.name || '-'}</TableCell>\n                        <TableCell>{r.code_iso || '-'}</TableCell>\n                        <TableCell>{r.code_national || '-'}</TableCell>\n                        <TableCell className=\"space-x-2\">\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => {\n                            setEditStateForm({ id: r.id, name: r.name || '', country_id: r.country_id || '', iso: r.code_iso || '', nat: r.code_national || '', is_active: !!r.is_active });\n                            setShowEditState(true);\n                          }}>Edit</Button>\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => updateRow('states', r.id, { is_active: !r.is_active })}>{r.is_active ? 'Disable' : 'Enable'}</Button>\n                          <Button size=\"sm\" variant=\"destructive\" onClick={() => deleteRow('states', r.id)}>Delete</Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                <div className=\"mt-4 grid grid-cols-5 gap-2\">\n                  <Input id=\"state_name\" placeholder=\"Name\" />\n                  <Select onValueChange={(v) => (document.getElementById('state_country') as HTMLInputElement).value = v}>\n                    <SelectTrigger><SelectValue placeholder=\"Country\" /></SelectTrigger>\n                    <SelectContent>\n                      {countries.map(c => <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>)}\n                    </SelectContent>\n                  </Select>\n                  <Input id=\"state_country\" type=\"hidden\" />\n                  <Input id=\"state_iso\" placeholder=\"ISO Code\" />\n                  <Input id=\"state_nat\" placeholder=\"National Code\" />\n                  <Button onClick={() => {\n                    const name = (document.getElementById('state_name') as HTMLInputElement).value.trim();\n                    const country_id = (document.getElementById('state_country') as HTMLInputElement).value.trim();\n                    const code_iso = (document.getElementById('state_iso') as HTMLInputElement).value.trim();\n                    const code_national = (document.getElementById('state_nat') as HTMLInputElement).value.trim();\n                    if (!name || !country_id) return toast({ title: 'Name and country required', variant: 'destructive' });\n                    addRow('states', { name, country_id, code_iso: code_iso || null, code_national: code_national || null });\n                  }}>Add</Button>\n                </div>\n                {/* Edit State Modal */}\n                <Dialog open={showEditState} onOpenChange={setShowEditState}>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>Edit State / Province</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      <Input placeholder=\"Name\" value={editStateForm.name} onChange={e => setEditStateForm({ ...editStateForm, name: e.target.value })} />\n                      <Select value={String(editStateForm.country_id || '')} onValueChange={(v) => setEditStateForm({ ...editStateForm, country_id: v })}>\n                        <SelectTrigger><SelectValue placeholder=\"Country\" /></SelectTrigger>\n                        <SelectContent>\n                          {countries.map(c => <SelectItem key={c.id} value={String(c.id)}>{c.name}</SelectItem>)}\n                        </SelectContent>\n                      </Select>\n                      <Input placeholder=\"ISO Code\" value={editStateForm.iso} onChange={e => setEditStateForm({ ...editStateForm, iso: e.target.value })} />\n                    </div>\n                    <div className=\"flex justify-end gap-2 mt-3\">\n                      <Button variant=\"outline\" onClick={() => setShowEditState(false)}>Cancel</Button>\n                      <Button onClick={() => {\n                        const name = String(editStateForm.name || '').trim();\n                        const country_id = String(editStateForm.country_id || '').trim();\n                        const iso = String(editStateForm.iso || '').trim();\n                        if (!name || !country_id) return toast({ title: 'Name and country required', variant: 'destructive' });\n                        if (iso && iso.length > 5) return toast({ title: 'ISO code too long', variant: 'destructive' });\n                        updateRow('states', editStateForm.id, { name, country_id, code_iso: iso || null });\n                        setShowEditState(false);\n                      }}>Save</Button>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"cities\" className=\"mt-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Cities</CardTitle>\n                <CardDescription>National codes and coordinates</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ActionsToolbar>\n                  <Dialog open={showAddCity} onOpenChange={setShowAddCity}>\n                    <DialogTrigger asChild>\n                      <Tooltip>\n                        <TooltipTrigger asChild>\n                          <Button size=\"sm\"><Plus className=\"mr-1 h-4 w-4\" /> Add City</Button>\n                        </TooltipTrigger>\n                        <TooltipContent>Add a single city</TooltipContent>\n                      </Tooltip>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Add City</DialogTitle>\n                      </DialogHeader>\n                      <div className=\"grid grid-cols-3 gap-2\">\n                        <Input placeholder=\"Name\" value={cityForm.name} onChange={e => setCityForm({ ...cityForm, name: e.target.value })} />\n                        <Select onValueChange={(v) => setCityForm({ ...cityForm, country_id: v })}>\n                          <SelectTrigger><SelectValue placeholder=\"Country\" /></SelectTrigger>\n                          <SelectContent>\n                            {countries.map(c => <SelectItem key={c.id} value={String(c.id)}>{c.name}</SelectItem>)}\n                          </SelectContent>\n                        </Select>\n                        <Select onValueChange={(v) => setCityForm({ ...cityForm, state_id: v })}>\n                          <SelectTrigger><SelectValue placeholder=\"State\" /></SelectTrigger>\n                          <SelectContent>\n                            {states.map(s => <SelectItem key={s.id} value={String(s.id)}>{s.name}</SelectItem>)}\n                          </SelectContent>\n                        </Select>\n                        <Input placeholder=\"National Code\" value={cityForm.nat} onChange={e => setCityForm({ ...cityForm, nat: e.target.value })} />\n                        <Input placeholder=\"Latitude\" value={cityForm.lat} onChange={e => setCityForm({ ...cityForm, lat: e.target.value })} />\n                        <Input placeholder=\"Longitude\" value={cityForm.lng} onChange={e => setCityForm({ ...cityForm, lng: e.target.value })} />\n                      </div>\n                      <div className=\"flex justify-end gap-2 mt-3\">\n                        <Button variant=\"outline\" onClick={() => setShowAddCity(false)}>Cancel</Button>\n                        <Button onClick={() => {\n                          const name = String(cityForm.name || '').trim();\n                          const country_id = String(cityForm.country_id || '').trim();\n                          const state_id = String(cityForm.state_id || '').trim();\n                          if (!name || !country_id) return toast({ title: 'Name and country required', variant: 'destructive' });\n                          const latitude = parseFloat(String(cityForm.lat || '').trim());\n                          const longitude = parseFloat(String(cityForm.lng || '').trim());\n                          addRow('cities', { name, country_id, state_id: state_id || null, code_national: cityForm.nat || null, latitude: isNaN(latitude) ? null : latitude, longitude: isNaN(longitude) ? null : longitude });\n                          setShowAddCity(false);\n                          setCityForm({ name: '', country_id: '', state_id: '', nat: '', lat: '', lng: '' });\n                        }}>Save</Button>\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                  <input ref={cityFileRef} type=\"file\" accept=\".csv,.xlsx\" className=\"hidden\" onChange={async (e) => {\n                    const file = e.target.files?.[0];\n                    if (!file) return;\n                    try {\n                      const rows = await parseFileRows(file);\n                      const indexCountry = new Map<string, string>(countries.map((c: any) => [String(c.code_iso2 || '').toUpperCase(), String(c.id)]));\n                      const indexStateKey = new Map<string, string>(states.map((s: any) => [String(s.code_iso || '').toUpperCase() + '|' + String(s.country_id), String(s.id)]));\n                      const errors: any[] = [];\n                      const payload = rows.map((r, idx) => {\n                        const name = r[0]?.trim();\n                        const ciso2 = (r[1]?.trim() || '').toUpperCase();\n                        const siso = (r[2]?.trim() || '').toUpperCase();\n                        const nat = r[3]?.trim();\n                        const lat = parseFloat(r[4] || '');\n                        const lng = parseFloat(r[5] || '');\n                        const country_id = indexCountry.get(ciso2) || null;\n                        const state_id = country_id ? (indexStateKey.get(siso + '|' + String(country_id)) || null) : null;\n                        if (!name) { errors.push({ row: idx + 1, reason: 'Missing name', name, ciso2, siso, nat, lat, lng }); return null; }\n                        if (!country_id) { errors.push({ row: idx + 1, reason: 'Unknown country ISO2', name, ciso2, siso, nat, lat, lng }); return null; }\n                        if (Number.isFinite(lat) && (lat < -90 || lat > 90)) { errors.push({ row: idx + 1, reason: 'Latitude out of range', name, ciso2, siso, nat, lat, lng }); }\n                        if (Number.isFinite(lng) && (lng < -180 || lng > 180)) { errors.push({ row: idx + 1, reason: 'Longitude out of range', name, ciso2, siso, nat, lat, lng }); }\n                        return { name, country_id, state_id, code_national: nat || null, latitude: isNaN(lat) ? null : lat, longitude: isNaN(lng) ? null : lng };\n                      }).filter(Boolean);\n                      if (payload.length === 0) return toast({ title: 'No valid rows found', variant: 'destructive' });\n                      const { error } = await (supabase as any).from('cities').upsert(payload, { onConflict: 'country_id,state_id,name' });\n                      if (error) throw error;\n                      toast({ title: 'Imported', description: `Imported ${payload.length} cities` });\n                      setCityImportErrors(errors);\n                      if (cityFileRef.current) cityFileRef.current.value = '';\n                      loadData();\n                    } catch (err: any) {\n                      toast({ title: 'Import failed', description: err?.message || 'Error importing cities', variant: 'destructive' });\n                    }\n                  }} />\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => cityFileRef.current?.click()}>\n                        <Upload className=\"mr-1 h-4 w-4\" /> Import CSV/Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Import cities via CSV or Excel</TooltipContent>\n                  </Tooltip>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"ghost\" size=\"icon\" aria-label=\"Import help\"><Info className=\"h-4 w-4\" /></Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-80\" align=\"start\">\n                      <div className=\"text-sm\">\n                        <div className=\"font-semibold mb-1\">Expected columns</div>\n                        <div>name, country_iso2, state_code_iso, national_code, lat, lng</div>\n                        <div className=\"font-semibold mt-2\">Sample CSV</div>\n                        <pre className=\"text-xs bg-muted p-2 rounded\">{`name,country_iso2,state_code_iso,national_code,lat,lng\\nSan Francisco,US,CA,94103,37.7749,-122.4194`}</pre>\n                        <div className=\"mt-2\">\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => exportCsv('cities_template.csv', ['name','country_iso2','state_code_iso','national_code','lat','lng'], [])}>\n                            Download CSV Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportExcel('cities_template.xlsx', ['name','country_iso2','state_code_iso','national_code','lat','lng'], [])}>\n                            Download XLSX Template\n                          </Button>\n                          <Button variant=\"outline\" size=\"sm\" className=\"ml-2\" onClick={() => exportJsonTemplate('cities_template.json', ['name','country_iso2','state_code_iso','national_code','lat','lng'])}>\n                            Download JSON Template\n                          </Button>\n                        </div>\n                      </div>\n                    </PopoverContent>\n                  </Popover>\n                  {cityImportErrors.length > 0 && (\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <Button variant=\"outline\" onClick={() => downloadErrorsCsv('city_import_errors.csv', ['row','reason','name','ciso2','siso','nat','lat','lng'], cityImportErrors)}>\n                          <AlertCircle className=\"mr-1 h-4 w-4\" /> Errors ({cityImportErrors.length})\n                        </Button>\n                      </TooltipTrigger>\n                      <TooltipContent>Download rejected rows</TooltipContent>\n                    </Tooltip>\n                  )}\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                        const countryIndex = new Map<string, string>(countries.map((c: any) => [String(c.id), String(c.code_iso2 || '')]));\n                        const stateIndexKey = new Map<string, string>(states.map((s: any) => [String(s.id), String(s.code_iso || '')]));\n                        const headers = ['id','name','country_iso2','state_code_iso','national_code','lat','lng','is_active'];\n                        const rows = filtered(cities).map((r: any) => ({\n                          id: r.id, name: r.name, country_iso2: countryIndex.get(String(r.country_id)) || '', state_code_iso: stateIndexKey.get(String(r.state_id)) || '', national_code: r.code_national || '', lat: r.latitude ?? '', lng: r.longitude ?? '', is_active: r.is_active ? 'true' : 'false'\n                        }));\n                        exportCsv('cities.csv', headers, rows);\n                      }}>\n                        <Download className=\"mr-1 h-4 w-4\" /> Export CSV\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to CSV</TooltipContent>\n                  </Tooltip>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" onClick={() => {\n                        const countryIndex = new Map<string, string>(countries.map((c: any) => [String(c.id), String(c.code_iso2 || '')]));\n                        const stateIndexKey = new Map<string, string>(states.map((s: any) => [String(s.id), String(s.code_iso || '')]));\n                        const headers = ['id','name','country_iso2','state_code_iso','national_code','lat','lng','is_active'];\n                        const rows = filtered(cities).map((r: any) => ({\n                          id: r.id, name: r.name, country_iso2: countryIndex.get(String(r.country_id)) || '', state_code_iso: stateIndexKey.get(String(r.state_id)) || '', national_code: r.code_national || '', lat: r.latitude ?? '', lng: r.longitude ?? '', is_active: r.is_active ? 'true' : 'false'\n                        }));\n                        exportExcel('cities.xlsx', headers, rows);\n                      }}>\n                        <FileText className=\"mr-1 h-4 w-4\" /> Export Excel\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Export current list to Excel</TooltipContent>\n                  </Tooltip>\n                </ActionsToolbar>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Name</TableHead>\n                      <TableHead>Country</TableHead>\n                      <TableHead>State</TableHead>\n                      <TableHead>National Code</TableHead>\n                      <TableHead>Lat</TableHead>\n                      <TableHead>Lng</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filtered(cities).map((r) => (\n                      <TableRow key={r.id}>\n                        <TableCell>{r.name}</TableCell>\n                        <TableCell>{countries.find(c => c.id === r.country_id)?.name || '-'}</TableCell>\n                        <TableCell>{states.find(s => s.id === r.state_id)?.name || '-'}</TableCell>\n                        <TableCell>{r.code_national || '-'}</TableCell>\n                        <TableCell>{r.latitude ?? '-'}</TableCell>\n                        <TableCell>{r.longitude ?? '-'}</TableCell>\n                        <TableCell className=\"space-x-2\">\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => {\n                            setEditCityForm({ id: r.id, name: r.name || '', country_id: r.country_id || '', state_id: r.state_id || '', nat: r.code_national || '', lat: r.latitude ?? '', lng: r.longitude ?? '', is_active: !!r.is_active });\n                            setShowEditCity(true);\n                          }}>Edit</Button>\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => updateRow('cities', r.id, { is_active: !r.is_active })}>{r.is_active ? 'Disable' : 'Enable'}</Button>\n                          <Button size=\"sm\" variant=\"destructive\" onClick={() => deleteRow('cities', r.id)}>Delete</Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                {/* Toolbar-only pattern: no inline quick-add forms for Cities; use Add modal above */}\n                {/* Edit City Modal */}\n                <Dialog open={showEditCity} onOpenChange={setShowEditCity}>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>Edit City</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      <Input placeholder=\"Name\" value={editCityForm.name} onChange={e => setEditCityForm({ ...editCityForm, name: e.target.value })} />\n                      <Select value={String(editCityForm.country_id || '')} onValueChange={(v) => setEditCityForm({ ...editCityForm, country_id: v })}>\n                        <SelectTrigger><SelectValue placeholder=\"Country\" /></SelectTrigger>\n                        <SelectContent>\n                          {countries.map(c => <SelectItem key={c.id} value={String(c.id)}>{c.name}</SelectItem>)}\n                        </SelectContent>\n                      </Select>\n                      <Select value={String(editCityForm.state_id || '')} onValueChange={(v) => setEditCityForm({ ...editCityForm, state_id: v })}>\n                        <SelectTrigger><SelectValue placeholder=\"State\" /></SelectTrigger>\n                        <SelectContent>\n                          {states.map(s => <SelectItem key={s.id} value={String(s.id)}>{s.name}</SelectItem>)}\n                        </SelectContent>\n                      </Select>\n                      <Input placeholder=\"National Code\" value={editCityForm.nat} onChange={e => setEditCityForm({ ...editCityForm, nat: e.target.value })} />\n                      <Input placeholder=\"Latitude\" value={editCityForm.lat} onChange={e => setEditCityForm({ ...editCityForm, lat: e.target.value })} />\n                      <Input placeholder=\"Longitude\" value={editCityForm.lng} onChange={e => setEditCityForm({ ...editCityForm, lng: e.target.value })} />\n                    </div>\n                    <div className=\"flex justify-end gap-2 mt-3\">\n                      <Button variant=\"outline\" onClick={() => setShowEditCity(false)}>Cancel</Button>\n                      <Button onClick={() => {\n                        const name = String(editCityForm.name || '').trim();\n                        const country_id = String(editCityForm.country_id || '').trim();\n                        const state_id = String(editCityForm.state_id || '').trim();\n                        if (!name || !country_id) return toast({ title: 'Name and country required', variant: 'destructive' });\n                        const latitude = parseFloat(String(editCityForm.lat || '').trim());\n                        const longitude = parseFloat(String(editCityForm.lng || '').trim());\n                        updateRow('cities', editCityForm.id, { name, country_id, state_id: state_id || null, code_national: editCityForm.nat || null, latitude: isNaN(latitude) ? null : latitude, longitude: isNaN(longitude) ? null : longitude });\n                        setShowEditCity(false);\n                      }}>Save</Button>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </CardContent>\n              {/* Cities bottom add/import section removed; unified in top Actions toolbar */}\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/MasterDataHTS.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/More.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/MultiModalQuote.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Opportunities.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOpportunities'. Either include it or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOpportunities]","fix":{"range":[2093,2095],"text":"[fetchOpportunities]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport TitleStrip from '@/components/ui/title-strip';\nimport { Table, TableBody, TableCell, TableHeader, TableRow, SortableHead } from '@/components/ui/table';\nimport { useSort } from '@/hooks/useSort';\nimport { Badge } from '@/components/ui/badge';\nimport { Plus, TrendingUp } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { matchText, TextOp } from '@/lib/utils';\nimport { Opportunity, OpportunityStage, stageColors, stageLabels } from './opportunities-data';\n\nexport default function Opportunities() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const [opportunities, setOpportunities] = useState<Opportunity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [viewMode, setViewMode] = useState<ViewMode>('list');\n\n  // Advanced per-column filters\n  const [nameQuery, setNameQuery] = useState('');\n  const [nameOp, setNameOp] = useState<TextOp>('contains');\n  const [accountQuery, setAccountQuery] = useState('');\n  const [accountOp, setAccountOp] = useState<TextOp>('contains');\n  const [stageAdv, setStageAdv] = useState<string>('');\n  const [amountMin, setAmountMin] = useState<string>('');\n  const [amountMax, setAmountMax] = useState<string>('');\n  const [closeStart, setCloseStart] = useState<string>('');\n  const [closeEnd, setCloseEnd] = useState<string>('');\n  const [probMin, setProbMin] = useState<string>('');\n  const [probMax, setProbMax] = useState<string>('');\n\n  useEffect(() => {\n    fetchOpportunities();\n  }, []);\n\n  const fetchOpportunities = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('opportunities')\n        .select(`\n          *,\n          accounts:account_id(name),\n          contacts:contact_id(first_name, last_name)\n        `)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setOpportunities(data as unknown as Opportunity[]);\n    } catch (error: unknown) {\n      const description = error instanceof Error ? error.message : String(error);\n      toast.error('Failed to load opportunities', {\n        description,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatCurrency = (amount: number | null) => {\n    if (!amount) return '-';\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n    }).format(amount);\n  };\n\n  const formatDate = (date: string | null) => {\n    if (!date) return '-';\n    return new Date(date).toLocaleDateString();\n  };\n\n  const totalValue = opportunities.reduce((sum, opp) => sum + (Number(opp.amount) || 0), 0);\n  const openOpportunities = opportunities.filter(opp => !['closed_won', 'closed_lost'].includes(opp.stage));\n  const wonOpportunities = opportunities.filter(opp => opp.stage === 'closed_won');\n\n  // Derived list with advanced filters applied\n  const filteredOpportunitiesAdvanced = opportunities.filter((opp) => {\n    if (nameQuery && !matchText(opp.name || '', nameQuery, nameOp)) return false;\n    if (accountQuery && !matchText(opp.accounts?.name || '', accountQuery, accountOp)) return false;\n    if (stageAdv && stageAdv !== 'any' && opp.stage !== stageAdv) return false;\n\n    const amountNum = Number(opp.amount) || 0;\n    if (amountMin && amountNum < Number(amountMin)) return false;\n    if (amountMax && amountNum > Number(amountMax)) return false;\n\n    const closeDate = opp.close_date ? new Date(opp.close_date) : null;\n    if (closeStart && closeDate && closeDate < new Date(closeStart)) return false;\n    if (closeEnd && closeDate && closeDate > new Date(closeEnd)) return false;\n    if ((closeStart || closeEnd) && !closeDate) return false;\n\n    const probNum = Number(opp.probability) || 0;\n    if (probMin && probNum < Number(probMin)) return false;\n    if (probMax && probNum > Number(probMax)) return false;\n\n    return true;\n  });\n\n  const { sorted: sortedOpportunities, sortField, sortDirection, onSort } = useSort<Opportunity>(filteredOpportunitiesAdvanced, {\n    accessors: {\n      name: (o: Opportunity) => o.name,\n      account: (o: Opportunity) => o.accounts?.name ?? '',\n      stage: (o: Opportunity) => o.stage,\n      amount: (o: Opportunity) => o.amount ?? 0,\n      close_date: (o: Opportunity) => o.close_date ?? '',\n      probability: (o: Opportunity) => o.probability ?? 0,\n    },\n  });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Opportunities</h1>\n            <p className=\"text-muted-foreground\">Manage your sales pipeline</p>\n          </div>\n          <div className=\"flex gap-2 items-center\">\n            <ViewToggle\n              value={viewMode}\n              modes={['pipeline','card','grid','list']}\n              onChange={(v) => v === 'pipeline' ? navigate('/dashboard/opportunities/pipeline') : setViewMode(v)}\n            />\n            {/* Removed standalone Pipeline View button; use ViewToggle with Pipeline first */}\n            <Button onClick={() => navigate('/dashboard/opportunities/new')}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New Opportunity\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Pipeline Value</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{formatCurrency(totalValue)}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {opportunities.length} total opportunities\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Open Opportunities</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{openOpportunities.length}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {formatCurrency(openOpportunities.reduce((sum, opp) => sum + (Number(opp.amount) || 0), 0))} value\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Closed Won</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{wonOpportunities.length}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {formatCurrency(wonOpportunities.reduce((sum, opp) => sum + (Number(opp.amount) || 0), 0))} value\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {loading ? (\n          <Card>\n            <CardContent>\n              <div className=\"text-center py-8 text-muted-foreground\">Loading...</div>\n            </CardContent>\n          </Card>\n        ) : opportunities.length === 0 ? (\n          <Card>\n            <CardContent>\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No opportunities yet. Create your first opportunity to get started.\n              </div>\n            </CardContent>\n          </Card>\n        ) : viewMode === 'list' ? (\n          <Card>\n            <CardHeader>\n              <TitleStrip label=\"All Opportunities\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3 mb-4\">\n                <p className=\"text-sm text-muted-foreground\">Combine any filters below; results intersect across all criteria.</p>\n                <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-3\">\n                  <div className=\"space-y-2\">\n                    <Label>Name</Label>\n                    <div className=\"flex gap-2\">\n                      <Select value={nameOp} onValueChange={(v) => setNameOp(v as TextOp)}>\n                        <SelectTrigger className=\"w-[160px]\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"contains\">Contains</SelectItem>\n                          <SelectItem value=\"starts_with\">Starts with</SelectItem>\n                          <SelectItem value=\"equals\">Equals</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Input placeholder=\"Search name\" value={nameQuery} onChange={(e) => setNameQuery(e.target.value)} />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label>Account</Label>\n                    <div className=\"flex gap-2\">\n                      <Select value={accountOp} onValueChange={(v) => setAccountOp(v as TextOp)}>\n                        <SelectTrigger className=\"w-[160px]\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"contains\">Contains</SelectItem>\n                          <SelectItem value=\"starts_with\">Starts with</SelectItem>\n                          <SelectItem value=\"equals\">Equals</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <Input placeholder=\"Search account\" value={accountQuery} onChange={(e) => setAccountQuery(e.target.value)} />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label>Stage</Label>\n                    <Select value={stageAdv} onValueChange={setStageAdv}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Any stage\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"any\">Any</SelectItem>\n                        <SelectItem value=\"prospecting\">Prospecting</SelectItem>\n                        <SelectItem value=\"qualification\">Qualification</SelectItem>\n                        <SelectItem value=\"needs_analysis\">Needs Analysis</SelectItem>\n                        <SelectItem value=\"value_proposition\">Value Proposition</SelectItem>\n                        <SelectItem value=\"proposal\">Proposal</SelectItem>\n                        <SelectItem value=\"negotiation\">Negotiation</SelectItem>\n                        <SelectItem value=\"closed_won\">Closed Won</SelectItem>\n                        <SelectItem value=\"closed_lost\">Closed Lost</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label>Amount range</Label>\n                    <div className=\"flex gap-2\">\n                      <Input type=\"number\" placeholder=\"Min\" value={amountMin} onChange={(e) => setAmountMin(e.target.value)} />\n                      <Input type=\"number\" placeholder=\"Max\" value={amountMax} onChange={(e) => setAmountMax(e.target.value)} />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label>Close date range</Label>\n                    <div className=\"flex gap-2\">\n                      <Input type=\"date\" value={closeStart} onChange={(e) => setCloseStart(e.target.value)} />\n                      <Input type=\"date\" value={closeEnd} onChange={(e) => setCloseEnd(e.target.value)} />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label>Probability range (%)</Label>\n                    <div className=\"flex gap-2\">\n                      <Input type=\"number\" placeholder=\"Min\" value={probMin} onChange={(e) => setProbMin(e.target.value)} />\n                      <Input type=\"number\" placeholder=\"Max\" value={probMax} onChange={(e) => setProbMax(e.target.value)} />\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <Table>\n                <TableHeader className=\"bg-[hsl(var(--title-strip))] [&_th]:text-white [&_th]:font-semibold [&_th]:text-xs [&_th]:px-3 [&_th]:py-2 [&_th]:border-l [&_th]:border-white/60\">\n                  <TableRow className=\"border-b-2\" style={{ borderBottomColor: 'hsl(var(--title-strip))' }}>\n                    <SortableHead field=\"name\" activeField={sortField} direction={sortDirection} onSort={onSort}>Name</SortableHead>\n                    <SortableHead field=\"account\" activeField={sortField} direction={sortDirection} onSort={onSort}>Account</SortableHead>\n                    <SortableHead field=\"stage\" activeField={sortField} direction={sortDirection} onSort={onSort}>Stage</SortableHead>\n                    <SortableHead field=\"amount\" activeField={sortField} direction={sortDirection} onSort={onSort}>Amount</SortableHead>\n                    <SortableHead field=\"close_date\" activeField={sortField} direction={sortDirection} onSort={onSort}>Close Date</SortableHead>\n                    <SortableHead field=\"probability\" activeField={sortField} direction={sortDirection} onSort={onSort}>Probability</SortableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {sortedOpportunities.map((opportunity) => (\n                    <TableRow\n                      key={opportunity.id}\n                      className=\"cursor-pointer hover:bg-muted/50\"\n                      onClick={() => navigate(`/dashboard/opportunities/${opportunity.id}`)}\n                    >\n                      <TableCell className=\"font-medium\">{opportunity.name}</TableCell>\n                      <TableCell>{opportunity.accounts?.name || '-'}</TableCell>\n                      <TableCell>\n                        <Badge className={stageColors[opportunity.stage]}>\n                          {stageLabels[opportunity.stage]}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>{formatCurrency(opportunity.amount)}</TableCell>\n                      <TableCell>{formatDate(opportunity.close_date)}</TableCell>\n                      <TableCell>{opportunity.probability ? `${opportunity.probability}%` : '-'}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        ) : viewMode === 'grid' ? (\n          <div className=\"space-y-2\">\n            <TitleStrip label=\"All Opportunities\" />\n            <div className=\"grid gap-3 grid-cols-2 md:grid-cols-3 lg:grid-cols-4\">\n              {sortedOpportunities.map((opportunity) => (\n                <Card key={opportunity.id} className=\"hover:shadow transition-shadow cursor-pointer\" onClick={() => navigate(`/dashboard/opportunities/${opportunity.id}`)}>\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-base truncate\">{opportunity.name}</CardTitle>\n                      <Badge className={stageColors[opportunity.stage]}>{stageLabels[opportunity.stage]}</Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"text-sm text-muted-foreground flex items-center justify-between\">\n                    <span className=\"truncate\">{opportunity.accounts?.name || '-'}</span>\n                    <span>{formatCurrency(opportunity.amount)}</span>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            <TitleStrip label=\"All Opportunities\" />\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {filteredOpportunitiesAdvanced.map((opportunity) => (\n                <Card key={opportunity.id} className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\" onClick={() => navigate(`/dashboard/opportunities/${opportunity.id}`)}>\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <Badge className={stageColors[opportunity.stage]}> {stageLabels[opportunity.stage]} </Badge>\n                      <Badge variant=\"outline\">{opportunity.accounts?.name || '-'}</Badge>\n                    </div>\n                    <CardTitle className=\"mt-4\">{opportunity.name}</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm text-muted-foreground\">\n                    <div className=\"flex items-center justify-between\">\n                      <span>Amount</span>\n                      <span className=\"font-medium\">{formatCurrency(opportunity.amount)}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>Close Date</span>\n                      <span>{formatDate(opportunity.close_date)}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>Probability</span>\n                      <span>{opportunity.probability ? `${opportunity.probability}%` : '-'}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )\n      }\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/OpportunitiesPipeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchAccounts' and 'fetchOpportunities'. Either include them or remove the dependency array.","line":82,"column":6,"nodeType":"ArrayExpression","endLine":82,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccounts, fetchOpportunities]","fix":{"range":[3482,3484],"text":"[fetchAccounts, fetchOpportunities]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'searchParams'. Either include it or remove the dependency array.","line":408,"column":6,"nodeType":"ArrayExpression","endLine":408,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams]","fix":{"range":[14093,14095],"text":"[searchParams]"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'searchParams' and 'setSearchParams'. Either include them or remove the dependency array.","line":397,"column":6,"nodeType":"ArrayExpression","endLine":397,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams, selectedStages, setSearchParams]","fix":{"range":[13737,13753],"text":"[searchParams, selectedStages, setSearchParams]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { ArrowLeft, Search, Filter, Layers, Settings, CheckSquare, Square, Trash2, AlertCircle, TrendingUp } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DndContext, DragEndEvent, DragOverlay, DragStartEvent, PointerSensor, useSensor, useSensors } from \"@dnd-kit/core\";\nimport { Droppable } from \"@/components/kanban/Droppable\";\nimport { Draggable } from \"@/components/kanban/Draggable\";\nimport { SwimLane } from \"@/components/kanban/SwimLane\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { KanbanFunnel } from \"@/components/kanban/KanbanFunnel\";\nimport { Opportunity, OpportunityStage, stageColors, stageLabels, stages } from \"./opportunities-data\";\n\nexport default function OpportunitiesPipeline() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { context } = useCRM();\n  const [opportunities, setOpportunities] = useState<Opportunity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [accountFilter, setAccountFilter] = useState<string>(\"all\");\n  const [probabilityFilter, setProbabilityFilter] = useState<string>(\"all\");\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const [groupBy, setGroupBy] = useState<'none' | 'probability' | 'value' | 'account'>('none');\n  const [accounts, setAccounts] = useState<Array<{ id: string; name: string }>>([]);\n  const [franchiseFilter, setFranchiseFilter] = useState<string>(\"all\");\n  const [createdFrom, setCreatedFrom] = useState<string>(\"\");\n  const [createdTo, setCreatedTo] = useState<string>(\"\");\n\n  // Advanced filters\n  const [minAmount, setMinAmount] = useState<string>(\"\");\n  const [maxAmount, setMaxAmount] = useState<string>(\"\");\n  const [dateFrom, setDateFrom] = useState<string>(\"\");\n  const [dateTo, setDateTo] = useState<string>(\"\");\n\n  // WIP limits\n  const [wipLimits, setWipLimits] = useState<Record<OpportunityStage, number>>({\n    prospecting: 30,\n    qualification: 20,\n    needs_analysis: 15,\n    value_proposition: 12,\n    proposal: 10,\n    negotiation: 8,\n    closed_won: 999,\n    closed_lost: 999,\n  });\n\n  // Card customization\n  const [showFields, setShowFields] = useState({\n    account: true,\n    contact: true,\n    amount: true,\n    probability: true,\n    closeDate: true,\n  });\n\n  // Bulk operations\n  const [selectedOpportunities, setSelectedOpportunities] = useState<Set<string>>(new Set());\n  const [bulkMode, setBulkMode] = useState(false);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    })\n  );\n\n  useEffect(() => {\n    fetchOpportunities();\n    fetchAccounts();\n  }, []);\n\n  const fetchOpportunities = async () => {\n    try {\n      setLoading(true);\n      let query = supabase\n        .from(\"opportunities\")\n        .select(`\n          *,\n          accounts:account_id(name),\n          contacts:contact_id(first_name, last_name)\n        `)\n        .order(\"created_at\", { ascending: false });\n\n      if (!context.isPlatformAdmin) {\n        if (context.franchiseId) query = query.eq(\"franchise_id\", context.franchiseId);\n        else if (context.tenantId) query = query.eq(\"tenant_id\", context.tenantId as string);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setOpportunities((data || []) as Opportunity[]);\n    } catch (error) {\n      console.error(\"Error fetching opportunities:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to fetch opportunities\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchAccounts = async () => {\n    try {\n      let query = supabase\n        .from(\"accounts\")\n        .select(\"id, name\")\n        .limit(100)\n        .order(\"name\");\n      if (!context.isPlatformAdmin) {\n        if (context.franchiseId) query = query.eq(\"franchise_id\", context.franchiseId);\n        else if (context.tenantId) query = query.eq(\"tenant_id\", context.tenantId as string);\n      }\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setAccounts(data || []);\n    } catch (error) {\n      console.error(\"Error fetching accounts:\", error);\n    }\n  };\n\n  const handleStageChange = async (opportunityId: string, newStage: Stage) => {\n    try {\n      const { error } = await supabase\n        .from(\"opportunities\")\n        .update({ stage: newStage })\n        .eq(\"id\", opportunityId);\n\n      if (error) throw error;\n\n      setOpportunities((prev) =>\n        prev.map((opportunity) =>\n          opportunity.id === opportunityId ? { ...opportunity, stage: newStage } : opportunity\n        )\n      );\n\n      toast({\n        title: \"Success\",\n        description: \"Opportunity stage updated\",\n      });\n    } catch (error) {\n      console.error(\"Error updating opportunity stage:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update opportunity stage\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDragStart = (event: DragStartEvent) => {\n    setActiveId(event.active.id as string);\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n    setActiveId(null);\n\n    if (!over) return;\n\n    const opportunityId = active.id as string;\n    const newStage = over.id as Stage;\n\n    const opportunity = opportunities.find((o) => o.id === opportunityId);\n    if (!opportunity || opportunity.stage === newStage) return;\n\n    handleStageChange(opportunityId, newStage);\n  };\n\n  const filteredOpportunities = opportunities.filter((opportunity) => {\n    const searchLower = searchQuery.toLowerCase();\n    const matchesSearch =\n      !searchQuery ||\n      opportunity.name.toLowerCase().includes(searchLower) ||\n      opportunity.accounts?.name?.toLowerCase().includes(searchLower);\n\n    const matchesProbability =\n      probabilityFilter === \"all\" ||\n      (probabilityFilter === \"high\" && (opportunity.probability || 0) >= 70) ||\n      (probabilityFilter === \"medium\" && (opportunity.probability || 0) >= 40 && (opportunity.probability || 0) < 70) ||\n      (probabilityFilter === \"low\" && (opportunity.probability || 0) < 40);\n\n    const matchesAccount = accountFilter === \"all\" || opportunity.account_id === accountFilter;\n\n    const matchesFranchise = franchiseFilter === \"all\" || opportunity.franchise_id === franchiseFilter;\n\n    // Amount range filter\n    const amount = opportunity.amount || 0;\n    const matchesMinAmount = !minAmount || amount >= parseFloat(minAmount);\n    const matchesMaxAmount = !maxAmount || amount <= parseFloat(maxAmount);\n\n    // Date range filter\n    const closeDate = opportunity.close_date ? new Date(opportunity.close_date) : null;\n    const matchesDateFrom = !dateFrom || (closeDate && closeDate >= new Date(dateFrom));\n    const matchesDateTo = !dateTo || (closeDate && closeDate <= new Date(dateTo));\n\n    const createdAt = new Date(opportunity.created_at);\n    const matchesCreatedFrom = !createdFrom || createdAt >= new Date(createdFrom);\n    const matchesCreatedTo = !createdTo || createdAt <= new Date(createdTo);\n\n    return matchesSearch && matchesProbability && matchesAccount && matchesFranchise && matchesMinAmount && matchesMaxAmount && matchesDateFrom && matchesDateTo && matchesCreatedFrom && matchesCreatedTo;\n  });\n\n  const toggleOpportunitySelection = (opportunityId: string) => {\n    setSelectedOpportunities(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(opportunityId)) {\n        newSet.delete(opportunityId);\n      } else {\n        newSet.add(opportunityId);\n      }\n      return newSet;\n    });\n  };\n\n  const handleBulkDelete = async () => {\n    if (selectedOpportunities.size === 0) return;\n\n    try {\n      const { error } = await supabase\n        .from(\"opportunities\")\n        .delete()\n        .in(\"id\", Array.from(selectedOpportunities));\n\n      if (error) throw error;\n\n      setOpportunities(prev => prev.filter(o => !selectedOpportunities.has(o.id)));\n      setSelectedOpportunities(new Set());\n\n      toast({\n        title: \"Success\",\n        description: `Deleted ${selectedOpportunities.size} opportunity(ies)`,\n      });\n    } catch (error) {\n      console.error(\"Error deleting opportunities:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete opportunities\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleBulkStageChange = async (newStage: Stage) => {\n    if (selectedOpportunities.size === 0) return;\n\n    try {\n      const { error } = await supabase\n        .from(\"opportunities\")\n        .update({ stage: newStage })\n        .in(\"id\", Array.from(selectedOpportunities));\n\n      if (error) throw error;\n\n      setOpportunities(prev => prev.map(o =>\n        selectedOpportunities.has(o.id) ? { ...o, stage: newStage } : o\n      ));\n      setSelectedOpportunities(new Set());\n\n      toast({\n        title: \"Success\",\n        description: `Updated ${selectedOpportunities.size} opportunity(ies)`,\n      });\n    } catch (error) {\n      console.error(\"Error updating opportunities:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update opportunities\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const groupedOpportunities = stages.reduce((acc, stage) => {\n    acc[stage] = filteredOpportunities.filter((opportunity) => opportunity.stage === stage);\n    return acc;\n  }, {} as Record<Stage, Opportunity[]>);\n\n  // Group opportunities by swim lane\n  const getSwimLanes = () => {\n    if (groupBy === 'none') {\n      return [{ id: 'all', title: 'All Opportunities', opportunities: filteredOpportunities }];\n    }\n\n    if (groupBy === 'probability') {\n      return [\n        {\n          id: 'high',\n          title: 'High Probability (70%+)',\n          opportunities: filteredOpportunities.filter(o => (o.probability || 0) >= 70)\n        },\n        {\n          id: 'medium',\n          title: 'Medium Probability (40-69%)',\n          opportunities: filteredOpportunities.filter(o => (o.probability || 0) >= 40 && (o.probability || 0) < 70)\n        },\n        {\n          id: 'low',\n          title: 'Low Probability (<40%)',\n          opportunities: filteredOpportunities.filter(o => (o.probability || 0) < 40)\n        },\n      ].filter(lane => lane.opportunities.length > 0);\n    }\n\n    if (groupBy === 'value') {\n      return [\n        {\n          id: 'high-value',\n          title: 'High Value ($100K+)',\n          opportunities: filteredOpportunities.filter(o => (o.amount || 0) >= 100000)\n        },\n        {\n          id: 'mid-value',\n          title: 'Mid Value ($25K-$100K)',\n          opportunities: filteredOpportunities.filter(o => (o.amount || 0) >= 25000 && (o.amount || 0) < 100000)\n        },\n        {\n          id: 'low-value',\n          title: 'Low Value (<$25K)',\n          opportunities: filteredOpportunities.filter(o => (o.amount || 0) < 25000)\n        },\n      ].filter(lane => lane.opportunities.length > 0);\n    }\n\n    if (groupBy === 'account') {\n      const unassigned = {\n        id: 'unassigned',\n        title: 'Unassigned',\n        opportunities: filteredOpportunities.filter(o => !o.account_id)\n      };\n\n      const accountGroups = accounts.map(account => ({\n        id: account.id,\n        title: account.name,\n        opportunities: filteredOpportunities.filter(o => o.account_id === account.id)\n      })).filter(g => g.opportunities.length > 0);\n\n      return [unassigned, ...accountGroups].filter(lane => lane.opportunities.length > 0);\n    }\n\n    return [{ id: 'all', title: 'All Opportunities', opportunities: filteredOpportunities }];\n  };\n\n  const swimLanes = getSwimLanes();\n\n  const formatCurrency = (amount: number | null) => {\n    if (!amount) return \"\";\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  const formatDate = (date: string | null) => {\n    if (!date) return \"\";\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  const activeOpportunity = activeId ? opportunities.find((o) => o.id === activeId) : null;\n\n  // Multi-stage selection with deep-linking via `stage` query param\n  const [searchParams, setSearchParams] = useSearchParams();\n  const initialStagesParam = searchParams.get('stage');\n  const initialSelectedStages = (initialStagesParam ? initialStagesParam.split(',') : [])\n    .filter((s): s is Stage => (stages as string[]).includes(s));\n  const [selectedStages, setSelectedStages] = useState<Stage[]>(initialSelectedStages);\n\n  useEffect(() => {\n    const next = new URLSearchParams(searchParams);\n    if (selectedStages.length > 0) {\n      next.set('stage', selectedStages.join(','));\n    } else {\n      next.delete('stage');\n    }\n    setSearchParams(next);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedStages]);\n\n  useEffect(() => {\n    const acc = searchParams.get('account');\n    const fr = searchParams.get('franchise');\n    const from = searchParams.get('from');\n    const to = searchParams.get('to');\n    if (acc) setAccountFilter(acc);\n    if (fr) setFranchiseFilter(fr);\n    if (from) setCreatedFrom(from);\n    if (to) setCreatedTo(to);\n  }, []);\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Opportunities Pipeline</h1>\n            <p className=\"text-muted-foreground\">\n              Manage opportunities through stages\n              {(() => {\n                const selectedTotal = selectedStages.length\n                  ? selectedStages.reduce((acc, s) => acc + (groupedOpportunities[s]?.length || 0), 0)\n                  : filteredOpportunities.length;\n                const fullTotal = filteredOpportunities.length;\n                return (\n                  <span className=\"ml-2 text-xs\">\n                    {selectedStages.length > 0 ? `Selected: ${selectedTotal} of ${fullTotal}` : `Total: ${fullTotal}`}\n                  </span>\n                );\n              })()}\n            </p>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate(\"/dashboard/opportunities\")}>\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to List\n          </Button>\n        </div>\n\n        <div className=\"space-y-4\">\n          {/* Filters */}\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"space-y-4\">\n                {(() => {\n                  const labelMap: Record<Stage, string> = Object.fromEntries(\n                    stages.map((s) => [s, stageLabels[s]])\n                  ) as Record<Stage, string>;\n                  const colorMap: Record<Stage, string> = Object.fromEntries(\n                    stages.map((s) => [s, stageColors[s]])\n                  ) as Record<Stage, string>;\n                  const baseCountMap: Record<Stage, number> = Object.fromEntries(\n                    stages.map((s) => [s, (groupedOpportunities[s]?.length || 0)])\n                  ) as Record<Stage, number>;\n                  const countMap: Record<Stage, number> = selectedStages.length > 0\n                    ? Object.fromEntries(stages.map((s) => [s, selectedStages.includes(s) ? baseCountMap[s] : 0])) as Record<Stage, number>\n                    : baseCountMap;\n                  const totalCount = selectedStages.length > 0\n                    ? selectedStages.reduce((acc, s) => acc + baseCountMap[s], 0)\n                    : filteredOpportunities.length;\n\n                  return (\n                    <KanbanFunnel\n                      stages={stages}\n                      labels={labelMap}\n                      colors={colorMap}\n                      counts={countMap}\n                      total={totalCount}\n                      activeStages={selectedStages}\n                      onStageClick={(s) => {\n                        setSelectedStages((prev) => {\n                          const exists = prev.includes(s);\n                          const nextSel = exists ? prev.filter((x) => x !== s) : [...prev, s];\n                          return nextSel.sort((a, b) => stages.indexOf(a) - stages.indexOf(b));\n                        });\n                      }}\n                      onClearStage={() => setSelectedStages([])}\n                    />\n                  );\n                })()}\n                {/* Main Filters */}\n                <div className=\"flex flex-col md:flex-row gap-4\">\n                  <div className=\"flex-1 relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search opportunities...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"pl-9\"\n                    />\n                  </div>\n                  <Select value={probabilityFilter} onValueChange={setProbabilityFilter}>\n                    <SelectTrigger className=\"w-full md:w-[180px]\">\n                      <Filter className=\"h-4 w-4 mr-2\" />\n                      <SelectValue placeholder=\"Probability\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Probabilities</SelectItem>\n                      <SelectItem value=\"high\">High (70%+)</SelectItem>\n                      <SelectItem value=\"medium\">Medium (40-69%)</SelectItem>\n                      <SelectItem value=\"low\">Low (&lt;40%)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Select value={accountFilter} onValueChange={setAccountFilter}>\n                    <SelectTrigger className=\"w-full md:w-[200px]\">\n                      <TrendingUp className=\"h-4 w-4 mr-2\" />\n                      <SelectValue placeholder=\"Account\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Accounts</SelectItem>\n                      {accounts.map(account => (\n                        <SelectItem key={account.id} value={account.id}>\n                          {account.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <Select value={groupBy} onValueChange={(v) => setGroupBy(v as typeof groupBy)}>\n                    <SelectTrigger className=\"w-full md:w-[200px]\">\n                      <Layers className=\"h-4 w-4 mr-2\" />\n                      <SelectValue placeholder=\"Group By\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"none\">No Grouping</SelectItem>\n                      <SelectItem value=\"probability\">By Probability</SelectItem>\n                      <SelectItem value=\"value\">By Value</SelectItem>\n                      <SelectItem value=\"account\">By Account</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Advanced Filters */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Min Amount ($)</Label>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"0\"\n                      value={minAmount}\n                      onChange={(e) => setMinAmount(e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Max Amount ($)</Label>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"No limit\"\n                      value={maxAmount}\n                      onChange={(e) => setMaxAmount(e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Close From</Label>\n                    <Input\n                      type=\"date\"\n                      value={dateFrom}\n                      onChange={(e) => setDateFrom(e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Close To</Label>\n                    <Input\n                      type=\"date\"\n                      value={dateTo}\n                      onChange={(e) => setDateTo(e.target.value)}\n                    />\n                  </div>\n                </div>\n\n                {/* Actions Bar */}\n                <div className=\"flex items-center justify-between pt-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant={bulkMode ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => {\n                        setBulkMode(!bulkMode);\n                        setSelectedOpportunities(new Set());\n                      }}\n                    >\n                      <CheckSquare className=\"h-4 w-4 mr-2\" />\n                      {bulkMode ? \"Cancel Selection\" : \"Bulk Select\"}\n                    </Button>\n\n                    {bulkMode && selectedOpportunities.size > 0 && (\n                      <>\n                        <Badge variant=\"secondary\">{selectedOpportunities.size} selected</Badge>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={handleBulkDelete}\n                        >\n                          <Trash2 className=\"h-4 w-4 mr-2\" />\n                          Delete\n                        </Button>\n                        <Select onValueChange={handleBulkStageChange}>\n                          <SelectTrigger className=\"w-[200px] h-9\">\n                            <SelectValue placeholder=\"Change Stage\" />\n                          </SelectTrigger>\n                          <SelectContent>\n{(selectedStages.length ? selectedStages : stages).map(stage => (\n                              <SelectItem key={stage} value={stage}>\n                                {stageLabels[stage]}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </>\n                    )}\n                  </div>\n\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\">\n                        <Settings className=\"h-4 w-4 mr-2\" />\n                        Customize Cards\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-80\">\n                      <div className=\"space-y-4\">\n                        <h4 className=\"font-medium\">Card Fields</h4>\n                        <div className=\"space-y-3\">\n                          {Object.entries(showFields).map(([field, show]) => (\n                            <div key={field} className=\"flex items-center space-x-2\">\n                              <Checkbox\n                                id={field}\n                                checked={show}\n                                onCheckedChange={(checked) =>\n                                  setShowFields(prev => ({ ...prev, [field]: !!checked }))\n                                }\n                              />\n                              <Label htmlFor={field} className=\"capitalize\">\n                                {field.replace(/([A-Z])/g, ' $1').trim()}\n                              </Label>\n                            </div>\n                          ))}\n                        </div>\n                        <Separator />\n                        <h4 className=\"font-medium\">WIP Limits</h4>\n                        <div className=\"space-y-2\">\n                          {stages.slice(0, 6).map(stage => (\n                            <div key={stage} className=\"flex items-center justify-between\">\n                              <Label className=\"text-xs\">{stageLabels[stage]}</Label>\n                              <Input\n                                type=\"number\"\n                                min=\"0\"\n                                value={wipLimits[stage]}\n                                onChange={(e) => setWipLimits(prev => ({\n                                  ...prev,\n                                  [stage]: parseInt(e.target.value) || 0\n                                }))}\n                                className=\"w-20 h-8\"\n                              />\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </PopoverContent>\n                  </Popover>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {loading ? (\n            <div className=\"text-center py-12\">Loading opportunities...</div>\n          ) : (\n            <DndContext sensors={sensors} onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n              <div className=\"space-y-4\">\n                {swimLanes.map((lane) => {\n                  const laneGroupedOpportunities = stages.reduce((acc, stage) => {\n                    acc[stage] = lane.opportunities.filter((opportunity) => opportunity.stage === stage);\n                    return acc;\n                  }, {} as Record<Stage, Opportunity[]>);\n\n                  const totalValue = lane.opportunities.reduce((sum, opp) => sum + (opp.amount || 0), 0);\n                  const avgProbability = lane.opportunities.length > 0\n                    ? Math.round(lane.opportunities.reduce((sum, opp) => sum + (opp.probability || 0), 0) / lane.opportunities.length)\n                    : 0;\n\n                  return (\n                    <SwimLane\n                      key={lane.id}\n                      id={lane.id}\n                      title={lane.title}\n                      count={lane.opportunities.length}\n                      metrics={[\n                        { label: 'Total Value', value: formatCurrency(totalValue) },\n                        { label: 'Avg Probability', value: `${avgProbability}%` },\n                      ]}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-8 gap-4\">\n{(selectedStages.length ? selectedStages : stages).map((stage) => (\n                          <Droppable key={stage} id={stage}>\n                            <Card className=\"h-full transition-all duration-200 hover:shadow-md\">\n                              <CardHeader className=\"pb-3\">\n                                <CardTitle className=\"text-sm font-medium flex items-center justify-between\">\n                                  <span>{stageLabels[stage]}</span>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Badge\n                                      variant=\"secondary\"\n                                      className={`${stageColors[stage]} transition-all duration-200`}\n                                    >\n                                      {laneGroupedOpportunities[stage].length}\n                                    </Badge>\n                                    {wipLimits[stage] < 999 && laneGroupedOpportunities[stage].length >= wipLimits[stage] && (\n                                      <AlertCircle className=\"h-4 w-4 text-destructive\" />\n                                    )}\n                                  </div>\n                                </CardTitle>\n                                {wipLimits[stage] < 999 && (\n                                  <div className=\"text-xs text-muted-foreground\">\n                                    Limit: {wipLimits[stage]}\n                                    {laneGroupedOpportunities[stage].length > wipLimits[stage] && (\n                                      <span className=\"text-destructive ml-1\">\n                                        (+{laneGroupedOpportunities[stage].length - wipLimits[stage]} over)\n                                      </span>\n                                    )}\n                                  </div>\n                                )}\n                              </CardHeader>\n                              <CardContent className=\"space-y-2 min-h-[200px]\">\n                                {laneGroupedOpportunities[stage].map((opportunity) => (\n                                  <Draggable key={opportunity.id} id={opportunity.id}>\n                                    <Card\n                                      className=\"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1 animate-fade-in relative\"\n                                      onClick={(e) => {\n                                        if (bulkMode) {\n                                          e.stopPropagation();\n                                          toggleOpportunitySelection(opportunity.id);\n                                        } else {\n                                          navigate(`/dashboard/opportunities/${opportunity.id}`);\n                                        }\n                                      }}\n                                    >\n                                      <CardContent className=\"p-3 space-y-2\">\n                                        {bulkMode && (\n                                          <div className=\"absolute top-2 right-2 z-10\">\n                                            {selectedOpportunities.has(opportunity.id) ? (\n                                              <CheckSquare className=\"h-4 w-4 text-primary\" />\n                                            ) : (\n                                              <Square className=\"h-4 w-4 text-muted-foreground\" />\n                                            )}\n                                          </div>\n                                        )}\n                                        <div className=\"font-medium text-sm\">{opportunity.name}</div>\n                                        {showFields.account && opportunity.accounts?.name && (\n                                          <div className=\"text-xs text-muted-foreground\">{opportunity.accounts.name}</div>\n                                        )}\n                                        {showFields.contact && opportunity.contacts && (\n                                          <div className=\"text-xs text-muted-foreground\">\n                                            {opportunity.contacts.first_name} {opportunity.contacts.last_name}\n                                          </div>\n                                        )}\n                                        {showFields.amount && opportunity.amount && (\n                                          <div className=\"text-xs font-semibold text-primary\">\n                                            {formatCurrency(opportunity.amount)}\n                                          </div>\n                                        )}\n                                        {showFields.probability && opportunity.probability !== null && (\n                                          <Badge\n                                            variant=\"outline\"\n                                            className={`transition-all duration-200 ${\n                                              opportunity.probability >= 70\n                                                ? \"bg-green-500/10 hover:bg-green-500/20\"\n                                                : opportunity.probability >= 40\n                                                ? \"bg-yellow-500/10 hover:bg-yellow-500/20\"\n                                                : \"bg-red-500/10 hover:bg-red-500/20\"\n                                            }`}\n                                          >\n                                            {opportunity.probability}% chance\n                                          </Badge>\n                                        )}\n                                        {showFields.closeDate && opportunity.close_date && (\n                                          <div className=\"text-xs text-muted-foreground\">\n                                            Close: {formatDate(opportunity.close_date)}\n                                          </div>\n                                        )}\n                                      </CardContent>\n                                    </Card>\n                                  </Draggable>\n                                ))}\n                                {laneGroupedOpportunities[stage].length === 0 && (\n                                  <div className=\"text-xs text-muted-foreground text-center py-4\">\n                                    No opportunities in this stage\n                                  </div>\n                                )}\n                              </CardContent>\n                            </Card>\n                          </Droppable>\n                        ))}\n                      </div>\n                    </SwimLane>\n                  );\n                })}\n              </div>\n              <DragOverlay>\n                {activeOpportunity ? (\n                  <Card className=\"w-64 shadow-2xl rotate-3 scale-105 border-2 border-primary animate-scale-in\">\n                    <CardContent className=\"p-3 space-y-2 bg-gradient-to-br from-background to-muted\">\n                      <div className=\"font-medium text-sm\">{activeOpportunity.name}</div>\n                      {activeOpportunity.accounts?.name && (\n                        <div className=\"text-xs text-muted-foreground\">{activeOpportunity.accounts.name}</div>\n                      )}\n                      {activeOpportunity.amount && (\n                        <div className=\"text-xs font-semibold text-primary\">\n                          {formatCurrency(activeOpportunity.amount)}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                ) : null}\n              </DragOverlay>\n            </DndContext>\n          )}\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/OpportunityDetail.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'toast'. Either exclude it or remove the dependency array. Outer scope values like 'toast' aren't valid dependencies because mutating them doesn't re-render the component.","line":83,"column":6,"nodeType":"ArrayExpression","endLine":83,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [id, supabase, navigate]","fix":{"range":[3739,3770],"text":"[id, supabase, navigate]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { matchText, TextOp } from '@/lib/utils';\nimport { OpportunityForm } from '@/components/crm/OpportunityForm';\nimport { ArrowLeft, Edit, Trash2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { OpportunityItemsEditor } from '@/components/crm/OpportunityItemsEditor';\nimport { OpportunityHistoryTab } from '@/components/crm/OpportunityHistoryTab';\nimport { Opportunity, OpportunityHistory, OpportunityStage, stageColors, stageLabels } from './opportunities-data';\nimport type { Database } from '@/integrations/supabase/types';\n\nexport default function OpportunityDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { supabase } = useCRM();\n  const [opportunity, setOpportunity] = useState<Opportunity | null>(null);\n  const [isEditing, setIsEditing] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [history, setHistory] = useState<OpportunityHistory[]>([]);\n  const [loadingHistory, setLoadingHistory] = useState(false);\n  const [sfIdInput, setSfIdInput] = useState('');\n  const [syncing, setSyncing] = useState(false);\n  type QuoteRow = Database['public']['Tables']['quotes']['Row'];\n  const [quotes, setQuotes] = useState<QuoteRow[]>([]);\n  const [quotesLoading, setQuotesLoading] = useState(true);\n\n  // Advanced quote filters\n  const [quoteNumberQuery, setQuoteNumberQuery] = useState('');\n  const [quoteNumberOp, setQuoteNumberOp] = useState<TextOp>('contains');\n  const [quoteStatus, setQuoteStatus] = useState<string>('');\n  const [quoteMinTotal, setQuoteMinTotal] = useState<string>('');\n  const [quoteMaxTotal, setQuoteMaxTotal] = useState<string>('');\n  const [quoteStartDate, setQuoteStartDate] = useState<string>('');\n  const [quoteEndDate, setQuoteEndDate] = useState<string>('');\n\n  const fetchOpportunity = useCallback(async () => {\n    try {\n      const { data, error } = await supabase\n        .from('opportunities')\n        .select(`\n          *,\n          accounts:account_id(name),\n          contacts:contact_id(first_name, last_name),\n          leads:lead_id(first_name, last_name, company)\n        `)\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      setOpportunity(data as unknown as Opportunity);\n      const extra = data as unknown as { salesforce_opportunity_id?: string | null };\n      setSfIdInput(extra?.salesforce_opportunity_id || '');\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to load opportunity', {\n        description: message,\n      });\n      navigate('/dashboard/opportunities');\n    } finally {\n      setLoading(false);\n    }\n  }, [id, supabase, navigate, toast]);\n\n  useEffect(() => {\n    fetchOpportunity();\n  }, [fetchOpportunity]);\n\n  const fetchHistory = async () => {\n    if (!id) return;\n    setLoadingHistory(true);\n    try {\n      const { data, error } = await supabase\n        .from('opportunity_probability_history' as never)\n        .select(`\n          *,\n          changer:changed_by(first_name, last_name, email)\n        `)\n        .eq('opportunity_id', id)\n        .order('changed_at', { ascending: false });\n\n      if (error) throw error;\n      setHistory((data || []) as OpportunityHistory[]);\n    } catch (error) {\n      console.error('Error fetching history:', error);\n    } finally {\n      setLoadingHistory(false);\n    }\n  };\n\n  const handleUpdate = async (formData: {\n    name: string;\n    description?: string;\n    stage: OpportunityStage;\n    amount?: string;\n    probability?: string;\n    close_date?: string;\n    account_id?: string;\n    contact_id?: string;\n    lead_id?: string;\n    lead_source?: Database['public']['Enums']['lead_source'];\n    next_step?: string;\n    competitors?: string;\n    type?: string;\n    forecast_category?: string;\n    tenant_id?: string;\n    franchise_id?: string;\n  }) => {\n    try {\n      const updateData = {\n        name: formData.name,\n        description: formData.description || null,\n        stage: formData.stage,\n        amount: formData.amount ? parseFloat(formData.amount) : null,\n        probability: formData.probability ? parseInt(formData.probability) : null,\n        close_date: formData.close_date || null,\n        account_id: formData.account_id || null,\n        contact_id: formData.contact_id || null,\n        lead_id: formData.lead_id || null,\n        lead_source: formData.lead_source || null,\n        next_step: formData.next_step || null,\n        competitors: formData.competitors || null,\n        type: formData.type || null,\n        forecast_category: formData.forecast_category || null,\n        closed_at: ['closed_won', 'closed_lost'].includes(formData.stage) ? new Date().toISOString() : null,\n      };\n\n      const { error } = await supabase\n        .from('opportunities')\n        .update(updateData)\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Opportunity updated successfully');\n      setIsEditing(false);\n      fetchOpportunity();\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to update opportunity', {\n        description: message,\n      });\n    }\n  };\n\n  const saveSalesforceId = async () => {\n    try {\n      const { error } = await supabase\n        .from('opportunities')\n        .update({ salesforce_opportunity_id: sfIdInput || null } as unknown as Database['public']['Tables']['opportunities']['Update'])\n        .eq('id', id);\n\n      if (error) throw error;\n      toast.success('SOS Opportunity ID saved');\n      fetchOpportunity();\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to save SOS ID', { description: message });\n    }\n  };\n\n  const syncSalesforce = async () => {\n    try {\n      setSyncing(true);\n      const { data, error } = await supabase.functions.invoke('salesforce-sync-opportunity', {\n        body: { opportunity_id: id },\n      });\n      if (error) throw error;\n      toast.success('SOS sync completed');\n      fetchOpportunity();\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('SOS sync failed', { description: message });\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const { error } = await supabase\n        .from('opportunities')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast.success('Opportunity deleted successfully');\n      navigate('/dashboard/opportunities');\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to delete opportunity', {\n        description: message,\n      });\n    }\n  };\n\n  useEffect(() => {\n    const fetchQuotes = async () => {\n      if (!id) return;\n      try {\n        const { data, error } = await supabase\n          .from('quotes')\n          .select('*')\n          .eq('opportunity_id', id)\n          .order('created_at', { ascending: false });\n        if (error) throw error;\n        setQuotes((data || []) as QuoteRow[]);\n      } catch (err: unknown) {\n        const message = err instanceof Error ? err.message : String(err);\n        console.error('Failed to load related quotes:', message);\n      } finally {\n        setQuotesLoading(false);\n      }\n    };\n    fetchQuotes();\n  }, [id, supabase]);\n\n  const makePrimary = async (quoteId: string) => {\n    try {\n      const { error } = await supabase\n        .from('quotes')\n        .update({ is_primary: true, opportunity_id: id } as unknown as Database['public']['Tables']['quotes']['Update'])\n        .eq('id', quoteId);\n      if (error) throw error;\n      toast.success('Primary quote updated');\n      await fetchOpportunity();\n      const { data } = await supabase\n        .from('quotes')\n        .select('*')\n        .eq('opportunity_id', id)\n        .order('created_at', { ascending: false });\n      setQuotes((data || []) as QuoteRow[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : 'Unknown error';\n      toast.error('Failed to set primary quote', { description: message });\n    }\n  };\n\n  const formatCurrency = (amount: number | null) => {\n    if (!amount) return '-';\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n    }).format(amount);\n  };\n\n  const formatDate = (date: string | null) => {\n    if (!date) return '-';\n    return new Date(date).toLocaleDateString();\n  };\n\n  // Derived list: apply advanced filters to related quotes\n  const filteredQuotesAdvanced = quotes.filter((q) => {\n    const matchesNumber = matchText(\n      (q.quote_number || (q.id ? String(q.id).slice(0, 8) : '')),\n      quoteNumberQuery,\n      quoteNumberOp\n    );\n\n    const statusVal = (q.status || '').toLowerCase();\n    const matchesStatus = quoteStatus && quoteStatus !== 'any' ? statusVal === quoteStatus : true;\n\n    const totalNum = Number(q.total_amount ?? 0);\n    const matchesMin = quoteMinTotal ? totalNum >= Number(quoteMinTotal) : true;\n    const matchesMax = quoteMaxTotal ? totalNum <= Number(quoteMaxTotal) : true;\n\n    const created = q.created_at ? new Date(q.created_at) : null;\n    const startOk = quoteStartDate ? (created ? created >= new Date(quoteStartDate) : false) : true;\n    const endOk = quoteEndDate ? (created ? created <= new Date(quoteEndDate) : false) : true;\n\n    return matchesNumber && matchesStatus && matchesMin && matchesMax && startOk && endOk;\n  });\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8 text-muted-foreground\">Loading...</div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!opportunity) {\n    return null;\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-4xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/opportunities')}>\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">{opportunity.name}</h1>\n              <p className=\"text-muted-foreground\">Opportunity Details</p>\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={() => setIsEditing(!isEditing)}>\n              <Edit className=\"mr-2 h-4 w-4\" />\n              {isEditing ? 'Cancel' : 'Edit'}\n            </Button>\n            <Button variant=\"destructive\" onClick={() => setShowDeleteDialog(true)}>\n              <Trash2 className=\"mr-2 h-4 w-4\" />\n              Delete\n            </Button>\n          </div>\n        </div>\n\n        {isEditing ? (\n          <>\n          <Card>\n            <CardHeader>\n              <CardTitle>Edit Opportunity</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <OpportunityForm\n                opportunity={opportunity}\n                onSubmit={handleUpdate}\n                onCancel={() => setIsEditing(false)}\n              />\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>SOS</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Sync Status</p>\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"outline\">\n                      {opportunity.salesforce_sync_status || 'pending'}\n                    </Badge>\n                    {opportunity.salesforce_last_synced && (\n                      <span className=\"text-xs text-muted-foreground\">\n                        Last: {formatDate(opportunity.salesforce_last_synced)}\n                      </span>\n                    )}\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"sf-id\">SOS Opportunity ID</Label>\n                  <div className=\"flex gap-2 mt-1\">\n                    <Input id=\"sf-id\" value={sfIdInput} onChange={(e) => setSfIdInput(e.target.value)} placeholder=\"006XXXXXXXXXXXX\" />\n                    <Button variant=\"outline\" onClick={saveSalesforceId}>Save</Button>\n                  </div>\n                </div>\n              </div>\n              {opportunity.salesforce_error && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Last Error</p>\n                  <p className=\"mt-1 text-sm text-red-600 break-words\">{opportunity.salesforce_error}</p>\n                </div>\n              )}\n              <div className=\"flex gap-2\">\n                <Button onClick={syncSalesforce} disabled={!sfIdInput || syncing}>\n                  {syncing ? 'Syncing' : 'Sync to SOS'}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n          </>\n        ) : (\n          <Tabs defaultValue=\"details\" onValueChange={(val) => {\n            if (val === 'history') fetchHistory();\n          }}>\n            <TabsList>\n              <TabsTrigger value=\"details\">Details</TabsTrigger>\n              <TabsTrigger value=\"history\">Stage & Probability History</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"details\" className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Opportunity Information</CardTitle>\n                </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Stage</p>\n                    <Badge className={stageColors[opportunity.stage]}>\n                      {stageLabels[opportunity.stage]}\n                    </Badge>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Amount</p>\n                    <p className=\"text-lg font-semibold\">{formatCurrency(opportunity.amount)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Probability</p>\n                    <p className=\"font-medium\">{opportunity.probability ? `${opportunity.probability}%` : '-'}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Expected Close Date</p>\n                    <p className=\"font-medium\">{formatDate(opportunity.close_date)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Account</p>\n                    <p className=\"font-medium\">{opportunity.accounts?.name || '-'}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Primary Contact</p>\n                    <p className=\"font-medium\">\n                      {opportunity.contacts\n                        ? `${opportunity.contacts.first_name} ${opportunity.contacts.last_name}`\n                        : '-'}\n                    </p>\n                  </div>\n                  {opportunity.lead_source && (\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Lead Source</p>\n                      <p className=\"font-medium capitalize\">{opportunity.lead_source.replace('_', ' ')}</p>\n                    </div>\n                  )}\n                  {opportunity.type && (\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Type</p>\n                      <p className=\"font-medium\">{opportunity.type}</p>\n                    </div>\n                  )}\n                </div>\n\n                {opportunity.description && (\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Description</p>\n                    <p className=\"mt-1\">{opportunity.description}</p>\n                  </div>\n                )}\n\n                {opportunity.next_step && (\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Next Step</p>\n                    <p className=\"mt-1\">{opportunity.next_step}</p>\n                  </div>\n                )}\n\n                {opportunity.competitors && (\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Competitors</p>\n                    <p className=\"mt-1\">{opportunity.competitors}</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex items-center justify-between\">\n                <CardTitle>Quotes</CardTitle>\n                <Button size=\"sm\" onClick={() => navigate(`/dashboard/quotes/new?opportunityId=${id}`)}>New Quote</Button>\n              </CardHeader>\n              <CardContent>\n                {quotesLoading ? (\n                  <div className=\"text-sm text-muted-foreground\">Loading quotes...</div>\n                ) : quotes.length === 0 ? (\n                  <div className=\"text-sm text-muted-foreground\">No quotes linked to this opportunity.</div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-3 p-3 border rounded-md\">\n                      <p className=\"text-sm text-muted-foreground\">Filter related quotes by number, status, total, and date.</p>\n                      <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-3\">\n                        <div className=\"space-y-2\">\n                          <Label>Quote number</Label>\n                          <div className=\"flex gap-2\">\n                            <Select value={quoteNumberOp} onValueChange={(v) => setQuoteNumberOp(v as TextOp)}>\n                              <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Operator\" /></SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"contains\">Contains</SelectItem>\n                                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                                <SelectItem value=\"equals\">Equals</SelectItem>\n                                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n                              </SelectContent>\n                            </Select>\n                            <Input placeholder=\"Search number\" value={quoteNumberQuery} onChange={(e) => setQuoteNumberQuery(e.target.value)} />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                          <Label>Status</Label>\n                          <Select value={quoteStatus} onValueChange={setQuoteStatus}>\n                            <SelectTrigger><SelectValue placeholder=\"Any status\" /></SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"any\">Any</SelectItem>\n                              <SelectItem value=\"draft\">Draft</SelectItem>\n                              <SelectItem value=\"sent\">Sent</SelectItem>\n                              <SelectItem value=\"accepted\">Accepted</SelectItem>\n                              <SelectItem value=\"rejected\">Rejected</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                          <Label>Total amount</Label>\n                          <div className=\"flex gap-2\">\n                            <Input type=\"number\" placeholder=\"Min\" value={quoteMinTotal} onChange={(e) => setQuoteMinTotal(e.target.value)} />\n                            <Input type=\"number\" placeholder=\"Max\" value={quoteMaxTotal} onChange={(e) => setQuoteMaxTotal(e.target.value)} />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                          <Label>Created range</Label>\n                          <div className=\"flex gap-2\">\n                            <Input type=\"date\" value={quoteStartDate} onChange={(e) => setQuoteStartDate(e.target.value)} />\n                            <Input type=\"date\" value={quoteEndDate} onChange={(e) => setQuoteEndDate(e.target.value)} />\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    {filteredQuotesAdvanced.length === 0 ? (\n                      <div className=\"text-sm text-muted-foreground\">No matching quotes.</div>\n                    ) : (\n                      <div className=\"space-y-3\">\n                    {filteredQuotesAdvanced.map((q) => (\n                      <div key={q.id} className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"font-medium\">{q.quote_number || q.id.slice(0,8)}</p>\n                          <p className=\"text-xs text-muted-foreground\">Status: {q.status}  Total: {String(q.total_amount ?? 0)}</p>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {(q as unknown as { is_primary?: boolean }).is_primary ? (\n                            <span className=\"text-xs px-2 py-1 rounded bg-green-100 text-green-700\">Primary</span>\n                          ) : (\n                            <Button size=\"sm\" variant=\"outline\" onClick={() => makePrimary(q.id)}>Make Primary</Button>\n                          )}\n                          <Button size=\"sm\" onClick={() => navigate(`/dashboard/quotes/${q.id}`)}>View</Button>\n                        </div>\n                      </div>\n                    ))}\n                      </div>\n                    )}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Opportunity Items Editor */}\n            <OpportunityItemsEditor opportunityId={id!} />\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Timeline</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Created</p>\n                  <p className=\"font-medium\">{formatDate(opportunity.created_at)}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Last Updated</p>\n                  <p className=\"font-medium\">{formatDate(opportunity.updated_at)}</p>\n                </div>\n                {opportunity.closed_at && (\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Closed</p>\n                    <p className=\"font-medium\">{formatDate(opportunity.closed_at)}</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n            </TabsContent>\n\n            <TabsContent value=\"history\" className=\"space-y-6\">\n              <OpportunityHistoryTab history={history} onRefresh={fetchHistory} />\n            </TabsContent>\n          </Tabs>\n        )}\n      </div>\n\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Are you sure?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. This will permanently delete the opportunity.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete}>Delete</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/OpportunityNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[508,511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[508,511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1876,1879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1876,1879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { OpportunityForm } from '@/components/crm/OpportunityForm';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nexport default function OpportunityNew() {\n  const navigate = useNavigate();\n  const { supabase, user, context } = useCRM();\n\n  const handleSubmit = async (formData: any) => {\n    try {\n      const opportunityData = {\n        name: formData.name,\n        description: formData.description || null,\n        stage: formData.stage,\n        amount: formData.amount ? parseFloat(formData.amount) : null,\n        probability: formData.probability ? parseInt(formData.probability) : null,\n        close_date: formData.close_date || null,\n        account_id: formData.account_id || null,\n        contact_id: formData.contact_id || null,\n        lead_id: formData.lead_id || null,\n        lead_source: formData.lead_source || null,\n        next_step: formData.next_step || null,\n        competitors: formData.competitors || null,\n        type: formData.type || null,\n        forecast_category: formData.forecast_category || null,\n        tenant_id: context.isPlatformAdmin ? formData.tenant_id : context.tenantId,\n        franchise_id: formData.franchise_id || context.franchiseId,\n        owner_id: user?.id,\n        created_by: user?.id,\n      };\n\n      // Validate tenant_id\n      if (!opportunityData.tenant_id) {\n        toast.error('Tenant is required');\n        return;\n      }\n\n      const { error } = await supabase\n        .from('opportunities')\n        .insert(opportunityData);\n\n      if (error) throw error;\n\n      toast.success('Opportunity created successfully');\n      navigate('/dashboard/opportunities');\n    } catch (error: any) {\n      toast.error('Failed to create opportunity', {\n        description: error.message,\n      });\n    }\n  };\n\n  const handleCancel = () => {\n    navigate('/dashboard/opportunities');\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-4xl mx-auto space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">New Opportunity</h1>\n          <p className=\"text-muted-foreground\">Create a new sales opportunity</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Opportunity Information</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <OpportunityForm onSubmit={handleSubmit} onCancel={handleCancel} />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/PackageCategories.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[749,752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[749,752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCategories'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, context.tenantId, fetchCategories]","fix":{"range":[916,959],"text":"[context.isPlatformAdmin, context.tenantId, fetchCategories]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2663,2666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2663,2666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { PackageCategoryForm } from \"@/components/logistics/PackageCategoryForm\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\n\nexport default function PackageCategories() {\n  const { supabase, context } = useCRM();\n  const [categories, setCategories] = useState<any[]>([]);\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    if (context.isPlatformAdmin || context.tenantId) {\n      fetchCategories();\n    }\n  }, [context.isPlatformAdmin, context.tenantId]);\n\n  const fetchCategories = async () => {\n    const isPlatform = context.isPlatformAdmin;\n    const tenantId = context.tenantId;\n    if (!isPlatform && !tenantId) return;\n\n    let query = supabase.from(\"package_categories\").select(\"*\");\n    if (!isPlatform) {\n      query = query.eq(\"tenant_id\", tenantId as string);\n    }\n    const { data, error } = await query.order(\"category_name\");\n\n    if (error) {\n      console.error(\"Error fetching package categories:\", error);\n      return;\n    }\n\n    const rows = data || [];\n    // Dev-only: auto-seed demo categories if none exist (only when tenant scoped)\n    if (!isPlatform && rows.length === 0 && import.meta.env.DEV) {\n      try {\n        await supabase.from(\"package_categories\").insert([\n          {\n            tenant_id: tenantId,\n            category_name: \"Container\",\n            category_code: \"CONT\",\n            description: \"Standard shipping containers\",\n            is_active: true,\n          },\n          {\n            tenant_id: tenantId,\n            category_name: \"Palletized\",\n            category_code: \"PAL\",\n            description: \"Goods packed on pallets\",\n            is_active: true,\n          },\n          {\n            tenant_id: tenantId,\n            category_name: \"Loose\",\n            category_code: \"LOOSE\",\n            description: \"Loose cargo items\",\n            is_active: false,\n          },\n        ]);\n        toast.success(\"Seeded demo package categories\");\n        const { data: seeded } = await supabase\n          .from(\"package_categories\")\n          .select(\"*\")\n          .eq(\"tenant_id\", tenantId as string)\n          .order(\"category_name\");\n        setCategories(seeded || []);\n      } catch (seedErr: any) {\n        console.warn(\"Package categories seed failed:\", seedErr?.message || seedErr);\n        setCategories([]);\n      }\n    } else {\n      setCategories(rows);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Package Categories</h1>\n          <p className=\"text-muted-foreground\">Manage container and package categories for quotations</p>\n        </div>\n        <div className=\"space-y-4\">\n        <div className=\"flex justify-end\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Add Category\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Create Package Category</DialogTitle>\n              </DialogHeader>\n              <PackageCategoryForm\n                onSuccess={() => {\n                  setOpen(false);\n                  fetchCategories();\n                }}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Category Name</TableHead>\n              <TableHead>Code</TableHead>\n              <TableHead>Description</TableHead>\n              <TableHead>Status</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {categories.map((category) => (\n              <TableRow key={category.id}>\n                <TableCell className=\"font-medium\">{category.category_name}</TableCell>\n                <TableCell>{category.category_code}</TableCell>\n                <TableCell>{category.description}</TableCell>\n                <TableCell>\n                  <Badge variant={category.is_active ? \"default\" : \"secondary\"}>\n                    {category.is_active ? \"Active\" : \"Inactive\"}\n                  </Badge>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/PackageSizes.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[726,729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[726,729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSizes'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, context.tenantId, fetchSizes]","fix":{"range":[888,931],"text":"[context.isPlatformAdmin, context.tenantId, fetchSizes]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2774,2777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2774,2777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { PackageSizeForm } from \"@/components/logistics/PackageSizeForm\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\n\nexport default function PackageSizes() {\n  const { supabase, context } = useCRM();\n  const [sizes, setSizes] = useState<any[]>([]);\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    if (context.isPlatformAdmin || context.tenantId) {\n      fetchSizes();\n    }\n  }, [context.isPlatformAdmin, context.tenantId]);\n\n  const fetchSizes = async () => {\n    const isPlatform = context.isPlatformAdmin;\n    const tenantId = context.tenantId;\n    if (!isPlatform && !tenantId) return;\n\n    let query = supabase.from(\"package_sizes\").select(\"*\");\n    if (!isPlatform) {\n      query = query.eq(\"tenant_id\", tenantId as string);\n    }\n    const { data, error } = await query.order(\"size_name\");\n\n    if (error) {\n      console.error(\"Error fetching package sizes:\", error);\n      return;\n    }\n\n    const rows = data || [];\n    // Dev-only: auto-seed demo sizes if none exist (only when tenant scoped)\n    if (!isPlatform && rows.length === 0 && import.meta.env.DEV) {\n      try {\n        await supabase.from(\"package_sizes\").insert([\n          {\n            tenant_id: tenantId,\n            size_name: \"20ft Container\",\n            size_code: \"20FT\",\n            length_ft: 20,\n            width_ft: 8,\n            height_ft: 8.5,\n            max_weight_kg: 28200,\n            is_active: true,\n          },\n          {\n            tenant_id: tenantId,\n            size_name: \"40ft Container\",\n            size_code: \"40FT\",\n            length_ft: 40,\n            width_ft: 8,\n            height_ft: 8.5,\n            max_weight_kg: 30480,\n            is_active: true,\n          },\n          {\n            tenant_id: tenantId,\n            size_name: \"Pallet (48x40)\",\n            size_code: \"PAL48x40\",\n            length_ft: 4,\n            width_ft: 3.33,\n            height_ft: null,\n            max_weight_kg: 1000,\n            is_active: false,\n          },\n        ]);\n        toast.success(\"Seeded demo package sizes\");\n        const { data: seeded } = await supabase\n          .from(\"package_sizes\")\n          .select(\"*\")\n          .eq(\"tenant_id\", tenantId as string)\n          .order(\"size_name\");\n        setSizes(seeded || []);\n      } catch (seedErr: any) {\n        console.warn(\"Package sizes seed failed:\", seedErr?.message || seedErr);\n        setSizes([]);\n      }\n    } else {\n      setSizes(rows);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Package Sizes</h1>\n          <p className=\"text-muted-foreground\">Manage container and package sizes for quotations</p>\n        </div>\n        <div className=\"space-y-4\">\n        <div className=\"flex justify-end\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Add Size\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Create Package Size</DialogTitle>\n              </DialogHeader>\n              <PackageSizeForm\n                onSuccess={() => {\n                  setOpen(false);\n                  fetchSizes();\n                }}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Size Name</TableHead>\n              <TableHead>Code</TableHead>\n              <TableHead>Dimensions (ft)</TableHead>\n              <TableHead>Max Weight (kg)</TableHead>\n              <TableHead>Status</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {sizes.map((size) => (\n              <TableRow key={size.id}>\n                <TableCell className=\"font-medium\">{size.size_name}</TableCell>\n                <TableCell>{size.size_code}</TableCell>\n                <TableCell>\n                  {size.length_ft && size.width_ft && size.height_ft\n                    ? `${size.length_ft}'  ${size.width_ft}'  ${size.height_ft}'`\n                    : \"-\"}\n                </TableCell>\n                <TableCell>{size.max_weight_kg || \"-\"}</TableCell>\n                <TableCell>\n                  <Badge variant={size.is_active ? \"default\" : \"secondary\"}>\n                    {size.is_active ? \"Active\" : \"Inactive\"}\n                  </Badge>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/PermissionsMatrix.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/PortsLocations.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1228,1231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1228,1231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPorts'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, context.tenantId, fetchPorts, roles]","fix":{"range":[2185,2235],"text":"[context.isPlatformAdmin, context.tenantId, fetchPorts, roles]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3371,3374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3371,3374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3564,3567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3564,3567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4284,4287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4284,4287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8053,8056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8053,8056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8921,8924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8921,8924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9564,9567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9564,9567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Plus, Pencil, Trash2 } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from 'sonner';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { PortLocationForm } from '@/components/logistics/PortLocationForm';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { seedPortsForTenant } from '@/integrations/supabase/seedPortsLocations';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\n\nexport default function PortsLocations() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n  const { roles } = useAuth();\n  const [ports, setPorts] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [editingLocationId, setEditingLocationId] = useState<string | undefined>(undefined);\n  const [filterName, setFilterName] = useState('');\n  const [filterCode, setFilterCode] = useState('');\n  const [filterType, setFilterType] = useState<'all' | 'seaport' | 'airport' | 'inland_port' | 'warehouse' | 'terminal'>('all');\n  const [filterCity, setFilterCity] = useState('');\n  const [filterCountry, setFilterCountry] = useState('');\n  const [filterCustoms, setFilterCustoms] = useState<'all' | 'yes' | 'no'>('all');\n  const [filterStatus, setFilterStatus] = useState<'all' | 'active' | 'inactive'>('all');\n\n  useEffect(() => {\n    if (context.isPlatformAdmin || context.tenantId || roles?.[0]?.tenant_id) {\n      fetchPorts();\n    } else {\n      setLoading(false);\n    }\n  }, [context.isPlatformAdmin, context.tenantId, roles]);\n\n  const fetchPorts = async () => {\n    const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n    const isPlatform = context.isPlatformAdmin;\n    if (!isPlatform && !tenantId) {\n      setLoading(false);\n      return;\n    }\n\n    try {\n      let query = supabase\n        .from('ports_locations')\n        .select('*');\n      if (!isPlatform) {\n        query = query.eq('tenant_id', tenantId as string);\n      }\n      const { data, error } = await query.order('location_name');\n\n      if (error) throw error;\n      const rows = data || [];\n      // Dev-only: auto-seed demo ports/locations if none exist (only when tenant scoped)\n      if (!isPlatform && rows.length === 0 && import.meta.env.DEV) {\n        try {\n          const count = await seedPortsForTenant(supabase, tenantId as string);\n          if (count > 0) toast.success(`Seeded ${count} demo ports/locations`);\n          const { data: seeded } = await supabase\n            .from('ports_locations')\n            .select('*')\n            .eq('tenant_id', tenantId as string)\n            .order('location_name');\n          setPorts(seeded || []);\n        } catch (seedErr: any) {\n          console.warn('Ports/locations seed failed:', seedErr?.message || seedErr);\n          setPorts([]);\n        }\n      } else {\n        setPorts(rows);\n      }\n    } catch (error: any) {\n      toast.error('Failed to load ports/locations', {\n        description: error.message,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSuccess = () => {\n    setDialogOpen(false);\n    fetchPorts();\n  };\n\n  const handleEditSuccess = () => {\n    setEditDialogOpen(false);\n    setEditingLocationId(undefined);\n    fetchPorts();\n  };\n\n  const onEdit = (id: string) => {\n    setEditingLocationId(id);\n    setEditDialogOpen(true);\n  };\n\n  const onDelete = async (id: string) => {\n    try {\n      const { error } = await supabase.from('ports_locations').delete().eq('id', id);\n      if (error) throw error;\n      toast.success('Port/Location deleted');\n      fetchPorts();\n    } catch (e: any) {\n      toast.error(e.message || 'Failed to delete port/location');\n    }\n  };\n\n  const filteredPorts = ports.filter((p) => {\n    const nameMatch = !filterName || (p.location_name || '').toLowerCase().includes(filterName.toLowerCase());\n    const codeMatch = !filterCode || (p.location_code || '').toLowerCase().includes(filterCode.toLowerCase());\n    const typeMatch = filterType === 'all' || p.location_type === filterType;\n    const cityMatch = !filterCity || (p.city || '').toLowerCase().includes(filterCity.toLowerCase());\n    const countryMatch = !filterCountry || (p.country || '').toLowerCase().includes(filterCountry.toLowerCase());\n    const customsMatch = filterCustoms === 'all' || (filterCustoms === 'yes' ? !!p.customs_available : !p.customs_available);\n    const statusMatch = filterStatus === 'all' || (filterStatus === 'active' ? !!p.is_active : !p.is_active);\n    return nameMatch && codeMatch && typeMatch && cityMatch && countryMatch && customsMatch && statusMatch;\n  });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Ports & Locations</h1>\n            <p className=\"text-muted-foreground\">Manage shipping ports, airports, and facilities</p>\n          </div>\n          <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                New Port/Location\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Add New Port/Location</DialogTitle>\n              </DialogHeader>\n              <PortLocationForm onSuccess={handleSuccess} />\n            </DialogContent>\n          </Dialog>\n          {import.meta.env.DEV && (context.tenantId || roles?.[0]?.tenant_id) && (\n            <Button\n              variant=\"outline\"\n              onClick={async () => {\n                const tenantId = context.tenantId || roles?.[0]?.tenant_id;\n                const count = await seedPortsForTenant(supabase, tenantId as string);\n                if (count > 0) fetchPorts();\n              }}\n            >Seed Demo Ports</Button>\n          )}\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>All Ports & Locations</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-6 gap-3 mb-4\">\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Name</label>\n                <Input placeholder=\"Search name\" value={filterName} onChange={(e) => setFilterName(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Code</label>\n                <Input placeholder=\"Search code\" value={filterCode} onChange={(e) => setFilterCode(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">City</label>\n                <Input placeholder=\"Search city\" value={filterCity} onChange={(e) => setFilterCity(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Country</label>\n                <Input placeholder=\"Search country\" value={filterCountry} onChange={(e) => setFilterCountry(e.target.value)} />\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Type</label>\n                <Select value={filterType} onValueChange={(v) => setFilterType(v as any)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All</SelectItem>\n                    <SelectItem value=\"seaport\">Seaport</SelectItem>\n                    <SelectItem value=\"airport\">Airport</SelectItem>\n                    <SelectItem value=\"inland_port\">Inland Port</SelectItem>\n                    <SelectItem value=\"warehouse\">Warehouse</SelectItem>\n                    <SelectItem value=\"terminal\">Terminal</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Customs</label>\n                <Select value={filterCustoms} onValueChange={(v) => setFilterCustoms(v as any)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All</SelectItem>\n                    <SelectItem value=\"yes\">Available</SelectItem>\n                    <SelectItem value=\"no\">Not Available</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <label className=\"text-sm text-muted-foreground mb-1 block\">Status</label>\n                <Select value={filterStatus} onValueChange={(v) => setFilterStatus(v as any)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All</SelectItem>\n                    <SelectItem value=\"active\">Active</SelectItem>\n                    <SelectItem value=\"inactive\">Inactive</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            {loading ? (\n              <div className=\"text-center py-8 text-muted-foreground\">Loading ports/locations...</div>\n            ) : filteredPorts.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No ports/locations found. Create your first port/location to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Location Name</TableHead>\n                    <TableHead>Code</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Location</TableHead>\n                    <TableHead>Customs</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredPorts.map((port) => (\n                    <TableRow key={port.id}>\n                      <TableCell className=\"font-medium\">{port.location_name}</TableCell>\n                      <TableCell>{port.location_code || 'N/A'}</TableCell>\n                      <TableCell>\n                        {port.location_type && (\n                          <Badge variant=\"outline\">\n                            {port.location_type.replace('_', ' ').toUpperCase()}\n                          </Badge>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"text-sm\">\n                          {port.city && port.country ? (\n                            <div>{port.city}, {port.country}</div>\n                          ) : (\n                            <div className=\"text-muted-foreground\">Location not specified</div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={port.customs_available ? 'default' : 'secondary'}>\n                          {port.customs_available ? 'Available' : 'Not Available'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={port.is_active ? 'default' : 'secondary'}>\n                          {port.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-2\">\n                          <Button variant=\"outline\" size=\"icon\" onClick={() => onEdit(port.id)}>\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button variant=\"destructive\" size=\"icon\" onClick={() => onDelete(port.id)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n        <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Edit Port/Location</DialogTitle>\n            </DialogHeader>\n            {editingLocationId && (\n              <PortLocationForm locationId={editingLocationId} onSuccess={handleEditSuccess} />\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/QuoteDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1447,1450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1447,1450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1495,1498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1495,1498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1568,1571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1568,1571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'navigate' and 'supabase'. Either include them or remove the dependency array.","line":41,"column":6,"nodeType":"ArrayExpression","endLine":41,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, navigate, supabase]","fix":{"range":[1727,1731],"text":"[id, navigate, supabase]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3174,3177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3174,3177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'supabase' and 'tenantId'. Either include them or remove the dependency array.","line":133,"column":6,"nodeType":"ArrayExpression","endLine":133,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [resolvedId, supabase, tenantId]","fix":{"range":[4751,4763],"text":"[resolvedId, supabase, tenantId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { QuoteForm } from '@/components/sales/QuoteForm';\nimport { QuotationVersionHistory } from '@/components/sales/QuotationVersionHistory';\nimport { MultiModalQuoteComposer } from '@/components/sales/MultiModalQuoteComposer';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { Breadcrumb, BreadcrumbItem, BreadcrumbLink, BreadcrumbList } from '@/components/ui/breadcrumb';\n\nexport default function QuoteDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { supabase } = useCRM();\n  const [loading, setLoading] = useState(true);\n  const [resolvedId, setResolvedId] = useState<string | null>(null);\n  const [versionId, setVersionId] = useState<string | null>(null);\n  const [tenantId, setTenantId] = useState<string | null>(null);\n\n  useEffect(() => {\n    const checkQuote = async () => {\n      try {\n        if (!id) throw new Error('Missing quote identifier');\n        // Allow navigating by either UUID id or quote_number (e.g., QT-2025-002)\n        const { data, error } = await supabase\n          .from('quotes')\n          .select('id, tenant_id')\n          .or(`id.eq.${id},quote_number.eq.${id}`)\n          .limit(1)\n          .single();\n        if (error) throw error;\n        setResolvedId((data as any)?.id ?? null);\n        setTenantId((data as any)?.tenant_id ?? null);\n        setLoading(false);\n      } catch (err: any) {\n        toast.error('Failed to load quote', { description: err.message });\n        navigate('/dashboard/quotes');\n      }\n    };\n    checkQuote();\n  }, [id]);\n\n  useEffect(() => {\n    const loadLatestVersion = async () => {\n      if (!resolvedId) return;\n      \n      console.log('[QuoteDetail] Loading latest version for quote:', resolvedId);\n      \n      try {\n        const { data, error } = await supabase\n          .from('quotation_versions')\n          .select('id, version_number')\n          .eq('quote_id', resolvedId)\n          .order('version_number', { ascending: false })\n          .limit(1);\n        \n        if (error) {\n          console.error('[QuoteDetail] Error querying versions:', error);\n          return;\n        }\n        \n        if (Array.isArray(data) && data.length && data[0]?.id) {\n          console.log('[QuoteDetail] Found existing version:', data[0].id);\n          setVersionId(String(data[0].id));\n          return;\n        }\n        \n        // Create initial version only if none exists\n        console.log('[QuoteDetail] No version found, creating version 1');\n        \n        let finalTenantId = tenantId;\n        if (!finalTenantId) {\n          // Fallback: fetch tenant from quote if not already set\n          const { data: qRow, error: qError } = await supabase\n            .from('quotes')\n            .select('tenant_id')\n            .eq('id', resolvedId)\n            .maybeSingle();\n          \n          if (qError) {\n            console.error('[QuoteDetail] Error fetching quote tenant:', qError);\n          }\n          \n          finalTenantId = (qRow as any)?.tenant_id ?? null;\n          if (finalTenantId) {\n            setTenantId(finalTenantId);\n          }\n        }\n        \n        if (!finalTenantId) {\n          const { data: { user } } = await supabase.auth.getUser();\n          finalTenantId = user?.user_metadata?.tenant_id;\n        }\n        \n        if (!finalTenantId) {\n          console.error('[QuoteDetail] Cannot create version: no tenant_id available');\n          return;\n        }\n        \n        const { data: v, error: insertError } = await supabase\n          .from('quotation_versions')\n          .insert({ quote_id: resolvedId, tenant_id: finalTenantId, version_number: 1 })\n          .select('id')\n          .maybeSingle();\n        \n        if (insertError) {\n          console.error('[QuoteDetail] Error creating version:', insertError);\n          // Check if version was created by another process\n          const { data: retry } = await supabase\n            .from('quotation_versions')\n            .select('id')\n            .eq('quote_id', resolvedId)\n            .limit(1)\n            .maybeSingle();\n          \n          if (retry?.id) {\n            console.log('[QuoteDetail] Version found on retry:', retry.id);\n            setVersionId(String(retry.id));\n          }\n          return;\n        }\n        \n        if (v?.id) {\n          console.log('[QuoteDetail] Created version:', v.id);\n          setVersionId(String(v.id));\n        }\n      } catch (error) {\n        console.error('[QuoteDetail] Unexpected error in loadLatestVersion:', error);\n      }\n    };\n    \n    loadLatestVersion();\n  }, [resolvedId]);\n\n  const handleSuccess = () => {\n    toast.success('Quote updated successfully');\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8 text-muted-foreground\">Loading...</div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-6xl mx-auto space-y-6\">\n        <div className=\"space-y-2\">\n          <Breadcrumb>\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard/quotes\">Quotes</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbItem>\n                <BreadcrumbLink href={`/dashboard/quotes/${resolvedId ?? id}`}>Edit</BreadcrumbLink>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between\">\n            <h1 className=\"text-3xl font-bold\">Edit Quote</h1>\n          </div>\n        </div>\n        <QuoteForm quoteId={resolvedId ?? id} onSuccess={handleSuccess} />\n        <QuotationVersionHistory quoteId={resolvedId ?? id as string} />\n        \n        {resolvedId && versionId && (\n          <div className=\"mt-6\">\n            <MultiModalQuoteComposer quoteId={resolvedId} versionId={versionId} />\n          </div>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/QuoteNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1197,1200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1197,1200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2356,2359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2356,2359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'supabase' and 'tenantId'. Either include them or remove the dependency array.","line":98,"column":6,"nodeType":"ArrayExpression","endLine":98,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [createdQuoteId, supabase, tenantId]","fix":{"range":[3657,3673],"text":"[createdQuoteId, supabase, tenantId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { QuoteForm } from '@/components/sales/QuoteForm';\nimport { MultiModalQuoteComposer } from '@/components/sales/MultiModalQuoteComposer';\nimport { Breadcrumb, BreadcrumbItem, BreadcrumbLink, BreadcrumbList } from '@/components/ui/breadcrumb';\nimport { useCRM } from '@/hooks/useCRM';\n\nexport default function QuoteNew() {\n  const navigate = useNavigate();\n  const { supabase } = useCRM();\n  const [createdQuoteId, setCreatedQuoteId] = useState<string | null>(null);\n  const [versionId, setVersionId] = useState<string | null>(null);\n  const [tenantId, setTenantId] = useState<string | null>(null);\n\n  const handleSuccess = (quoteId: string) => {\n    // Instead of navigating immediately, create initial version and show composer inline\n    setCreatedQuoteId(quoteId);\n    // Fetch tenant_id for the created quote to ensure version insert works\n    (async () => {\n      const { data } = await supabase\n        .from('quotes')\n        .select('tenant_id')\n        .eq('id', quoteId)\n        .single();\n      setTenantId((data as any)?.tenant_id ?? null);\n    })();\n  };\n\n  useEffect(() => {\n    const ensureVersion = async () => {\n      if (!createdQuoteId) return;\n      \n      console.log('[QuoteNew] Ensuring version exists for quote:', createdQuoteId);\n      \n      try {\n        // Check if version already exists\n        const { data: existing, error: queryError } = await supabase\n          .from('quotation_versions')\n          .select('id, version_number')\n          .eq('quote_id', createdQuoteId)\n          .order('version_number', { ascending: false })\n          .limit(1);\n        \n        if (queryError) {\n          console.error('[QuoteNew] Error querying versions:', queryError);\n          return;\n        }\n        \n        if (Array.isArray(existing) && existing.length && existing[0]?.id) {\n          console.log('[QuoteNew] Found existing version:', existing[0].id);\n          setVersionId(String(existing[0].id));\n          return;\n        }\n        \n        // Create initial version only if none exists\n        console.log('[QuoteNew] No version found, creating version 1');\n        const finalTenantId = tenantId ?? ((await supabase.auth.getUser()).data?.user as any)?.user_metadata?.tenant_id;\n        \n        if (!finalTenantId) {\n          console.error('[QuoteNew] Cannot create version: no tenant_id available');\n          return;\n        }\n        \n        const { data: v, error: insertError } = await supabase\n          .from('quotation_versions')\n          .insert({ quote_id: createdQuoteId, tenant_id: finalTenantId, version_number: 1 })\n          .select('id')\n          .maybeSingle();\n        \n        if (insertError) {\n          console.error('[QuoteNew] Error creating version:', insertError);\n          // Check if version was created by another process\n          const { data: retry } = await supabase\n            .from('quotation_versions')\n            .select('id')\n            .eq('quote_id', createdQuoteId)\n            .limit(1)\n            .maybeSingle();\n          \n          if (retry?.id) {\n            console.log('[QuoteNew] Version found on retry:', retry.id);\n            setVersionId(String(retry.id));\n          }\n          return;\n        }\n        \n        if (v?.id) {\n          console.log('[QuoteNew] Created version:', v.id);\n          setVersionId(String(v.id));\n        }\n      } catch (error) {\n        console.error('[QuoteNew] Unexpected error in ensureVersion:', error);\n      }\n    };\n    \n    ensureVersion();\n  }, [createdQuoteId]);\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-6xl mx-auto space-y-6\">\n        <div className=\"space-y-2\">\n          <Breadcrumb>\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard/quotes\">Quotes</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard/quotes/new\">New</BreadcrumbLink>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between\">\n            <h1 className=\"text-3xl font-bold\">New Quote</h1>\n          </div>\n        </div>\n        <QuoteForm onSuccess={handleSuccess} />\n        \n        {createdQuoteId && versionId && (\n          <div className=\"mt-6\">\n            <MultiModalQuoteComposer quoteId={createdQuoteId} versionId={versionId} />\n          </div>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/QuoteNumberSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[824,827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[824,827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1621,1624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1621,1624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1695,1698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1695,1698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2106,2109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2106,2109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2188,2191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2188,2191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2572,2575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2572,2575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadConfig'. Either include it or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [tenantId, franchiseId, loadConfig]","fix":{"range":[2680,2703],"text":"[tenantId, franchiseId, loadConfig]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3759,3762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3759,3762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5123,5126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5123,5126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from '@/components/ui/select';\nimport { Button } from '@/components/ui/button';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype ResetPolicy = 'none' | 'daily' | 'monthly' | 'yearly';\n\nexport default function QuoteNumberSettings() {\n  const { supabase, context } = useCRM();\n  const tenantId = context.tenantId;\n  const franchiseId = context.franchiseId || null;\n  // Use an untyped client for newly added tables/RPC not present in generated types\n  const sb: any = supabase;\n\n  const [tenantPrefix, setTenantPrefix] = useState('QUO');\n  const [tenantPolicy, setTenantPolicy] = useState<ResetPolicy>('daily');\n  const [franchisePrefix, setFranchisePrefix] = useState('QUO');\n  const [franchisePolicy, setFranchisePolicy] = useState<ResetPolicy>('daily');\n  const [previewNext, setPreviewNext] = useState<string>('');\n  const [savingTenant, setSavingTenant] = useState(false);\n  const [savingFranchise, setSavingFranchise] = useState(false);\n\n  const loadConfig = async () => {\n    if (!tenantId) return;\n    try {\n      const { data: tenantCfg } = await sb\n        .from('quote_number_config_tenant')\n        .select('prefix, reset_policy')\n        .eq('tenant_id', tenantId)\n        .single();\n      if (tenantCfg) {\n        setTenantPrefix(((tenantCfg as any).prefix as string) || 'QUO');\n        setTenantPolicy((((tenantCfg as any).reset_policy as ResetPolicy) || 'none') as ResetPolicy);\n      }\n\n      if (franchiseId) {\n        const { data: franchiseCfg } = await sb\n          .from('quote_number_config_franchise')\n          .select('prefix, reset_policy')\n          .eq('tenant_id', tenantId)\n          .eq('franchise_id', franchiseId)\n          .single();\n        if (franchiseCfg) {\n          setFranchisePrefix(((franchiseCfg as any).prefix as string) || 'QUO');\n          setFranchisePolicy((((franchiseCfg as any).reset_policy as ResetPolicy) || 'none') as ResetPolicy);\n        }\n      }\n\n      const { data: previewRes, error: previewErr } = await sb.rpc('preview_next_quote_number', {\n        p_tenant_id: tenantId,\n        p_franchise_id: franchiseId,\n      });\n      if (!previewErr) setPreviewNext(typeof previewRes === 'string' ? previewRes : String(previewRes ?? ''));\n    } catch (e: any) {\n      console.error('Load config failed', e);\n    }\n  };\n\n  useEffect(() => {\n    loadConfig();\n  }, [tenantId, franchiseId]);\n\n  const saveTenant = async () => {\n    if (!tenantId) return;\n    const prefix = (tenantPrefix || '').toUpperCase();\n    if (prefix.length !== 3) {\n      toast.error('Prefix must be exactly 3 characters');\n      return;\n    }\n    setSavingTenant(true);\n    try {\n      const { data: existing, error: loadErr } = await sb\n        .from('quote_number_config_tenant')\n        .select('tenant_id')\n        .eq('tenant_id', tenantId)\n        .maybeSingle();\n      if (loadErr) throw loadErr;\n\n      if (existing) {\n        const { error: updErr } = await sb\n          .from('quote_number_config_tenant')\n          .update({ prefix, reset_policy: tenantPolicy })\n          .eq('tenant_id', tenantId);\n        if (updErr) throw updErr;\n      } else {\n        const { error: insErr } = await sb\n          .from('quote_number_config_tenant')\n          .insert([{ tenant_id: tenantId, prefix, reset_policy: tenantPolicy }]);\n        if (insErr) throw insErr;\n      }\n      toast.success('Tenant quote numbering saved');\n      await loadConfig();\n    } catch (e: any) {\n      toast.error('Failed to save tenant config', { description: e?.message });\n    } finally {\n      setSavingTenant(false);\n    }\n  };\n\n  const saveFranchise = async () => {\n    if (!tenantId || !franchiseId) return;\n    const prefix = (franchisePrefix || '').toUpperCase();\n    if (prefix.length !== 3) {\n      toast.error('Prefix must be exactly 3 characters');\n      return;\n    }\n    setSavingFranchise(true);\n    try {\n      const { data: existing, error: loadErr } = await sb\n        .from('quote_number_config_franchise')\n        .select('tenant_id,franchise_id')\n        .eq('tenant_id', tenantId)\n        .eq('franchise_id', franchiseId)\n        .maybeSingle();\n      if (loadErr) throw loadErr;\n\n      if (existing) {\n        const { error: updErr } = await sb\n          .from('quote_number_config_franchise')\n          .update({ prefix, reset_policy: franchisePolicy })\n          .eq('tenant_id', tenantId)\n          .eq('franchise_id', franchiseId);\n        if (updErr) throw updErr;\n      } else {\n        const { error: insErr } = await sb\n          .from('quote_number_config_franchise')\n          .insert([{ tenant_id: tenantId, franchise_id: franchiseId, prefix, reset_policy: franchisePolicy }]);\n        if (insErr) throw insErr;\n      }\n      toast.success('Franchise quote numbering saved');\n      await loadConfig();\n    } catch (e: any) {\n      toast.error('Failed to save franchise config', { description: e?.message });\n    } finally {\n      setSavingFranchise(false);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 max-w-3xl\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Quote Numbering</h1>\n          <p className=\"text-muted-foreground\">Configure prefixes and reset policies per tenant or franchise.</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Preview</CardTitle>\n            <CardDescription>Next quote number based on current settings</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Input readOnly value={previewNext || ''} />\n            <div className=\"mt-2\">\n              <Button variant=\"secondary\" onClick={loadConfig}>Refresh Preview</Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Tenant Settings</CardTitle>\n            <CardDescription>Default prefix and reset policy for the tenant</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Prefix (3 chars)</label>\n              <Input maxLength={3} value={tenantPrefix} onChange={(e) => setTenantPrefix(e.target.value.toUpperCase())} />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Reset policy</label>\n              <Select value={tenantPolicy} onValueChange={(v) => setTenantPolicy(v as ResetPolicy)}>\n                <SelectTrigger><SelectValue placeholder=\"Select\" /></SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"none\">None</SelectItem>\n                  <SelectItem value=\"daily\">Daily</SelectItem>\n                  <SelectItem value=\"monthly\">Monthly</SelectItem>\n                  <SelectItem value=\"yearly\">Yearly</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <Button onClick={saveTenant} disabled={savingTenant}>Save Tenant Settings</Button>\n          </CardContent>\n        </Card>\n\n        {franchiseId && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Franchise Settings</CardTitle>\n              <CardDescription>Override for the current franchise</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Prefix (3 chars)</label>\n              <Input maxLength={3} value={franchisePrefix} onChange={(e) => setFranchisePrefix(e.target.value.toUpperCase())} />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Reset policy</label>\n                <Select value={franchisePolicy} onValueChange={(v) => setFranchisePolicy(v as ResetPolicy)}>\n                  <SelectTrigger><SelectValue placeholder=\"Select\" /></SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">None</SelectItem>\n                    <SelectItem value=\"daily\">Daily</SelectItem>\n                    <SelectItem value=\"monthly\">Monthly</SelectItem>\n                    <SelectItem value=\"yearly\">Yearly</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button onClick={saveFranchise} disabled={savingFranchise}>Save Franchise Settings</Button>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Quotes.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'supabase'. Either include it or remove the dependency array.","line":99,"column":6,"nodeType":"ArrayExpression","endLine":99,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [supabase]","fix":{"range":[4458,4460],"text":"[supabase]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport TitleStrip from '@/components/ui/title-strip';\nimport { Button } from '@/components/ui/button';\nimport { Table, TableBody, TableCell, TableHeader, TableRow, SortableHead } from '@/components/ui/table';\nimport { Pagination, PaginationContent, PaginationItem, PaginationPrevious, PaginationNext, PaginationFirst, PaginationLast, PaginationLink } from '@/components/ui/pagination';\nimport { useSort } from '@/hooks/useSort';\nimport { usePagination } from '@/hooks/usePagination';\nimport { useCRM } from '@/hooks/useCRM';\nimport { useEffect, useState } from 'react';\nimport { toast } from 'sonner';\nimport { Badge } from '@/components/ui/badge';\nimport { Breadcrumb, BreadcrumbItem, BreadcrumbLink, BreadcrumbList } from '@/components/ui/breadcrumb';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from '@/components/ui/select';\n\nimport { Quote, QuoteStatus, statusConfig } from './quotes-data';\n\nexport default function Quotes() {\n  const navigate = useNavigate();\n  const { supabase } = useCRM();\n  const [quotes, setQuotes] = useState<Quote[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [viewMode, setViewMode] = useState<ViewMode>('list');\n\n  // Filters state and helpers\n  type TextOp = 'contains' | 'startsWith' | 'equals' | 'endsWith';\n\n  const [quoteNumberOp, setQuoteNumberOp] = useState<TextOp>('contains');\n  const [quoteNumberQuery, setQuoteNumberQuery] = useState('');\n\n  const [customerOp, setCustomerOp] = useState<TextOp>('contains');\n  const [customerQuery, setCustomerQuery] = useState('');\n\n  const [contactOp, setContactOp] = useState<TextOp>('contains');\n  const [contactQuery, setContactQuery] = useState('');\n\n  const [opportunityOp, setOpportunityOp] = useState<TextOp>('contains');\n  const [opportunityQuery, setOpportunityQuery] = useState('');\n\n  const [carrierOp, setCarrierOp] = useState<TextOp>('contains');\n  const [carrierQuery, setCarrierQuery] = useState('');\n\n  const [quoteStatus, setQuoteStatus] = useState<string>('any');\n\n  const [minSellPrice, setMinSellPrice] = useState<string>('');\n  const [maxSellPrice, setMaxSellPrice] = useState<string>('');\n  const [minMargin, setMinMargin] = useState<string>('');\n\n  const [startDate, setStartDate] = useState<string>('');\n  const [endDate, setEndDate] = useState<string>('');\n\n  useEffect(() => {\n    const fetchQuotes = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('quotes')\n      .select('*')\n      .order('created_at', { ascending: false })\n      .limit(50);\n    \n    if (error) throw error;\n\n    // Fetch related data separately\n    const quotesWithRelations = await Promise.all(\n      (data || []).map(async (quote) => {\n        const [account, contact, opportunity, carrier, serviceType] = await Promise.all([\n          quote.account_id ? supabase.from('accounts').select('name').eq('id', quote.account_id).single() : null,\n          quote.contact_id ? supabase.from('contacts').select('first_name, last_name').eq('id', quote.contact_id).single() : null,\n          quote.opportunity_id ? supabase.from('opportunities').select('name').eq('id', quote.opportunity_id).single() : null,\n          quote.carrier_id ? supabase.from('carriers').select('carrier_name').eq('id', quote.carrier_id).single() : null,\n          quote.service_type_id ? supabase.from('service_types').select('name').eq('id', quote.service_type_id).single() : null,\n        ]);\n\n        return {\n          ...quote,\n          accounts: account?.data || null,\n          contacts: contact?.data || null,\n          opportunities: opportunity?.data || null,\n          carriers: carrier?.data || null,\n          service_types: serviceType?.data || null,\n        };\n      })\n    );\n\n        setQuotes(quotesWithRelations as unknown as Quote[]);\n      } catch (err: unknown) {\n        const description = err instanceof Error ? err.message : String(err);\n        toast.error('Failed to load quotes', { description });\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchQuotes();\n  }, []);\n\n  const currency = new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' });\n\n  const statusVariant = (status?: string) => {\n    switch ((status || '').toLowerCase()) {\n      case 'accepted':\n        return 'success';\n      case 'sent':\n        return 'secondary';\n      case 'rejected':\n        return 'destructive';\n      case 'draft':\n        return 'outline';\n      default:\n        return 'outline';\n    }\n  };\n\n  const matchText = (value: string | undefined | null, query: string, op: TextOp) => {\n    if (!query) return true;\n    const v = (value || '').toLowerCase();\n    const q = query.toLowerCase();\n    switch (op) {\n      case 'contains':\n        return v.includes(q);\n      case 'startsWith':\n        return v.startsWith(q);\n      case 'equals':\n        return v === q;\n      case 'endsWith':\n        return v.endsWith(q);\n      default:\n        return true;\n    }\n  };\n\n  const filteredQuotes = quotes.filter((q) => {\n    const quoteNum = q.quote_number || (q.id ? String(q.id).slice(0, 8) : '');\n    const matchesQuoteNum = matchText(quoteNum, quoteNumberQuery, quoteNumberOp);\n\n    const customerName = q.accounts?.name || '';\n    const matchesCustomer = matchText(customerName, customerQuery, customerOp);\n\n    const contactName = q.contacts ? `${q.contacts.first_name} ${q.contacts.last_name}` : '';\n    const matchesContact = matchText(contactName, contactQuery, contactOp);\n\n    const opportunityName = q.opportunities?.name || '';\n    const matchesOpportunity = matchText(opportunityName, opportunityQuery, opportunityOp);\n\n    const carrierName = q.carriers?.carrier_name || '';\n    const matchesCarrier = matchText(carrierName, carrierQuery, carrierOp);\n\n    const statusVal = (q.status || '').toLowerCase();\n    const matchesStatus = quoteStatus && quoteStatus !== 'any' ? statusVal === quoteStatus.toLowerCase() : true;\n\n    const sell = Number(q.sell_price ?? 0);\n    const matchesMinSell = minSellPrice ? sell >= Number(minSellPrice) : true;\n    const matchesMaxSell = maxSellPrice ? sell <= Number(maxSellPrice) : true;\n\n    const margin = (q.sell_price != null && q.cost_price != null) ? Number(q.sell_price) - Number(q.cost_price) : null;\n    const matchesMinMargin = minMargin ? (margin != null ? margin >= Number(minMargin) : false) : true;\n\n    const created = q.created_at ? new Date(q.created_at) : null;\n    const startOk = startDate ? (created ? created >= new Date(startDate) : false) : true;\n    const endOk = endDate ? (created ? created <= new Date(endDate) : false) : true;\n\n    return (\n      matchesQuoteNum &&\n      matchesCustomer &&\n      matchesContact &&\n      matchesOpportunity &&\n      matchesCarrier &&\n      matchesStatus &&\n      matchesMinSell &&\n      matchesMaxSell &&\n      matchesMinMargin &&\n      startOk &&\n      endOk\n    );\n  });\n\n  const { sorted: sortedQuotes, sortField, sortDirection, onSort } = useSort<Quote>(\n    filteredQuotes,\n    {\n      initialField: 'created_at',\n      initialDirection: 'desc',\n      accessors: {\n        quote_number: (q: Quote) => q.quote_number || (q.id ? String(q.id).slice(0, 8) : ''),\n        customer: (q: Quote) => q.accounts?.name || '',\n        contact: (q: Quote) => (q.contacts ? `${q.contacts.first_name} ${q.contacts.last_name}` : ''),\n        opportunity: (q: Quote) => q.opportunities?.name || '',\n        carrier: (q: Quote) => q.carriers?.carrier_name || '',\n        status: (q: Quote) => q.status || '',\n        sell_price: (q: Quote) => Number(q.sell_price ?? 0),\n        margin: (q: Quote) => (q.sell_price != null && q.cost_price != null ? Number(q.sell_price) - Number(q.cost_price) : 0),\n        created_at: (q: Quote) => (q.created_at ? new Date(q.created_at).getTime() : 0),\n      },\n    }\n  );\n\n  const {\n    pageItems: pagedQuotes,\n    pageSize,\n    setPageSize,\n    pageSizeOptions,\n    currentPage,\n    totalPages,\n    nextPage,\n    prevPage,\n    firstPage,\n    lastPage,\n    canPrev,\n    canNext,\n  } = usePagination(sortedQuotes, { initialPageSize: 20 });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-3\">\n          <div className=\"space-y-2\">\n            <Breadcrumb>\n              <BreadcrumbList>\n                <BreadcrumbItem>\n                  <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n                </BreadcrumbItem>\n                <BreadcrumbItem>\n                  <BreadcrumbLink href=\"/dashboard/quotes\">Quotes</BreadcrumbLink>\n                </BreadcrumbItem>\n              </BreadcrumbList>\n            </Breadcrumb>\n            <div>\n              <h1 className=\"text-3xl font-bold\">Quotes</h1>\n              <p className=\"text-muted-foreground\">Manage customer quotations</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <ViewToggle\n              value={viewMode}\n              modes={['pipeline','card','grid','list']}\n              onChange={(v) => v === 'pipeline' ? navigate('/dashboard/quotes/pipeline') : setViewMode(v)}\n            />\n            {/* Removed standalone Pipeline View button; use ViewToggle with Pipeline first */}\n            <Button onClick={() => navigate('/dashboard/quotes/new')}>New Quote</Button>\n          </div>\n        </div>\n\n        {/* Filters toolbar shown when not loading and there is data */}\n        {!loading && quotes.length > 0 && (\n          <Card>\n            <CardContent className=\"p-4 space-y-3\">\n              <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-3\">\n                <div className=\"space-y-2\">\n                  <Label>Quote number</Label>\n                  <div className=\"flex gap-2\">\n                    <Select value={quoteNumberOp} onValueChange={(v) => setQuoteNumberOp(v as TextOp)}>\n                      <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Operator\" /></SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"contains\">Contains</SelectItem>\n                        <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                        <SelectItem value=\"equals\">Equals</SelectItem>\n                        <SelectItem value=\"endsWith\">Ends With</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Input placeholder=\"Search number\" value={quoteNumberQuery} onChange={(e) => setQuoteNumberQuery(e.target.value)} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Customer</Label>\n                  <div className=\"flex gap-2\">\n                    <Select value={customerOp} onValueChange={(v) => setCustomerOp(v as TextOp)}>\n                      <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Operator\" /></SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"contains\">Contains</SelectItem>\n                        <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                        <SelectItem value=\"equals\">Equals</SelectItem>\n                        <SelectItem value=\"endsWith\">Ends With</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Input placeholder=\"Search customer\" value={customerQuery} onChange={(e) => setCustomerQuery(e.target.value)} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Contact</Label>\n                  <div className=\"flex gap-2\">\n                    <Select value={contactOp} onValueChange={(v) => setContactOp(v as TextOp)}>\n                      <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Operator\" /></SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"contains\">Contains</SelectItem>\n                        <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                        <SelectItem value=\"equals\">Equals</SelectItem>\n                        <SelectItem value=\"endsWith\">Ends With</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Input placeholder=\"Search contact\" value={contactQuery} onChange={(e) => setContactQuery(e.target.value)} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Opportunity</Label>\n                  <div className=\"flex gap-2\">\n                    <Select value={opportunityOp} onValueChange={(v) => setOpportunityOp(v as TextOp)}>\n                      <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Operator\" /></SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"contains\">Contains</SelectItem>\n                        <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                        <SelectItem value=\"equals\">Equals</SelectItem>\n                        <SelectItem value=\"endsWith\">Ends With</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Input placeholder=\"Search opportunity\" value={opportunityQuery} onChange={(e) => setOpportunityQuery(e.target.value)} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Carrier</Label>\n                  <div className=\"flex gap-2\">\n                    <Select value={carrierOp} onValueChange={(v) => setCarrierOp(v as TextOp)}>\n                      <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Operator\" /></SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"contains\">Contains</SelectItem>\n                        <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                        <SelectItem value=\"equals\">Equals</SelectItem>\n                        <SelectItem value=\"endsWith\">Ends With</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Input placeholder=\"Search carrier\" value={carrierQuery} onChange={(e) => setCarrierQuery(e.target.value)} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Status</Label>\n                  <Select value={quoteStatus} onValueChange={(v) => setQuoteStatus(v)}>\n                    <SelectTrigger><SelectValue placeholder=\"Any status\" /></SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"any\">Any</SelectItem>\n                      <SelectItem value=\"draft\">Draft</SelectItem>\n                      <SelectItem value=\"sent\">Sent</SelectItem>\n                      <SelectItem value=\"accepted\">Accepted</SelectItem>\n                      <SelectItem value=\"rejected\">Rejected</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Sell price range</Label>\n                  <div className=\"flex gap-2\">\n                    <Input type=\"number\" placeholder=\"Min\" value={minSellPrice} onChange={(e) => setMinSellPrice(e.target.value)} />\n                    <Input type=\"number\" placeholder=\"Max\" value={maxSellPrice} onChange={(e) => setMaxSellPrice(e.target.value)} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Min margin</Label>\n                  <Input type=\"number\" placeholder=\"Min margin\" value={minMargin} onChange={(e) => setMinMargin(e.target.value)} />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Created date range</Label>\n                  <div className=\"flex gap-2\">\n                    <Input type=\"date\" value={startDate} onChange={(e) => setStartDate(e.target.value)} />\n                    <Input type=\"date\" value={endDate} onChange={(e) => setEndDate(e.target.value)} />\n                  </div>\n                </div>\n              </div>\n              <div className=\"mt-3 flex items-center justify-between gap-3\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"text-xs text-muted-foreground\">Cards per page</div>\n                  <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                    <SelectTrigger className=\"w-[140px]\">\n                      <SelectValue placeholder=\"Cards\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {pageSizeOptions.map((opt) => (\n                        <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Pagination className=\"justify-end\">\n                  <PaginationContent>\n                    <PaginationItem>\n                      <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                  </PaginationContent>\n                </Pagination>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {loading ? (\n          <Card>\n            <CardHeader>\n              <CardTitle>All Quotes</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {[...Array(6)].map((_, i) => (\n                  <div key={i} className=\"grid grid-cols-9 gap-4 items-center\">\n                    {[...Array(9)].map((__, j) => (\n                      <Skeleton key={`${i}-${j}`} className=\"h-4 w-full\" />\n                    ))}\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        ) : quotes.length === 0 ? (\n          <Card>\n            <CardContent>\n              <div className=\"text-center py-10 space-y-3\">\n                <p className=\"text-muted-foreground\">No quotes yet</p>\n                <Button onClick={() => navigate('/dashboard/quotes/new')} size=\"sm\">Create your first quote</Button>\n              </div>\n            </CardContent>\n          </Card>\n        ) : viewMode === 'list' ? (\n          <Card>\n            <CardHeader>\n              <TitleStrip label=\"All Quotes\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableHead label=\"Quote #\" field=\"quote_number\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Customer\" field=\"customer\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Contact\" field=\"contact\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Opportunity\" field=\"opportunity\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Carrier\" field=\"carrier\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Status\" field=\"status\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Sell Price\" field=\"sell_price\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Margin\" field=\"margin\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                    <SortableHead label=\"Created\" field=\"created_at\" activeField={sortField} direction={sortDirection} onSort={onSort} />\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {pagedQuotes.map((q) => (\n                    <TableRow key={q.id} className=\"cursor-pointer hover:bg-muted/50\" onClick={() => navigate(`/dashboard/quotes/${q.id}`)}>\n                      <TableCell className=\"font-medium\">{q.quote_number || q.id.slice(0,8)}</TableCell>\n                      <TableCell>{q.accounts?.name || '-'}</TableCell>\n                      <TableCell>\n                        {q.contacts ? `${q.contacts.first_name} ${q.contacts.last_name}` : '-'}\n                      </TableCell>\n                      <TableCell>{q.opportunities?.name || '-'}</TableCell>\n                      <TableCell>{q.carriers?.carrier_name || '-'}</TableCell>\n                      <TableCell>\n                        <Badge variant={statusVariant(q.status)} className=\"capitalize\">{q.status || 'unknown'}</Badge>\n                      </TableCell>\n                      <TableCell className=\"font-medium\">{q.sell_price != null ? currency.format(q.sell_price) : currency.format(0)}</TableCell>\n                      <TableCell>\n                        {q.sell_price && q.cost_price ? (\n                          <span className={`${(q.sell_price - q.cost_price) > 0 ? 'text-green-600' : 'text-red-600'}`}>\n                            {currency.format((q.sell_price - q.cost_price))}\n                          </span>\n                        ) : '-'}\n                      </TableCell>\n                      <TableCell>{new Date(q.created_at).toLocaleDateString()}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              <div className=\"mt-3 flex items-center justify-between gap-3\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"text-xs text-muted-foreground\">Rows per page</div>\n                  <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                    <SelectTrigger className=\"w-[140px]\">\n                      <SelectValue placeholder=\"Rows\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {pageSizeOptions.map((opt) => (\n                        <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <Pagination className=\"justify-end\">\n                  <PaginationContent>\n                    <PaginationItem>\n                      <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                    <PaginationItem>\n                      <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                    </PaginationItem>\n                  </PaginationContent>\n                </Pagination>\n              </div>\n              </div>\n            </CardContent>\n          </Card>\n        ) : viewMode === 'grid' ? (\n          <Card>\n            <CardHeader>\n              <CardTitle>All Quotes</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid gap-3 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4\">\n                {pagedQuotes.map((q) => (\n                  <div key={q.id} className=\"border rounded-lg p-3 hover:bg-muted/50 cursor-pointer\" onClick={() => navigate(`/dashboard/quotes/${q.id}`)}>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"font-medium\">{q.quote_number || q.id.slice(0,8)}</div>\n                      <Badge variant={statusVariant(q.status)} className=\"capitalize\">{q.status || 'unknown'}</Badge>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground mt-1\">{q.accounts?.name || '-'}</div>\n                    <div className=\"mt-3 flex items-center justify-between\">\n                      <div>\n                        <div className=\"text-xs text-muted-foreground\">Sell</div>\n                        <div className=\"font-medium\">{q.sell_price != null ? currency.format(q.sell_price) : currency.format(0)}</div>\n                      </div>\n                      <div>\n                        <div className=\"text-xs text-muted-foreground\">Margin</div>\n                        <div className={`${(q.sell_price && q.cost_price && (q.sell_price - q.cost_price) > 0) ? 'text-green-600' : 'text-red-600'} font-medium`}>\n                          {q.sell_price && q.cost_price ? currency.format((q.sell_price - q.cost_price)) : '-'}\n                        </div>\n                      </div>\n                      <div>\n                        <div className=\"text-xs text-muted-foreground\">Created</div>\n                        <div className=\"font-medium\">{new Date(q.created_at).toLocaleDateString()}</div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-3\">\n            {pagedQuotes.map((q) => (\n              <Card key={q.id} className=\"hover:bg-muted/50 cursor-pointer\" onClick={() => navigate(`/dashboard/quotes/${q.id}`)}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"text-xl font-semibold\">{q.quote_number || q.id.slice(0,8)}</div>\n                      <Badge variant={statusVariant(q.status)} className=\"capitalize\">{q.status || 'unknown'}</Badge>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">{new Date(q.created_at).toLocaleDateString()}</div>\n                  </div>\n                  <div className=\"mt-2 text-muted-foreground\">\n                    <div>Customer: <span className=\"text-foreground\">{q.accounts?.name || '-'}</span></div>\n                    <div>Contact: <span className=\"text-foreground\">{q.contacts ? `${q.contacts.first_name} ${q.contacts.last_name}` : '-'}</span></div>\n                    <div>Opportunity: <span className=\"text-foreground\">{q.opportunities?.name || '-'}</span></div>\n                    <div>Carrier: <span className=\"text-foreground\">{q.carriers?.carrier_name || '-'}</span></div>\n                  </div>\n                  <div className=\"mt-3 flex items-center gap-6\">\n                    <div>\n                      <div className=\"text-xs text-muted-foreground\">Sell Price</div>\n                      <div className=\"font-medium\">{q.sell_price != null ? currency.format(q.sell_price) : currency.format(0)}</div>\n                    </div>\n                    <div>\n                      <div className=\"text-xs text-muted-foreground\">Cost Price</div>\n                      <div className=\"font-medium\">{q.cost_price != null ? currency.format(q.cost_price) : '-'}</div>\n                    </div>\n                    <div>\n                      <div className=\"text-xs text-muted-foreground\">Margin</div>\n                      <div className={`${(q.sell_price && q.cost_price && (q.sell_price - q.cost_price) > 0) ? 'text-green-600' : 'text-red-600'} font-medium`}>\n                        {q.sell_price && q.cost_price ? currency.format((q.sell_price - q.cost_price)) : '-'}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n            <div className=\"mt-3 flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"text-xs text-muted-foreground\">Cards per page</div>\n                <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                  <SelectTrigger className=\"w-[140px]\">\n                    <SelectValue placeholder=\"Cards\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {pageSizeOptions.map((opt) => (\n                      <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <Pagination className=\"justify-end\">\n                <PaginationContent>\n                  <PaginationItem>\n                    <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                </PaginationContent>\n              </Pagination>\n            </div>\n          </div>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/QuotesPipeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchAccounts' and 'fetchQuotes'. Either include them or remove the dependency array.","line":81,"column":6,"nodeType":"ArrayExpression","endLine":81,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccounts, fetchQuotes]","fix":{"range":[3256,3258],"text":"[fetchAccounts, fetchQuotes]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'searchParams'. Either include it or remove the dependency array.","line":403,"column":6,"nodeType":"ArrayExpression","endLine":403,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams]","fix":{"range":[12889,12891],"text":"[searchParams]"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'searchParams' and 'setSearchParams'. Either include them or remove the dependency array.","line":392,"column":6,"nodeType":"ArrayExpression","endLine":392,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams, selectedStages, setSearchParams]","fix":{"range":[12539,12555],"text":"[searchParams, selectedStages, setSearchParams]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useCRM } from \"@/hooks/useCRM\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { ArrowLeft, Search, Filter, Layers, Settings, CheckSquare, Square, Trash2, AlertCircle, DollarSign } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DndContext, DragEndEvent, DragOverlay, DragStartEvent, PointerSensor, useSensor, useSensors } from \"@dnd-kit/core\";\nimport { Droppable } from \"@/components/kanban/Droppable\";\nimport { Draggable } from \"@/components/kanban/Draggable\";\nimport { SwimLane } from \"@/components/kanban/SwimLane\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { KanbanFunnel } from \"@/components/kanban/KanbanFunnel\";\nimport { Quote, QuoteStatus, statusConfig, stages } from \"./quotes-data\";\n\nexport default function QuotesPipeline() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { context } = useCRM();\n  const [quotes, setQuotes] = useState<Quote[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [accountFilter, setAccountFilter] = useState<string>(\"all\");\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const [groupBy, setGroupBy] = useState<'none' | 'value' | 'margin' | 'account'>('none');\n  const [accounts, setAccounts] = useState<Array<{ id: string; name: string }>>([]);\n  const [franchiseFilter, setFranchiseFilter] = useState<string>(\"all\");\n\n  // Advanced filters\n  const [minValue, setMinValue] = useState<string>(\"\");\n  const [maxValue, setMaxValue] = useState<string>(\"\");\n  const [minMargin, setMinMargin] = useState<string>(\"\");\n  const [dateFrom, setDateFrom] = useState<string>(\"\");\n  const [dateTo, setDateTo] = useState<string>(\"\");\n\n  // WIP limits\n  const [wipLimits, setWipLimits] = useState<Record<QuoteStatus, number>>({\n    draft: 50,\n    pricing_review: 40,\n    approved: 40,\n    sent: 30,\n    customer_reviewing: 30,\n    revision_requested: 20,\n    accepted: 999,\n    rejected: 999,\n    expired: 20,\n  });\n\n  // Card customization\n  const [showFields, setShowFields] = useState({\n    account: true,\n    opportunity: true,\n    value: true,\n    margin: true,\n    validUntil: true,\n  });\n\n  // Bulk operations\n  const [selectedQuotes, setSelectedQuotes] = useState<Set<string>>(new Set());\n  const [bulkMode, setBulkMode] = useState(false);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    })\n  );\n\n  useEffect(() => {\n    fetchQuotes();\n    fetchAccounts();\n  }, []);\n\n  const fetchQuotes = async () => {\n    try {\n      setLoading(true);\n      let query = supabase\n        .from(\"quotes\")\n        .select(`\n          *,\n          accounts:account_id(name),\n          opportunities:opportunity_id(name)\n        `)\n        .order(\"created_at\", { ascending: false });\n\n      if (!context.isPlatformAdmin) {\n        if (context.franchiseId) query = query.eq(\"franchise_id\", context.franchiseId);\n        else if (context.tenantId) query = query.eq(\"tenant_id\", context.tenantId as string);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setQuotes((data || []) as Quote[]);\n    } catch (error) {\n      console.error(\"Error fetching quotes:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to fetch quotes\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchAccounts = async () => {\n    try {\n      let query = supabase\n        .from(\"accounts\")\n        .select(\"id, name\")\n        .limit(100)\n        .order(\"name\");\n      if (!context.isPlatformAdmin) {\n        if (context.franchiseId) query = query.eq(\"franchise_id\", context.franchiseId);\n        else if (context.tenantId) query = query.eq(\"tenant_id\", context.tenantId as string);\n      }\n      const { data, error } = await query;\n\n      if (error) throw error;\n      setAccounts(data || []);\n    } catch (error) {\n      console.error(\"Error fetching accounts:\", error);\n    }\n  };\n\n  const handleStatusChange = async (quoteId: string, newStatus: QuoteStatus) => {\n    try {\n      const { error } = await supabase\n        .from(\"quotes\")\n        .update({ status: newStatus })\n        .eq(\"id\", quoteId);\n\n      if (error) throw error;\n\n      setQuotes((prev) =>\n        prev.map((quote) =>\n          quote.id === quoteId ? { ...quote, status: newStatus } : quote\n        )\n      );\n\n      toast({\n        title: \"Success\",\n        description: \"Quote status updated\",\n      });\n    } catch (error) {\n      console.error(\"Error updating quote status:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update quote status\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDragStart = (event: DragStartEvent) => {\n    setActiveId(event.active.id as string);\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n    setActiveId(null);\n\n    if (!over) return;\n\n    const quoteId = active.id as string;\n    const newStatus = over.id as QuoteStatus;\n\n    const quote = quotes.find((q) => q.id === quoteId);\n    if (!quote || quote.status === newStatus) return;\n\n    handleStatusChange(quoteId, newStatus);\n  };\n\n  const filteredQuotes = quotes.filter((quote) => {\n    const searchLower = searchQuery.toLowerCase();\n    const matchesSearch =\n      !searchQuery ||\n      quote.quote_number.toLowerCase().includes(searchLower) ||\n      quote.title?.toLowerCase().includes(searchLower) ||\n      quote.accounts?.name?.toLowerCase().includes(searchLower);\n\n    const matchesAccount = accountFilter === \"all\" || quote.account_id === accountFilter;\n\n    const matchesFranchise = franchiseFilter === \"all\" || quote.franchise_id === franchiseFilter;\n\n    // Value range filter\n    const quoteValue = quote.sell_price || 0;\n    const matchesMinValue = !minValue || quoteValue >= parseFloat(minValue);\n    const matchesMaxValue = !maxValue || quoteValue <= parseFloat(maxValue);\n\n    // Margin filter\n    const margin = quote.margin_amount || 0;\n    const matchesMinMargin = !minMargin || margin >= parseFloat(minMargin);\n\n    // Date range filter\n    const quoteDate = new Date(quote.created_at);\n    const matchesDateFrom = !dateFrom || quoteDate >= new Date(dateFrom);\n    const matchesDateTo = !dateTo || quoteDate <= new Date(dateTo);\n\n\n    return matchesSearch && matchesAccount && matchesFranchise && matchesMinValue && matchesMaxValue && matchesMinMargin && matchesDateFrom && matchesDateTo;\n  });\n\n  const toggleQuoteSelection = (quoteId: string) => {\n    setSelectedQuotes(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(quoteId)) {\n        newSet.delete(quoteId);\n      } else {\n        newSet.add(quoteId);\n      }\n      return newSet;\n    });\n  };\n\n  const handleBulkDelete = async () => {\n    if (selectedQuotes.size === 0) return;\n\n    try {\n      const { error } = await supabase\n        .from(\"quotes\")\n        .delete()\n        .in(\"id\", Array.from(selectedQuotes));\n\n      if (error) throw error;\n\n      setQuotes(prev => prev.filter(q => !selectedQuotes.has(q.id)));\n      setSelectedQuotes(new Set());\n\n      toast({\n        title: \"Success\",\n        description: `Deleted ${selectedQuotes.size} quote(s)`,\n      });\n    } catch (error) {\n      console.error(\"Error deleting quotes:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete quotes\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleBulkStatusChange = async (newStatus: QuoteStatus) => {\n    if (selectedQuotes.size === 0) return;\n\n    try {\n      const { error } = await supabase\n        .from(\"quotes\")\n        .update({ status: newStatus })\n        .in(\"id\", Array.from(selectedQuotes));\n\n      if (error) throw error;\n\n      setQuotes(prev => prev.map(q =>\n        selectedQuotes.has(q.id) ? { ...q, status: newStatus } : q\n      ));\n      setSelectedQuotes(new Set());\n\n      toast({\n        title: \"Success\",\n        description: `Updated ${selectedQuotes.size} quote(s)`,\n      });\n    } catch (error) {\n      console.error(\"Error updating quotes:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update quotes\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const groupedQuotes = stages.reduce((acc, stage) => {\n    acc[stage] = filteredQuotes.filter((quote) => quote.status === stage);\n    return acc;\n  }, {} as Record<QuoteStatus, Quote[]>);\n\n  // Group quotes by swim lane\n  const getSwimLanes = () => {\n    if (groupBy === 'none') {\n      return [{ id: 'all', title: 'All Quotes', quotes: filteredQuotes }];\n    }\n\n    if (groupBy === 'value') {\n      return [\n        {\n          id: 'high-value',\n          title: 'High Value ($50K+)',\n          quotes: filteredQuotes.filter(q => (q.sell_price || 0) >= 50000)\n        },\n        {\n          id: 'mid-value',\n          title: 'Mid Value ($10K-$50K)',\n          quotes: filteredQuotes.filter(q => (q.sell_price || 0) >= 10000 && (q.sell_price || 0) < 50000)\n        },\n        {\n          id: 'low-value',\n          title: 'Low Value (<$10K)',\n          quotes: filteredQuotes.filter(q => (q.sell_price || 0) > 0 && (q.sell_price || 0) < 10000)\n        },\n      ].filter(lane => lane.quotes.length > 0);\n    }\n\n    if (groupBy === 'margin') {\n      return [\n        {\n          id: 'high-margin',\n          title: 'High Margin (30%+)',\n          quotes: filteredQuotes.filter(q => (q.margin_percentage || 0) >= 30)\n        },\n        {\n          id: 'mid-margin',\n          title: 'Mid Margin (15-30%)',\n          quotes: filteredQuotes.filter(q => (q.margin_percentage || 0) >= 15 && (q.margin_percentage || 0) < 30)\n        },\n        {\n          id: 'low-margin',\n          title: 'Low Margin (<15%)',\n          quotes: filteredQuotes.filter(q => (q.margin_percentage || 0) < 15)\n        },\n      ].filter(lane => lane.quotes.length > 0);\n    }\n\n    if (groupBy === 'account') {\n      const unassigned = {\n        id: 'unassigned',\n        title: 'Unassigned',\n        quotes: filteredQuotes.filter(q => !q.account_id)\n      };\n\n      const accountGroups = accounts.map(account => ({\n        id: account.id,\n        title: account.name,\n        quotes: filteredQuotes.filter(q => q.account_id === account.id)\n      })).filter(g => g.quotes.length > 0);\n\n      return [unassigned, ...accountGroups].filter(lane => lane.quotes.length > 0);\n    }\n\n    return [{ id: 'all', title: 'All Quotes', quotes: filteredQuotes }];\n  };\n\n  const swimLanes = getSwimLanes();\n\n  const formatCurrency = (amount: number | null) => {\n    if (!amount) return \"\";\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  const formatDate = (date: string | null) => {\n    if (!date) return \"\";\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  const activeQuote = activeId ? quotes.find((q) => q.id === activeId) : null;\n\n  // Multi-stage selection with deep-linking via `stage` query param\n  const [searchParams, setSearchParams] = useSearchParams();\n  const initialStagesParam = searchParams.get('stage');\n  const initialSelectedStages = (initialStagesParam ? initialStagesParam.split(',') : [])\n    .filter((s): s is QuoteStatus => (stages as string[]).includes(s));\n  const [selectedStages, setSelectedStages] = useState<QuoteStatus[]>(initialSelectedStages);\n\n  useEffect(() => {\n    const next = new URLSearchParams(searchParams);\n    if (selectedStages.length > 0) {\n      next.set('stage', selectedStages.join(','));\n    } else {\n      next.delete('stage');\n    }\n    setSearchParams(next);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedStages]);\n\n  useEffect(() => {\n    const acc = searchParams.get('account');\n    const fr = searchParams.get('franchise');\n    const from = searchParams.get('from');\n    const to = searchParams.get('to');\n    if (acc) setAccountFilter(acc);\n    if (fr) setFranchiseFilter(fr);\n    if (from) setDateFrom(from);\n    if (to) setDateTo(to);\n  }, []);\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Quotes Pipeline</h1>\n            <p className=\"text-muted-foreground\">\n              Manage quotes through stages\n              {(() => {\n                const selectedTotal = selectedStages.length\n                  ? selectedStages.reduce((acc, s) => acc + (groupedQuotes[s]?.length || 0), 0)\n                  : filteredQuotes.length;\n                const fullTotal = filteredQuotes.length;\n                return (\n                  <span className=\"ml-2 text-xs\">\n                    {selectedStages.length > 0 ? `Selected: ${selectedTotal} of ${fullTotal}` : `Total: ${fullTotal}`}\n                  </span>\n                );\n              })()}\n            </p>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate(\"/dashboard/quotes\")}>\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to List\n          </Button>\n        </div>\n\n        <div className=\"space-y-4\">\n          {/* Filters */}\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"space-y-4\">\n                {(() => {\n                  const labelMap: Record<QuoteStatus, string> = Object.fromEntries(\n                    stages.map((s) => [s, statusConfig[s].label])\n                  ) as Record<QuoteStatus, string>;\n                  const colorMap: Record<QuoteStatus, string> = Object.fromEntries(\n                    stages.map((s) => [s, statusConfig[s].color])\n                  ) as Record<QuoteStatus, string>;\n                  const baseCountMap: Record<QuoteStatus, number> = Object.fromEntries(\n                    stages.map((s) => [s, (groupedQuotes[s]?.length || 0)])\n                  ) as Record<QuoteStatus, number>;\n                  const countMap: Record<QuoteStatus, number> = selectedStages.length > 0\n                    ? Object.fromEntries(stages.map((s) => [s, selectedStages.includes(s) ? baseCountMap[s] : 0])) as Record<QuoteStatus, number>\n                    : baseCountMap;\n                  const totalCount = selectedStages.length > 0\n                    ? selectedStages.reduce((acc, s) => acc + baseCountMap[s], 0)\n                    : filteredQuotes.length;\n\n                  return (\n                    <KanbanFunnel\n                      stages={stages}\n                      labels={labelMap}\n                      colors={colorMap}\n                      counts={countMap}\n                      total={totalCount}\n                      activeStages={selectedStages}\n                      onStageClick={(s) => {\n                        setSelectedStages((prev) => {\n                          const exists = prev.includes(s);\n                          const nextSel = exists ? prev.filter((x) => x !== s) : [...prev, s];\n                          return nextSel.sort((a, b) => stages.indexOf(a) - stages.indexOf(b));\n                        });\n                      }}\n                      onClearStage={() => setSelectedStages([])}\n                    />\n                  );\n                })()}\n                {/* Main Filters */}\n                <div className=\"flex flex-col md:flex-row gap-4\">\n                  <div className=\"flex-1 relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search quotes...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"pl-9\"\n                    />\n                  </div>\n                  <Select value={accountFilter} onValueChange={setAccountFilter}>\n                    <SelectTrigger className=\"w-full md:w-[200px]\">\n                      <Filter className=\"h-4 w-4 mr-2\" />\n                      <SelectValue placeholder=\"Account\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Accounts</SelectItem>\n                      {accounts.map(account => (\n                        <SelectItem key={account.id} value={account.id}>\n                          {account.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <Select value={groupBy} onValueChange={(v) => setGroupBy(v as typeof groupBy)}>\n                    <SelectTrigger className=\"w-full md:w-[200px]\">\n                      <Layers className=\"h-4 w-4 mr-2\" />\n                      <SelectValue placeholder=\"Group By\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"none\">No Grouping</SelectItem>\n                      <SelectItem value=\"value\">By Value</SelectItem>\n                      <SelectItem value=\"margin\">By Margin</SelectItem>\n                      <SelectItem value=\"account\">By Account</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Advanced Filters */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Min Value ($)</Label>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"0\"\n                      value={minValue}\n                      onChange={(e) => setMinValue(e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Max Value ($)</Label>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"No limit\"\n                      value={maxValue}\n                      onChange={(e) => setMaxValue(e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Min Margin ($)</Label>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"0\"\n                      value={minMargin}\n                      onChange={(e) => setMinMargin(e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <Label className=\"text-xs text-muted-foreground\">Date From</Label>\n                    <Input\n                      type=\"date\"\n                      value={dateFrom}\n                      onChange={(e) => setDateFrom(e.target.value)}\n                    />\n                  </div>\n                </div>\n\n                {/* Actions Bar */}\n                <div className=\"flex items-center justify-between pt-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant={bulkMode ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => {\n                        setBulkMode(!bulkMode);\n                        setSelectedQuotes(new Set());\n                      }}\n                    >\n                      <CheckSquare className=\"h-4 w-4 mr-2\" />\n                      {bulkMode ? \"Cancel Selection\" : \"Bulk Select\"}\n                    </Button>\n\n                    {bulkMode && selectedQuotes.size > 0 && (\n                      <>\n                        <Badge variant=\"secondary\">{selectedQuotes.size} selected</Badge>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={handleBulkDelete}\n                        >\n                          <Trash2 className=\"h-4 w-4 mr-2\" />\n                          Delete\n                        </Button>\n                        <Select onValueChange={handleBulkStatusChange}>\n                          <SelectTrigger className=\"w-[180px] h-9\">\n                            <SelectValue placeholder=\"Change Status\" />\n                          </SelectTrigger>\n                          <SelectContent>\n{(selectedStages.length ? selectedStages : stages).map(stage => (\n                              <SelectItem key={stage} value={stage}>\n                                {statusConfig[stage].label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </>\n                    )}\n                  </div>\n\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\">\n                        <Settings className=\"h-4 w-4 mr-2\" />\n                        Customize Cards\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-80\">\n                      <div className=\"space-y-4\">\n                        <h4 className=\"font-medium\">Card Fields</h4>\n                        <div className=\"space-y-3\">\n                          {Object.entries(showFields).map(([field, show]) => (\n                            <div key={field} className=\"flex items-center space-x-2\">\n                              <Checkbox\n                                id={field}\n                                checked={show}\n                                onCheckedChange={(checked) =>\n                                  setShowFields(prev => ({ ...prev, [field]: !!checked }))\n                                }\n                              />\n                              <Label htmlFor={field} className=\"capitalize\">\n                                {field.replace(/([A-Z])/g, ' $1').trim()}\n                              </Label>\n                            </div>\n                          ))}\n                        </div>\n                        <Separator />\n                        <h4 className=\"font-medium\">WIP Limits</h4>\n                        <div className=\"space-y-2\">\n                          {stages.slice(0, 3).map(stage => (\n                            <div key={stage} className=\"flex items-center justify-between\">\n                              <Label className=\"text-xs\">{statusConfig[stage].label}</Label>\n                              <Input\n                                type=\"number\"\n                                min=\"0\"\n                                value={wipLimits[stage]}\n                                onChange={(e) => setWipLimits(prev => ({\n                                  ...prev,\n                                  [stage]: parseInt(e.target.value) || 0\n                                }))}\n                                className=\"w-20 h-8\"\n                              />\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </PopoverContent>\n                  </Popover>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {loading ? (\n            <div className=\"text-center py-12\">Loading quotes...</div>\n          ) : (\n            <DndContext sensors={sensors} onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n              <div className=\"space-y-4\">\n                {swimLanes.map((lane) => {\n                  const laneGroupedQuotes = stages.reduce((acc, stage) => {\n                    acc[stage] = lane.quotes.filter((quote) => quote.status === stage);\n                    return acc;\n                  }, {} as Record<QuoteStatus, Quote[]>);\n\n                  const totalValue = lane.quotes.reduce((sum, quote) => sum + (quote.sell_price || 0), 0);\n                  const totalMargin = lane.quotes.reduce((sum, quote) => sum + (quote.margin_amount || 0), 0);\n\n                  return (\n                    <SwimLane\n                      key={lane.id}\n                      id={lane.id}\n                      title={lane.title}\n                      count={lane.quotes.length}\n                      metrics={[\n                        { label: 'Total Value', value: formatCurrency(totalValue) },\n                        { label: 'Total Margin', value: formatCurrency(totalMargin) },\n                      ]}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4\">\n{(selectedStages.length ? selectedStages : stages).map((stage) => (\n                          <Droppable key={stage} id={stage}>\n                            <Card className=\"h-full transition-all duration-200 hover:shadow-md\">\n                              <CardHeader className=\"pb-3\">\n                                <CardTitle className=\"text-sm font-medium flex items-center justify-between\">\n                                  <span>{statusConfig[stage].label}</span>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Badge\n                                      variant=\"secondary\"\n                                      className={`${statusConfig[stage].color} transition-all duration-200`}\n                                    >\n                                      {laneGroupedQuotes[stage].length}\n                                    </Badge>\n                                    {wipLimits[stage] < 999 && laneGroupedQuotes[stage].length >= wipLimits[stage] && (\n                                      <AlertCircle className=\"h-4 w-4 text-destructive\" />\n                                    )}\n                                  </div>\n                                </CardTitle>\n                                {wipLimits[stage] < 999 && (\n                                  <div className=\"text-xs text-muted-foreground\">\n                                    Limit: {wipLimits[stage]}\n                                    {laneGroupedQuotes[stage].length > wipLimits[stage] && (\n                                      <span className=\"text-destructive ml-1\">\n                                        (+{laneGroupedQuotes[stage].length - wipLimits[stage]} over)\n                                      </span>\n                                    )}\n                                  </div>\n                                )}\n                              </CardHeader>\n                              <CardContent className=\"space-y-2 min-h-[200px]\">\n                                {laneGroupedQuotes[stage].map((quote) => (\n                                  <Draggable key={quote.id} id={quote.id}>\n                                    <Card\n                                      className=\"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1 animate-fade-in relative\"\n                                      onClick={(e) => {\n                                        if (bulkMode) {\n                                          e.stopPropagation();\n                                          toggleQuoteSelection(quote.id);\n                                        } else {\n                                          navigate(`/dashboard/quotes/${quote.id}`);\n                                        }\n                                      }}\n                                    >\n                                      <CardContent className=\"p-3 space-y-2\">\n                                        {bulkMode && (\n                                          <div className=\"absolute top-2 right-2 z-10\">\n                                            {selectedQuotes.has(quote.id) ? (\n                                              <CheckSquare className=\"h-4 w-4 text-primary\" />\n                                            ) : (\n                                              <Square className=\"h-4 w-4 text-muted-foreground\" />\n                                            )}\n                                          </div>\n                                        )}\n                                        <div className=\"font-medium text-sm\">{quote.quote_number}</div>\n                                        {quote.title && (\n                                          <div className=\"text-xs text-muted-foreground line-clamp-1\">{quote.title}</div>\n                                        )}\n                                        {showFields.account && quote.accounts?.name && (\n                                          <div className=\"text-xs text-muted-foreground\">{quote.accounts.name}</div>\n                                        )}\n                                        {showFields.opportunity && quote.opportunities?.name && (\n                                          <Badge variant=\"outline\" className=\"text-xs\">\n                                            {quote.opportunities.name}\n                                          </Badge>\n                                        )}\n                                        {showFields.value && quote.sell_price && (\n                                          <div className=\"text-xs font-semibold text-primary flex items-center gap-1\">\n                                            <DollarSign className=\"h-3 w-3\" />\n                                            {formatCurrency(quote.sell_price)}\n                                          </div>\n                                        )}\n                                        {showFields.margin && quote.margin_amount !== null && (\n                                          <div className=\"text-xs text-muted-foreground\">\n                                            Margin: {formatCurrency(quote.margin_amount)}\n                                            {quote.margin_percentage !== null && ` (${Math.round(quote.margin_percentage)}%)`}\n                                          </div>\n                                        )}\n                                        {showFields.validUntil && quote.valid_until && (\n                                          <div className=\"text-xs text-muted-foreground\">\n                                            Valid: {formatDate(quote.valid_until)}\n                                          </div>\n                                        )}\n                                      </CardContent>\n                                    </Card>\n                                  </Draggable>\n                                ))}\n                                {laneGroupedQuotes[stage].length === 0 && (\n                                  <div className=\"text-xs text-muted-foreground text-center py-4\">\n                                    No quotes in this stage\n                                  </div>\n                                )}\n                              </CardContent>\n                            </Card>\n                          </Droppable>\n                        ))}\n                      </div>\n                    </SwimLane>\n                  );\n                })}\n              </div>\n              <DragOverlay>\n                {activeQuote ? (\n                  <Card className=\"w-64 shadow-2xl rotate-3 scale-105 border-2 border-primary animate-scale-in\">\n                    <CardContent className=\"p-3 space-y-2 bg-gradient-to-br from-background to-muted\">\n                      <div className=\"font-medium text-sm\">{activeQuote.quote_number}</div>\n                      {activeQuote.title && (\n                        <div className=\"text-xs text-muted-foreground\">{activeQuote.title}</div>\n                      )}\n                      {activeQuote.sell_price && (\n                        <div className=\"text-xs font-semibold text-primary\">\n                          {formatCurrency(activeQuote.sell_price)}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                ) : null}\n              </DragOverlay>\n            </DndContext>\n          )}\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Reports.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/SecurityOverview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1875,1878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1875,1878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2416,2419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2416,2419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4437,4440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4437,4440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4738,4741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4738,4741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5169,5172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5169,5172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5486,5489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5486,5489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5840,5843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5840,5843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6278,6281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6278,6281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6891,6894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6891,6894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7825,7828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7825,7828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8013,8016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8013,8016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8435,8438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8435,8438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8877,8880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8877,8880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9420,9423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9420,9423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11068,11071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11068,11071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11920,11923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11920,11923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12245,12248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12245,12248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12291,12294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12291,12294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":342,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12616,12619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12616,12619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12747,12750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12747,12750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":355,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13000,13003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13000,13003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":380,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":380,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[13962,13962],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":386,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":386,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[14100,14100],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":392,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":392,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[14251,14251],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":398,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":398,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[14412,14412],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":410,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14917,14920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14917,14920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":414,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15156,15159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15156,15159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":422,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15456,15459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15456,15459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":427,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15606,15609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15606,15609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":428,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15695,15698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15695,15698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":433,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":433,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15857,15860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15857,15860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":437,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":437,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15955,15958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15955,15958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":441,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16156,16159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16156,16159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":448,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":448,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16432,16435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16432,16435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":490,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":490,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17941,17944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17941,17944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":651,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":651,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27137,27140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27137,27140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":813,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":813,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35584,35587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35584,35587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'runDataSearch'. Either include it or remove the dependency array.","line":503,"column":6,"nodeType":"ArrayExpression","endLine":503,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [selectedTableForSearch, dataPage, dataPageSize, runDataSearch]","fix":{"range":[18307,18355],"text":"[selectedTableForSearch, dataPage, dataPageSize, runDataSearch]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":4,"fatalErrorCount":0,"warningCount":33,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useState, useMemo } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/integrations/supabase/client';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Shield, Database, Lock, Terminal } from 'lucide-react';\nimport { RoleGuard } from '@/components/auth/RoleGuard';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCRM } from '@/hooks/useCRM';\nimport TenantConfigForm from './data-management/TenantConfigForm';\nimport FranchiseConfigForm from './data-management/FranchiseConfigForm';\nimport SequencesAndPreview from './data-management/SequencesAndPreview';\n\nexport default function SecurityOverview() {\n  const { toast } = useToast();\n  const location = useLocation();\n  const params = new URLSearchParams(location.search);\n  const tabParam = params.get('tab');\n  const initialTab = tabParam ?? 'sql';\n  const { supabase: crmSupabase, context } = useCRM();\n  const [sqlQuery, setSqlQuery] = useState('SELECT * FROM leads LIMIT 10;');\n  const [queryResult, setQueryResult] = useState<any>(null);\n  const [isExecuting, setIsExecuting] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(10);\n  const [minWidthCh, setMinWidthCh] = useState(8);\n  const [maxWidthCh, setMaxWidthCh] = useState(40);\n  const [stickyHeader, setStickyHeader] = useState(true);\n  // Database Tables explorer state\n  const [selectedTable, setSelectedTable] = useState<string | null>(null);\n  const [tableSearch, setTableSearch] = useState('');\n  const [tableRows, setTableRows] = useState<any[]>([]);\n  const [tableLoading, setTableLoading] = useState(false);\n  const [tableError, setTableError] = useState<string | null>(null);\n  // Horizontal scroll sync between top scrollbar and the main table container\n  const tableScrollRef = useRef<HTMLDivElement | null>(null);\n  const topScrollRef = useRef<HTMLDivElement | null>(null);\n  const [topScrollWidth, setTopScrollWidth] = useState<number>(0);\n\n  // Data Management local state\n  const [tenants, setTenants] = useState<Array<{ id: string; name: string }>>([]);\n  const [franchises, setFranchises] = useState<Array<{ id: string; name: string }>>([]);\n  const [tenantId, setTenantId] = useState<string | undefined>(context?.tenantId || undefined);\n  const [franchiseId, setFranchiseId] = useState<string | undefined>(context?.franchiseId || undefined);\n\n  useEffect(() => {\n    const loadTenants = async () => {\n      const { data } = await crmSupabase.from('tenants').select('id,name').eq('is_active', true).order('name');\n      setTenants(data || []);\n    };\n    loadTenants();\n  }, [crmSupabase]);\n\n  useEffect(() => {\n    const loadFranchises = async () => {\n      if (!tenantId) { setFranchises([]); return; }\n      const { data } = await crmSupabase\n        .from('franchises')\n        .select('id,name')\n        .eq('tenant_id', tenantId)\n        .eq('is_active', true)\n        .order('name');\n      setFranchises(data || []);\n    };\n    loadFranchises();\n  }, [crmSupabase, tenantId]);\n\n  const onTenantChange = (id: string) => {\n    setTenantId(id);\n    setFranchiseId(undefined);\n  };\n  const onFranchiseChange = (id: string) => setFranchiseId(id);\n\n  useEffect(() => {\n    const el = tableScrollRef.current;\n    if (!el) return;\n    // Mirror the table content width to the top scrollbar spacer\n    setTopScrollWidth(el.scrollWidth);\n  }, [queryResult, pageSize, currentPage, minWidthCh, maxWidthCh]);\n\n  const executeQuery = async () => {\n    setIsExecuting(true);\n    try {\n      const { data, error } = await supabase.rpc('execute_sql_query' as any, { \n        query_text: sqlQuery \n      });\n      \n      if (error) throw error;\n      \n      setQueryResult(data);\n      setCurrentPage(1);\n      toast({\n        title: 'Query executed',\n        description: `Returned ${Array.isArray(data) ? data.length : 0} rows`,\n      });\n    } catch (error: any) {\n      toast({\n        title: 'Query failed',\n        description: error.message,\n        variant: 'destructive',\n      });\n      setQueryResult({ error: error.message });\n    } finally {\n      setIsExecuting(false);\n    }\n  };\n\n  const { data: enums, isLoading: enumsLoading } = useQuery({\n    queryKey: ['security-enums'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_database_enums' as any);\n      if (error) throw error;\n      return data as unknown as Array<{ enum_type: string; labels: string }>;\n    }\n  });\n\n  const { data: rlsStatus, isLoading: rlsLoading } = useQuery({\n    queryKey: ['rls-status'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_rls_status' as any);\n      if (error) throw error;\n      return data as unknown as Array<{ table_name: string; rls_enabled: boolean; policy_count: number }>;\n    }\n  });\n\n  const { data: policies, isLoading: policiesLoading } = useQuery({\n    queryKey: ['rls-policies'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_rls_policies' as any);\n      if (error) throw error;\n      return data as unknown as Array<{\n        table_name: string;\n        policy_name: string;\n        command: string;\n        roles: string;\n        using_expression: string;\n      }>;\n    }\n  });\n\n  const { data: schema, isLoading: schemaLoading } = useQuery({\n    queryKey: ['database-schema'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_database_schema' as any);\n      if (error) throw error;\n      return data as unknown as Array<{\n        table_name: string;\n        column_name: string;\n        data_type: string;\n        is_nullable: boolean;\n        column_default: string | null;\n        is_primary_key: boolean;\n        is_foreign_key: boolean;\n        references_table: string | null;\n        references_column: string | null;\n      }>;\n    }\n  });\n\n  const { data: schemaTables, isLoading: schemaTablesLoading } = useQuery({\n    queryKey: ['database-tables'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_database_tables' as any);\n      if (error) throw error;\n      return data as unknown as Array<{\n        table_name: string;\n        table_type: string;\n        rls_enabled: boolean | null;\n        policy_count: number;\n        column_count: number;\n        index_count: number;\n        row_estimate: number | null;\n      }>;\n    }\n  });\n\n  // Auto-select first table when tables load\n  useEffect(() => {\n    if (!schemaTablesLoading && schemaTables && schemaTables.length > 0) {\n      if (!selectedTable) {\n        setSelectedTable(schemaTables[0].table_name);\n      }\n    }\n  }, [schemaTablesLoading, schemaTables, selectedTable]);\n\n  // Load rows for selected table\n  useEffect(() => {\n    (async () => {\n      if (!selectedTable) return;\n      setTableLoading(true);\n      setTableError(null);\n      try {\n        // Use dynamic table name with a loose type to avoid TS literal union overload errors\n        const { data, error } = await (supabase as any)\n          .from(selectedTable)\n          .select('*')\n          .limit(50);\n        if (error) throw error;\n        setTableRows(Array.isArray(data) ? data : []);\n      } catch (err: any) {\n        setTableError(err?.message || 'Failed to load table data');\n        setTableRows([]);\n      } finally {\n        setTableLoading(false);\n      }\n    })();\n  }, [selectedTable]);\n\n  const { data: schemaConstraints, isLoading: schemaConstraintsLoading } = useQuery({\n    queryKey: ['database-constraints'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_table_constraints' as any);\n      if (error) throw error;\n      return data as unknown as Array<{\n        table_name: string;\n        constraint_name: string;\n        constraint_type: string;\n        constraint_details: string;\n      }>;\n    }\n  });\n\n  const { data: schemaIndexes, isLoading: schemaIndexesLoading } = useQuery({\n    queryKey: ['database-indexes'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_table_indexes' as any);\n      if (error) throw error;\n      return data as unknown as Array<{\n        table_name: string;\n        index_name: string;\n        is_unique: boolean;\n        index_columns: string;\n        index_definition: string;\n      }>;\n    }\n  });\n\n  const { data: dbFunctions, isLoading: functionsLoading, error: functionsError } = useQuery({\n    queryKey: ['database-functions'],\n    queryFn: async () => {\n      // Primary: use dedicated RPC for listing functions\n      const { data, error } = await supabase.rpc('get_database_functions' as any);\n      if (!error) {\n        return (data ?? []) as unknown as Array<{\n          name: string;\n          schema: string;\n          kind: string;\n          return_type: string;\n          argument_types: string;\n          language: string;\n          volatility: string;\n          security_definer: boolean;\n          description: string | null;\n        }>;\n      }\n\n      // Fallback: query pg_catalog via safe read-only SQL RPC if the function isnt cached yet\n      const sql = `\n        SELECT\n          p.proname::text AS name,\n          n.nspname::text AS schema,\n          CASE p.prokind \n            WHEN 'f' THEN 'function' \n            WHEN 'p' THEN 'procedure' \n            WHEN 'a' THEN 'aggregate' \n            WHEN 'w' THEN 'window' \n            ELSE p.prokind::text \n          END AS kind,\n          pg_catalog.format_type(p.prorettype, NULL)::text AS return_type,\n          pg_catalog.pg_get_function_identity_arguments(p.oid)::text AS argument_types,\n          l.lanname::text AS language,\n          CASE p.provolatile \n            WHEN 'i' THEN 'immutable' \n            WHEN 's' THEN 'stable' \n            WHEN 'v' THEN 'volatile' \n            ELSE p.provolatile::text \n          END AS volatility,\n          p.prosecdef AS security_definer,\n          pg_catalog.obj_description(p.oid, 'pg_proc')::text AS description\n        FROM pg_proc p\n        JOIN pg_namespace n ON n.oid = p.pronamespace\n        JOIN pg_language l ON l.oid = p.prolang\n        WHERE n.nspname = 'public'\n        ORDER BY n.nspname, p.proname;\n      `;\n\n      const { data: fallbackData, error: fallbackError } = await supabase.rpc('execute_sql_query' as any, { query_text: sql });\n      if (fallbackError) {\n        // Surface the original error to the UI for clarity\n        throw error;\n      }\n\n      const rows = Array.isArray(fallbackData) ? fallbackData : [];\n      return rows as unknown as Array<{\n        name: string;\n        schema: string;\n        kind: string;\n        return_type: string;\n        argument_types: string;\n        language: string;\n        volatility: string;\n        security_definer: boolean;\n        description: string | null;\n      }>;\n    },\n    staleTime: 60_000,\n    retry: 1\n  });\n\n  // Full table search and data search state\n  const [schemaSearch, setSchemaSearch] = useState('');\n  const [selectedTableForSearch, setSelectedTableForSearch] = useState<string>('');\n  const [dataSearch, setDataSearch] = useState('');\n  const [dataResults, setDataResults] = useState<any[]>([]);\n  const [dataLoading, setDataLoading] = useState(false);\n  const [dataPage, setDataPage] = useState(1);\n  const [dataPageSize, setDataPageSize] = useState(20);\n  const [dataTotalCount, setDataTotalCount] = useState<number | null>(null);\n\n  const columnsByTable = useMemo(() => {\n    const grouped: Record<string, any[]> = {};\n    (schema || []).forEach((col: any) => {\n      const t = col.table_name;\n      if (!grouped[t]) grouped[t] = [];\n      grouped[t].push(col);\n    });\n    return grouped;\n  }, [schema]);\n\n  // Tailored filters per table\n  const [showFilters, setShowFilters] = useState(false);\n  const [tableFilters, setTableFilters] = useState<Record<string, Record<string, any>>>({});\n  const enumLabelsByType = useMemo(() => {\n    const map: Record<string, string[]> = {};\n    (enums || []).forEach((e: any) => {\n      const labels = String(e.labels || '')\n        .split(',')\n        .map((s) => s.trim())\n        .filter(Boolean);\n      map[e.enum_type] = labels;\n    });\n    return map;\n  }, [enums]);\n\n  const setFilterValue = (colName: string, patch: any) => {\n    setTableFilters((prev) => {\n      const table = selectedTableForSearch;\n      const existing = prev[table] || {};\n      const col = existing[colName] || {};\n      return { ...prev, [table]: { ...existing, [colName]: { ...col, ...patch } } };\n    });\n  };\n\n  const clearFiltersForCurrentTable = () => {\n    setTableFilters((prev) => ({ ...prev, [selectedTableForSearch]: {} }));\n  };\n\n  // Persist filters, selected table, and visibility\n  useEffect(() => {\n    try {\n      const json = localStorage.getItem('schema_table_filters');\n      if (json) {\n        const parsed = JSON.parse(json);\n        if (parsed && typeof parsed === 'object') setTableFilters(parsed);\n      }\n      const savedTable = localStorage.getItem('schema_selected_table');\n      if (savedTable) setSelectedTableForSearch(savedTable);\n      const savedShow = localStorage.getItem('schema_show_filters');\n      if (savedShow) setShowFilters(savedShow === 'true');\n    } catch {}\n  }, []);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem('schema_table_filters', JSON.stringify(tableFilters));\n    } catch {}\n  }, [tableFilters]);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem('schema_selected_table', selectedTableForSearch || '');\n    } catch {}\n  }, [selectedTableForSearch]);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem('schema_show_filters', showFilters ? 'true' : 'false');\n    } catch {}\n  }, [showFilters]);\n \n   const runDataSearch = async (pageOverride?: number) => {\n    if (!selectedTableForSearch) return;\n    const page = pageOverride ?? dataPage;\n    setDataLoading(true);\n    try {\n      const cols = columnsByTable[selectedTableForSearch] || [];\n      const q = dataSearch.trim();\n      const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(q);\n      const isNumber = q !== '' && !isNaN(Number(q));\n      const textCols = cols.filter((c: any) => {\n        const dt = String(c.data_type || '').toLowerCase();\n        return dt.includes('text') || dt.includes('character varying') || dt.includes('varchar') || dt.includes('uuid');\n      });\n      const numCols = cols.filter((c: any) => {\n        const dt = String(c.data_type || '').toLowerCase();\n        return dt === 'integer' || dt === 'bigint' || dt === 'numeric' || dt === 'double precision' || dt === 'real';\n      });\n\n      let segments: string[] = [];\n      if (q) {\n        segments = [\n          ...textCols.map((c: any) => `${c.column_name}.ilike.*${q}*`),\n        ];\n        if (isUUID) {\n          segments.push(\n            ...textCols\n              .filter((c: any) => String(c.data_type || '').toLowerCase().includes('uuid'))\n              .map((c: any) => `${c.column_name}.eq.${q}`)\n          );\n        }\n        if (isNumber) {\n          const numVal = Number(q);\n          segments.push(...numCols.map((c: any) => `${c.column_name}.eq.${numVal}`));\n        }\n      }\n\n      let query = (supabase.from as any)(selectedTableForSearch).select('*', { count: 'exact' });\n\n      // Apply typed filters (AND semantics)\n      const tableFilter = tableFilters[selectedTableForSearch] || {};\n      cols.forEach((c: any) => {\n        const fv = tableFilter[c.column_name];\n        if (!fv) return;\n        const dt = String(c.data_type || '').toLowerCase();\n\n        // Enumerations\n        if (fv.enumValue !== undefined && fv.enumValue !== '') {\n          query = query.eq(c.column_name as any, fv.enumValue);\n          return;\n        }\n\n        // Date/time range\n        if ((dt.includes('timestamp') || dt === 'date') && (fv.from || fv.to)) {\n          if (fv.from) query = query.gte(c.column_name, fv.from);\n          if (fv.to) query = query.lte(c.column_name, fv.to);\n          return;\n        }\n\n        // Numeric range\n        if (\n          dt === 'integer' || dt === 'bigint' || dt === 'smallint' || dt === 'numeric' || dt === 'double precision' || dt === 'real' || dt === 'decimal'\n        ) {\n          if (fv.min !== undefined && fv.min !== '') query = query.gte(c.column_name, Number(fv.min));\n          if (fv.max !== undefined && fv.max !== '') query = query.lte(c.column_name, Number(fv.max));\n          return;\n        }\n\n        // UUID equals\n        if (dt.includes('uuid')) {\n          if (fv.eq && fv.eq.trim()) query = query.eq(c.column_name, fv.eq.trim());\n          return;\n        }\n\n        // Text contains\n        if (fv.contains && fv.contains.trim()) {\n          query = query.ilike(c.column_name, `%${fv.contains.trim()}%`);\n        }\n      });\n\n      // Apply general search (OR across common columns)\n      if (segments.length) {\n        query = query.or(segments.join(','));\n      }\n      const from = (page - 1) * dataPageSize;\n      const to = from + dataPageSize - 1;\n      const { data, count, error } = await query.range(from, to);\n      if (error) throw error;\n      setDataResults(data || []);\n      setDataTotalCount(count ?? null);\n    } catch (error: any) {\n      toast({ title: 'Data search failed', description: error.message, variant: 'destructive' });\n      setDataResults([]);\n      setDataTotalCount(null);\n    } finally {\n      setDataLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (!selectedTableForSearch) return;\n    runDataSearch();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedTableForSearch, dataPage, dataPageSize]);\n\n  return (\n    <RoleGuard roles={['platform_admin', 'tenant_admin']} fallback={<div>Access denied</div>}>\n      <DashboardLayout>\n        <div className=\"space-y-6\">\n          <div className=\"flex items-center gap-3\">\n            <Shield className=\"h-8 w-8 text-primary\" />\n            <div>\n              <h1 className=\"text-3xl font-bold\">Security Overview</h1>\n              <p className=\"text-muted-foreground\">Database security configuration and policies</p>\n            </div>\n          </div>\n\n          <Tabs defaultValue={initialTab} className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"sql\">SQL Editor</TabsTrigger>\n          <TabsTrigger value=\"rls\">RLS Status</TabsTrigger>\n          <TabsTrigger value=\"policies\">Policies</TabsTrigger>\n          <TabsTrigger value=\"functions\">Functions</TabsTrigger>\n          <TabsTrigger value=\"enums\">Enums</TabsTrigger>\n          <TabsTrigger value=\"schema\">Schema</TabsTrigger>\n          <TabsTrigger value=\"tables\">Database Tables</TabsTrigger>\n          <TabsTrigger value=\"data-management\">Data Management</TabsTrigger>\n        </TabsList>\n\n            <TabsContent value=\"sql\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Terminal className=\"h-5 w-5\" />\n                    SQL Query Editor\n                  </CardTitle>\n                  <CardDescription>\n                    Execute read-only SQL queries (SELECT only)\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <Textarea\n                      value={sqlQuery}\n                      onChange={(e) => setSqlQuery(e.target.value)}\n                      placeholder=\"Enter your SQL query here...\"\n                      className=\"font-mono min-h-[200px]\"\n                    />\n                  </div>\n                  <Button \n                    onClick={executeQuery} \n                    disabled={isExecuting}\n                    className=\"w-full\"\n                  >\n                    {isExecuting ? 'Executing...' : 'Execute Query'}\n                  </Button>\n                  \n                  {queryResult && (\n                    <div className=\"mt-4\">\n                      <h4 className=\"font-semibold mb-2\">Database Query Result</h4>\n                      {queryResult.error ? (\n                        <div className=\"bg-destructive/10 text-destructive p-4 rounded-lg\">\n                          {queryResult.error}\n                        </div>\n                      ) : Array.isArray(queryResult) ? (\n                        <div className=\"space-y-3\">\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-4\">\n                              <div className=\"text-sm text-muted-foreground\">\n                                Showing {(queryResult.length === 0) ? 0 : Math.min(queryResult.length, (currentPage - 1) * pageSize + queryResult.slice((currentPage - 1) * pageSize, (currentPage - 1) * pageSize + pageSize).length)} of {queryResult.length} rows\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => setCurrentPage((p) => Math.max(1, p - 1))} disabled={currentPage <= 1}>Prev</Button>\n                                <span className=\"text-sm\">Page {currentPage} of {Math.max(1, Math.ceil((queryResult?.length || 0) / pageSize))}</span>\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => setCurrentPage((p) => Math.min(Math.ceil((queryResult?.length || 0) / pageSize), p + 1))} disabled={currentPage >= Math.ceil((queryResult?.length || 0) / pageSize)}>Next</Button>\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-4\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm text-muted-foreground\">Rows per page</span>\n                                <Select value={String(pageSize)} onValueChange={(v) => { setPageSize(Number(v)); setCurrentPage(1); }}>\n                                  <SelectTrigger className=\"w-[100px]\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"10\">10</SelectItem>\n                                    <SelectItem value=\"25\">25</SelectItem>\n                                    <SelectItem value=\"50\">50</SelectItem>\n                                    <SelectItem value=\"100\">100</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm text-muted-foreground\">Sticky header</span>\n                                <Switch checked={stickyHeader} onCheckedChange={setStickyHeader} />\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm text-muted-foreground\">Min col width</span>\n                                <Select value={String(minWidthCh)} onValueChange={(v) => { setMinWidthCh(Number(v)); }}>\n                                  <SelectTrigger className=\"w-[100px]\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"6\">6ch</SelectItem>\n                                    <SelectItem value=\"8\">8ch</SelectItem>\n                                    <SelectItem value=\"10\">10ch</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm text-muted-foreground\">Max col width</span>\n                                <Select value={String(maxWidthCh)} onValueChange={(v) => { setMaxWidthCh(Number(v)); }}>\n                                  <SelectTrigger className=\"w-[110px]\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    <SelectItem value=\"30\">30ch</SelectItem>\n                                    <SelectItem value=\"40\">40ch</SelectItem>\n                                    <SelectItem value=\"60\">60ch</SelectItem>\n                                    <SelectItem value=\"80\">80ch</SelectItem>\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                              \n                            </div>\n                          </div>\n                          {/* Top horizontal scrollbar synced with the table */}\n                          <div\n                            className=\"overflow-x-auto h-4 mt-2\"\n                            ref={topScrollRef}\n                            onScroll={(e) => {\n                              const src = e.currentTarget;\n                              if (tableScrollRef.current && Math.abs(tableScrollRef.current.scrollLeft - src.scrollLeft) > 1) {\n                                tableScrollRef.current.scrollLeft = src.scrollLeft;\n                              }\n                            }}\n                            aria-label=\"Horizontal scroll for result table\"\n                          >\n                            <div style={{ width: topScrollWidth }} />\n                          </div>\n                          <div\n                            className=\"border rounded-lg overflow-x-auto overflow-y-auto max-h-[400px]\"\n                            ref={tableScrollRef}\n                            onScroll={(e) => {\n                              const src = e.currentTarget;\n                              if (topScrollRef.current && Math.abs(topScrollRef.current.scrollLeft - src.scrollLeft) > 1) {\n                                topScrollRef.current.scrollLeft = src.scrollLeft;\n                              }\n                            }}\n                          >\n                            {(() => {\n                              const rows = queryResult as Array<Record<string, any>>;\n                              const headerSet = new Set<string>();\n                              rows.forEach(r => Object.keys(r || {}).forEach(k => headerSet.add(k)));\n                              const headers = Array.from(headerSet);\n                              const start = (currentPage - 1) * pageSize;\n                              const end = start + pageSize;\n                              const pageRows = rows.slice(start, end);\n\n                              // Compute dynamic column widths (in ch) based on longest content\n                              const minCh = minWidthCh;\n                              const maxCh = maxWidthCh;\n                              const widths: Record<string, number> = {};\n                              headers.forEach(h => {\n                                let longest = String(h).length;\n                                for (const row of rows) {\n                                  const v = row?.[h];\n                                  const s = v === null || v === undefined\n                                    ? ''\n                                    : typeof v === 'object'\n                                      ? JSON.stringify(v)\n                                      : String(v);\n                                  if (s.length > longest) longest = s.length;\n                                }\n                                widths[h] = Math.min(maxCh, Math.max(minCh, longest + 2));\n                              });\n                              return (\n                                <Table>\n                                  <TableHeader>\n                                    <TableRow>\n                                      {headers.length === 0 ? (\n                                        <TableHead></TableHead>\n                                      ) : headers.map((h) => (\n                                        <TableHead \n                                          key={h} \n                                          className={`whitespace-nowrap ${stickyHeader ? 'sticky top-0 z-10 bg-muted' : ''}`}\n                                          style={{ width: `${widths[h]}ch` }}\n                                        >\n                                          {h}\n                                        </TableHead>\n                                      ))}\n                                    </TableRow>\n                                  </TableHeader>\n                                  <TableBody>\n                                    {pageRows.length === 0 ? (\n                                      <TableRow>\n                                        <TableCell colSpan={Math.max(1, headers.length)} className=\"text-center text-muted-foreground\">No rows</TableCell>\n                                      </TableRow>\n                                    ) : (\n                                      pageRows.map((row, idx) => (\n                                        <TableRow key={idx}>\n                                          {headers.map((h) => (\n                                            <TableCell \n                                              key={h} \n                                              className=\"text-xs whitespace-nowrap\"\n                                              style={{ width: `${widths[h]}ch` }}\n                                            >\n                                              {row[h] === null || row[h] === undefined\n                                                ? ''\n                                                : typeof row[h] === 'object'\n                                                  ? JSON.stringify(row[h])\n                                                  : String(row[h])}\n                                            </TableCell>\n                                          ))}\n                                        </TableRow>\n                                      ))\n                                    )}\n                                  </TableBody>\n                                </Table>\n                              );\n                            })()}\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"border rounded-lg overflow-auto max-h-[400px]\">\n                          <pre className=\"p-4 text-xs\">\n                            {JSON.stringify(queryResult, null, 2)}\n                          </pre>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"data-management\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Database className=\"h-5 w-5\" />\n                    Data Management Options\n                  </CardTitle>\n                  <CardDescription>\n                    Configure quote numbering and preview sequences\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Context selectors */}\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div>\n                      <div className=\"text-sm font-medium mb-2\">Tenant</div>\n                      <Select onValueChange={onTenantChange} value={tenantId}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select tenant\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {tenants.map((t) => (\n                            <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <div className=\"text-sm font-medium mb-2\">Franchise (optional)</div>\n                      <Select onValueChange={onFranchiseChange} value={franchiseId}>\n                        <SelectTrigger>\n                          <SelectValue placeholder={tenantId ? 'Select franchise' : 'Select tenant first'} />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {franchises.map((f) => (\n                            <SelectItem key={f.id} value={f.id}>{f.name}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  <Tabs defaultValue=\"tenant\">\n                    <TabsList>\n                      <TabsTrigger value=\"tenant\">Tenant Config</TabsTrigger>\n                      <TabsTrigger value=\"franchise\">Franchise Config</TabsTrigger>\n                      <TabsTrigger value=\"preview\">Sequences & Preview</TabsTrigger>\n                    </TabsList>\n                    <TabsContent value=\"tenant\" className=\"mt-4\">\n                      <TenantConfigForm tenantIdOverride={tenantId} />\n                    </TabsContent>\n                    <TabsContent value=\"franchise\" className=\"mt-4\">\n                      <FranchiseConfigForm tenantIdOverride={tenantId} franchiseIdOverride={franchiseId} />\n                    </TabsContent>\n                    <TabsContent value=\"preview\" className=\"mt-4\">\n                      <SequencesAndPreview tenantIdOverride={tenantId} franchiseIdOverride={franchiseId} />\n                    </TabsContent>\n                  </Tabs>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"functions\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Database className=\"h-5 w-5\" />\n                    Database Functions & Procedures\n                  </CardTitle>\n                  <CardDescription>\n                    Implemented functions and procedures in the `public` schema\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {functionsLoading ? (\n                    <div>Loading...</div>\n                  ) : functionsError ? (\n                    <div className=\"text-destructive\">Failed to load functions: {(functionsError as any)?.message ?? 'Unknown error'}</div>\n                  ) : !dbFunctions || dbFunctions.length === 0 ? (\n                    <div className=\"text-muted-foreground\">No functions found</div>\n                  ) : (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Name</TableHead>\n                          <TableHead>Kind</TableHead>\n                          <TableHead>Return Type</TableHead>\n                          <TableHead>Arguments</TableHead>\n                          <TableHead>Language</TableHead>\n                          <TableHead>Volatility</TableHead>\n                          <TableHead>Security</TableHead>\n                          <TableHead>Description</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {dbFunctions?.map((fn) => (\n                          <TableRow key={`${fn.schema}.${fn.name}(${fn.argument_types})`}>\n                            <TableCell className=\"font-medium\">{fn.name}</TableCell>\n                            <TableCell>\n                              <Badge variant=\"outline\">{fn.kind}</Badge>\n                            </TableCell>\n                            <TableCell className=\"text-xs\">{fn.return_type}</TableCell>\n                            <TableCell className=\"text-xs break-all\">{fn.argument_types || ''}</TableCell>\n                            <TableCell>\n                              <Badge variant=\"secondary\">{fn.language}</Badge>\n                            </TableCell>\n                            <TableCell>\n                              <Badge variant=\"outline\">{fn.volatility}</Badge>\n                            </TableCell>\n                            <TableCell>\n                              <Badge variant={fn.security_definer ? 'default' : 'secondary'}>\n                                {fn.security_definer ? 'SECURITY DEFINER' : 'SECURITY INVOKER'}\n                              </Badge>\n                            </TableCell>\n                            <TableCell className=\"text-xs break-all\">{fn.description ?? ''}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"rls\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Lock className=\"h-5 w-5\" />\n                    Row Level Security Status\n                  </CardTitle>\n                  <CardDescription>\n                    Tables with RLS enabled and policy counts\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {rlsLoading ? (\n                    <div>Loading...</div>\n                  ) : (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Table Name</TableHead>\n                          <TableHead>RLS Enabled</TableHead>\n                          <TableHead>Policy Count</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {rlsStatus?.map((table) => (\n                          <TableRow key={table.table_name}>\n                            <TableCell className=\"font-medium\">{table.table_name}</TableCell>\n                            <TableCell>\n                              <Badge variant={table.rls_enabled ? 'default' : 'destructive'}>\n                                {table.rls_enabled ? 'Enabled' : 'Disabled'}\n                              </Badge>\n                            </TableCell>\n                            <TableCell>{table.policy_count}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"policies\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Shield className=\"h-5 w-5\" />\n                    RLS Policies\n                  </CardTitle>\n                  <CardDescription>\n                    All Row Level Security policies by table\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {policiesLoading ? (\n                    <div>Loading...</div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      <Input\n                        value={schemaSearch}\n                        onChange={(e) => setSchemaSearch(e.target.value)}\n                        placeholder=\"Search tables or columns...\"\n                        className=\"w-[280px]\"\n                      />\n                      <div className=\"flex flex-wrap items-center gap-2\">\n                        <Input\n                          value={schemaSearch}\n                          onChange={(e) => setSchemaSearch(e.target.value)}\n                          placeholder=\"Search tables or columns...\"\n                          className=\"w-[280px]\"\n                        />\n                        <Select value={selectedTableForSearch} onValueChange={setSelectedTableForSearch}>\n                          <SelectTrigger className=\"w-[240px]\">\n                            <SelectValue placeholder=\"Choose table\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {(schemaTables ? schemaTables.map((t) => t.table_name) : Object.keys(columnsByTable)).map((name) => (\n                              <SelectItem key={name} value={name}>{name}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <Input\n                          value={dataSearch}\n                          onChange={(e) => setDataSearch(e.target.value)}\n                          placeholder=\"Search table data...\"\n                          className=\"w-[280px]\"\n                          disabled={!selectedTableForSearch}\n                        />\n                        <Button\n                          onClick={() => { setDataPage(1); runDataSearch(1); }}\n                          disabled={!selectedTableForSearch || dataLoading}\n                        >\n                          {dataLoading ? 'Searching' : 'Search'}\n                        </Button>\n                      </div>\n                      <div className=\"border rounded-lg\">\n                        <div className=\"px-4 py-3 border-b bg-muted/30\">\n                          <span className=\"font-semibold\">Tables</span>\n                        </div>\n                        <div className=\"p-3 overflow-x-auto\">\n                          {schemaTablesLoading ? (\n                            <div>Loading...</div>\n                          ) : !schemaTables || schemaTables.length === 0 ? (\n                            <div className=\"text-muted-foreground\">No tables found</div>\n                          ) : (\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead>Name</TableHead>\n                                  <TableHead>Type</TableHead>\n                                  <TableHead>RLS</TableHead>\n                                  <TableHead>Policies</TableHead>\n                                  <TableHead>Columns</TableHead>\n                                  <TableHead>Indexes</TableHead>\n                                  <TableHead>Row Estimate</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {schemaTables?.map((t) => (\n                                  <TableRow key={t.table_name}>\n                                    <TableCell className=\"font-medium\">{t.table_name}</TableCell>\n                                    <TableCell><Badge variant=\"outline\">{t.table_type}</Badge></TableCell>\n                                    <TableCell>\n                                      {t.rls_enabled === null ? (\n                                        <span className=\"text-muted-foreground\"></span>\n                                      ) : (\n                                        <Badge variant={t.rls_enabled ? 'default' : 'destructive'}>\n                                          {t.rls_enabled ? 'Enabled' : 'Disabled'}\n                                        </Badge>\n                                      )}\n                                    </TableCell>\n                                    <TableCell>{t.policy_count}</TableCell>\n                                    <TableCell>{t.column_count}</TableCell>\n                                    <TableCell>{t.index_count}</TableCell>\n                                    <TableCell>{t.row_estimate ?? ''}</TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          )}\n                        </div>\n                      </div>\n\n                      <div className=\"border rounded-lg\">\n                        <div className=\"px-4 py-3 border-b bg-muted/30\">\n                          <span className=\"font-semibold\">Constraints</span>\n                        </div>\n                        <div className=\"p-3 overflow-x-auto\">\n                          {schemaConstraintsLoading ? (\n                            <div>Loading...</div>\n                          ) : !schemaConstraints || schemaConstraints.length === 0 ? (\n                            <div className=\"text-muted-foreground\">No constraints found</div>\n                          ) : (\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead>Table</TableHead>\n                                  <TableHead>Name</TableHead>\n                                  <TableHead>Type</TableHead>\n                                  <TableHead>Details</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {schemaConstraints?.map((c, idx) => (\n                                  <TableRow key={`${c.table_name}-${c.constraint_name}-${idx}`}>\n                                    <TableCell className=\"font-medium\">{c.table_name}</TableCell>\n                                    <TableCell>{c.constraint_name}</TableCell>\n                                    <TableCell><Badge variant=\"outline\">{c.constraint_type}</Badge></TableCell>\n                                    <TableCell className=\"text-xs break-all\">{c.constraint_details}</TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          )}\n                        </div>\n                      </div>\n\n                      <div className=\"border rounded-lg\">\n                        <div className=\"px-4 py-3 border-b bg-muted/30\">\n                          <span className=\"font-semibold\">Indexes</span>\n                        </div>\n                        <div className=\"p-3 overflow-x-auto\">\n                          {schemaIndexesLoading ? (\n                            <div>Loading...</div>\n                          ) : !schemaIndexes || schemaIndexes.length === 0 ? (\n                            <div className=\"text-muted-foreground\">No indexes found</div>\n                          ) : (\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead>Table</TableHead>\n                                  <TableHead>Index</TableHead>\n                                  <TableHead>Unique</TableHead>\n                                  <TableHead>Columns</TableHead>\n                                  <TableHead>Definition</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {schemaIndexes?.map((i, idx) => (\n                                  <TableRow key={`${i.table_name}-${i.index_name}-${idx}`}>\n                                    <TableCell className=\"font-medium\">{i.table_name}</TableCell>\n                                    <TableCell>{i.index_name}</TableCell>\n                                    <TableCell>\n                                      <Badge variant={i.is_unique ? 'default' : 'secondary'}>\n                                        {i.is_unique ? 'Yes' : 'No'}\n                                      </Badge>\n                                    </TableCell>\n                                    <TableCell className=\"text-xs\">{i.index_columns}</TableCell>\n                                    <TableCell className=\"text-xs break-all\">{i.index_definition}</TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"border rounded-lg\">\n                        <div className=\"px-4 py-3 border-b bg-muted/30\">\n                          <span className=\"font-semibold\">Tables</span>\n                        </div>\n                        <div className=\"p-3 overflow-x-auto\">\n                          {schemaTablesLoading ? (\n                            <div>Loading...</div>\n                          ) : (\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead>Name</TableHead>\n                                  <TableHead>Type</TableHead>\n                                  <TableHead>RLS</TableHead>\n                                  <TableHead>Policies</TableHead>\n                                  <TableHead>Columns</TableHead>\n                                  <TableHead>Indexes</TableHead>\n                                  <TableHead>Row Estimate</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {schemaTables?.map((t) => (\n                                  <TableRow key={t.table_name}>\n                                    <TableCell className=\"font-medium\">{t.table_name}</TableCell>\n                                    <TableCell><Badge variant=\"outline\">{t.table_type}</Badge></TableCell>\n                                    <TableCell>\n                                      {t.rls_enabled === null ? (\n                                        <span className=\"text-muted-foreground\"></span>\n                                      ) : (\n                                        <Badge variant={t.rls_enabled ? 'default' : 'destructive'}>\n                                          {t.rls_enabled ? 'Enabled' : 'Disabled'}\n                                        </Badge>\n                                      )}\n                                    </TableCell>\n                                    <TableCell>{t.policy_count}</TableCell>\n                                    <TableCell>{t.column_count}</TableCell>\n                                    <TableCell>{t.index_count}</TableCell>\n                                    <TableCell>{t.row_estimate ?? ''}</TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          )}\n                        </div>\n                      </div>\n\n                      <div className=\"border rounded-lg\">\n                        <div className=\"px-4 py-3 border-b bg-muted/30\">\n                          <span className=\"font-semibold\">Constraints</span>\n                        </div>\n                        <div className=\"p-3 overflow-x-auto\">\n                          {schemaConstraintsLoading ? (\n                            <div>Loading...</div>\n                          ) : (\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead>Table</TableHead>\n                                  <TableHead>Name</TableHead>\n                                  <TableHead>Type</TableHead>\n                                  <TableHead>Details</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {schemaConstraints?.map((c, idx) => (\n                                  <TableRow key={`${c.table_name}-${c.constraint_name}-${idx}`}>\n                                    <TableCell className=\"font-medium\">{c.table_name}</TableCell>\n                                    <TableCell>{c.constraint_name}</TableCell>\n                                    <TableCell><Badge variant=\"outline\">{c.constraint_type}</Badge></TableCell>\n                                    <TableCell className=\"text-xs break-all\">{c.constraint_details}</TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          )}\n                        </div>\n                      </div>\n\n                      <div className=\"border rounded-lg\">\n                        <div className=\"px-4 py-3 border-b bg-muted/30\">\n                          <span className=\"font-semibold\">Indexes</span>\n                        </div>\n                        <div className=\"p-3 overflow-x-auto\">\n                          {schemaIndexesLoading ? (\n                            <div>Loading...</div>\n                          ) : (\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead>Table</TableHead>\n                                  <TableHead>Index</TableHead>\n                                  <TableHead>Unique</TableHead>\n                                  <TableHead>Columns</TableHead>\n                                  <TableHead>Definition</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {schemaIndexes?.map((i, idx) => (\n                                  <TableRow key={`${i.table_name}-${i.index_name}-${idx}`}>\n                                    <TableCell className=\"font-medium\">{i.table_name}</TableCell>\n                                    <TableCell>{i.index_name}</TableCell>\n                                    <TableCell>\n                                      <Badge variant={i.is_unique ? 'default' : 'secondary'}>\n                                        {i.is_unique ? 'Yes' : 'No'}\n                                      </Badge>\n                                    </TableCell>\n                                    <TableCell className=\"text-xs\">{i.index_columns}</TableCell>\n                                    <TableCell className=\"text-xs break-all\">{i.index_definition}</TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          )}\n                        </div>\n                      </div>\n                      {Object.entries(\n                        policies?.reduce((acc, policy) => {\n                          if (!acc[policy.table_name]) acc[policy.table_name] = [];\n                          acc[policy.table_name].push(policy);\n                          return acc;\n                        }, {} as Record<string, typeof policies>) || {}\n                      ).map(([tableName, tablePolicies]) => (\n                        <div key={tableName} className=\"border rounded-lg p-4\">\n                          <h3 className=\"font-semibold text-lg mb-3\">{tableName}</h3>\n                          <div className=\"space-y-3\">\n                            {tablePolicies.map((policy, idx) => (\n                              <div key={idx} className=\"border-l-2 border-primary pl-3\">\n                                <div className=\"flex items-center gap-2 mb-1\">\n                                  <span className=\"font-medium\">{policy.policy_name}</span>\n                                  <Badge variant=\"outline\">{policy.command}</Badge>\n                                  <Badge variant=\"secondary\">{policy.roles}</Badge>\n                                </div>\n                                <code className=\"text-xs text-muted-foreground block\">\n                                  {policy.using_expression}\n                                </code>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"enums\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Database className=\"h-5 w-5\" />\n                    Database Enums\n                  </CardTitle>\n                  <CardDescription>\n                    Custom enum types and their values\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {enumsLoading ? (\n                    <div>Loading...</div>\n                  ) : (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Enum Type</TableHead>\n                          <TableHead>Values</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {enums?.map((enumType) => (\n                          <TableRow key={enumType.enum_type}>\n                            <TableCell className=\"font-medium\">{enumType.enum_type}</TableCell>\n                            <TableCell>\n                              <div className=\"flex flex-wrap gap-1\">\n                                {enumType.labels.split(', ').map((label) => (\n                                  <Badge key={label} variant=\"outline\">{label}</Badge>\n                                ))}\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n        <TabsContent value=\"schema\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Database className=\"h-5 w-5\" />\n                    Database Schema\n                  </CardTitle>\n                  <CardDescription>\n                    Tables, columns, constraints, and indexes\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {schemaLoading ? (\n                    <div>Loading...</div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      <Input\n                        value={schemaSearch}\n                        onChange={(e) => setSchemaSearch(e.target.value)}\n                        placeholder=\"Search tables or columns...\"\n                        className=\"w-[280px]\"\n                      />\n                      <div className=\"flex flex-wrap items-center gap-2 mt-2\">\n                        <Select value={selectedTableForSearch} onValueChange={setSelectedTableForSearch}>\n                          <SelectTrigger className=\"w-[240px]\">\n                            <SelectValue placeholder=\"Choose table\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {(schemaTables ? schemaTables.map((t) => t.table_name) : Object.keys(columnsByTable)).map((name) => (\n                              <SelectItem key={name} value={name}>{name}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <Input\n                          value={dataSearch}\n                          onChange={(e) => setDataSearch(e.target.value)}\n                          placeholder=\"Search table data...\"\n                          className=\"w-[280px]\"\n                          disabled={!selectedTableForSearch}\n                        />\n                        <Button\n                          onClick={() => { setDataPage(1); runDataSearch(1); }}\n                          disabled={!selectedTableForSearch || dataLoading}\n                        >\n                          {dataLoading ? 'Searching' : 'Search'}\n                        </Button>\n                      </div>\n                      {Object.entries(columnsByTable)\n                        .filter(([tableName, columns]) => {\n                          const q = schemaSearch.trim().toLowerCase();\n                          if (!q) return true;\n                          return (\n                            tableName.toLowerCase().includes(q) ||\n                            columns.some((col) => col.column_name.toLowerCase().includes(q))\n                          );\n                        })\n                        .map(([tableName, columns]) => (\n                        <div key={tableName} className=\"border rounded-lg\">\n                          <div className=\"px-4 py-3 border-b bg-muted/30\">\n                            <span className=\"font-semibold\">{tableName}</span>\n                          </div>\n                          <div className=\"p-3 overflow-x-auto\">\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  <TableHead>Column</TableHead>\n                                  <TableHead>Type</TableHead>\n                                  <TableHead>Nullable</TableHead>\n                                  <TableHead>Default</TableHead>\n                                  <TableHead>Keys</TableHead>\n                                  <TableHead>References</TableHead>\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {columns?.map((col, idx) => (\n                                  <TableRow key={`${tableName}-${col.column_name}-${idx}`}>\n                                    <TableCell className=\"font-medium\">{col.column_name}</TableCell>\n                                    <TableCell>\n                                      <Badge variant=\"outline\">{col.data_type}</Badge>\n                                    </TableCell>\n                                    <TableCell>{col.is_nullable ? 'YES' : 'NO'}</TableCell>\n                                    <TableCell className=\"text-xs break-all\">{col.column_default ?? ''}</TableCell>\n                                    <TableCell>\n                                      <div className=\"flex gap-1 flex-wrap\">\n                                        {col.is_primary_key && (\n                                          <Badge variant=\"default\">PK</Badge>\n                                        )}\n                                        {col.is_foreign_key && (\n                                          <Badge variant=\"secondary\">FK</Badge>\n                                        )}\n                                      </div>\n                                    </TableCell>\n                                    <TableCell>\n                                      {col.references_table ? (\n                                        <div className=\"flex items-center gap-1\">\n                                          <Badge variant=\"outline\">{col.references_table}</Badge>\n                                          <span className=\"text-xs text-muted-foreground\">{col.references_column}</span>\n                                        </div>\n                                      ) : (\n                                        <span className=\"text-muted-foreground\"></span>\n                                      )}\n                                    </TableCell>\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n        </TabsContent>\n\n        {/* Database Tables Explorer */}\n        <TabsContent value=\"tables\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle>Database Tables</CardTitle>\n                  <CardDescription>Select a table to view rows</CardDescription>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-3 gap-4\">\n                {/* Explorer list */}\n                <div className=\"col-span-1\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Input\n                      placeholder=\"Search tables\"\n                      value={tableSearch}\n                      onChange={(e) => setTableSearch(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"border rounded h-80 overflow-auto\">\n                    {schemaTablesLoading ? (\n                      <div className=\"p-3 text-sm text-muted-foreground\">Loading tables...</div>\n                    ) : !schemaTables || schemaTables.length === 0 ? (\n                      <div className=\"p-3 text-sm text-muted-foreground\">No tables found</div>\n                    ) : (\n                      (schemaTables\n                        .filter(t => t.table_name.toLowerCase().includes(tableSearch.toLowerCase()))\n                        .map((t) => (\n                          <button\n                            key={t.table_name}\n                            className={`w-full text-left px-3 py-2 border-b hover:bg-muted ${selectedTable === t.table_name ? 'bg-muted' : ''}`}\n                            onClick={() => setSelectedTable(t.table_name)}\n                          >\n                            <div className=\"flex items-center justify-between\">\n                              <span className=\"font-medium\">{t.table_name}</span>\n                              <Badge variant=\"outline\" className=\"ml-2\">{t.row_estimate ?? 0}</Badge>\n                            </div>\n                            <div className=\"text-xs text-muted-foreground\">\n                              {t.table_type}  {t.column_count} cols  {t.index_count} idx\n                            </div>\n                          </button>\n                        )))\n                    )}\n                  </div>\n                </div>\n\n                {/* Data viewer */}\n                <div className=\"col-span-2\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div>\n                      <div className=\"text-sm text-muted-foreground\">Selected table</div>\n                      <div className=\"text-lg font-semibold\">{selectedTable || '-'}</div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Button variant=\"outline\" onClick={() => selectedTable && setSelectedTable(selectedTable)} disabled={!selectedTable || tableLoading}>Refresh</Button>\n                    </div>\n                  </div>\n                  <div className=\"border rounded overflow-auto\">\n                    {tableLoading ? (\n                      <div className=\"p-3 text-sm text-muted-foreground\">Loading rows...</div>\n                    ) : tableError ? (\n                      <div className=\"p-3 text-sm text-destructive\">{tableError}</div>\n                    ) : !tableRows || tableRows.length === 0 ? (\n                      <div className=\"p-3 text-sm text-muted-foreground\">No rows found</div>\n                    ) : (\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            {Object.keys(tableRows[0]).map((col) => (\n                              <TableHead key={col} className=\"whitespace-nowrap\">{col}</TableHead>\n                            ))}\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {tableRows.map((row, idx) => (\n                            <TableRow key={idx}>\n                              {Object.keys(tableRows[0]).map((col) => (\n                                <TableCell key={col}>\n                                  {row[col] === null || row[col] === undefined\n                                    ? ''\n                                    : typeof row[col] === 'object'\n                                      ? JSON.stringify(row[col])\n                                      : String(row[col])}\n                                </TableCell>\n                              ))}\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n          </Tabs>\n        </div>\n      </DashboardLayout>\n    </RoleGuard>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ServiceTypeMappings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchMappings', 'fetchServices', 'fetchTenants', and 'fetchTypes'. Either include them or remove the dependency array.","line":128,"column":6,"nodeType":"ArrayExpression","endLine":128,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMappings, fetchServices, fetchTenants, fetchTypes, isPlatform, tenantId]","fix":{"range":[5483,5505],"text":"[fetchMappings, fetchServices, fetchTenants, fetchTypes, isPlatform, tenantId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'resolveCandidateTypes'. Either include it or remove the dependency array.","line":283,"column":6,"nodeType":"ArrayExpression","endLine":283,"endColumn":55,"suggestions":[{"desc":"Update the dependencies array to be: [newType, resolveCandidateTypes, services, isPlatform, selectedTenantId]","fix":{"range":[12110,12159],"text":"[newType, resolveCandidateTypes, services, isPlatform, selectedTenantId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'resolveCandidateTypes'. Either include it or remove the dependency array.","line":294,"column":6,"nodeType":"ArrayExpression","endLine":294,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [editType, resolveCandidateTypes, services, isPlatform, editTenantId]","fix":{"range":[12559,12605],"text":"[editType, resolveCandidateTypes, services, isPlatform, editTenantId]"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchServices', 'isPlatform', and 'open'. Either include them or remove the dependency array.","line":157,"column":6,"nodeType":"ArrayExpression","endLine":157,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [fetchServices, isPlatform, open, selectedTenantId]","fix":{"range":[6565,6583],"text":"[fetchServices, isPlatform, open, selectedTenantId]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Input } from '@/components/ui/input';\nimport { Switch } from '@/components/ui/switch';\nimport { Badge } from '@/components/ui/badge';\nimport { Trash2, Plus, Pencil } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport type { Json } from '@/integrations/supabase/types';\n\ntype MappingRow = {\n  id: string;\n  tenant_id: string;\n  service_type: 'ocean' | 'air' | 'trucking' | 'courier' | 'moving' | 'railway_transport' | string;\n  service_id: string;\n  is_default: boolean;\n  priority: number;\n  conditions: Json | null;\n  is_active: boolean;\n};\n\nconst FALLBACK_SERVICE_TYPES = ['ocean', 'air', 'trucking', 'courier', 'moving', 'railway_transport'] as const;\n\nexport default function ServiceTypeMappings() {\n  const { supabase, context } = useCRM();\n  const [mappings, setMappings] = useState<MappingRow[]>([]);\n  type ServiceRow = {\n    id: string;\n    service_name: string;\n    service_type: string;\n    tenant_id: string;\n    is_active: boolean;\n  };\n  const [services, setServices] = useState<ServiceRow[]>([]);\n  const [typeOptions, setTypeOptions] = useState<{ name: string; is_active: boolean }[]>([]);\n  const [open, setOpen] = useState(false);\n  const [tenants, setTenants] = useState<{ id: string; name?: string }[]>([]);\n  const [selectedTenantId, setSelectedTenantId] = useState<string>('');\n  const [newType, setNewType] = useState<string>('');\n  const [newServiceId, setNewServiceId] = useState<string>('');\n  const [newIsDefault, setNewIsDefault] = useState<boolean>(false);\n  const [newPriority, setNewPriority] = useState<number>(0);\n  const [newConditions, setNewConditions] = useState<string>('{}');\n  const [newIsActive, setNewIsActive] = useState<boolean>(true);\n  const [editOpen, setEditOpen] = useState(false);\n  const [editingRow, setEditingRow] = useState<MappingRow | null>(null);\n  const [editTenantId, setEditTenantId] = useState<string>('');\n  const [editType, setEditType] = useState<string>('');\n  const [editServiceId, setEditServiceId] = useState<string>('');\n  const [editIsDefault, setEditIsDefault] = useState<boolean>(false);\n  const [editPriority, setEditPriority] = useState<number>(0);\n  const [editConditions, setEditConditions] = useState<string>('{}');\n  const [editIsActive, setEditIsActive] = useState<boolean>(true);\n  // Search / filter / sort for listing\n  const [search, setSearch] = useState('');\n  const [statusFilter, setStatusFilter] = useState<'all'|'active'|'inactive'>('all');\n  const [typeFilter, setTypeFilter] = useState<string>('all');\n  const [listTenantFilter, setListTenantFilter] = useState<string>('all');\n  const [sortKey, setSortKey] = useState<'priority'|'type'|'service'|'status'|'default'>('priority');\n  const [sortDir, setSortDir] = useState<'asc'|'desc'>('desc');\n\n  // Map friendly labels to canonical codes used by services.service_type, else use the label.\n  const toCanonicalType = (name: string) => {\n    const n = String(name || '').trim().toLowerCase();\n    const direct: Record<string,string> = {\n      'ocean': 'ocean',\n      'ocean freight': 'ocean',\n      'sea': 'ocean',\n      'sea freight': 'ocean',\n      'sea cargo': 'ocean',\n      'air': 'air',\n      'air freight': 'air',\n      'air cargo': 'air',\n      'trucking': 'trucking',\n      'inland trucking': 'trucking',\n      'truck': 'trucking',\n      'road': 'trucking',\n      'road transport': 'trucking',\n      'road freight': 'trucking',\n      'courier': 'courier',\n      'courier service': 'courier',\n      'express': 'courier',\n      'express delivery': 'courier',\n      'express_delivery': 'courier',\n      'parcel': 'courier',\n      'moving': 'moving',\n      'moving service': 'moving',\n      'movers': 'moving',\n      'movers packers': 'moving',\n      'packers and movers': 'moving',\n      'rail': 'railway_transport',\n      'railway': 'railway_transport',\n      'railway transport': 'railway_transport',\n      'rail transport': 'railway_transport',\n    };\n    return direct[n] || String(name);\n  };\n  const selectTypeOptions = useMemo(() => {\n    const names = (typeOptions.length > 0 ? typeOptions.map(t => t.name) : Array.from(FALLBACK_SERVICE_TYPES));\n    const seen: Record<string,boolean> = {};\n    const opts = names.map((label) => {\n      const value = toCanonicalType(label);\n      // Deduplicate by value to avoid multiple synonyms\n      if (seen[value]) return null;\n      seen[value] = true;\n      return { value, label };\n    }).filter(Boolean) as { value: string; label: string }[];\n    return opts.length > 0 ? opts : Array.from(FALLBACK_SERVICE_TYPES).map(v => ({ value: v, label: v }));\n  }, [typeOptions]);\n\n  const isPlatform = context.isPlatformAdmin;\n  const tenantId = context.tenantId || null;\n\n  useEffect(() => {\n    if (isPlatform || tenantId) {\n      fetchServices();\n      fetchMappings();\n    }\n    fetchTypes();\n    if (isPlatform) {\n      fetchTenants();\n    }\n  }, [isPlatform, tenantId]);\n\n  const fetchServices = async () => {\n    try {\n      let query = supabase\n        .from('services')\n        .select('id, service_name, service_type, tenant_id, is_active');\n      if (!isPlatform) {\n        query = query.eq('tenant_id', tenantId as string);\n      } else if (selectedTenantId) {\n        // Scope to selected tenant for admins to reduce payload and ensure correct filtering\n        query = query.eq('tenant_id', selectedTenantId);\n      }\n      const { data, error } = await query.order('service_name');\n      if (error) throw error;\n      setServices((data || []) as ServiceRow[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch services:', message);\n      toast.error('Failed to fetch services', { description: message });\n    }\n  };\n\n  useEffect(() => {\n    // When platform admin changes selected tenant, refetch services\n    if (isPlatform && open) {\n      fetchServices();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedTenantId]);\n\n  const fetchMappings = async () => {\n    try {\n      let query = supabase\n        .from('service_type_mappings')\n        .select('*');\n      if (!isPlatform) query = query.eq('tenant_id', tenantId as string);\n      const { data, error } = await query.order('service_type').order('priority', { ascending: false });\n      if (error) throw error;\n      const rows = Array.isArray(data) ? (data as MappingRow[]) : [];\n      setMappings(rows);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch mappings:', message);\n      toast.error('Failed to fetch mappings', { description: message });\n    }\n  };\n\n  const fetchTypes = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('service_types')\n        .select('name, is_active')\n        .eq('is_active', true)\n        .order('name');\n      if (error) throw error;\n      setTypeOptions((data || []) as { name: string; is_active: boolean }[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch service types:', message);\n    }\n  };\n\n  const fetchTenants = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tenants')\n        .select('id, name')\n        .order('name');\n      if (error) throw error;\n      setTenants((data || []) as { id: string; name?: string }[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch tenants:', message);\n      toast.error('Failed to fetch tenants', { description: message });\n    }\n  };\n\n  const serviceById = useMemo(() => {\n    const map: Record<string, ServiceRow> = {};\n    services.forEach((s) => { map[String(s.id)] = s; });\n    return map;\n  }, [services]);\n  const tenantNameById = useMemo(() => {\n    const map: Record<string, string> = {};\n    tenants.forEach((t) => { map[String(t.id)] = String(t.name || t.id?.slice(0,8)); });\n    return map;\n  }, [tenants]);\n\n  const visibleMappings = useMemo(() => {\n    const term = search.trim().toLowerCase();\n    const filtered = (mappings || []).filter((m) => {\n      const svc = serviceById[String(m.service_id)];\n      const name = String(svc?.service_name || '');\n      const matchesSearch = term === ''\n        ? true\n        : [name, m.service_type].some(v => String(v).toLowerCase().includes(term));\n      const matchesStatus = statusFilter === 'all' ? true : statusFilter === 'active' ? m.is_active : !m.is_active;\n      const matchesType = typeFilter === 'all' ? true : m.service_type === typeFilter;\n      const matchesTenant = !isPlatform ? true : (listTenantFilter === 'all' ? true : m.tenant_id === listTenantFilter);\n      return matchesSearch && matchesStatus && matchesType && matchesTenant;\n    });\n    const cmp = (a: MappingRow, b: MappingRow) => {\n      let av: string | number; let bv: string | number;\n      if (sortKey === 'priority') { av = a.priority; bv = b.priority; }\n      else if (sortKey === 'type') { av = String(a.service_type).toLowerCase(); bv = String(b.service_type).toLowerCase(); }\n      else if (sortKey === 'service') {\n        av = String(serviceById[String(a.service_id)]?.service_name || '').toLowerCase();\n        bv = String(serviceById[String(b.service_id)]?.service_name || '').toLowerCase();\n      } else if (sortKey === 'status') { av = a.is_active ? 1 : 0; bv = b.is_active ? 1 : 0; }\n      else { av = a.is_default ? 1 : 0; bv = b.is_default ? 1 : 0; }\n      const base = av < bv ? -1 : av > bv ? 1 : 0;\n      return sortDir === 'asc' ? base : -base;\n    };\n    return filtered.sort(cmp);\n  }, [mappings, serviceById, search, statusFilter, typeFilter, listTenantFilter, sortKey, sortDir, isPlatform]);\n\n  // Candidate canonical service types to show for a selected friendly type label\n  const candidateTypesFor = useMemo(() => {\n    const map: Record<string, string[]> = {\n      'freight forwarding': ['ocean','air','trucking','courier','railway_transport'],\n      'customs clearance': ['ocean','air','trucking','courier','railway_transport'],\n      'inland_waterway': ['ocean','trucking','railway_transport'],\n      'inland waterway': ['ocean','trucking','railway_transport'],\n      'express_delivery': ['courier','air'],\n      'express delivery': ['courier','air'],\n      'warehouse': ['moving','trucking'],\n      'warehousing': ['moving','trucking'],\n      'distribution': ['trucking','courier'],\n      'last mile': ['courier','trucking'],\n    };\n    return map;\n  }, []);\n\n  const resolveCandidateTypes = (labelOrValue: string) => {\n    const key = String(labelOrValue || '').trim().toLowerCase();\n    const direct = candidateTypesFor[key];\n    if (direct && direct.length > 0) return direct;\n    const canonical = toCanonicalType(labelOrValue);\n    if (canonical) return [canonical];\n    // Fallback to all common modes\n    return Array.from(FALLBACK_SERVICE_TYPES);\n  };\n\n  const filteredServicesForType = useMemo(() => {\n    if (!newType) return [];\n    const candidates = resolveCandidateTypes(newType);\n    const byType = services.filter((s) => candidates.includes(String(s.service_type)));\n    if (isPlatform) {\n      // When platform admin, scope by selected tenant if provided\n      if (selectedTenantId) return byType.filter((s) => String(s.tenant_id) === String(selectedTenantId));\n      // No tenant selected: do not show services to force tenant scoping\n      return [];\n    }\n    return byType;\n  }, [services, newType, isPlatform, selectedTenantId]);\n\n  const filteredEditServicesForType = useMemo(() => {\n    if (!editType) return [];\n    const candidates = resolveCandidateTypes(editType);\n    const byType = services.filter((s) => candidates.includes(String(s.service_type)));\n    if (isPlatform) {\n      if (editTenantId) return byType.filter((s) => String(s.tenant_id) === String(editTenantId));\n      return [];\n    }\n    return byType;\n  }, [services, editType, isPlatform, editTenantId]);\n\n  const resetForm = () => {\n    setNewType('');\n    setNewServiceId('');\n    setNewIsDefault(false);\n    setNewPriority(0);\n    setNewConditions('{}');\n    setNewIsActive(true);\n    if (isPlatform) setSelectedTenantId('');\n  };\n\n  const resetEditForm = () => {\n    setEditingRow(null);\n    setEditTenantId('');\n    setEditType('');\n    setEditServiceId('');\n    setEditIsDefault(false);\n    setEditPriority(0);\n    setEditConditions('{}');\n    setEditIsActive(true);\n  };\n\n  const handleCreate = async () => {\n    try {\n      const tId = isPlatform ? selectedTenantId : (tenantId as string);\n      if (!tId) {\n        toast.error('No tenant context found');\n        return;\n      }\n      if (!newType || !newServiceId) {\n        toast.error('Please select type and service');\n        return;\n      }\n      let conditionsObj: Json = {};\n      try {\n        const parsed = JSON.parse(newConditions || '{}');\n        conditionsObj = typeof parsed === 'object' && parsed !== null ? parsed : {};\n      } catch (jsonErr) {\n        toast.error('Conditions must be valid JSON');\n        return;\n      }\n      const payload = {\n        tenant_id: tId,\n        service_type: newType,\n        service_id: newServiceId,\n        is_default: newIsDefault,\n        priority: newPriority,\n        conditions: conditionsObj,\n        is_active: newIsActive,\n      } as const;\n      const { error } = await supabase.from('service_type_mappings').insert(payload);\n      if (error) throw error;\n      toast.success('Mapping created');\n      setOpen(false);\n      resetForm();\n      fetchMappings();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to create mapping:', message);\n      toast.error('Failed to create mapping', { description: message });\n    }\n  };\n\n  const handleToggleDefault = async (row: MappingRow, next: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('service_type_mappings')\n        .update({ is_default: next })\n        .eq('id', row.id);\n      if (error) throw error;\n      fetchMappings();\n    } catch (err: unknown) {\n      const msg = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update default', { description: msg });\n      // Unique default constraint may fail; refresh to reflect current state\n      fetchMappings();\n    }\n  };\n\n  const handleToggleActive = async (row: MappingRow, next: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('service_type_mappings')\n        .update({ is_active: next })\n        .eq('id', row.id);\n      if (error) throw error;\n      fetchMappings();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update status', { description: message });\n    }\n  };\n\n  const handleDelete = async (row: MappingRow) => {\n    try {\n      const { error } = await supabase\n        .from('service_type_mappings')\n        .delete()\n        .eq('id', row.id);\n      if (error) throw error;\n      toast.success('Mapping deleted');\n      fetchMappings();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to delete mapping', { description: message });\n    }\n  };\n\n  const openEdit = (row: MappingRow) => {\n    setEditingRow(row);\n    setEditTenantId(String(row.tenant_id));\n    setEditType(String(row.service_type));\n    setEditServiceId(String(row.service_id));\n    setEditIsDefault(row.is_default);\n    setEditPriority(Number(row.priority) || 0);\n    setEditConditions(JSON.stringify(row.conditions || {}));\n    setEditIsActive(row.is_active);\n    setEditOpen(true);\n  };\n\n  const handleUpdate = async () => {\n    try {\n      if (!editingRow) return;\n      if (!editType || !editServiceId) {\n        toast.error('Please select type and service');\n        return;\n      }\n      let conditionsObj: Json = {};\n      try {\n        const parsed = JSON.parse(editConditions || '{}');\n        conditionsObj = typeof parsed === 'object' && parsed !== null ? parsed : {};\n      } catch (jsonErr) {\n        toast.error('Conditions must be valid JSON');\n        return;\n      }\n      const payload = {\n        service_type: editType,\n        service_id: editServiceId,\n        is_default: editIsDefault,\n        priority: editPriority,\n        conditions: conditionsObj,\n        is_active: editIsActive,\n      } as const;\n      const { error } = await supabase\n        .from('service_type_mappings')\n        .update(payload)\n        .eq('id', editingRow.id);\n      if (error) throw error;\n      toast.success('Mapping updated');\n      setEditOpen(false);\n      resetEditForm();\n      fetchMappings();\n    } catch (err: unknown) {\n      const msg = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update mapping', { description: msg });\n      fetchMappings();\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Service Type Mappings</h1>\n          <p className=\"text-muted-foreground\">Configure which services are eligible for each service type and set defaults.</p>\n        </div>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <div>\n              <CardTitle>Mappings</CardTitle>\n              <CardDescription>Tenant-scoped mapping rules for service selection.</CardDescription>\n            </div>\n            <Dialog open={open} onOpenChange={(v) => { setOpen(v); if (!v) resetForm(); }}>\n              <DialogTrigger asChild>\n                <Button>\n                  <Plus className=\"mr-2 h-4 w-4\" /> Add Mapping\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Create Mapping</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  {isPlatform && (\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Tenant</label>\n                      <Select value={selectedTenantId} onValueChange={(v) => { setSelectedTenantId(v); setNewServiceId(''); }}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a tenant\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {tenants.length === 0 ? (\n                            <div className=\"px-3 py-2 text-sm text-muted-foreground\">No tenants found</div>\n                          ) : (\n                            tenants.map((t) => (\n                              <SelectItem key={t.id} value={t.id}>\n                                <div className=\"flex items-center gap-2\">\n                                  <span>{t.name || String(t.id).slice(0,8)}</span>\n                                  <span className=\"text-xs text-muted-foreground\">{String(t.id).slice(0,8)}</span>\n                                </div>\n                              </SelectItem>\n                            ))\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Service Type</label>\n                      <Select value={newType} onValueChange={(v) => { setNewType(v); setNewServiceId(''); }}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select a type\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {selectTypeOptions.map((opt) => (\n                            <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Service</label>\n                      <Select value={newServiceId} onValueChange={setNewServiceId} disabled={!newType || (isPlatform && !selectedTenantId)}>\n                        <SelectTrigger>\n                          <SelectValue placeholder={!newType ? 'Choose type first' : (isPlatform && !selectedTenantId ? 'Choose tenant first' : 'Select service')} />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {filteredServicesForType.length === 0 ? (\n                            <div className=\"px-3 py-2 text-sm text-muted-foreground\">No services for selected type</div>\n                          ) : (\n                            filteredServicesForType.map((s: ServiceRow) => (\n                              <SelectItem key={String(s.id)} value={String(s.id)}>\n                                {s.service_name}\n                              </SelectItem>\n                            ))\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Default for Type</label>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch checked={newIsDefault} onCheckedChange={setNewIsDefault} />\n                        <span className=\"text-sm text-muted-foreground\">Mark as default</span>\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Priority</label>\n                      <Input type=\"number\" value={newPriority} onChange={(e) => setNewPriority(Number(e.target.value))} />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Active</label>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch checked={newIsActive} onCheckedChange={setNewIsActive} />\n                        <span className=\"text-sm text-muted-foreground\">Enabled</span>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Conditions (JSON)</label>\n                    <Input value={newConditions} onChange={(e) => setNewConditions(e.target.value)} placeholder=\"{}\" />\n                  </div>\n                  <div className=\"flex justify-end gap-2\">\n                    <Button variant=\"ghost\" onClick={() => { setOpen(false); resetForm(); }}>Cancel</Button>\n                    <Button onClick={handleCreate}>Save</Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 sm:grid-cols-6 gap-3 mb-4\">\n              <Input\n                placeholder=\"Search service or type\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n              />\n              <Select value={statusFilter} onValueChange={(v) => setStatusFilter(v as 'all'|'active'|'inactive')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All</SelectItem>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={typeFilter} onValueChange={(v) => setTypeFilter(v)}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Types</SelectItem>\n                  {selectTypeOptions.map((opt) => (\n                    <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {isPlatform && (\n                <Select value={listTenantFilter} onValueChange={(v) => setListTenantFilter(v)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Tenant\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Tenants</SelectItem>\n                    {tenants.map((t) => (\n                      <SelectItem key={t.id} value={t.id}>{t.name || t.id.slice(0,8)}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              )}\n              <Select value={sortKey} onValueChange={(v) => setSortKey(v as 'priority'|'type'|'service'|'status'|'default')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Sort by\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"priority\">Priority</SelectItem>\n                  <SelectItem value=\"type\">Type</SelectItem>\n                  <SelectItem value=\"service\">Service</SelectItem>\n                  <SelectItem value=\"status\">Status</SelectItem>\n                  <SelectItem value=\"default\">Default</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={sortDir} onValueChange={(v) => setSortDir(v as 'asc'|'desc')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Order\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"asc\">Asc</SelectItem>\n                  <SelectItem value=\"desc\">Desc</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  {isPlatform && <TableHead>Tenant</TableHead>}\n                  <TableHead>Service Type</TableHead>\n                  <TableHead>Service</TableHead>\n                  <TableHead>Default</TableHead>\n                  <TableHead>Priority</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {visibleMappings.map((row) => {\n                  const svc = serviceById[String(row.service_id)];\n                  return (\n                    <TableRow key={row.id}>\n                      {isPlatform && (\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <span>{tenantNameById[row.tenant_id] || row.tenant_id?.slice(0,8)}</span>\n                            <span className=\"text-xs text-muted-foreground\">{String(row.tenant_id || '').slice(0,8)}</span>\n                          </div>\n                        </TableCell>\n                      )}\n                      <TableCell className=\"font-medium\">{row.service_type}</TableCell>\n                      <TableCell>{svc?.service_name || row.service_id}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Switch checked={row.is_default} onCheckedChange={(v) => handleToggleDefault(row, v)} />\n                          <span className=\"text-xs text-muted-foreground\">One default per type</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>{row.priority}</TableCell>\n                      <TableCell>\n                        <Badge variant={row.is_active ? 'default' : 'secondary'}>\n                          {row.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Switch checked={row.is_active} onCheckedChange={(v) => handleToggleActive(row, v)} />\n                          <Button variant=\"ghost\" size=\"icon\" onClick={() => openEdit(row)}>\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(row)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n        {/* Edit dialog */}\n        <Dialog open={editOpen} onOpenChange={(v) => { setEditOpen(v); if (!v) resetEditForm(); }}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Edit Mapping</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              {isPlatform && (\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Tenant</label>\n                  <div className=\"flex items-center gap-2\">\n                    <span>{tenantNameById[editTenantId] || editTenantId}</span>\n                    <span className=\"text-xs text-muted-foreground\">{String(editTenantId || '').slice(0,8)}</span>\n                  </div>\n                  <span className=\"text-xs text-muted-foreground\">Tenant is fixed for existing mapping</span>\n                </div>\n              )}\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Service Type</label>\n                  <Select value={editType} onValueChange={(v) => { setEditType(v); setEditServiceId(''); }}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select a type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {selectTypeOptions.map((opt) => (\n                        <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Service</label>\n                  <Select value={editServiceId} onValueChange={setEditServiceId} disabled={!editType || (isPlatform && !editTenantId)}>\n                    <SelectTrigger>\n                      <SelectValue placeholder={!editType ? 'Choose type first' : (isPlatform && !editTenantId ? 'Tenant required' : 'Select service')} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {filteredEditServicesForType.length === 0 ? (\n                        <div className=\"px-3 py-2 text-sm text-muted-foreground\">No services for selected type</div>\n                      ) : (\n                        filteredEditServicesForType.map((s: ServiceRow) => (\n                          <SelectItem key={String(s.id)} value={String(s.id)}>\n                            {s.service_name}\n                          </SelectItem>\n                        ))\n                      )}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Default for Type</label>\n                  <div className=\"flex items-center gap-2\">\n                    <Switch checked={editIsDefault} onCheckedChange={setEditIsDefault} />\n                    <span className=\"text-sm text-muted-foreground\">One default per type</span>\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Priority</label>\n                  <Input type=\"number\" value={editPriority} onChange={(e) => setEditPriority(Number(e.target.value))} />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Active</label>\n                  <div className=\"flex items-center gap-2\">\n                    <Switch checked={editIsActive} onCheckedChange={setEditIsActive} />\n                    <span className=\"text-sm text-muted-foreground\">Enabled</span>\n                  </div>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Conditions (JSON)</label>\n                <Input value={editConditions} onChange={(e) => setEditConditions(e.target.value)} />\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"ghost\" onClick={() => { setEditOpen(false); resetEditForm(); }}>Cancel</Button>\n                <Button onClick={handleUpdate}>Save</Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ServiceTypes.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTypes'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTypes]","fix":{"range":[2080,2082],"text":"[fetchTypes]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Switch } from '@/components/ui/switch';\nimport { Badge } from '@/components/ui/badge';\nimport { Trash2, Plus, Pencil } from 'lucide-react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype ServiceTypeRow = {\n  id: string;\n  name: string;\n  code: string;\n  description: string | null;\n  is_active: boolean;\n};\n\nexport default function ServiceTypes() {\n  const { supabase, context } = useCRM();\n  const [types, setTypes] = useState<ServiceTypeRow[]>([]);\n  const [open, setOpen] = useState(false);\n  const [name, setName] = useState('');\n  const [code, setCode] = useState('');\n  const [description, setDescription] = useState('');\n  const [isActive, setIsActive] = useState(true);\n  // Search / filter / sort\n  const [search, setSearch] = useState('');\n  const [statusFilter, setStatusFilter] = useState<'all'|'active'|'inactive'>('all');\n  const [sortKey, setSortKey] = useState<'name'|'status'|'description'>('name');\n  const [sortDir, setSortDir] = useState<'asc'|'desc'>('asc');\n\n  const [editOpen, setEditOpen] = useState(false);\n  const [editingRow, setEditingRow] = useState<ServiceTypeRow | null>(null);\n  const [editName, setEditName] = useState('');\n  const [editCode, setEditCode] = useState('');\n  const [editDescription, setEditDescription] = useState('');\n  const [editIsActive, setEditIsActive] = useState(true);\n\n  const isPlatform = context.isPlatformAdmin;\n\n  useEffect(() => {\n    fetchTypes();\n  }, []);\n\n  const fetchTypes = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('service_types')\n        .select('*')\n        .order('name');\n      if (error) throw error;\n      setTypes((data || []) as ServiceTypeRow[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch service types:', message);\n      toast.error('Failed to fetch service types', { description: message });\n    }\n  };\n\n  const resetForm = () => {\n    setName('');\n    setCode('');\n    setDescription('');\n    setIsActive(true);\n  };\n\n  const resetEditForm = () => {\n    setEditingRow(null);\n    setEditName('');\n    setEditCode('');\n    setEditDescription('');\n    setEditIsActive(true);\n  };\n\n  const handleCreate = async () => {\n    try {\n      if (!isPlatform) {\n        toast.error('Only platform admins can create service types');\n        return;\n      }\n      if (!name.trim()) {\n        toast.error('Type name is required');\n        return;\n      }\n      if (!code.trim()) {\n        toast.error('Type code is required');\n        return;\n      }\n      const payload = { \n        name: name.trim(), \n        code: code.trim().toLowerCase(),\n        description: description || null, \n        is_active: isActive \n      } as const;\n      const { error } = await supabase.from('service_types').insert(payload);\n      if (error) throw error;\n      toast.success('Service type created');\n      setOpen(false);\n      resetForm();\n      fetchTypes();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to create type', { description: message });\n    }\n  };\n\n  const handleToggleActive = async (row: ServiceTypeRow, next: boolean) => {\n    try {\n      if (!isPlatform) {\n        toast.error('Only platform admins can update service types');\n        return;\n      }\n      const { error } = await supabase\n        .from('service_types')\n        .update({ is_active: next })\n        .eq('id', row.id);\n      if (error) throw error;\n      fetchTypes();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update type', { description: message });\n    }\n  };\n\n  const handleDelete = async (row: ServiceTypeRow) => {\n    try {\n      if (!isPlatform) {\n        toast.error('Only platform admins can delete service types');\n        return;\n      }\n      const { error } = await supabase\n        .from('service_types')\n        .delete()\n        .eq('id', row.id);\n      if (error) throw error;\n      toast.success('Service type deleted');\n      fetchTypes();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to delete type', { description: message });\n    }\n  };\n\n  const openEdit = (row: ServiceTypeRow) => {\n    setEditingRow(row);\n    setEditName(row.name);\n    setEditCode(row.code);\n    setEditDescription(row.description || '');\n    setEditIsActive(row.is_active);\n    setEditOpen(true);\n  };\n\n  const handleUpdate = async () => {\n    try {\n      if (!isPlatform) {\n        toast.error('Only platform admins can update service types');\n        return;\n      }\n      if (!editingRow) return;\n      if (!editName.trim()) {\n        toast.error('Type name is required');\n        return;\n      }\n      if (!editCode.trim()) {\n        toast.error('Type code is required');\n        return;\n      }\n      const payload = {\n        name: editName.trim(),\n        code: editCode.trim().toLowerCase(),\n        description: editDescription || null,\n        is_active: editIsActive,\n      } as const;\n      const { error } = await supabase\n        .from('service_types')\n        .update(payload)\n        .eq('id', editingRow.id);\n      if (error) throw error;\n      toast.success('Service type updated');\n      setEditOpen(false);\n      resetEditForm();\n      fetchTypes();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update type', { description: message });\n    }\n  };\n\n  const visibleTypes = (() => {\n    const term = search.trim().toLowerCase();\n    const filtered = types.filter((t) => {\n      const matchesSearch = term === ''\n        ? true\n        : [t.name, t.description || ''].some(v => String(v).toLowerCase().includes(term));\n      const matchesStatus = statusFilter === 'all'\n        ? true\n        : statusFilter === 'active'\n          ? t.is_active\n          : !t.is_active;\n      return matchesSearch && matchesStatus;\n    });\n    const cmp = (a: ServiceTypeRow, b: ServiceTypeRow) => {\n      let av: string | number; let bv: string | number;\n      if (sortKey === 'name') { av = a.name.toLowerCase(); bv = b.name.toLowerCase(); }\n      else if (sortKey === 'description') { av = (a.description || '').toLowerCase(); bv = (b.description || '').toLowerCase(); }\n      else { av = a.is_active ? 1 : 0; bv = b.is_active ? 1 : 0; }\n      const base = av < bv ? -1 : av > bv ? 1 : 0;\n      return sortDir === 'asc' ? base : -base;\n    };\n    return filtered.sort(cmp);\n  })();\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Service Types</h1>\n          <p className=\"text-muted-foreground\">Define and manage allowed service type values for services and mappings.</p>\n        </div>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <div>\n              <CardTitle>Types</CardTitle>\n              <CardDescription>Platform-wide allowed service types.</CardDescription>\n            </div>\n            <Dialog open={open} onOpenChange={(v) => { setOpen(v); if (!v) resetForm(); }}>\n              <DialogTrigger asChild>\n                <Button disabled={!isPlatform}>\n                  <Plus className=\"mr-2 h-4 w-4\" /> Add Type\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Create Service Type</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Name</label>\n                    <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"e.g. Ocean Freight\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Code</label>\n                    <Input value={code} onChange={(e) => setCode(e.target.value)} placeholder=\"e.g. ocean\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Description</label>\n                    <Input value={description} onChange={(e) => setDescription(e.target.value)} placeholder=\"Optional\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Active</label>\n                    <div className=\"flex items-center gap-2\">\n                      <Switch checked={isActive} onCheckedChange={setIsActive} />\n                      <span className=\"text-sm text-muted-foreground\">Enabled</span>\n                    </div>\n                  </div>\n                  <div className=\"flex justify-end gap-2\">\n                    <Button variant=\"ghost\" onClick={() => { setOpen(false); resetForm(); }}>Cancel</Button>\n                    <Button onClick={handleCreate} disabled={!isPlatform}>Save</Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 sm:grid-cols-4 gap-3 mb-4\">\n              <Input\n                placeholder=\"Search name or description\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n              />\n              <Select value={statusFilter} onValueChange={(v) => setStatusFilter(v as 'all'|'active'|'inactive')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All</SelectItem>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={sortKey} onValueChange={(v) => setSortKey(v as 'name'|'description'|'status')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Sort by\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"name\">Name</SelectItem>\n                  <SelectItem value=\"description\">Description</SelectItem>\n                  <SelectItem value=\"status\">Status</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={sortDir} onValueChange={(v) => setSortDir(v as 'asc'|'desc')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Order\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"asc\">Asc</SelectItem>\n                  <SelectItem value=\"desc\">Desc</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Code</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n            <TableBody>\n              {visibleTypes.map((row) => (\n                <TableRow key={row.id}>\n                  <TableCell className=\"font-medium\">{row.name}</TableCell>\n                  <TableCell className=\"font-mono text-sm\">{row.code}</TableCell>\n                  <TableCell>{row.description || ''}</TableCell>\n                  <TableCell>\n                    <Badge variant={row.is_active ? 'default' : 'secondary'}>\n                      {row.is_active ? 'Active' : 'Inactive'}\n                    </Badge>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <Switch checked={row.is_active} onCheckedChange={(v) => handleToggleActive(row, v)} disabled={!isPlatform} />\n                      <Button variant=\"ghost\" size=\"icon\" onClick={() => openEdit(row)} disabled={!isPlatform}>\n                        <Pencil className=\"h-4 w-4\" />\n                      </Button>\n                      <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(row)} disabled={!isPlatform}>\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n      {/* Edit dialog */}\n      <Dialog open={editOpen} onOpenChange={(v) => { setEditOpen(v); if (!v) resetEditForm(); }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Service Type</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Name</label>\n              <Input value={editName} onChange={(e) => setEditName(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Code</label>\n              <Input value={editCode} onChange={(e) => setEditCode(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Description</label>\n              <Input value={editDescription} onChange={(e) => setEditDescription(e.target.value)} />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Active</label>\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={editIsActive} onCheckedChange={setEditIsActive} />\n                <span className=\"text-sm text-muted-foreground\">Enabled</span>\n              </div>\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"ghost\" onClick={() => { setEditOpen(false); resetEditForm(); }}>Cancel</Button>\n              <Button onClick={handleUpdate} disabled={!isPlatform}>Save</Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Services.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'toast'. Either exclude it or remove the dependency array. Outer scope values like 'toast' aren't valid dependencies because mutating them doesn't re-render the component.","line":103,"column":6,"nodeType":"ArrayExpression","endLine":103,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [supabase]","fix":{"range":[4939,4956],"text":"[supabase]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'toast'. Either exclude it or remove the dependency array. Outer scope values like 'toast' aren't valid dependencies because mutating them doesn't re-render the component.","line":126,"column":6,"nodeType":"ArrayExpression","endLine":126,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [supabase, isPlatform, tenantId]","fix":{"range":[5871,5910],"text":"[supabase, isPlatform, tenantId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState, useCallback } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Input } from '@/components/ui/input';\nimport { Switch } from '@/components/ui/switch';\nimport { Badge } from '@/components/ui/badge';\nimport { Trash2, Plus, Pencil } from 'lucide-react';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\ntype ServiceRow = {\n  id: string;\n  tenant_id: string;\n  service_name: string;\n  service_type: string;\n  service_code: string | null;\n  description: string | null;\n  pricing_unit: string | null;\n  base_price: number | null;\n  transit_time_days: number | null;\n  is_active: boolean;\n};\n\nexport default function Services() {\n  const { supabase, context } = useCRM();\n  const [services, setServices] = useState<ServiceRow[]>([]);\n  const [types, setTypes] = useState<{ name: string; is_active: boolean }[]>([]);\n  const [tenants, setTenants] = useState<{ id: string; name: string }[]>([]);\n  const [open, setOpen] = useState(false);\n  const [selectedTenantId, setSelectedTenantId] = useState('');\n  const [serviceName, setServiceName] = useState('');\n  const [serviceType, setServiceType] = useState('');\n  const [serviceCode, setServiceCode] = useState('');\n  const [description, setDescription] = useState('');\n  const [pricingUnit, setPricingUnit] = useState('');\n  const [basePrice, setBasePrice] = useState<number | ''>('');\n  const [transitDays, setTransitDays] = useState<number | ''>('');\n  const [isActive, setIsActive] = useState(true);\n\n  const [editOpen, setEditOpen] = useState(false);\n  const [editingRow, setEditingRow] = useState<ServiceRow | null>(null);\n  const [editServiceName, setEditServiceName] = useState('');\n  const [editServiceType, setEditServiceType] = useState('');\n  const [editServiceCode, setEditServiceCode] = useState('');\n  const [editDescription, setEditDescription] = useState('');\n  const [editPricingUnit, setEditPricingUnit] = useState('');\n  const [editBasePrice, setEditBasePrice] = useState<number | ''>('');\n  const [editTransitDays, setEditTransitDays] = useState<number | ''>('');\n  const [editIsActive, setEditIsActive] = useState(true);\n  const [editTenantId, setEditTenantId] = useState('');\n  const [editMigrateMappings, setEditMigrateMappings] = useState(false);\n  const [confirmOpen, setConfirmOpen] = useState(false);\n  const [mappingsCount, setMappingsCount] = useState<number>(0);\n  const [confirmBusy, setConfirmBusy] = useState(false);\n  const STRICT_DISALLOW_TENANT_CHANGE_WITH_MAPPINGS = false;\n  // Search / filter / sort for listing\n  const [search, setSearch] = useState('');\n  const [statusFilter, setStatusFilter] = useState<'all'|'active'|'inactive'>('all');\n  const [typeFilter, setTypeFilter] = useState<string>('all');\n  const [listTenantFilter, setListTenantFilter] = useState<string>('all');\n  const [sortKey, setSortKey] = useState<'name'|'type'|'tenant'|'price'|'time'|'status'>('name');\n  const [sortDir, setSortDir] = useState<'asc'|'desc'>('asc');\n\n  const isTenantAdmin = context.isTenantAdmin;\n  const isPlatform = context.isPlatformAdmin;\n  const isAdmin = isTenantAdmin || isPlatform;\n  const tenantId = context.tenantId || null;\n\n  const fetchTypes = useCallback(async () => {\n    try {\n      const { data, error } = await supabase\n        .from('service_types')\n        .select('name, is_active')\n        .eq('is_active', true)\n        .order('name');\n      if (error) throw error;\n      setTypes((data || []) as { name: string; is_active: boolean }[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch service types:', message);\n    }\n  }, [supabase]);\n\n  const fetchTenants = useCallback(async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tenants')\n        .select('id, name')\n        .eq('is_active', true)\n        .order('name');\n      if (error) throw error;\n      setTenants((data || []) as { id: string; name: string }[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch tenants:', message);\n      toast.error('Failed to fetch tenants', { description: message });\n    }\n  }, [supabase, toast]);\n\n  const fetchServices = useCallback(async () => {\n    try {\n      // Platform admins can view all services across tenants; others are tenant-scoped\n      let query = supabase\n        .from('services')\n        .select('id, tenant_id, service_name, service_type, service_code, description, pricing_unit, base_price, transit_time_days, is_active')\n        .order('service_name');\n\n      if (!isPlatform) {\n        if (!tenantId) return; // non-admin without tenant context: nothing to show\n        query = query.eq('tenant_id', tenantId);\n      }\n\n      const { data, error } = await query;\n      if (error) throw error;\n      setServices((data || []) as ServiceRow[]);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('Failed to fetch services:', message);\n      toast.error('Failed to fetch services', { description: message });\n    }\n  }, [supabase, isPlatform, tenantId, toast]);\n\n  useEffect(() => {\n    fetchTypes();\n    fetchServices();\n    if (isPlatform) fetchTenants();\n  }, [tenantId, isPlatform, fetchTypes, fetchServices, fetchTenants]);\n\n  const resetForm = () => {\n    setServiceName('');\n    setServiceType('');\n    setServiceCode('');\n    setDescription('');\n    setPricingUnit('');\n    setBasePrice('');\n    setTransitDays('');\n    setIsActive(true);\n  };\n\n  const resetEditForm = () => {\n    setEditingRow(null);\n    setEditServiceName('');\n    setEditServiceType('');\n    setEditServiceCode('');\n    setEditDescription('');\n    setEditPricingUnit('');\n    setEditBasePrice('');\n    setEditTransitDays('');\n    setEditIsActive(true);\n    setEditTenantId('');\n    setEditMigrateMappings(false);\n  };\n\n  const handleCreate = async () => {\n    try {\n      const targetTenantId = isPlatform ? (selectedTenantId || tenantId) : tenantId;\n      if (!targetTenantId) {\n        toast.error('Select a tenant to create service');\n        return;\n      }\n      if (!isAdmin) {\n        toast.error('Only admins can create services');\n        return;\n      }\n      if (!serviceName.trim()) {\n        toast.error('Service name is required');\n        return;\n      }\n      const chosenType = serviceType || resolvedDefaultServiceType;\n      if (!chosenType) {\n        toast.error('No active service types available', { description: 'Activate at least one type under Service Types.' });\n        return;\n      }\n      const payload: {\n        tenant_id: string;\n        service_name: string;\n        service_type: string;\n        service_code: string | null;\n        description: string | null;\n        pricing_unit: string | null;\n        base_price: number | null;\n        transit_time_days: number | null;\n        is_active: boolean;\n      } = {\n        tenant_id: targetTenantId,\n        service_name: serviceName.trim(),\n        service_type: chosenType,\n        service_code: serviceCode || null,\n        description: description || null,\n        pricing_unit: pricingUnit || null,\n        base_price: basePrice === '' ? null : Number(basePrice),\n        transit_time_days: transitDays === '' ? null : Number(transitDays),\n        is_active: isActive,\n      };\n      const { error } = await supabase.from('services').insert(payload);\n      if (error) throw error;\n      toast.success('Service created');\n      setOpen(false);\n      resetForm();\n      fetchServices();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to create service', { description: message });\n    }\n  };\n\n  const handleToggleActive = async (row: ServiceRow, next: boolean) => {\n    try {\n      if (!isAdmin) {\n        toast.error('Only admins can update services');\n        return;\n      }\n      const { error } = await supabase\n        .from('services')\n        .update({ is_active: next })\n        .eq('id', row.id);\n      if (error) throw error;\n      fetchServices();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update service', { description: message });\n    }\n  };\n\n  const handleDelete = async (row: ServiceRow) => {\n    try {\n      if (!isAdmin) {\n        toast.error('Only admins can delete services');\n        return;\n      }\n      const { error } = await supabase\n        .from('services')\n        .delete()\n        .eq('id', row.id);\n      if (error) throw error;\n      toast.success('Service deleted');\n      fetchServices();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to delete service', { description: message });\n    }\n  };\n\n  const openEdit = (row: ServiceRow) => {\n    setEditingRow(row);\n    setEditServiceName(row.service_name);\n    setEditServiceType(row.service_type);\n    setEditServiceCode(row.service_code || '');\n    setEditDescription(row.description || '');\n    setEditPricingUnit(row.pricing_unit || '');\n    setEditBasePrice(row.base_price ?? '');\n    setEditTransitDays(row.transit_time_days ?? '');\n    setEditIsActive(row.is_active);\n    setEditTenantId(row.tenant_id);\n    setEditMigrateMappings(false);\n    setEditOpen(true);\n  };\n\n  const doSaveWithMigrationIfNeeded = async () => {\n    try {\n      if (!isAdmin || !editingRow) return;\n      const payload: {\n        service_name: string;\n        service_code: string | null;\n        description: string | null;\n        pricing_unit: string | null;\n        base_price: number | null;\n        transit_time_days: number | null;\n        is_active: boolean;\n        tenant_id?: string;\n      } = {\n        service_name: editServiceName.trim(),\n        service_code: editServiceCode || null,\n        description: editDescription || null,\n        pricing_unit: editPricingUnit || null,\n        base_price: editBasePrice === '' ? null : Number(editBasePrice),\n        transit_time_days: editTransitDays === '' ? null : Number(editTransitDays),\n        is_active: editIsActive,\n      };\n      if (isPlatform && editTenantId) {\n        // If tenant changed and migration toggled, update mappings first\n        if (editTenantId !== editingRow.tenant_id && editMigrateMappings && mappingsCount > 0) {\n          const { error: migError } = await supabase\n            .from('service_type_mappings')\n            .update({ tenant_id: editTenantId })\n            .eq('service_id', editingRow.id)\n            .eq('tenant_id', editingRow.tenant_id);\n          if (migError) throw migError;\n        }\n        payload.tenant_id = editTenantId;\n      }\n      const { error } = await supabase\n        .from('services')\n        .update(payload)\n        .eq('id', editingRow.id);\n      if (error) throw error;\n      toast.success('Service updated');\n      setEditOpen(false);\n      setConfirmOpen(false);\n      resetEditForm();\n      fetchServices();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update service', { description: message });\n    } finally {\n      setConfirmBusy(false);\n    }\n  };\n\n  const handleUpdate = async () => {\n    try {\n      if (!isAdmin) {\n        toast.error('Only admins can update services');\n        return;\n      }\n      if (!editingRow) return;\n      if (!editServiceName.trim()) {\n        toast.error('Service name is required');\n        return;\n      }\n      if (isPlatform && !editTenantId) {\n        toast.error('Select a tenant for this service');\n        return;\n      }\n\n      // If platform admin is changing tenant, check mappings and ask confirmation\n      if (isPlatform && editTenantId && editTenantId !== editingRow.tenant_id) {\n        const { count, error: countError } = await supabase\n          .from('service_type_mappings')\n          .select('id', { count: 'exact', head: true })\n          .eq('service_id', editingRow.id)\n          .eq('tenant_id', editingRow.tenant_id);\n        if (countError) throw countError;\n        const existing = count || 0;\n        setMappingsCount(existing);\n        if (existing > 0) {\n          if (STRICT_DISALLOW_TENANT_CHANGE_WITH_MAPPINGS) {\n            toast.error('Tenant change is not allowed because mappings exist. Remove mappings first.');\n            return;\n          }\n          setConfirmOpen(true);\n          return; // wait for confirmation\n        }\n      }\n      await doSaveWithMigrationIfNeeded();\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      toast.error('Failed to update service', { description: message });\n    }\n  };\n\n  const activeTypes = useMemo(() => types.filter(t => t.is_active), [types]);\n  // Map friendly DB type names to canonical codes for services.service_type\n  const toCanonicalType = (name: string) => {\n    const n = String(name || '').trim().toLowerCase();\n    const direct: Record<string,string> = {\n      'ocean': 'ocean',\n      'ocean freight': 'ocean',\n      'sea': 'ocean',\n      'sea freight': 'ocean',\n      'sea cargo': 'ocean',\n      'air': 'air',\n      'air freight': 'air',\n      'air cargo': 'air',\n      'trucking': 'trucking',\n      'inland trucking': 'trucking',\n      'truck': 'trucking',\n      'road': 'trucking',\n      'road transport': 'trucking',\n      'road freight': 'trucking',\n      'courier': 'courier',\n      'courier service': 'courier',\n      'express': 'courier',\n      'express delivery': 'courier',\n      'express_delivery': 'courier',\n      'parcel': 'courier',\n      'moving': 'moving',\n      'moving service': 'moving',\n      'movers': 'moving',\n      'movers packers': 'moving',\n      'packers and movers': 'moving',\n      'rail': 'railway_transport',\n      'railway': 'railway_transport',\n      'railway transport': 'railway_transport',\n      'rail transport': 'railway_transport',\n    };\n    return direct[n] || String(name);\n  };\n  const displayTypes = useMemo(() => {\n    if (activeTypes.length > 0) return activeTypes;\n    // Fallback to common types if none active are found in DB\n    const FALLBACK = ['ocean','air','trucking','courier','moving','railway_transport'];\n    return FALLBACK.map((name) => ({ name, is_active: true }));\n  }, [activeTypes]);\n  const resolvedDefaultServiceType = useMemo(() => {\n    const first = String(displayTypes[0]?.name || '');\n    return toCanonicalType(first);\n  }, [displayTypes]);\n  const tenantNameById = useMemo(() => Object.fromEntries(tenants.map(t => [t.id, t.name])), [tenants]);\n  const visibleServices = useMemo(() => {\n    const term = search.trim().toLowerCase();\n    const filtered = services.filter((s) => {\n      const matchesSearch = term === ''\n        ? true\n        : [s.service_name, s.service_type, s.service_code || '', s.description || '']\n            .some(v => String(v).toLowerCase().includes(term));\n      const matchesStatus = statusFilter === 'all' ? true : statusFilter === 'active' ? s.is_active : !s.is_active;\n      const matchesType = typeFilter === 'all' ? true : s.service_type === typeFilter;\n      const matchesTenant = !isPlatform ? true : (listTenantFilter === 'all' ? true : s.tenant_id === listTenantFilter);\n      return matchesSearch && matchesStatus && matchesType && matchesTenant;\n    });\n    const cmp = (a: ServiceRow, b: ServiceRow) => {\n      let av: string | number; let bv: string | number;\n      if (sortKey === 'name') { av = a.service_name.toLowerCase(); bv = b.service_name.toLowerCase(); }\n      else if (sortKey === 'type') { av = String(a.service_type).toLowerCase(); bv = String(b.service_type).toLowerCase(); }\n      else if (sortKey === 'tenant') { av = String(tenantNameById[a.tenant_id] || a.tenant_id).toLowerCase(); bv = String(tenantNameById[b.tenant_id] || b.tenant_id).toLowerCase(); }\n      else if (sortKey === 'price') { av = a.base_price ?? Number.POSITIVE_INFINITY; bv = b.base_price ?? Number.POSITIVE_INFINITY; }\n      else if (sortKey === 'time') { av = a.transit_time_days ?? Number.POSITIVE_INFINITY; bv = b.transit_time_days ?? Number.POSITIVE_INFINITY; }\n      else { av = a.is_active ? 1 : 0; bv = b.is_active ? 1 : 0; }\n      const base = av < bv ? -1 : av > bv ? 1 : 0;\n      return sortDir === 'asc' ? base : -base;\n    };\n    return filtered.sort(cmp);\n  }, [services, search, statusFilter, typeFilter, listTenantFilter, sortKey, sortDir, isPlatform, tenantNameById]);\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Services</h1>\n          <p className=\"text-muted-foreground\">Create and manage tenant services.</p>\n        </div>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <div>\n              <CardTitle>Services</CardTitle>\n              <CardDescription>\n                Tenant-scoped services available for quotes and mappings. Platform admins can manage across tenants.\n              </CardDescription>\n            </div>\n            <Dialog open={open} onOpenChange={(v) => { setOpen(v); if (!v) resetForm(); }}>\n              <DialogTrigger asChild>\n                <Button disabled={!isAdmin}>\n                  <Plus className=\"mr-2 h-4 w-4\" /> Add Service\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Create Service</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  {isPlatform && (\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Tenant</label>\n                      <Select value={selectedTenantId} onValueChange={setSelectedTenantId}>\n                        <SelectTrigger>\n                          <SelectValue placeholder={tenants.length === 0 ? 'No tenants' : 'Select tenant'} />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {tenants.length === 0 ? (\n                            <div className=\"px-3 py-2 text-sm text-muted-foreground\">No tenants available</div>\n                          ) : (\n                            tenants.map((t) => (\n                              <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                            ))\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n                <div className=\"grid grid-cols-1 gap-4\">\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Service Name</label>\n                    <Input value={serviceName} onChange={(e) => setServiceName(e.target.value)} placeholder=\"e.g. Ocean Standard\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Type</label>\n                    <Select value={serviceType} onValueChange={setServiceType}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select type\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {displayTypes.map((t) => {\n                          const val = toCanonicalType(t.name);\n                          return (\n                            <SelectItem key={val} value={val}>{val}</SelectItem>\n                          );\n                        })}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Service Code</label>\n                      <Input value={serviceCode} onChange={(e) => setServiceCode(e.target.value)} placeholder=\"Optional\" />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Pricing Unit</label>\n                      <Input value={pricingUnit} onChange={(e) => setPricingUnit(e.target.value)} placeholder=\"e.g. per kg\" />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Base Price</label>\n                      <Input type=\"number\" value={basePrice} onChange={(e) => setBasePrice(e.target.value === '' ? '' : Number(e.target.value))} placeholder=\"Optional\" />\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Transit Time (days)</label>\n                      <Input type=\"number\" value={transitDays} onChange={(e) => setTransitDays(e.target.value === '' ? '' : Number(e.target.value))} placeholder=\"Optional\" />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">Active</label>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch checked={isActive} onCheckedChange={setIsActive} />\n                        <span className=\"text-sm text-muted-foreground\">Enabled</span>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Description</label>\n                    <Input value={description} onChange={(e) => setDescription(e.target.value)} placeholder=\"Optional\" />\n                  </div>\n                  <div className=\"flex justify-end gap-2\">\n                    <Button variant=\"ghost\" onClick={() => { setOpen(false); resetForm(); }}>Cancel</Button>\n                    <Button onClick={handleCreate} disabled={!isAdmin || (isPlatform && !selectedTenantId && !tenantId)}>Save</Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 sm:grid-cols-6 gap-3 mb-4\">\n              <Input\n                placeholder=\"Search name, type, code\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n              />\n              <Select value={statusFilter} onValueChange={(v) => setStatusFilter(v as 'all'|'active'|'inactive')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All</SelectItem>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={typeFilter} onValueChange={(v) => setTypeFilter(v)}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Types</SelectItem>\n                  {displayTypes.map((t) => (\n                    <SelectItem key={toCanonicalType(t.name)} value={toCanonicalType(t.name)}>{toCanonicalType(t.name)}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {isPlatform && (\n                <Select value={listTenantFilter} onValueChange={(v) => setListTenantFilter(v)}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Tenant\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Tenants</SelectItem>\n                    {tenants.map((t) => (\n                      <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              )}\n              <Select value={sortKey} onValueChange={(v) => setSortKey(v as 'name'|'type'|'tenant'|'price'|'time'|'status')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Sort by\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"name\">Name</SelectItem>\n                  <SelectItem value=\"type\">Type</SelectItem>\n                  {isPlatform && <SelectItem value=\"tenant\">Tenant</SelectItem>}\n                  <SelectItem value=\"price\">Base Price</SelectItem>\n                  <SelectItem value=\"time\">Transit Days</SelectItem>\n                  <SelectItem value=\"status\">Status</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={sortDir} onValueChange={(v) => setSortDir(v as 'asc'|'desc')}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Order\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"asc\">Asc</SelectItem>\n                  <SelectItem value=\"desc\">Desc</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Service Name</TableHead>\n                  {isPlatform && <TableHead>Tenant</TableHead>}\n                  <TableHead>Type</TableHead>\n                  <TableHead>Code</TableHead>\n                  <TableHead>Base Price</TableHead>\n                  <TableHead>Transit Days</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {visibleServices.map((row) => (\n                  <TableRow key={row.id}>\n                    <TableCell className=\"font-medium\">{row.service_name}</TableCell>\n                    {isPlatform && (\n                      <TableCell>{tenantNameById[row.tenant_id] || row.tenant_id}</TableCell>\n                    )}\n                    <TableCell>{row.service_type}</TableCell>\n                    <TableCell>{row.service_code || ''}</TableCell>\n                    <TableCell>{row.base_price ?? ''}</TableCell>\n                    <TableCell>{row.transit_time_days ?? ''}</TableCell>\n                    <TableCell>\n                      <Badge variant={row.is_active ? 'default' : 'secondary'}>\n                        {row.is_active ? 'Active' : 'Inactive'}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch checked={row.is_active} onCheckedChange={(v) => handleToggleActive(row, v)} disabled={!isAdmin} />\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => openEdit(row)} disabled={!isAdmin}>\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(row)} disabled={!isAdmin}>\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n        {/* Edit dialog */}\n        <Dialog open={editOpen} onOpenChange={(v) => { setEditOpen(v); if (!v) resetEditForm(); }}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Edit Service</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              {isPlatform ? (\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Tenant</label>\n                  <Select value={editTenantId} onValueChange={setEditTenantId}>\n                    <SelectTrigger>\n                      <SelectValue placeholder={tenants.length === 0 ? 'No tenants' : 'Select tenant'} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {tenants.length === 0 ? (\n                        <div className=\"px-3 py-2 text-sm text-muted-foreground\">No tenants available</div>\n                      ) : (\n                        tenants.map((t) => (\n                          <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\n                        ))\n                      )}\n                    </SelectContent>\n                  </Select>\n                  {editingRow && editTenantId && editTenantId !== editingRow.tenant_id && (\n                    <div className=\"mt-2 space-y-2\">\n                      <div className=\"text-xs text-muted-foreground\">\n                        Changing tenant may orphan existing mappings for this service.\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch checked={editMigrateMappings} onCheckedChange={setEditMigrateMappings} />\n                        <span className=\"text-sm\">Migrate mappings to new tenant</span>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <div className=\"space-y-1\">\n                  <label className=\"text-sm font-medium\">Tenant</label>\n                  <div className=\"text-sm text-muted-foreground\">{tenantNameById[editingRow?.tenant_id || ''] || 'Current tenant'}</div>\n                </div>\n              )}\n            <div className=\"grid grid-cols-1 gap-4\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Service Name</label>\n                <Input value={editServiceName} onChange={(e) => setEditServiceName(e.target.value)} />\n              </div>\n            </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Service Code</label>\n                  <Input value={editServiceCode} onChange={(e) => setEditServiceCode(e.target.value)} />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Pricing Unit</label>\n                  <Input value={editPricingUnit} onChange={(e) => setEditPricingUnit(e.target.value)} />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Base Price</label>\n                  <Input type=\"number\" value={editBasePrice} onChange={(e) => setEditBasePrice(e.target.value === '' ? '' : Number(e.target.value))} />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Transit Time (days)</label>\n                  <Input type=\"number\" value={editTransitDays} onChange={(e) => setEditTransitDays(e.target.value === '' ? '' : Number(e.target.value))} />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Active</label>\n                  <div className=\"flex items-center gap-2\">\n                    <Switch checked={editIsActive} onCheckedChange={setEditIsActive} />\n                    <span className=\"text-sm text-muted-foreground\">Enabled</span>\n                  </div>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Description</label>\n                <Input value={editDescription} onChange={(e) => setEditDescription(e.target.value)} />\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"ghost\" onClick={() => { setEditOpen(false); resetEditForm(); }}>Cancel</Button>\n                <Button onClick={handleUpdate} disabled={!isAdmin || (isPlatform && !editTenantId)}>Save</Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* Confirm tenant change dialog */}\n        <AlertDialog open={confirmOpen} onOpenChange={setConfirmOpen}>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>Confirm Tenant Change</AlertDialogTitle>\n              <AlertDialogDescription>\n                This service has {mappingsCount} related mapping{mappingsCount === 1 ? '' : 's'}.\n                Changing tenant may orphan these mappings unless migrated.\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={editMigrateMappings} onCheckedChange={setEditMigrateMappings} />\n                <span className=\"text-sm\">Migrate mappings to new tenant</span>\n              </div>\n            </div>\n            <AlertDialogFooter>\n              <AlertDialogCancel disabled={confirmBusy}>Cancel</AlertDialogCancel>\n              <AlertDialogAction\n                onClick={async () => { setConfirmBusy(true); await doSaveWithMigrationIfNeeded(); }}\n                disabled={confirmBusy}\n              >\n                Proceed\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ShipmentDetail.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'toast'. Either exclude it or remove the dependency array. Outer scope values like 'toast' aren't valid dependencies because mutating them doesn't re-render the component.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [supabase, id]","fix":{"range":[1983,2004],"text":"[supabase, id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { ArrowLeft, Package, MapPin, Calendar, Edit, Paperclip, Download, Upload, CheckCircle2, AlertCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { TrackingTimeline } from '@/components/logistics/TrackingTimeline';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\nimport { Shipment, ShipmentStatus, statusConfig, formatShipmentType } from './shipments-data';\n\nexport default function ShipmentDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [shipment, setShipment] = useState<Shipment | null>(null);\n  const [loading, setLoading] = useState(true);\n  type ShipmentAttachment = {\n    path: string;\n    name: string;\n    size?: number;\n    uploaded_at?: string;\n    public_url?: string | null;\n    resolved_url?: string | null;\n    content_type?: string | null;\n    document_type?: string | null;\n  };\n  const [attachments, setAttachments] = useState<ShipmentAttachment[]>([]);\n  const [podUploading, setPodUploading] = useState(false);\n  const { supabase, context } = useCRM();\n  const [podFile, setPodFile] = useState<File | null>(null);\n\n  const fetchShipment = useCallback(async () => {\n    try {\n      const { data, error } = await supabase\n        .from('shipments')\n        .select('*, accounts(name), contacts(first_name, last_name)')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      setShipment(data as Shipment);\n    } catch (error: unknown) {\n      toast.error('Failed to load shipment');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, [supabase, id, toast]);\n\n  const fetchAttachments = useCallback(async () => {\n    try {\n      const { data, error } = await supabase\n        .from('shipment_attachments')\n        .select('*')\n        .eq('shipment_id', id)\n        .order('uploaded_at', { ascending: false });\n      if (error) throw error;\n      const rows = (data || []) as ShipmentAttachment[];\n      const withUrls = rows.map((att) => {\n        const urlRes = supabase.storage.from('shipments').getPublicUrl(att.path);\n        const resolved = att.public_url || urlRes?.data?.publicUrl || null;\n        return { ...att, resolved_url: resolved };\n      });\n      setAttachments(withUrls);\n    } catch (error: unknown) {\n      console.warn('Failed to load attachments', error);\n    }\n  }, [supabase, id]);\n\n  useEffect(() => {\n    if (id) {\n      fetchShipment();\n      fetchAttachments();\n    }\n  }, [id, fetchShipment, fetchAttachments]);\n\n  const handleUploadPOD = async () => {\n    try {\n      if (!id || !podFile) {\n        toast.error('Select a POD file to upload');\n        return;\n      }\n      setPodUploading(true);\n      const safeName = podFile.name.replace(/[^a-zA-Z0-9._-]/g, '_');\n      const path = `${id}/pod_${Date.now()}_${safeName}`;\n      const { error: uploadError } = await supabase.storage\n        .from('shipments')\n        .upload(path, podFile, { contentType: podFile.type || 'application/octet-stream', upsert: false });\n      if (uploadError) throw uploadError;\n\n      const { data: urlData } = supabase.storage\n        .from('shipments')\n        .getPublicUrl(path);\n      const publicUrl = urlData?.publicUrl ?? null;\n\n      const { error: metaErr } = await supabase\n        .from('shipment_attachments')\n        .insert([{\n          shipment_id: id,\n          tenant_id: context?.tenantId,\n          franchise_id: context?.franchiseId,\n          created_by: context?.userId,\n          name: podFile.name,\n          path,\n          size: podFile.size,\n          content_type: podFile.type || null,\n          public_url: publicUrl,\n          document_type: 'proof_of_delivery',\n        }]);\n      if (metaErr) throw metaErr;\n\n      const { error: updErr } = await supabase\n        .from('shipments')\n        .update({ pod_received: true, pod_received_at: new Date().toISOString() })\n        .eq('id', id);\n      if (updErr) throw updErr;\n\n      toast.success('POD uploaded and marked as received');\n      setPodFile(null);\n      await Promise.all([fetchAttachments(), fetchShipment()]);\n    } catch (error: unknown) {\n      console.error('POD upload failed:', error);\n      const msg =\n        typeof error === 'object' && error && 'message' in error\n          ? String((error as { message: unknown }).message)\n          : 'Unknown error';\n      toast.error('Failed to upload POD: ' + msg);\n    } finally {\n      setPodUploading(false);\n    }\n  };\n\n  const getStatusColor = (status: ShipmentStatus) => {\n    return statusConfig[status]?.color || 'bg-gray-500/10 text-gray-500';\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">Loading shipment...</div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!shipment) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">Shipment not found</div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate('/dashboard/shipments')}\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">{shipment.shipment_number}</h1>\n              <p className=\"text-muted-foreground\">\n                {formatShipmentType(shipment.shipment_type)}\n              </p>\n            </div>\n            <Badge className={getStatusColor(shipment.status)}>\n              {shipment.status.replace('_', ' ')}\n            </Badge>\n            {shipment.pod_received ? (\n              <Badge className=\"bg-green-500/10 text-green-600 flex items-center gap-1\">\n                <CheckCircle2 className=\"h-4 w-4\" /> POD Received\n              </Badge>\n            ) : (\n              shipment.status === 'delivered' && (\n                <Badge className=\"bg-red-500/10 text-red-600 flex items-center gap-1\">\n                  <AlertCircle className=\"h-4 w-4\" /> POD Pending\n                </Badge>\n              )\n            )}\n          </div>\n          <Button>\n            <Edit className=\"mr-2 h-4 w-4\" />\n            Edit\n          </Button>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Shipment Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Reference Number</p>\n                  <p className=\"font-medium\">{shipment.reference_number || '-'}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Priority</p>\n                  <Badge variant=\"outline\">{shipment.priority_level}</Badge>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Packages</p>\n                  <p className=\"font-medium\">{shipment.total_packages || '-'}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Weight</p>\n                  <p className=\"font-medium\">{shipment.total_weight_kg ? `${shipment.total_weight_kg} kg` : '-'}</p>\n                </div>\n              </div>\n\n              {shipment.accounts && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Customer</p>\n                  <p className=\"font-medium\">{shipment.accounts.name}</p>\n                </div>\n              )}\n\n              {shipment.special_instructions && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Special Instructions</p>\n                  <p className=\"font-medium\">{shipment.special_instructions}</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Dates & Timeline</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm text-muted-foreground\">Pickup Date</p>\n                  <p className=\"font-medium\">\n                    {shipment.pickup_date ? format(new Date(shipment.pickup_date), 'PPP') : 'Not scheduled'}\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm text-muted-foreground\">Estimated Delivery</p>\n                  <p className=\"font-medium\">\n                    {shipment.estimated_delivery_date ? format(new Date(shipment.estimated_delivery_date), 'PPP') : 'TBD'}\n                  </p>\n                </div>\n              </div>\n\n              {shipment.actual_delivery_date && (\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm text-muted-foreground\">Actual Delivery</p>\n                    <p className=\"font-medium\">\n                      {format(new Date(shipment.actual_delivery_date), 'PPP')}\n                    </p>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-5 w-5 text-primary\" />\n                <CardTitle>Origin</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p>{shipment.origin_address?.address || JSON.stringify(shipment.origin_address)}</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-5 w-5 text-primary\" />\n                <CardTitle>Destination</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p>{shipment.destination_address?.address || JSON.stringify(shipment.destination_address)}</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Attachments */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Paperclip className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Attachments</CardTitle>\n              <CardDescription>Uploaded documents for this shipment</CardDescription>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {/* POD upload control */}\n            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4 p-3 border rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Upload className=\"h-4 w-4 text-muted-foreground\" />\n                <p className=\"text-sm font-medium\">Proof of Delivery</p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"file\"\n                  accept=\"application/pdf,image/*\"\n                  onChange={(e) => setPodFile(e.target.files?.[0] || null)}\n                />\n                <Button onClick={handleUploadPOD} disabled={podUploading || !podFile}>\n                  {podUploading ? 'Uploading' : 'Upload POD'}\n                </Button>\n              </div>\n            </div>\n\n            {attachments.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No attachments yet.</p>\n            ) : (\n              <ul className=\"space-y-2\">\n                {/* Show POD attachments first */}\n                {attachments\n                  .filter((a) => a.document_type === 'proof_of_delivery')\n                  .map((att) => {\n                    const url = att.resolved_url;\n                    return (\n                      <li key={`pod-${att.id}`} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                          <div>\n                            <p className=\"font-medium leading-tight\">POD: {att.name}</p>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {att.content_type || 'file'}  {att.size ? `${Math.round(att.size / 1024)} KB` : ''}\n                            </p>\n                          </div>\n                        </div>\n                        {url && (\n                          <a\n                            href={url}\n                            target=\"_blank\"\n                            rel=\"noreferrer\"\n                            className=\"inline-flex items-center gap-2 text-primary hover:underline\"\n                          >\n                            <Download className=\"h-4 w-4\" />\n                            View\n                          </a>\n                        )}\n                      </li>\n                    );\n                  })}\n                {/* Other attachments */}\n                {attachments\n                  .filter((a) => a.document_type !== 'proof_of_delivery')\n                  .map((att) => {\n                  const url = att.resolved_url;\n                  return (\n                    <li key={att.id} className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <Package className=\"h-4 w-4 text-muted-foreground\" />\n                        <div>\n                          <p className=\"font-medium leading-tight\">{att.name}</p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {att.content_type || 'file'}  {att.size ? `${Math.round(att.size / 1024)} KB` : ''}\n                          </p>\n                        </div>\n                      </div>\n                      {url && (\n                        <a\n                          href={url}\n                          target=\"_blank\"\n                          rel=\"noreferrer\"\n                          className=\"inline-flex items-center gap-2 text-primary hover:underline\"\n                        >\n                          <Download className=\"h-4 w-4\" />\n                          View\n                        </a>\n                      )}\n                    </li>\n                  );\n                })}\n              </ul>\n            )}\n          </CardContent>\n        </Card>\n\n        {id && <TrackingTimeline shipmentId={id} />}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ShipmentNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[603,606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[603,606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3015,3018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3015,3018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4354,4357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4354,4357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { ArrowLeft } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { ShipmentForm } from '@/components/logistics/ShipmentForm';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nexport default function ShipmentNew() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n\n  const handleSubmit = async (data: any) => {\n    try {\n      const shipmentData = {\n        ...data,\n        tenant_id: context.tenantId,\n        franchise_id: context.franchiseId,\n        created_by: context.userId,\n        origin_address: { address: data.origin_address },\n        destination_address: { address: data.destination_address },\n        pickup_date: data.pickup_date ? new Date(data.pickup_date).toISOString() : null,\n        estimated_delivery_date: data.estimated_delivery_date ? new Date(data.estimated_delivery_date).toISOString() : null,\n        total_weight_kg: data.total_weight_kg ? parseFloat(data.total_weight_kg) : null,\n        total_volume_cbm: data.total_volume_cbm ? parseFloat(data.total_volume_cbm) : null,\n        total_packages: data.total_packages ? parseInt(data.total_packages) : null,\n        declared_value: typeof data.declared_value === 'number' ? data.declared_value : (data.declared_value ? parseFloat(data.declared_value) : null),\n      };\n\n      // Create shipment and get the new ID to attach files under it\n      const { data: inserted, error } = await supabase\n        .from('shipments')\n        .insert([shipmentData])\n        .select('id')\n        .single();\n\n      if (error) throw error;\n\n      const shipmentId = inserted?.id;\n\n      // Upload attachments to Supabase Storage (bucket: 'shipments')\n      const files: File[] = Array.isArray(data.attachments) ? data.attachments : [];\n      let uploadedCount = 0;\n      let failedCount = 0;\n      let firstErrorMsg: string | null = null;\n\n      if (shipmentId && files.length > 0) {\n        for (const file of files) {\n          const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');\n          const path = `${shipmentId}/${Date.now()}_${safeName}`;\n          const { error: uploadError } = await supabase.storage\n            .from('shipments')\n            .upload(path, file, { contentType: file.type || 'application/octet-stream', upsert: false });\n          if (uploadError) {\n            failedCount += 1;\n            if (!firstErrorMsg) firstErrorMsg = uploadError.message;\n          } else {\n            uploadedCount += 1;\n\n            // Save attachment metadata to shipment_attachments table\n            const { data: urlData } = supabase.storage\n              .from('shipments')\n              .getPublicUrl(path);\n            const publicUrl = urlData?.publicUrl ?? null;\n\n            const { error: metaErr } = await (supabase as any)\n              .from('shipment_attachments')\n              .insert([{\n                shipment_id: shipmentId,\n                tenant_id: context.tenantId,\n                franchise_id: context.franchiseId,\n                created_by: context.userId,\n                name: file.name,\n                path,\n                size: file.size,\n                content_type: file.type || null,\n                public_url: publicUrl,\n              }]);\n            if (metaErr) {\n              // Count as failure to persist metadata, but keep upload success\n              failedCount += 1;\n              if (!firstErrorMsg) firstErrorMsg = `metadata: ${metaErr.message}`;\n            }\n          }\n        }\n      }\n\n      // Notify result\n      if (failedCount > 0) {\n        toast.error('Shipment created, but some attachments failed to upload', {\n          description: `${uploadedCount} uploaded, ${failedCount} failed${firstErrorMsg ? `  ${firstErrorMsg}` : ''}`,\n        });\n      } else if (uploadedCount > 0) {\n        toast.success('Shipment created with attachments uploaded', {\n          description: `${uploadedCount} file${uploadedCount > 1 ? 's' : ''} uploaded to storage`,\n        });\n      } else {\n        toast.success('Shipment created successfully');\n      }\n\n      navigate('/dashboard/shipments');\n    } catch (error: any) {\n      toast.error('Failed to create shipment: ' + error.message);\n      console.error('Error:', error);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => navigate('/dashboard/shipments')}\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">New Shipment</h1>\n            <p className=\"text-muted-foreground\">Create a new shipment record</p>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Shipment Details</CardTitle>\n            <CardDescription>\n              Enter the shipment information below\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ShipmentForm\n              onSubmit={handleSubmit}\n              onCancel={() => navigate('/dashboard/shipments')}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Shipments.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchShipments'. Either include it or remove the dependency array.","line":46,"column":6,"nodeType":"ArrayExpression","endLine":46,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchShipments]","fix":{"range":[2584,2586],"text":"[fetchShipments]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Plus, Search, Package, Filter } from 'lucide-react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHeader, TableRow, SortableHead } from '@/components/ui/table';\nimport { useSort } from '@/hooks/useSort';\nimport { Pagination, PaginationContent, PaginationItem, PaginationPrevious, PaginationNext, PaginationFirst, PaginationLast, PaginationLink } from '@/components/ui/pagination';\nimport { usePagination } from '@/hooks/usePagination';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { useCRM } from '@/hooks/useCRM';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { ShipmentStats } from '@/components/logistics/ShipmentStats';\nimport { toast } from 'sonner';\nimport { format } from 'date-fns';\nimport { matchText, TextOp } from '@/lib/utils';\nimport { Shipment, ShipmentStatus, statusConfig, normalizeShipmentType, formatShipmentType } from './shipments-data';\n\nexport default function Shipments() {\n  const navigate = useNavigate();\n  const [shipments, setShipments] = useState<Shipment[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [typeFilter, setTypeFilter] = useState<string>('all');\n  const [viewMode, setViewMode] = useState<ViewMode>('card');\n  const { supabase, context } = useCRM();\n\n  // Advanced per-column filters\n  const [filterShipmentNo, setFilterShipmentNo] = useState('');\n  const [filterShipmentNoOp, setFilterShipmentNoOp] = useState<TextOp>('contains');\n  const [filterCustomer, setFilterCustomer] = useState('');\n  const [filterCustomerOp, setFilterCustomerOp] = useState<TextOp>('contains');\n  const [filterPriority, setFilterPriority] = useState('');\n  const [filterPriorityOp, setFilterPriorityOp] = useState<TextOp>('contains');\n  const [packagesMin, setPackagesMin] = useState<string>('');\n  const [packagesMax, setPackagesMax] = useState<string>('');\n  const [etaStart, setEtaStart] = useState<string>('');\n  const [etaEnd, setEtaEnd] = useState<string>('');\n\n  useEffect(() => {\n    fetchShipments();\n  }, []);\n\n  const fetchShipments = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('shipments')\n        .select('*, accounts(name)')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setShipments(data as unknown as Shipment[]);\n    } catch (error: unknown) {\n      toast.error('Failed to load shipments');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredShipments = shipments.filter(shipment => {\n    const globalQuery = searchQuery.trim().toLowerCase();\n    const matchesGlobal = !globalQuery || [\n      shipment.shipment_number,\n      shipment.accounts?.name || '',\n      shipment.priority_level || '',\n      shipment.shipment_type || '',\n      shipment.status || ''\n    ].some(v => (v || '').toLowerCase().includes(globalQuery));\n\n    const matchesStatus = statusFilter === 'all' || shipment.status === statusFilter;\n    const matchesType = typeFilter === 'all' || normalizeShipmentType(shipment.shipment_type) === normalizeShipmentType(typeFilter);\n\n    const matchesShipmentNo = matchText(shipment.shipment_number, filterShipmentNo, filterShipmentNoOp);\n    const matchesCustomer = matchText(shipment.accounts?.name ?? '', filterCustomer, filterCustomerOp);\n    const matchesPriority = matchText(shipment.priority_level, filterPriority, filterPriorityOp);\n\n    const min = packagesMin ? Number(packagesMin) : undefined;\n    const max = packagesMax ? Number(packagesMax) : undefined;\n    const total = shipment.total_packages ?? undefined;\n    const matchesPackages = (\n      (min === undefined || (total !== undefined && total >= min)) &&\n      (max === undefined || (total !== undefined && total <= max))\n    );\n\n    const eta = shipment.estimated_delivery_date ? new Date(shipment.estimated_delivery_date) : null;\n    const start = etaStart ? new Date(etaStart) : null;\n    const end = etaEnd ? new Date(etaEnd) : null;\n    const matchesETA = (\n      (!start || (eta && eta >= start)) &&\n      (!end || (eta && eta <= end))\n    );\n\n    return matchesGlobal && matchesStatus && matchesType &&\n      matchesShipmentNo && matchesCustomer && matchesPriority &&\n      matchesPackages && matchesETA;\n  });\n\n  const { sorted: sortedShipments, sortField, sortDirection, onSort } = useSort<Shipment>(filteredShipments, {\n    accessors: {\n      shipment_number: (s) => s.shipment_number,\n      type: (s) => s.shipment_type,\n      customer: (s) => s.accounts?.name ?? '',\n      status: (s) => s.status,\n      priority: (s) => s.priority_level ?? '',\n      packages: (s) => s.total_packages ?? 0,\n      eta: (s) => s.estimated_delivery_date ?? '',\n    },\n  });\n\n  const {\n    pageItems: pagedShipments,\n    pageSize,\n    setPageSize,\n    pageSizeOptions,\n    currentPage,\n    totalPages,\n    nextPage,\n    prevPage,\n    firstPage,\n    lastPage,\n    canPrev,\n    canNext,\n  } = usePagination(sortedShipments, { initialPageSize: 20 });\n\n  const totalShipments = shipments.length;\n  const inTransit = shipments.filter(s => s.status === 'in_transit').length;\n  const delivered = shipments.filter(s => s.status === 'delivered').length;\n  const pending = shipments.filter(s => ['draft', 'confirmed'].includes(s.status)).length;\n\n  const getStatusColor = (status: ShipmentStatus) => {\n    return statusConfig[status]?.color || 'bg-gray-500/10 text-gray-500';\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Shipments</h1>\n            <p className=\"text-muted-foreground\">Track and manage all shipments</p>\n          </div>\n          <div className=\"mt-3 flex items-center justify-between gap-3\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"text-xs text-muted-foreground\">Cards per page</div>\n              <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Cards\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {pageSizeOptions.map((opt) => (\n                    <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <Pagination className=\"justify-end\">\n              <PaginationContent>\n                <PaginationItem>\n                  <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n              </PaginationContent>\n            </Pagination>\n          </div>\n          <div className=\"flex gap-2 items-center\">\n            <ViewToggle\n              value={viewMode}\n              modes={['pipeline','card','grid','list']}\n              onChange={(v) => v === 'pipeline' ? navigate('/dashboard/shipments/pipeline') : setViewMode(v)}\n            />\n            {/* Removed standalone Pipeline View button; use ViewToggle with Pipeline first */}\n            <Button asChild>\n              <Link to=\"/dashboard/shipments/new\">\n                <Plus className=\"mr-2 h-4 w-4\" />\n                New Shipment\n              </Link>\n            </Button>\n          </div>\n        </div>\n\n        <ShipmentStats\n          totalShipments={totalShipments}\n          inTransit={inTransit}\n          delivered={delivered}\n          pending={pending}\n        />\n\n        <div className=\"flex flex-wrap gap-4\">\n          <div className=\"relative flex-1 min-w-[300px]\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search shipments...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n          \n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-[180px]\">\n              <Filter className=\"mr-2 h-4 w-4\" />\n              <SelectValue placeholder=\"Status\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Statuses</SelectItem>\n              <SelectItem value=\"draft\">Draft</SelectItem>\n              <SelectItem value=\"confirmed\">Confirmed</SelectItem>\n              <SelectItem value=\"in_transit\">In Transit</SelectItem>\n              <SelectItem value=\"customs\">Customs</SelectItem>\n              <SelectItem value=\"out_for_delivery\">Out for Delivery</SelectItem>\n              <SelectItem value=\"delivered\">Delivered</SelectItem>\n              <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n              <SelectItem value=\"on_hold\">On Hold</SelectItem>\n              <SelectItem value=\"returned\">Returned</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Select value={typeFilter} onValueChange={setTypeFilter}>\n            <SelectTrigger className=\"w-[180px]\">\n              <Package className=\"mr-2 h-4 w-4\" />\n              <SelectValue placeholder=\"Type\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Types</SelectItem>\n              <SelectItem value=\"ocean\">Ocean</SelectItem>\n              <SelectItem value=\"air\">Air</SelectItem>\n              <SelectItem value=\"inland_trucking\">Inland Trucking</SelectItem>\n              <SelectItem value=\"rail\">Rail</SelectItem>\n              <SelectItem value=\"courier\">Courier</SelectItem>\n              <SelectItem value=\"movers_packers\">Movers & Packers</SelectItem>\n            </SelectContent>\n          </Select>\n\n          {/* Advanced per-column filters */}\n          <div className=\"flex items-center gap-2\">\n            <Select value={filterShipmentNoOp} onValueChange={(v) => setFilterShipmentNoOp(v as TextOp)}>\n              <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Shipment # op\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"contains\">Contains</SelectItem>\n                <SelectItem value=\"equals\">Equals</SelectItem>\n                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input\n              placeholder=\"Shipment #\"\n              value={filterShipmentNo}\n              onChange={(e) => setFilterShipmentNo(e.target.value)}\n              className=\"w-[180px]\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Select value={filterCustomerOp} onValueChange={(v) => setFilterCustomerOp(v as TextOp)}>\n              <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Customer op\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"contains\">Contains</SelectItem>\n                <SelectItem value=\"equals\">Equals</SelectItem>\n                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input\n              placeholder=\"Customer\"\n              value={filterCustomer}\n              onChange={(e) => setFilterCustomer(e.target.value)}\n              className=\"w-[180px]\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Select value={filterPriorityOp} onValueChange={(v) => setFilterPriorityOp(v as TextOp)}>\n              <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Priority op\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"contains\">Contains</SelectItem>\n                <SelectItem value=\"equals\">Equals</SelectItem>\n                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input\n              placeholder=\"Priority\"\n              value={filterPriority}\n              onChange={(e) => setFilterPriority(e.target.value)}\n              className=\"w-[160px]\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Input\n              type=\"number\"\n              placeholder=\"Packages min\"\n              value={packagesMin}\n              onChange={(e) => setPackagesMin(e.target.value)}\n              className=\"w-[140px]\"\n            />\n            <Input\n              type=\"number\"\n              placeholder=\"Packages max\"\n              value={packagesMax}\n              onChange={(e) => setPackagesMax(e.target.value)}\n              className=\"w-[140px]\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Input\n              type=\"date\"\n              placeholder=\"ETA from\"\n              value={etaStart}\n              onChange={(e) => setEtaStart(e.target.value)}\n              className=\"w-[160px]\"\n            />\n            <Input\n              type=\"date\"\n              placeholder=\"ETA to\"\n              value={etaEnd}\n              onChange={(e) => setEtaEnd(e.target.value)}\n              className=\"w-[160px]\"\n            />\n          </div>\n        </div>\n\n        {loading ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">Loading shipments...</p>\n          </div>\n        ) : filteredShipments.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <Package className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">No shipments found</h3>\n              <p className=\"text-muted-foreground mb-4\">\n                {searchQuery ? 'Try adjusting your search' : 'Start tracking your first shipment'}\n              </p>\n              {!searchQuery && (\n                <Button asChild>\n                  <Link to=\"/dashboard/shipments/new\">\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Add Shipment\n                  </Link>\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        ) : viewMode === 'list' ? (\n          <Card>\n            <Table>\n                <TableHeader>\n                  <TableRow>\n                    <SortableHead field=\"shipment_number\" activeField={sortField} direction={sortDirection} onSort={onSort}>Shipment #</SortableHead>\n                    <SortableHead field=\"type\" activeField={sortField} direction={sortDirection} onSort={onSort}>Type</SortableHead>\n                    <SortableHead field=\"customer\" activeField={sortField} direction={sortDirection} onSort={onSort}>Customer</SortableHead>\n                    <SortableHead field=\"status\" activeField={sortField} direction={sortDirection} onSort={onSort}>Status</SortableHead>\n                    <SortableHead field=\"priority\" activeField={sortField} direction={sortDirection} onSort={onSort}>Priority</SortableHead>\n                    <SortableHead field=\"packages\" activeField={sortField} direction={sortDirection} onSort={onSort}>Packages</SortableHead>\n                    <SortableHead field=\"eta\" activeField={sortField} direction={sortDirection} onSort={onSort}>ETA</SortableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {pagedShipments.map((shipment) => (\n                  <TableRow \n                    key={shipment.id} \n                    className=\"cursor-pointer hover:bg-muted/50\"\n                    onClick={() => navigate(`/dashboard/shipments/${shipment.id}`)}\n                  >\n                    <TableCell className=\"font-medium\">{shipment.shipment_number}</TableCell>\n                    <TableCell>{formatShipmentType(shipment.shipment_type)}</TableCell>\n                    <TableCell>{shipment.accounts?.name || '-'}</TableCell>\n                    <TableCell>\n                      <Badge className={getStatusColor(shipment.status)}>\n                        {shipment.status.replace('_', ' ')}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant=\"outline\">{shipment.priority_level}</Badge>\n                    </TableCell>\n                    <TableCell>{shipment.total_packages || '-'}</TableCell>\n                    <TableCell>\n                      {shipment.estimated_delivery_date \n                        ? format(new Date(shipment.estimated_delivery_date), 'MMM dd, yyyy')\n                        : '-'\n                      }\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n            <div className=\"p-3 flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"text-xs text-muted-foreground\">Rows per page</div>\n                <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                  <SelectTrigger className=\"w-[140px]\">\n                    <SelectValue placeholder=\"Rows\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {pageSizeOptions.map((opt) => (\n                      <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <Pagination className=\"justify-end\">\n                <PaginationContent>\n                  <PaginationItem>\n                    <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                </PaginationContent>\n              </Pagination>\n            </div>\n          </Card>\n        ) : (\n          <div className={viewMode === 'grid' ? 'grid gap-4 md:grid-cols-2 lg:grid-cols-4' : 'grid gap-4 md:grid-cols-2 lg:grid-cols-3'}>\n            {pagedShipments.map((shipment) => (\n              <Link key={shipment.id} to={`/dashboard/shipments/${shipment.id}`}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <Package className=\"h-10 w-10 text-primary\" />\n                      <Badge className={getStatusColor(shipment.status)}>\n                        {shipment.status.replace('_', ' ')}\n                      </Badge>\n                    </div>\n                    <CardTitle className=\"mt-4\">{shipment.shipment_number}</CardTitle>\n                    <CardDescription>{formatShipmentType(shipment.shipment_type)}</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    {shipment.accounts?.name && (\n                      <div className=\"text-sm\">\n                        <span className=\"text-muted-foreground\">Customer: </span>\n                        <span className=\"font-medium\">{shipment.accounts.name}</span>\n                      </div>\n                    )}\n                    <div className=\"flex items-center justify-between\">\n                      <Badge variant=\"outline\">{shipment.priority_level}</Badge>\n                      {shipment.total_packages && (\n                        <span className=\"text-sm text-muted-foreground\">\n                          {shipment.total_packages} packages\n                        </span>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ShipmentsPipeline.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'supabase'. Either exclude it or remove the dependency array. Outer scope values like 'supabase' aren't valid dependencies because mutating them doesn't re-render the component.","line":109,"column":6,"nodeType":"ArrayExpression","endLine":109,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [toast]","fix":{"range":[4285,4302],"text":"[toast]"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'searchParams'. Either include it or remove the dependency array.","line":126,"column":6,"nodeType":"ArrayExpression","endLine":126,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams]","fix":{"range":[4763,4765],"text":"[searchParams]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from \"react\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { ArrowLeft, Search, Filter, Package, MapPin, Layers, Settings, CheckSquare, Square, Trash2, AlertCircle, CheckCircle2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DndContext, DragEndEvent, DragOverlay, DragStartEvent, PointerSensor, useSensor, useSensors } from \"@dnd-kit/core\";\nimport { Droppable } from \"@/components/kanban/Droppable\";\nimport { Draggable } from \"@/components/kanban/Draggable\";\nimport { SwimLane } from \"@/components/kanban/SwimLane\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { KanbanFunnel } from \"@/components/kanban/KanbanFunnel\";\nimport { Carrier, Shipment, ShipmentStatus, statusConfig, stages, Address } from \"./shipments-data\";\n\nexport default function ShipmentsPipeline() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [shipments, setShipments] = useState<Shipment[]>([]);\n  const [carriers, setCarriers] = useState<Carrier[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [originFilter, setOriginFilter] = useState<string>(\"\");\n  const [destinationFilter, setDestinationFilter] = useState<string>(\"\");\n  const [carrierFilter, setCarrierFilter] = useState<string>(\"all\");\n  const [priorityFilter, setPriorityFilter] = useState<string>(\"all\");\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const [groupBy, setGroupBy] = useState<'none' | 'priority' | 'carrier'>('none');\n  const [selectedStages, setSelectedStages] = useState<ShipmentStatus[]>([]);\n  const [searchParams, setSearchParams] = useSearchParams();\n  \n  // Advanced filters\n  const [minCharges, setMinCharges] = useState<string>(\"\");\n  const [maxCharges, setMaxCharges] = useState<string>(\"\");\n  const [dateFrom, setDateFrom] = useState<string>(\"\");\n  const [dateTo, setDateTo] = useState<string>(\"\");\n  \n  // WIP limits\n  const [wipLimits, setWipLimits] = useState<Record<ShipmentStatus, number>>({\n    draft: 50,\n    confirmed: 30,\n    in_transit: 40,\n    out_for_delivery: 20,\n    delivered: 999,\n    customs: 10,\n    cancelled: 999,\n    on_hold: 15,\n    returned: 999,\n  });\n  \n  // Card customization\n  const [showFields, setShowFields] = useState({\n    origin: true,\n    destination: true,\n    packages: true,\n    weight: false,\n    charges: true,\n    deliveryDate: true,\n  });\n  \n  // Bulk operations\n  const [selectedShipments, setSelectedShipments] = useState<Set<string>>(new Set());\n  const [bulkMode, setBulkMode] = useState(false);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    })\n  );\n\n  const fetchData = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      const { data: shipmentsData, error: shipmentsError } = await supabase\n        .from(\"shipments\")\n        .select(\"*\")\n        .order(\"created_at\", { ascending: false });\n\n      if (shipmentsError) throw shipmentsError;\n      (setShipments as any)(shipmentsData || []);\n\n      const { data: carriersData, error: carriersError } = await supabase\n        .from(\"carriers\")\n        .select(\"id, carrier_name\")\n        .eq(\"is_active\", true);\n\n      if (carriersError) throw carriersError;\n      setCarriers(carriersData || []);\n    } catch (error) {\n      console.error(\"Error fetching data:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to fetch shipments\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [supabase, toast]);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  // Initialize selected stages from URL\n  useEffect(() => {\n    const stagesParam = searchParams.get('stages');\n    if (stagesParam) {\n      const values = stagesParam\n        .split(',')\n        .map(s => s.trim())\n        .filter((s): s is ShipmentStatus => (stages as string[]).includes(s));\n      setSelectedStages(values);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Persist selected stages to URL\n  useEffect(() => {\n    if (selectedStages.length > 0) {\n      setSearchParams({ stages: selectedStages.join(',') }, { replace: true });\n    } else {\n      setSearchParams({}, { replace: true });\n    }\n  }, [selectedStages, setSearchParams]);\n\n\n  const handleStatusChange = async (shipmentId: string, newStatus: ShipmentStatus) => {\n    try {\n      const { error } = await supabase\n        .from(\"shipments\")\n        .update({ status: newStatus })\n        .eq(\"id\", shipmentId);\n\n      if (error) throw error;\n\n      setShipments((prev) =>\n        prev.map((shipment) =>\n          shipment.id === shipmentId ? { ...shipment, status: newStatus } : shipment\n        )\n      );\n\n      toast({\n        title: \"Success\",\n        description: \"Shipment status updated\",\n      });\n    } catch (error) {\n      console.error(\"Error updating shipment status:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update shipment status\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDragStart = (event: DragStartEvent) => {\n    setActiveId(event.active.id as string);\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n    setActiveId(null);\n\n    if (!over) return;\n\n    const shipmentId = active.id as string;\n    const newStatus = over.id as ShipmentStatus;\n\n    const shipment = shipments.find((s) => s.id === shipmentId);\n    if (!shipment || shipment.status === newStatus) return;\n\n    handleStatusChange(shipmentId, newStatus);\n  };\n\n  const getLocationString = (address: Address | null): string => {\n    if (!address) return \"\";\n    const city = address.city || \"\";\n    const country = address.country || \"\";\n    return [city, country].filter(Boolean).join(\", \") || \"\";\n  };\n\n  const filteredShipments = shipments.filter((shipment) => {\n    const searchLower = searchQuery.toLowerCase();\n    const matchesSearch =\n      !searchQuery ||\n      shipment.shipment_number.toLowerCase().includes(searchLower) ||\n      getLocationString(shipment.origin_address).toLowerCase().includes(searchLower) ||\n      getLocationString(shipment.destination_address).toLowerCase().includes(searchLower);\n\n    const matchesOrigin =\n      !originFilter ||\n      getLocationString(shipment.origin_address).toLowerCase().includes(originFilter.toLowerCase());\n\n    const matchesDestination =\n      !destinationFilter ||\n      getLocationString(shipment.destination_address).toLowerCase().includes(destinationFilter.toLowerCase());\n\n    const matchesPriority =\n      priorityFilter === \"all\" || shipment.priority_level === priorityFilter;\n    \n    // Charges range filter\n    const charges = shipment.total_charges || 0;\n    const matchesMinCharges = !minCharges || charges >= parseFloat(minCharges);\n    const matchesMaxCharges = !maxCharges || charges <= parseFloat(maxCharges);\n    \n    // Date range filter\n    const shipmentDate = shipment.pickup_date ? new Date(shipment.pickup_date) : new Date(shipment.created_at);\n    const matchesDateFrom = !dateFrom || shipmentDate >= new Date(dateFrom);\n    const matchesDateTo = !dateTo || shipmentDate <= new Date(dateTo);\n\n    return matchesSearch && matchesOrigin && matchesDestination && matchesPriority && matchesMinCharges && matchesMaxCharges && matchesDateFrom && matchesDateTo;\n  });\n  \n  const toggleShipmentSelection = (shipmentId: string) => {\n    setSelectedShipments(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(shipmentId)) {\n        newSet.delete(shipmentId);\n      } else {\n        newSet.add(shipmentId);\n      }\n      return newSet;\n    });\n  };\n  \n  const handleBulkDelete = async () => {\n    if (selectedShipments.size === 0) return;\n    \n    try {\n      const { error } = await supabase\n        .from(\"shipments\")\n        .delete()\n        .in(\"id\", Array.from(selectedShipments));\n        \n      if (error) throw error;\n      \n      setShipments(prev => prev.filter(s => !selectedShipments.has(s.id)));\n      setSelectedShipments(new Set());\n      \n      toast({\n        title: \"Success\",\n        description: `Deleted ${selectedShipments.size} shipment(s)`,\n      });\n    } catch (error) {\n      console.error(\"Error deleting shipments:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete shipments\",\n        variant: \"destructive\",\n      });\n    }\n  };\n  \n  const handleBulkStatusChange = async (newStatus: ShipmentStatus) => {\n    if (selectedShipments.size === 0) return;\n    \n    try {\n      const { error } = await supabase\n        .from(\"shipments\")\n        .update({ status: newStatus })\n        .in(\"id\", Array.from(selectedShipments));\n        \n      if (error) throw error;\n      \n      setShipments(prev => prev.map(s => \n        selectedShipments.has(s.id) ? { ...s, status: newStatus } : s\n      ));\n      setSelectedShipments(new Set());\n      \n      toast({\n        title: \"Success\",\n        description: `Updated ${selectedShipments.size} shipment(s)`,\n      });\n    } catch (error) {\n      console.error(\"Error updating shipments:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update shipments\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleBulkMarkPodReceived = async () => {\n    if (selectedShipments.size === 0) return;\n    try {\n      const now = new Date().toISOString();\n      const { error } = await (supabase as any)\n        .from(\"shipments\")\n        .update({ pod_received: true, pod_received_at: now })\n        .in(\"id\", Array.from(selectedShipments));\n      if (error) throw error;\n      setShipments(prev => prev.map(s =>\n        selectedShipments.has(s.id) ? { ...s, pod_received: true, pod_received_at: now } : s\n      ));\n      setSelectedShipments(new Set());\n      toast({ title: \"Success\", description: \"Marked POD received for selected shipments\" });\n    } catch (error) {\n      console.error(\"Error marking POD received:\", error);\n      toast({ title: \"Error\", description: \"Failed to mark POD received\", variant: \"destructive\" });\n    }\n  };\n\n  const handleMarkPodReceived = async (shipmentId: string) => {\n    try {\n      const now = new Date().toISOString();\n      const { error } = await (supabase as any)\n        .from(\"shipments\")\n        .update({ pod_received: true, pod_received_at: now })\n        .eq(\"id\", shipmentId);\n      if (error) throw error;\n      setShipments(prev => prev.map(s => s.id === shipmentId ? { ...s, pod_received: true, pod_received_at: now } : s));\n      toast({ title: \"Success\", description: \"POD marked received\" });\n    } catch (error) {\n      console.error(\"Error marking POD received:\", error);\n      toast({ title: \"Error\", description: \"Failed to mark POD received\", variant: \"destructive\" });\n    }\n  };\n\n  const groupedShipments = stages.reduce((acc, stage) => {\n    acc[stage] = filteredShipments.filter((shipment) => shipment.status === stage);\n    return acc;\n  }, {} as Record<ShipmentStatus, Shipment[]>);\n\n  // Maps for KanbanFunnel props\n  const labelMap: Record<ShipmentStatus, string> = Object.fromEntries(\n    stages.map((s) => [s, statusConfig[s].label])\n  ) as Record<ShipmentStatus, string>;\n  const colorMap: Record<ShipmentStatus, string> = Object.fromEntries(\n    stages.map((s) => [s, statusConfig[s].color])\n  ) as Record<ShipmentStatus, string>;\n  const countMap: Record<ShipmentStatus, number> = Object.fromEntries(\n    stages.map((s) => [\n      s,\n      selectedStages.length > 0\n        ? (selectedStages.includes(s) ? groupedShipments[s].length : 0)\n        : groupedShipments[s].length,\n    ])\n  ) as Record<ShipmentStatus, number>;\n\n  type SortMode = 'default' | 'created_at' | 'pickup_date' | 'charges';\n\n  // Per-stage sorting configuration\n  const [stageSort, setStageSort] = useState<Record<ShipmentStatus, SortMode>>({\n    draft: 'default',\n    confirmed: 'default',\n    in_transit: 'default',\n    out_for_delivery: 'default',\n    delivered: 'default',\n    customs: 'default',\n    cancelled: 'default',\n    on_hold: 'default',\n    returned: 'default',\n  });\n\n  // Group shipments by swim lane\n  const getSwimLanes = () => {\n    if (groupBy === 'none') {\n      return [{ id: 'all', title: 'All Shipments', shipments: filteredShipments }];\n    }\n\n    if (groupBy === 'priority') {\n      return [\n        { \n          id: 'high', \n          title: 'High Priority', \n          shipments: filteredShipments.filter(s => s.priority_level === 'high') \n        },\n        { \n          id: 'medium', \n          title: 'Medium Priority', \n          shipments: filteredShipments.filter(s => s.priority_level === 'medium') \n        },\n        { \n          id: 'low', \n          title: 'Low Priority', \n          shipments: filteredShipments.filter(s => s.priority_level === 'low') \n        },\n        { \n          id: 'no-priority', \n          title: 'No Priority Set', \n          shipments: filteredShipments.filter(s => !s.priority_level) \n        },\n      ].filter(lane => lane.shipments.length > 0);\n    }\n\n    if (groupBy === 'carrier') {\n      const carrierGroups = carriers.map(carrier => ({\n        id: carrier.id,\n        title: carrier.carrier_name,\n        shipments: filteredShipments.filter(s => {\n          // This would need a carrier_id field on shipments table\n          // For now, we'll just group by all\n          return true;\n        })\n      }));\n      return [{ id: 'all', title: 'All Shipments', shipments: filteredShipments }];\n    }\n\n    return [{ id: 'all', title: 'All Shipments', shipments: filteredShipments }];\n  };\n\n  const swimLanes = getSwimLanes();\n\n  const formatCurrency = (amount: number | null, currency: string | null) => {\n    if (!amount) return \"\";\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: currency || \"USD\",\n      minimumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  const formatDate = (date: string | null) => {\n    if (!date) return \"\";\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  const activeShipment = activeId ? shipments.find((s) => s.id === activeId) : null;\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Shipments Pipeline</h1>\n            <p className=\"text-muted-foreground\">Track shipments through stages</p>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate(\"/dashboard/shipments\")}>\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to List\n          </Button>\n        </div>\n\n        <KanbanFunnel\n          stages={stages}\n          labels={labelMap}\n          colors={colorMap}\n          counts={countMap}\n          total={filteredShipments.length}\n          activeStages={selectedStages}\n          onStageClick={(s) => setSelectedStages(prev => prev.includes(s) ? prev.filter(x => x !== s) : [...prev, s])}\n          onClearStage={() => setSelectedStages([])}\n        />\n\n        {/* Filters */}\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-4\">\n              {/* Main Filters */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Search shipments...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pl-9\"\n                  />\n                </div>\n                <div className=\"relative\">\n                  <MapPin className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Filter by origin...\"\n                    value={originFilter}\n                    onChange={(e) => setOriginFilter(e.target.value)}\n                    className=\"pl-9\"\n                  />\n                </div>\n                <div className=\"relative\">\n                  <MapPin className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Filter by destination...\"\n                    value={destinationFilter}\n                    onChange={(e) => setDestinationFilter(e.target.value)}\n                    className=\"pl-9\"\n                  />\n                </div>\n                <Select value={priorityFilter} onValueChange={setPriorityFilter}>\n                  <SelectTrigger>\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Priority\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Priorities</SelectItem>\n                    <SelectItem value=\"high\">High</SelectItem>\n                    <SelectItem value=\"medium\">Medium</SelectItem>\n                    <SelectItem value=\"low\">Low</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Select value={groupBy} onValueChange={(v) => setGroupBy(v as 'none' | 'priority' | 'carrier')}>\n                  <SelectTrigger>\n                    <Layers className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Group By\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">No Grouping</SelectItem>\n                    <SelectItem value=\"priority\">By Priority</SelectItem>\n                    <SelectItem value=\"carrier\">By Carrier</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Advanced Filters */}\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                <div>\n                  <Label className=\"text-xs text-muted-foreground\">Min Charges ($)</Label>\n                  <Input\n                    type=\"number\"\n                    placeholder=\"0\"\n                    value={minCharges}\n                    onChange={(e) => setMinCharges(e.target.value)}\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-xs text-muted-foreground\">Max Charges ($)</Label>\n                  <Input\n                    type=\"number\"\n                    placeholder=\"No limit\"\n                    value={maxCharges}\n                    onChange={(e) => setMaxCharges(e.target.value)}\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-xs text-muted-foreground\">Pickup From</Label>\n                  <Input\n                    type=\"date\"\n                    value={dateFrom}\n                    onChange={(e) => setDateFrom(e.target.value)}\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-xs text-muted-foreground\">Pickup To</Label>\n                  <Input\n                    type=\"date\"\n                    value={dateTo}\n                    onChange={(e) => setDateTo(e.target.value)}\n                  />\n                </div>\n              </div>\n              \n              {/* Actions Bar */}\n              <div className=\"flex items-center justify-between pt-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant={bulkMode ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => {\n                      setBulkMode(!bulkMode);\n                      setSelectedShipments(new Set());\n                    }}\n                  >\n                    <CheckSquare className=\"h-4 w-4 mr-2\" />\n                    {bulkMode ? \"Cancel Selection\" : \"Bulk Select\"}\n                  </Button>\n                  \n                  {bulkMode && selectedShipments.size > 0 && (\n                    <>\n                      <Badge variant=\"secondary\">{selectedShipments.size} selected</Badge>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleBulkDelete}\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-2\" />\n                        Delete\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleBulkMarkPodReceived}\n                      >\n                        <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                        Mark POD Received\n                      </Button>\n                      <Select onValueChange={handleBulkStatusChange}>\n                        <SelectTrigger className=\"w-[180px] h-9\">\n                          <SelectValue placeholder=\"Change Status\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {stages.map(stage => (\n                            <SelectItem key={stage} value={stage}>\n                              {statusConfig[stage].label}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </>\n                  )}\n                </div>\n                \n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\">\n                      <Settings className=\"h-4 w-4 mr-2\" />\n                      Customize Cards\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-80\">\n                    <div className=\"space-y-4\">\n                      <h4 className=\"font-medium\">Card Fields</h4>\n                      <div className=\"space-y-3\">\n                        {Object.entries(showFields).map(([field, show]) => (\n                          <div key={field} className=\"flex items-center space-x-2\">\n                            <Checkbox\n                              id={field}\n                              checked={show}\n                              onCheckedChange={(checked) =>\n                                setShowFields(prev => ({ ...prev, [field]: !!checked }))\n                              }\n                            />\n                            <Label htmlFor={field} className=\"capitalize\">\n                              {field.replace(/([A-Z])/g, ' $1').trim()}\n                            </Label>\n                          </div>\n                        ))}\n                      </div>\n                      <Separator />\n                      <h4 className=\"font-medium\">WIP Limits</h4>\n                      <div className=\"space-y-2\">\n                        {stages.slice(0, 6).map(stage => (\n                          <div key={stage} className=\"flex items-center justify-between\">\n                            <Label className=\"text-xs\">{statusConfig[stage].label}</Label>\n                            <Input\n                              type=\"number\"\n                              min=\"0\"\n                              value={wipLimits[stage]}\n                              onChange={(e) => setWipLimits(prev => ({\n                                ...prev,\n                                [stage]: parseInt(e.target.value) || 0\n                              }))}\n                              className=\"w-20 h-8\"\n                            />\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </PopoverContent>\n                </Popover>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {loading ? (\n          <div className=\"text-center py-12\">Loading shipments...</div>\n        ) : (\n          <DndContext sensors={sensors} onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n            <div className=\"space-y-4\">\n              {swimLanes.map((lane) => {\n                const laneGroupedShipments = stages.reduce((acc, stage) => {\n                  acc[stage] = lane.shipments.filter((shipment) => shipment.status === stage);\n                  return acc;\n                }, {} as Record<ShipmentStatus, Shipment[]>);\n\n                const totalCharges = lane.shipments.reduce((sum, s) => sum + (s.total_charges || 0), 0);\n                const totalPackages = lane.shipments.reduce((sum, s) => sum + (s.total_packages || 0), 0);\n\n                return (\n                  <SwimLane\n                    key={lane.id}\n                    id={lane.id}\n                    title={lane.title}\n                    count={lane.shipments.length}\n                    metrics={[\n                      { label: 'Total Charges', value: formatCurrency(totalCharges, 'USD') },\n                      { label: 'Packages', value: totalPackages },\n                    ]}\n                  >\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-8 gap-4\">\n                      {(selectedStages.length > 0 ? selectedStages : stages).map((stage) => (\n                        <Droppable key={stage} id={stage}>\n                          <Card className=\"h-full transition-all duration-200 hover:shadow-md\">\n                            <CardHeader className=\"pb-3\">\n                              <CardTitle className=\"text-sm font-medium flex items-center justify-between\">\n                                <span>{statusConfig[stage].label}</span>\n                                <div className=\"flex items-center gap-2\">\n                                  <Badge \n                                    variant=\"secondary\" \n                                    className={`${statusConfig[stage].color} transition-all duration-200`}\n                                  >\n                                    {laneGroupedShipments[stage].length}\n                                  </Badge>\n                                  <Select value={stageSort[stage]} onValueChange={(v) => setStageSort(prev => ({ ...prev, [stage]: v as SortMode }))}>\n                                    <SelectTrigger className=\"h-7 w-[120px] text-xs\">\n                                      <SelectValue placeholder=\"Sort\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      <SelectItem value=\"default\">Default</SelectItem>\n                                      <SelectItem value=\"created_at\">Newest</SelectItem>\n                                      <SelectItem value=\"pickup_date\">Pickup Date</SelectItem>\n                                      <SelectItem value=\"charges\">Charges</SelectItem>\n                                    </SelectContent>\n                                  </Select>\n                                  {wipLimits[stage] < 999 && laneGroupedShipments[stage].length >= wipLimits[stage] && (\n                                    <AlertCircle className=\"h-4 w-4 text-destructive\" />\n                                  )}\n                                </div>\n                              </CardTitle>\n                              {wipLimits[stage] < 999 && (\n                                <div className=\"text-xs text-muted-foreground\">\n                                  Limit: {wipLimits[stage]} \n                                  {laneGroupedShipments[stage].length > wipLimits[stage] && (\n                                    <span className=\"text-destructive ml-1\">\n                                      (+{laneGroupedShipments[stage].length - wipLimits[stage]} over)\n                                    </span>\n                                  )}\n                                </div>\n                              )}\n                            </CardHeader>\n                            <CardContent className=\"space-y-2 min-h-[200px]\">\n                              {(() => {\n                                const stageShipments = [...laneGroupedShipments[stage]];\n                                const mode = stageSort[stage];\n                                stageShipments.sort((a, b) => {\n                                  switch (mode) {\n                                    case 'pickup_date': {\n                                      const ad = new Date(a.pickup_date || a.created_at).getTime();\n                                      const bd = new Date(b.pickup_date || b.created_at).getTime();\n                                      return ad - bd;\n                                    }\n                                    case 'charges': {\n                                      const ac = a.total_charges || 0;\n                                      const bc = b.total_charges || 0;\n                                      return bc - ac; // high to low\n                                    }\n                                    case 'created_at': {\n                                      const ac = new Date(a.created_at).getTime();\n                                      const bc = new Date(b.created_at).getTime();\n                                      return bc - ac; // newest first\n                                    }\n                                    default:\n                                      return 0;\n                                  }\n                                });\n                                return stageShipments;\n                              })().map((shipment) => (\n                                <Draggable key={shipment.id} id={shipment.id}>\n                                  <Card\n                                    className=\"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02] hover:-translate-y-1 animate-fade-in relative\"\n                                    onClick={(e) => {\n                                      if (bulkMode) {\n                                        e.stopPropagation();\n                                        toggleShipmentSelection(shipment.id);\n                                      } else {\n                                        navigate(`/dashboard/shipments/${shipment.id}`);\n                                      }\n                                    }}\n                                  >\n                                    <CardContent className=\"p-3 space-y-2\">\n                                      {bulkMode && (\n                                        <div className=\"absolute top-2 right-2 z-10\">\n                                          {selectedShipments.has(shipment.id) ? (\n                                            <CheckSquare className=\"h-4 w-4 text-primary\" />\n                                          ) : (\n                                            <Square className=\"h-4 w-4 text-muted-foreground\" />\n                                          )}\n                                        </div>\n                                      )}\n                                      <div className=\"flex items-start justify-between\">\n                                        <div className=\"font-medium text-sm\">{shipment.shipment_number}</div>\n                                        <div className=\"flex items-center gap-2\">\n                                          {!shipment.pod_received && shipment.status === 'delivered' && (\n                                            <Badge className=\"bg-red-500/10 text-red-600\">POD Pending</Badge>\n                                          )}\n                                          {shipment.priority_level && (\n                                            <Badge\n                                              variant=\"outline\"\n                                              className={`transition-all duration-200 ${\n                                                shipment.priority_level === \"high\"\n                                                  ? \"bg-red-500/10 hover:bg-red-500/20\"\n                                                  : shipment.priority_level === \"medium\"\n                                                  ? \"bg-yellow-500/10 hover:bg-yellow-500/20\"\n                                                  : \"bg-blue-500/10 hover:bg-blue-500/20\"\n                                              }`}\n                                            >\n                                              {shipment.priority_level}\n                                            </Badge>\n                                          )}\n                                        </div>\n                                      </div>\n                                      {showFields.origin && (\n                                        <div className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                                          <MapPin className=\"h-3 w-3\" />\n                                          <span>{getLocationString(shipment.origin_address)}</span>\n                                        </div>\n                                      )}\n                                      {showFields.destination && (\n                                        <div className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                                          <MapPin className=\"h-3 w-3\" />\n                                          <span>{getLocationString(shipment.destination_address)}</span>\n                                        </div>\n                                      )}\n                                      {showFields.packages && shipment.total_packages && (\n                                        <div className=\"flex items-center gap-1 text-xs\">\n                                          <Package className=\"h-3 w-3\" />\n                                          <span>{shipment.total_packages} packages</span>\n                                        </div>\n                                      )}\n                                      {showFields.weight && shipment.total_weight_kg && (\n                                        <div className=\"text-xs text-muted-foreground\">\n                                          Weight: {shipment.total_weight_kg} kg\n                                        </div>\n                                      )}\n                                      {showFields.charges && shipment.total_charges && (\n                                        <div className=\"text-xs font-semibold text-primary\">\n                                          {formatCurrency(shipment.total_charges, shipment.currency)}\n                                        </div>\n                                      )}\n                                      {showFields.deliveryDate && shipment.estimated_delivery_date && (\n                                        <div className=\"text-xs text-muted-foreground\">\n                                          ETA: {formatDate(shipment.estimated_delivery_date)}\n                                        </div>\n                                      )}\n                                      {shipment.total_charges && (\n                                        <div className=\"text-xs font-semibold text-primary\">\n                                          {formatCurrency(shipment.total_charges, shipment.currency)}\n                                        </div>\n                                      )}\n                                      {!shipment.pod_received && shipment.status === 'delivered' && (\n                                        <div className=\"flex items-center justify-end\">\n                                          <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            className=\"h-7 px-2 text-xs\"\n                                            onClick={(e) => { e.stopPropagation(); handleMarkPodReceived(shipment.id); }}\n                                          >\n                                            <CheckCircle2 className=\"h-4 w-4 mr-1\" /> Mark POD Received\n                                          </Button>\n                                        </div>\n                                      )}\n                                    </CardContent>\n                                  </Card>\n                                </Draggable>\n                              ))}\n                              {laneGroupedShipments[stage].length === 0 && (\n                                <div className=\"text-xs text-muted-foreground text-center py-4\">\n                                  No shipments\n                                </div>\n                              )}\n                            </CardContent>\n                          </Card>\n                        </Droppable>\n                      ))}\n                    </div>\n                  </SwimLane>\n                );\n              })}\n            </div>\n            <DragOverlay>\n              {activeShipment ? (\n                <Card className=\"w-64 shadow-2xl rotate-3 scale-105 border-2 border-primary animate-scale-in\">\n                  <CardContent className=\"p-3 space-y-2 bg-gradient-to-br from-background to-muted\">\n                    <div className=\"font-medium text-sm\">{activeShipment.shipment_number}</div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      {getLocationString(activeShipment.origin_address)} {\" \"}\n                      {getLocationString(activeShipment.destination_address)}\n                    </div>\n                    {activeShipment.total_charges && (\n                      <div className=\"text-xs font-semibold text-primary\">\n                        {formatCurrency(activeShipment.total_charges, activeShipment.currency)}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              ) : null}\n            </DragOverlay>\n          </DndContext>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/SubscriptionManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[986,989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[986,989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchData' and 'fetchTenants'. Either include them or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":67,"suggestions":[{"desc":"Update the dependencies array to be: [context.tenantId, context.isPlatformAdmin, selectedTenantId, fetchData, fetchTenants]","fix":{"range":[1892,1953],"text":"[context.tenantId, context.isPlatformAdmin, selectedTenantId, fetchData, fetchTenants]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3245,3248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3245,3248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5471,5474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5471,5474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { PlanCard } from '@/components/subscription/PlanCard';\nimport { UsageMetrics } from '@/components/subscription/UsageMetrics';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { CreditCard, Package, TrendingUp } from 'lucide-react';\nimport { format } from 'date-fns';\n\ninterface Plan {\n  id: string;\n  name: string;\n  slug: string;\n  description: string | null;\n  price_monthly: number;\n  price_annual: number | null;\n  tier: string | null;\n  features: any;\n  billing_period: string;\n  is_active: boolean;\n  plan_type: string;\n}\n\ninterface Subscription {\n  id: string;\n  plan_id: string;\n  status: string;\n  current_period_start: string;\n  current_period_end: string;\n  trial_end: string | null;\n  subscription_plans: Plan;\n}\n\nexport default function SubscriptionManagement() {\n  const [currentSubscription, setCurrentSubscription] = useState<Subscription | null>(null);\n  const [availablePlans, setAvailablePlans] = useState<Plan[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { supabase, context, user } = useCRM();\n  const [tenants, setTenants] = useState<Array<{ id: string; name: string }>>([]);\n  const [selectedTenantId, setSelectedTenantId] = useState<string | null>(null);\n\n  useEffect(() => {\n    // Load tenants for platform admins to pick scope\n    if (context.isPlatformAdmin) {\n      fetchTenants();\n    }\n    fetchData();\n  }, [context.tenantId, context.isPlatformAdmin, selectedTenantId]);\n\n  const fetchData = async () => {\n    try {\n      // Fetch available plans first (public read)\n      const { data: plansData, error: plansError } = await supabase\n        .from('subscription_plans')\n        .select('*')\n        .eq('is_active', true)\n        .eq('plan_type', 'crm_base')\n        .order('price_monthly');\n\n      if (plansError) throw plansError;\n      setAvailablePlans(plansData || []);\n\n      // Fetch current subscription for the effective tenant scope\n      const tenantScope = context.isPlatformAdmin ? selectedTenantId : context.tenantId;\n      if (tenantScope) {\n        const { data: subData, error: subError } = await supabase\n          .from('tenant_subscriptions')\n          .select('*, subscription_plans(*)')\n          .eq('tenant_id', tenantScope)\n          .eq('status', 'active')\n          .order('created_at', { ascending: false })\n          .limit(1)\n          .maybeSingle();\n\n        if (subError) {\n          // Soft-fail: keep page usable even without subscription visibility\n          console.warn('Subscription fetch blocked or failed:', subError.message);\n          setCurrentSubscription(null);\n        } else {\n          setCurrentSubscription(subData);\n        }\n      } else {\n        setCurrentSubscription(null);\n      }\n    } catch (error: any) {\n      toast.error('Failed to load plans');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchTenants = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tenants')\n        .select('id, name')\n        .eq('is_active', true)\n        .order('name');\n      if (error) throw error;\n      setTenants(data || []);\n    } catch (error) {\n      console.warn('Failed to load tenants', error);\n    }\n  };\n\n  const handleSelectPlan = async (planId: string) => {\n    try {\n      const selectedPlan = availablePlans.find(p => p.id === planId);\n      if (!selectedPlan) return;\n      if (!selectedPlan.is_active) {\n        toast.error('This plan is currently unavailable.');\n        return;\n      }\n\n      // Resolve tenant_id robustly\n      let effectiveTenantId: string | undefined = context.isPlatformAdmin\n        ? (selectedTenantId ?? undefined)\n        : context.tenantId;\n      if (!effectiveTenantId && user?.id) {\n        const { data: tid, error: tidError } = await supabase.rpc('get_user_tenant_id', { check_user_id: user.id });\n        if (tidError) {\n          console.warn('Failed to resolve tenant_id via RPC:', tidError.message);\n        }\n        effectiveTenantId = tid as string | undefined;\n      }\n\n      if (!effectiveTenantId) {\n        throw new Error('Select a tenant to subscribe, or switch to a tenant role.');\n      }\n\n      // Cancel current subscription\n      if (currentSubscription) {\n        await supabase\n          .from('tenant_subscriptions')\n          .update({ status: 'canceled', canceled_at: new Date().toISOString() })\n          .eq('id', currentSubscription.id);\n      }\n\n      // Create new subscription\n      const { error } = await supabase\n        .from('tenant_subscriptions')\n        .insert([{ \n          tenant_id: effectiveTenantId,\n          plan_id: planId,\n          status: 'active',\n          current_period_start: new Date().toISOString(),\n          current_period_end: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n        }]);\n\n      if (error) throw error;\n\n      toast.success(`Successfully subscribed to ${selectedPlan.name}`);\n      fetchData();\n    } catch (error: any) {\n      toast.error('Failed to update subscription: ' + (error?.message || 'Unknown error'));\n      console.error('Error:', error);\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      active: 'bg-green-500/10 text-green-500',\n      trial: 'bg-blue-500/10 text-blue-500',\n      past_due: 'bg-red-500/10 text-red-500',\n      canceled: 'bg-gray-500/10 text-gray-500',\n      expired: 'bg-gray-600/10 text-gray-600',\n    };\n    return colors[status] || 'bg-gray-500/10 text-gray-500';\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">Loading subscription data...</div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Subscription Management</h1>\n          <p className=\"text-muted-foreground\">Manage your subscription plans and usage</p>\n        </div>\n\n        {context.isPlatformAdmin && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Tenant Scope</CardTitle>\n              <CardDescription>Select a tenant to manage subscriptions</CardDescription>\n            </CardHeader>\n            <CardContent className=\"flex items-center gap-3\">\n              <Select\n                value={selectedTenantId || ''}\n                onValueChange={(v) => setSelectedTenantId(v)}\n              >\n                <SelectTrigger className=\"w-[280px]\">\n                  <SelectValue placeholder=\"Choose a tenant\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {tenants.map((t) => (\n                    <SelectItem key={t.id} value={t.id}>\n                      {t.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {!selectedTenantId && (\n                <span className=\"text-sm text-muted-foreground\">Pick a tenant to enable plan selection</span>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {currentSubscription && (\n          <div className=\"grid gap-4 md:grid-cols-3\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Current Plan</CardTitle>\n                <Package className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{currentSubscription.subscription_plans.name}</div>\n                <Badge className={getStatusColor(currentSubscription.status)} variant=\"outline\">\n                  {currentSubscription.status}\n                </Badge>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Monthly Cost</CardTitle>\n                <CreditCard className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">\n                  ${currentSubscription.subscription_plans.price_monthly}\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  per {currentSubscription.subscription_plans.billing_period}\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Renewal Date</CardTitle>\n                <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">\n                  {format(new Date(currentSubscription.current_period_end), 'MMM dd')}\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {format(new Date(currentSubscription.current_period_end), 'yyyy')}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        <Tabs defaultValue=\"plans\" className=\"space-y-6\">\n          <TabsList>\n            <TabsTrigger value=\"plans\">Available Plans</TabsTrigger>\n            <TabsTrigger value=\"usage\">Usage & Billing</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"plans\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Choose Your Plan</CardTitle>\n                <CardDescription>\n                  Select the plan that best fits your business needs\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n                  {availablePlans.map((plan) => (\n                    <PlanCard\n                      key={plan.id}\n                      plan={plan}\n                      isCurrentPlan={currentSubscription?.plan_id === plan.id}\n                      onSelect={handleSelectPlan}\n                      showActions={true}\n                    />\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"usage\" className=\"space-y-4\">\n            {context.tenantId && <UsageMetrics tenantId={context.tenantId} />}\n            \n            <Card>\n              <CardHeader>\n                <CardTitle>Billing History</CardTitle>\n                <CardDescription>View your past invoices and payments</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground text-center py-8\">\n                  No billing history available yet\n                </p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/TenantDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[945,948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[945,948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTenant'. Either include it or remove the dependency array.","line":31,"column":6,"nodeType":"ArrayExpression","endLine":31,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTenant, id]","fix":{"range":[1050,1054],"text":"[fetchTenant, id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1310,1313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1310,1313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1830,1833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1830,1833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { TenantForm } from '@/components/admin/TenantForm';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Building2, Trash2, ArrowLeft } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog';\n\nexport default function TenantDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [tenant, setTenant] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchTenant();\n  }, [id]);\n\n  const fetchTenant = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tenants')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      setTenant(data);\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const { error } = await supabase\n        .from('tenants')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast({\n        title: 'Success',\n        description: 'Tenant deleted successfully',\n      });\n      navigate('/dashboard/tenants');\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    }\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8\">Loading...</div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!tenant) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8\">Tenant not found</div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/tenants')}>\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">{tenant.name}</h1>\n              <p className=\"text-muted-foreground\">Edit tenant details</p>\n            </div>\n          </div>\n          <AlertDialog>\n            <AlertDialogTrigger asChild>\n              <Button variant=\"destructive\" size=\"icon\">\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </AlertDialogTrigger>\n            <AlertDialogContent>\n              <AlertDialogHeader>\n                <AlertDialogTitle>Delete Tenant</AlertDialogTitle>\n                <AlertDialogDescription>\n                  Are you sure you want to delete this tenant? This action cannot be undone.\n                </AlertDialogDescription>\n              </AlertDialogHeader>\n              <AlertDialogFooter>\n                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                <AlertDialogAction onClick={handleDelete}>Delete</AlertDialogAction>\n              </AlertDialogFooter>\n            </AlertDialogContent>\n          </AlertDialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5\" />\n              Tenant Information\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <TenantForm tenant={tenant} onSuccess={fetchTenant} />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/TenantNew.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/TenantSubscription.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1142,1145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1142,1145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchData' and 'navigate'. Either include them or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [context.isPlatformAdmin, fetchData, navigate]","fix":{"range":[1453,1478],"text":"[context.isPlatformAdmin, fetchData, navigate]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2329,2332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2329,2332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3416,3419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3416,3419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\nimport { Building2, CreditCard } from 'lucide-react';\nimport { format } from 'date-fns';\n\ninterface Tenant {\n  id: string;\n  name: string;\n  tenant_subscriptions: Array<{\n    id: string;\n    status: string;\n    current_period_end: string;\n    subscription_plans: {\n      name: string;\n      price_monthly: number;\n    };\n  }>;\n}\n\nexport default function TenantSubscription() {\n  const navigate = useNavigate();\n  const [tenants, setTenants] = useState<Tenant[]>([]);\n  const [plans, setPlans] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedPlan, setSelectedPlan] = useState<Record<string, string>>({});\n  const { supabase, context } = useCRM();\n\n  useEffect(() => {\n    if (!context.isPlatformAdmin) {\n      navigate('/dashboard');\n      return;\n    }\n    fetchData();\n  }, [context.isPlatformAdmin]);\n\n  const fetchData = async () => {\n    try {\n      // Fetch tenants with subscriptions\n      const { data: tenantsData, error: tenantsError } = await supabase\n        .from('tenants')\n        .select(`\n          *,\n          tenant_subscriptions(\n            id,\n            status,\n            current_period_end,\n            subscription_plans(name, price_monthly)\n          )\n        `)\n        .order('name');\n\n      if (tenantsError) throw tenantsError;\n      setTenants(tenantsData || []);\n\n      // Fetch available plans\n      const { data: plansData, error: plansError } = await supabase\n        .from('subscription_plans')\n        .select('*')\n        .eq('is_active', true)\n        .eq('plan_type', 'crm_base')\n        .order('price_monthly');\n\n      if (plansError) throw plansError;\n      setPlans(plansData || []);\n    } catch (error: any) {\n      toast.error('Failed to load data');\n      console.error('Error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAssignPlan = async (tenantId: string) => {\n    const planId = selectedPlan[tenantId];\n    if (!planId) {\n      toast.error('Please select a plan');\n      return;\n    }\n\n    try {\n      // Cancel existing active subscriptions\n      await supabase\n        .from('tenant_subscriptions')\n        .update({ status: 'canceled', canceled_at: new Date().toISOString() })\n        .eq('tenant_id', tenantId)\n        .eq('status', 'active');\n\n      // Create new subscription\n      const { error } = await supabase\n        .from('tenant_subscriptions')\n        .insert([{\n          tenant_id: tenantId,\n          plan_id: planId,\n          status: 'active',\n          current_period_start: new Date().toISOString(),\n          current_period_end: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n        }]);\n\n      if (error) throw error;\n\n      toast.success('Plan assigned successfully');\n      fetchData();\n    } catch (error: any) {\n      toast.error('Failed to assign plan: ' + error.message);\n      console.error('Error:', error);\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      active: 'bg-green-500/10 text-green-500',\n      trial: 'bg-blue-500/10 text-blue-500',\n      past_due: 'bg-red-500/10 text-red-500',\n      canceled: 'bg-gray-500/10 text-gray-500',\n      expired: 'bg-gray-600/10 text-gray-600',\n    };\n    return colors[status] || 'bg-gray-500/10 text-gray-500';\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-12\">Loading...</div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Tenant Subscriptions</h1>\n          <p className=\"text-muted-foreground\">Manage subscription plans for all tenants</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Tenant Plans Assignment</CardTitle>\n            <CardDescription>Assign and manage subscription plans for each tenant</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Tenant</TableHead>\n                  <TableHead>Current Plan</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Renewal Date</TableHead>\n                  <TableHead>Monthly Cost</TableHead>\n                  <TableHead>Assign New Plan</TableHead>\n                  <TableHead>Action</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {tenants.map((tenant) => {\n                  const activeSub = tenant.tenant_subscriptions?.find(s => s.status === 'active');\n                  \n                  return (\n                    <TableRow key={tenant.id}>\n                      <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                          {tenant.name}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {activeSub ? activeSub.subscription_plans.name : 'No Plan'}\n                      </TableCell>\n                      <TableCell>\n                        {activeSub ? (\n                          <Badge className={getStatusColor(activeSub.status)}>\n                            {activeSub.status}\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"outline\">Inactive</Badge>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {activeSub \n                          ? format(new Date(activeSub.current_period_end), 'MMM dd, yyyy')\n                          : '-'\n                        }\n                      </TableCell>\n                      <TableCell>\n                        {activeSub ? (\n                          <div className=\"flex items-center gap-1\">\n                            <CreditCard className=\"h-4 w-4 text-muted-foreground\" />\n                            ${activeSub.subscription_plans.price_monthly}\n                          </div>\n                        ) : '-'}\n                      </TableCell>\n                      <TableCell>\n                        <Select\n                          value={selectedPlan[tenant.id] || ''}\n                          onValueChange={(value) => setSelectedPlan({ ...selectedPlan, [tenant.id]: value })}\n                        >\n                          <SelectTrigger className=\"w-[200px]\">\n                            <SelectValue placeholder=\"Select plan\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {plans.map((plan) => (\n                              <SelectItem key={plan.id} value={plan.id}>\n                                {plan.name} - ${plan.price_monthly}/mo\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </TableCell>\n                      <TableCell>\n                        <Button\n                          size=\"sm\"\n                          onClick={() => handleAssignPlan(tenant.id)}\n                          disabled={!selectedPlan[tenant.id]}\n                        >\n                          Assign\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n\n            {tenants.length === 0 && (\n              <p className=\"text-center py-8 text-muted-foreground\">\n                No tenants found\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Tenants.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTenants'. Either include it or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTenants]","fix":{"range":[1040,1042],"text":"[fetchTenants]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Plus, Building2 } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\n\nexport default function Tenants() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  interface Tenant {\n    id: string;\n    name: string;\n    slug: string;\n    domain: string | null;\n    subscription_tier: string | null;\n    is_active: boolean;\n    created_at: string;\n  }\n  const [tenants, setTenants] = useState<Tenant[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchTenants();\n  }, []);\n\n  const fetchTenants = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tenants')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setTenants(data || []);\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast({ title: 'Error', description: message, variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Tenants</h1>\n            <p className=\"text-muted-foreground\">Manage organization tenants</p>\n          </div>\n          <Button onClick={() => navigate('/dashboard/tenants/new')}>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New Tenant\n          </Button>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5\" />\n              All Tenants\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"text-center py-8\">Loading...</div>\n            ) : tenants.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No tenants found. Create your first tenant to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Slug</TableHead>\n                    <TableHead>Domain</TableHead>\n                    <TableHead>Subscription</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Created</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {tenants.map((tenant) => (\n                    <TableRow\n                      key={tenant.id}\n                      className=\"cursor-pointer\"\n                      onClick={() => navigate(`/dashboard/tenants/${tenant.id}`)}\n                    >\n                      <TableCell className=\"font-medium\">{tenant.name}</TableCell>\n                      <TableCell>{tenant.slug}</TableCell>\n                      <TableCell>{tenant.domain || '-'}</TableCell>\n                      <TableCell>{tenant.subscription_tier || 'Free'}</TableCell>\n                      <TableCell>\n                        <Badge variant={tenant.is_active ? 'default' : 'secondary'}>\n                          {tenant.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {new Date(tenant.created_at).toLocaleDateString()}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ThemeManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3310,3313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3310,3313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3390,3393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3390,3393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3579,3582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3579,3582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3686,3689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3686,3689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3803,3806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3803,3806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'accent', 'angle', 'dark', 'primary', 'radius', 'sidebarAccent', and 'sidebarBackground'. Either include them or remove the dependency array. You can also do a functional update 'setPrimary(p => ...)' if you only need 'primary' in the 'setPrimary' call.","line":70,"column":6,"nodeType":"ArrayExpression","endLine":70,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [accent, activeThemeName, angle, dark, primary, radius, sidebarAccent, sidebarBackground, themes]","fix":{"range":[3907,3932],"text":"[accent, activeThemeName, angle, dark, primary, radius, sidebarAccent, sidebarBackground, themes]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4150,4153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4150,4153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'setScope'. Either include it or remove the dependency array.","line":78,"column":6,"nodeType":"ArrayExpression","endLine":78,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams, setScope]","fix":{"range":[4167,4181],"text":"[searchParams, setScope]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9523,9526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9523,9526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9636,9639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9636,9639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9733,9736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9733,9736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9850,9853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9850,9853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9970,9973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9970,9973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16618,16621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16618,16621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":305,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16682,16685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16682,16685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":306,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":306,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16744,16747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16744,16747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17089,17092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17089,17092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":312,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17180,17183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17180,17183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17319,17322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17319,17322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17355,17358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17355,17358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17446,17449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17446,17449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18465,18468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18465,18468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18533,18536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18533,18536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":333,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18599,18602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18599,18602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18686,18689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18686,18689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18781,18784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18781,18784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18924,18927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18924,18927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18960,18963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18960,18963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":337,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19055,19058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19055,19058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":338,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19178,19181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19178,19181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19840,19843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19840,19843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":352,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":352,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19905,19908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19905,19908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":353,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19968,19971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19968,19971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20379,20382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20379,20382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":360,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20471,20474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20471,20474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20611,20614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20611,20614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20647,20650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20647,20650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":362,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20739,20742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20739,20742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":38,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { HslPicker } from '@/components/ui/hsl-picker';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { THEME_PRESETS } from '@/theme/themes';\nimport { useTheme } from '@/hooks/useTheme';\nimport { useCRM } from '@/hooks/useCRM';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\n\nexport default function ThemeManagement() {\n  const { themes, applyTheme, saveTheme, setActive, activeThemeName, toggleDark, scope, setScope } = useTheme();\n  const { context } = useCRM();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [name, setName] = useState('Custom Theme');\n  const [start, setStart] = useState('217 91% 60%');\n  const [end, setEnd] = useState('197 71% 52%');\n  const [primary, setPrimary] = useState('217 91% 60%');\n  const [accent, setAccent] = useState('197 71% 52%');\n  const [titleStrip, setTitleStrip] = useState('197 71% 52%');\n  // Table header tokens\n  const [tableHeaderText, setTableHeaderText] = useState('0 0% 100%');\n  const [tableHeaderSeparator, setTableHeaderSeparator] = useState<string | undefined>(undefined);\n  const [tableHeaderBackground, setTableHeaderBackground] = useState<string | undefined>(undefined);\n  const [tableBackground, setTableBackground] = useState<string | undefined>(undefined);\n  const [tableForeground, setTableForeground] = useState<string | undefined>(undefined);\n  const [angle, setAngle] = useState(135);\n  // Main page background gradient overrides (default to primary gradient)\n  const [bgStart, setBgStart] = useState<string | undefined>(undefined);\n  const [bgEnd, setBgEnd] = useState<string | undefined>(undefined);\n  const [bgAngle, setBgAngle] = useState<number | undefined>(undefined);\n  const [radius, setRadius] = useState('0.75rem');\n  const [sidebarBackground, setSidebarBackground] = useState('222 47% 11%');\n  const [sidebarAccent, setSidebarAccent] = useState('217 32% 17%');\n  const [dark, setDark] = useState(false);\n  const [open, setOpen] = useState(false);\n\n  // Removed local HSL/HEX helpers (now handled by HslPicker)\n\n  useEffect(() => {\n    if (activeThemeName) {\n      const found = themes.find(t => t.name === activeThemeName);\n      if (found) {\n        setName(found.name);\n        setStart(found.start);\n        setEnd(found.end);\n        setPrimary(found.primary || primary);\n        setAccent(found.accent || accent);\n        setAngle(found.angle ?? angle);\n        setBgStart(found.bgStart ?? found.start);\n        setBgEnd(found.bgEnd ?? found.end);\n        setBgAngle(found.bgAngle ?? found.angle ?? angle);\n        setRadius(found.radius ?? radius);\n        setSidebarBackground(found.sidebarBackground || sidebarBackground);\n        setSidebarAccent(found.sidebarAccent || sidebarAccent);\n        setDark(found.dark ?? dark);\n        // Table header tokens (fallback to accessible defaults by mode)\n        setTableHeaderText((found as any).tableHeaderText || '0 0% 100%');\n        setTableHeaderSeparator((found as any).tableHeaderSeparator || ((found?.dark ?? dark) ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'));\n        // New table header/table background tokens\n        setTableHeaderBackground((found as any).tableHeaderBackground || found.titleStrip || accent || primary);\n        setTableBackground((found as any).tableBackground || ((found?.dark ?? dark) ? '222 47% 11%' : '0 0% 100%'));\n        setTableForeground((found as any).tableForeground || ((found?.dark ?? dark) ? '210 40% 98%' : '222.2 84% 4.9%'));\n      }\n    }\n  }, [activeThemeName, themes]);\n\n  // Honor scope from query parameter if provided\n  useEffect(() => {\n    const s = searchParams.get('scope');\n    if (s === 'user' || s === 'franchise' || s === 'tenant' || s === 'platform') {\n      setScope(s as any);\n    }\n  }, [searchParams]);\n\n  const canWrite = useMemo(() => {\n    if (scope === 'user') return !!context?.userId;\n    if (scope === 'franchise') return !!context?.isFranchiseAdmin;\n    if (scope === 'tenant') return !!context?.isTenantAdmin;\n    if (scope === 'platform') return !!context?.isPlatformAdmin;\n    return false;\n  }, [scope, context?.userId, context?.isFranchiseAdmin, context?.isTenantAdmin, context?.isPlatformAdmin]);\n\n  const allThemes = useMemo(() => {\n    return [...THEME_PRESETS, ...themes];\n  }, [themes]);\n\n  const resetTableDefaults = () => {\n    // Apply theme without explicit table tokens to trigger dynamic defaults\n    applyTheme({\n      start,\n      end,\n      primary,\n      accent,\n      titleStrip,\n      angle,\n      radius,\n      sidebarBackground,\n      sidebarAccent,\n      dark,\n      bgStart: bgStart ?? start,\n      bgEnd: bgEnd ?? end,\n      bgAngle: bgAngle ?? angle,\n    });\n    // Read computed CSS variables set by applyTheme\n    const root = document.documentElement;\n    const readVar = (name: string) => getComputedStyle(root).getPropertyValue(name).trim();\n    const nextHeaderBg = readVar('--table-header-background');\n    const nextTableBg = readVar('--table-background');\n    const nextHeaderText = readVar('--table-header-text');\n    const nextSeparator = readVar('--table-header-separator');\n    const nextTableFg = readVar('--table-foreground');\n    if (nextHeaderBg) setTableHeaderBackground(nextHeaderBg);\n    if (nextTableBg) setTableBackground(nextTableBg);\n    if (nextHeaderText) setTableHeaderText(nextHeaderText);\n    if (nextSeparator) setTableHeaderSeparator(nextSeparator);\n    if (nextTableFg) setTableForeground(nextTableFg);\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Theme Management</h1>\n          <p className=\"text-muted-foreground\">Create, preview, and apply gradient themes.</p>\n        </div>\n\n        <Card>\n          <CardContent>\n            <div className=\"flex items-center gap-2\">\n              <Label className=\"mr-2\">Scope</Label>\n              <Button\n                variant={scope === 'user' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => { setScope('user'); setSearchParams({ scope: 'user' }); }}\n              >User</Button>\n              <Button\n                variant={scope === 'franchise' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => { setScope('franchise'); setSearchParams({ scope: 'franchise' }); }}\n              >Franchise</Button>\n              <Button\n                variant={scope === 'tenant' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => { setScope('tenant'); setSearchParams({ scope: 'tenant' }); }}\n              >Tenant</Button>\n              <Button\n                variant={scope === 'platform' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => { setScope('platform'); setSearchParams({ scope: 'platform' }); }}\n              >Platform</Button>\n              {!canWrite && (\n                <span className=\"ml-3 text-xs text-muted-foreground\">View-only for this scope</span>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Create / Preview</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid gap-4 md:grid-cols-6\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm\">Theme Name</label>\n                <Input value={name} onChange={(e) => setName(e.target.value)} />\n              </div>\n              <HslPicker label=\"Gradient Start\" value={start} onChange={setStart} />\n              <HslPicker label=\"Gradient End\" value={end} onChange={setEnd} />\n              <HslPicker label=\"Primary\" value={primary} onChange={setPrimary} />\n              <HslPicker label=\"Accent\" value={accent} onChange={setAccent} />\n              <HslPicker label=\"List Title Strip\" value={titleStrip} onChange={setTitleStrip} />\n              <HslPicker label=\"Table Header Text\" value={tableHeaderText} onChange={setTableHeaderText} />\n              <HslPicker label=\"Table Header Separator\" value={tableHeaderSeparator ?? (dark ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2')} onChange={(v) => setTableHeaderSeparator(v)} />\n              <HslPicker label=\"Table Header Background\" value={tableHeaderBackground ?? titleStrip} onChange={(v) => setTableHeaderBackground(v)} />\n              <HslPicker label=\"Table Background\" value={tableBackground ?? (dark ? '222 47% 11%' : '0 0% 100%')} onChange={(v) => setTableBackground(v)} />\n              <HslPicker label=\"Table Text\" value={tableForeground ?? (dark ? '210 40% 98%' : '222.2 84% 4.9%')} onChange={(v) => setTableForeground(v)} />\n              <div className=\"col-span-full\">\n                <Button variant=\"outline\" size=\"sm\" onClick={resetTableDefaults}>Reset Table Defaults</Button>\n              </div>\n            </div>\n\n            {/* Live Table Preview */}\n            <div className=\"mt-4\">\n              <div className=\"text-sm font-medium mb-2\">Table Preview</div>\n              <div\n                className=\"border rounded-lg overflow-hidden\"\n                style={{\n                  [\"--table-background\" as any]: tableBackground ?? (dark ? '222 47% 11%' : '0 0% 100%'),\n                  [\"--table-header-background\" as any]: tableHeaderBackground ?? titleStrip ?? accent,\n                  [\"--table-header-text\" as any]: tableHeaderText ?? (dark ? '210 40% 98%' : '222.2 84% 4.9%'),\n                  [\"--table-header-separator\" as any]: tableHeaderSeparator ?? (dark ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'),\n                  [\"--table-foreground\" as any]: tableForeground ?? (dark ? '210 40% 98%' : '222.2 84% 4.9%'),\n                }}\n              >\n                <div className=\"p-3\">\n                  <table className=\"w-full caption-bottom text-sm border-collapse bg-[hsl(var(--table-background))] text-[hsl(var(--table-foreground))]\">\n                    <thead className=\"bg-[hsl(var(--table-header-background))] border-y border-[hsl(var(--table-header-separator))]\">\n                      <tr>\n                        <th className=\"h-11 px-3 text-left font-medium text-[hsl(var(--table-header-text))]\">Column A</th>\n                        <th className=\"h-11 px-3 text-left font-medium text-[hsl(var(--table-header-text))]\">Column B</th>\n                        <th className=\"h-11 px-3 text-left font-medium text-[hsl(var(--table-header-text))]\">Column C</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr className=\"border-b\">\n                        <td className=\"p-3\">Alpha</td>\n                        <td className=\"p-3\">Bravo</td>\n                        <td className=\"p-3\">Charlie</td>\n                      </tr>\n                      <tr className=\"border-b\">\n                        <td className=\"p-3\">Delta</td>\n                        <td className=\"p-3\">Echo</td>\n                        <td className=\"p-3\">Foxtrot</td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"grid gap-4 md:grid-cols-4 mt-4\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm\">Gradient Angle</label>\n                <div className=\"flex items-center gap-2\">\n                  <input className=\"flex-1\" type=\"range\" min={0} max={360} value={angle} onChange={(e) => setAngle(Number(e.target.value))} />\n                  <Input type=\"number\" min={0} max={360} value={angle} onChange={(e) => setAngle(Number(e.target.value))} />\n                </div>\n              </div>\n              <div className=\"col-span-full\">\n                <div className=\"text-sm font-medium mb-2\">Main Background Gradient</div>\n                <div className=\"grid gap-4 md:grid-cols-3\">\n                  <HslPicker label=\"BG Start\" value={bgStart ?? start} onChange={(v) => setBgStart(v)} />\n                  <HslPicker label=\"BG End\" value={bgEnd ?? end} onChange={(v) => setBgEnd(v)} />\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm\">BG Angle</label>\n                    <div className=\"flex items-center gap-2\">\n                      <input className=\"flex-1\" type=\"range\" min={0} max={360} value={bgAngle ?? angle} onChange={(e) => setBgAngle(Number(e.target.value))} />\n                      <Input type=\"number\" min={0} max={360} value={bgAngle ?? angle} onChange={(e) => setBgAngle(Number(e.target.value))} />\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm\">Border Radius</label>\n                <div className=\"flex items-center gap-2\">\n                  <select className=\"border rounded px-2 py-1 text-sm\" value={radius} onChange={(e) => setRadius(e.target.value)}>\n                    <option value=\"0rem\">0</option>\n                    <option value=\"0.25rem\">0.25rem</option>\n                    <option value=\"0.5rem\">0.5rem</option>\n                    <option value=\"0.75rem\">0.75rem</option>\n                    <option value=\"1rem\">1rem</option>\n                    <option value=\"1.5rem\">1.5rem</option>\n                    <option value=\"2rem\">2rem</option>\n                  </select>\n                  <Input value={radius} onChange={(e) => setRadius(e.target.value)} placeholder=\"e.g., 0.75rem\" />\n                </div>\n              </div>\n              <HslPicker label=\"Sidebar Background\" value={sidebarBackground} onChange={setSidebarBackground} />\n              <HslPicker label=\"Sidebar Accent\" value={sidebarAccent} onChange={setSidebarAccent} />\n            </div>\n\n            <div className=\"mt-4 flex items-center gap-3\">\n              <Switch checked={dark} onCheckedChange={(v) => { setDark(v); toggleDark(v); }} />\n              <Label>Dark Mode</Label>\n            </div>\n\n            <div className=\"mt-6 flex items-center gap-3\">\n              <Button onClick={() => applyTheme({ start, end, primary, accent, titleStrip, angle, radius, sidebarBackground, sidebarAccent, dark, tableHeaderText, tableHeaderSeparator: tableHeaderSeparator ?? (dark ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'), tableHeaderBackground: tableHeaderBackground ?? titleStrip, tableBackground: tableBackground ?? (dark ? '222 47% 11%' : '0 0% 100%'), tableForeground: tableForeground ?? (dark ? '210 40% 98%' : '222.2 84% 4.9%'), bgStart: bgStart ?? start, bgEnd: bgEnd ?? end, bgAngle: bgAngle ?? angle })}>Preview</Button>\n              <Button variant=\"secondary\" onClick={() => setOpen(true)} disabled={!canWrite}>Save As</Button>\n              <div className=\"flex-1 h-16 rounded-lg bg-gradient-primary shadow-primary flex items-center justify-between px-4\">\n                <Button className=\"rounded-lg\" variant=\"default\">Primary Button</Button>\n                <div className=\"rounded-lg p-3 border bg-card text-card-foreground\">Card Preview</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Presets & Saved Themes</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\">\n              {allThemes.map((p) => (\n                <div key={p.name} className=\"border rounded-lg overflow-hidden\">\n                  <div className=\"h-20 w-full\" style={{ backgroundImage: `linear-gradient(${p.angle ?? 135}deg, hsl(${p.start}) 0%, hsl(${p.end}) 100%)` }} />\n                  <div className=\"p-3 flex items-center justify-between\">\n                    <div className=\"font-medium truncate\">{p.name}</div>\n                    <div className=\"flex gap-2\">\n                      <Button size=\"sm\" onClick={async () => {\n                        const isDarkPreset = typeof p.dark === 'boolean' ? p.dark : dark;\n                        applyTheme({\n                          start: p.start,\n                          end: p.end,\n                          primary: p.primary,\n                          accent: p.accent,\n                          angle: p.angle ?? angle,\n                          bgStart: (p as any).bgStart ?? p.start,\n                          bgEnd: (p as any).bgEnd ?? p.end,\n                          bgAngle: (p as any).bgAngle ?? p.angle ?? angle,\n                          radius: p.radius ?? radius,\n                          sidebarBackground: p.sidebarBackground ?? sidebarBackground,\n                          sidebarAccent: p.sidebarAccent ?? sidebarAccent,\n                          dark: isDarkPreset,\n                          tableHeaderText: (p as any).tableHeaderText ?? '0 0% 100%',\n                          tableHeaderSeparator: (p as any).tableHeaderSeparator ?? (isDarkPreset ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'),\n                          tableHeaderBackground: (p as any).tableHeaderBackground ?? (p as any).titleStrip ?? p.accent ?? p.primary,\n                          tableBackground: (p as any).tableBackground ?? (isDarkPreset ? '222 47% 11%' : '0 0% 100%'),\n                        });\n                        // Persist preset as a scoped theme if not yet saved, then set as default for scope\n                        if (canWrite) {\n                          const exists = themes.some(t => t.name === p.name);\n                          if (!exists) {\n                            await saveTheme({\n                              name: p.name,\n                              start: p.start,\n                              end: p.end,\n                              primary: p.primary,\n                              accent: p.accent,\n                              angle: p.angle ?? angle,\n                              radius: p.radius ?? radius,\n                              sidebarBackground: p.sidebarBackground ?? sidebarBackground,\n                              sidebarAccent: p.sidebarAccent ?? sidebarAccent,\n                              dark: isDarkPreset,\n                              bgStart: (p as any).bgStart ?? p.start,\n                              bgEnd: (p as any).bgEnd ?? p.end,\n                              bgAngle: (p as any).bgAngle ?? p.angle ?? angle,\n                              tableHeaderText: (p as any).tableHeaderText ?? '0 0% 100%',\n                              tableHeaderSeparator: (p as any).tableHeaderSeparator ?? (isDarkPreset ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'),\n                              tableHeaderBackground: (p as any).tableHeaderBackground ?? (p as any).titleStrip ?? p.accent ?? p.primary,\n                              tableBackground: (p as any).tableBackground ?? (isDarkPreset ? '222 47% 11%' : '0 0% 100%'),\n                              tableForeground: (p as any).tableForeground ?? (isDarkPreset ? '210 40% 98%' : '222.2 84% 4.9%'),\n                            });\n                          }\n                          setActive(p.name);\n                        }\n                      }}>Apply</Button>\n                      <Button size=\"sm\" variant=\"secondary\" onClick={() => {\n                        setName(`${p.name} Copy`);\n                        setStart(p.start);\n                        setEnd(p.end);\n                        setPrimary(p.primary || primary);\n                        setAccent(p.accent || accent);\n                        setAngle(p.angle ?? angle);\n                        setBgStart((p as any).bgStart ?? p.start);\n                        setBgEnd((p as any).bgEnd ?? p.end);\n                        setBgAngle((p as any).bgAngle ?? p.angle ?? angle);\n                        setRadius(p.radius ?? radius);\n                        setSidebarBackground(p.sidebarBackground ?? sidebarBackground);\n                        setSidebarAccent(p.sidebarAccent ?? sidebarAccent);\n                        const isDarkPreset = p.dark ?? dark;\n                        setDark(isDarkPreset);\n                        setTableHeaderText((p as any).tableHeaderText ?? '0 0% 100%');\n                        setTableHeaderSeparator((p as any).tableHeaderSeparator ?? (isDarkPreset ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'));\n                        setTableHeaderBackground((p as any).tableHeaderBackground ?? (p as any).titleStrip ?? p.accent ?? p.primary);\n                        setTableBackground((p as any).tableBackground ?? (isDarkPreset ? '222 47% 11%' : '0 0% 100%'));\n                        if (canWrite) setOpen(true);\n                      }}>Customize</Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Save Theme As</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-3\">\n              <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"New theme name\" />\n            </div>\n            <DialogFooter>\n              <Button disabled={!canWrite} onClick={() => {\n                saveTheme({ name, start, end, primary, accent, titleStrip, angle, radius, sidebarBackground, sidebarAccent, dark, tableHeaderText, tableHeaderSeparator: tableHeaderSeparator ?? (dark ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'), tableHeaderBackground: tableHeaderBackground ?? titleStrip, tableBackground: tableBackground ?? (dark ? '222 47% 11%' : '0 0% 100%'), tableForeground: tableForeground ?? (dark ? '210 40% 98%' : '222.2 84% 4.9%'), bgStart: bgStart ?? start, bgEnd: bgEnd ?? end, bgAngle: bgAngle ?? angle });\n                setActive(name);\n                applyTheme({ start, end, primary, accent, titleStrip, angle, radius, sidebarBackground, sidebarAccent, dark, tableHeaderText, tableHeaderSeparator: tableHeaderSeparator ?? (dark ? '0 0% 100% / 0.75' : '0 0% 0% / 0.2'), tableHeaderBackground: tableHeaderBackground ?? titleStrip, tableBackground: tableBackground ?? (dark ? '222 47% 11%' : '0 0% 100%'), tableForeground: tableForeground ?? (dark ? '210 40% 98%' : '222.2 84% 4.9%'), bgStart: bgStart ?? start, bgEnd: bgEnd ?? end, bgAngle: bgAngle ?? angle });\n                setOpen(false);\n              }}>Save</Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/ThemeManagementFull.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/TransportModes.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1365,1368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1365,1368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3802,3805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3802,3805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6342,6345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6342,6345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTransportModes } from '@/hooks/useTransportModes';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Plus, Pencil, Trash2, MoveUp, MoveDown } from 'lucide-react';\nimport * as LucideIcons from 'lucide-react';\n\ninterface TransportModeForm {\n  name: string;\n  code: string;\n  icon_name: string;\n  color: string;\n  display_order: number;\n  is_active: boolean;\n}\n\nexport default function TransportModes() {\n  const { toast } = useToast();\n  const { data: modes, refetch } = useTransportModes();\n  \n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [isEditOpen, setIsEditOpen] = useState(false);\n  const [editingMode, setEditingMode] = useState<any>(null);\n  \n  const [formData, setFormData] = useState<TransportModeForm>({\n    name: '',\n    code: '',\n    icon_name: 'Package',\n    color: 'hsl(var(--chart-1))',\n    display_order: 1000,\n    is_active: true\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      code: '',\n      icon_name: 'Package',\n      color: 'hsl(var(--chart-1))',\n      display_order: 1000,\n      is_active: true\n    });\n  };\n\n  const handleCreate = async () => {\n    if (!formData.name || !formData.code || !formData.icon_name) {\n      toast({\n        title: 'Validation Error',\n        description: 'Please fill in all required fields',\n        variant: 'destructive'\n      });\n      return;\n    }\n\n    const { error } = await supabase\n      .from('transport_modes')\n      .insert([formData]);\n\n    if (error) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive'\n      });\n    } else {\n      toast({\n        title: 'Success',\n        description: 'Transport mode created successfully'\n      });\n      setIsCreateOpen(false);\n      resetForm();\n      refetch();\n    }\n  };\n\n  const handleUpdate = async () => {\n    if (!editingMode) return;\n\n    const { error } = await supabase\n      .from('transport_modes')\n      .update({\n        name: formData.name,\n        code: formData.code,\n        icon_name: formData.icon_name,\n        color: formData.color,\n        display_order: formData.display_order,\n        is_active: formData.is_active\n      })\n      .eq('id', editingMode.id);\n\n    if (error) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive'\n      });\n    } else {\n      toast({\n        title: 'Success',\n        description: 'Transport mode updated successfully'\n      });\n      setIsEditOpen(false);\n      setEditingMode(null);\n      resetForm();\n      refetch();\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Are you sure you want to delete this transport mode?')) return;\n\n    const { error } = await supabase\n      .from('transport_modes')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive'\n      });\n    } else {\n      toast({\n        title: 'Success',\n        description: 'Transport mode deleted successfully'\n      });\n      refetch();\n    }\n  };\n\n  const openEdit = (mode: any) => {\n    setEditingMode(mode);\n    setFormData({\n      name: mode.name,\n      code: mode.code,\n      icon_name: mode.icon_name,\n      color: mode.color,\n      display_order: mode.display_order,\n      is_active: mode.is_active\n    });\n    setIsEditOpen(true);\n  };\n\n  const updateDisplayOrder = async (id: string, direction: 'up' | 'down') => {\n    if (!modes) return;\n    \n    const currentMode = modes.find(m => m.id === id);\n    if (!currentMode) return;\n\n    const newOrder = direction === 'up' \n      ? currentMode.display_order - 150 \n      : currentMode.display_order + 150;\n\n    const { error } = await supabase\n      .from('transport_modes')\n      .update({ display_order: newOrder })\n      .eq('id', id);\n\n    if (error) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive'\n      });\n    } else {\n      refetch();\n    }\n  };\n\n  // Common icon names for transport\n  const iconOptions = [\n    'Ship', 'Plane', 'Truck', 'Train', 'Package', 'Waves',\n    'Container', 'Navigation', 'Anchor', 'Bus', 'Network'\n  ];\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Transport Modes</h1>\n          <p className=\"text-muted-foreground\">\n            Manage transport modes for multi-modal shipments\n          </p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle>Transport Modes</CardTitle>\n                <CardDescription>\n                  Configure available transport modes and their properties\n                </CardDescription>\n              </div>\n              <Button onClick={() => setIsCreateOpen(true)}>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Add Mode\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Order</TableHead>\n                  <TableHead>Icon</TableHead>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Code</TableHead>\n                  <TableHead>Color</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {modes?.map((mode) => {\n                  const IconComponent = (LucideIcons as any)[mode.icon_name] || LucideIcons.Package;\n                  return (\n                    <TableRow key={mode.id}>\n                      <TableCell>\n                        <div className=\"flex gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => updateDisplayOrder(mode.id, 'up')}\n                          >\n                            <MoveUp className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => updateDisplayOrder(mode.id, 'down')}\n                          >\n                            <MoveDown className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div \n                          className=\"p-2 rounded-full w-fit text-white\"\n                          style={{ backgroundColor: mode.color }}\n                        >\n                          <IconComponent className=\"h-4 w-4\" />\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"font-medium\">{mode.name}</TableCell>\n                      <TableCell className=\"font-mono text-sm\">{mode.code}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <div \n                            className=\"w-6 h-6 rounded border\"\n                            style={{ backgroundColor: mode.color }}\n                          />\n                          <span className=\"text-sm text-muted-foreground font-mono\">\n                            {mode.color}\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <span className={mode.is_active ? 'text-green-600' : 'text-muted-foreground'}>\n                          {mode.is_active ? 'Active' : 'Inactive'}\n                        </span>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => openEdit(mode)}\n                          >\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(mode.id)}\n                            className=\"text-destructive hover:text-destructive\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        {/* Create Dialog */}\n        <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Create Transport Mode</DialogTitle>\n              <DialogDescription>\n                Add a new transport mode for your quotes\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label>Name *</Label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"e.g., Ocean Freight\"\n                />\n              </div>\n              <div>\n                <Label>Code *</Label>\n                <Input\n                  value={formData.code}\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value })}\n                  placeholder=\"e.g., ocean\"\n                />\n              </div>\n              <div>\n                <Label>Icon *</Label>\n                <select\n                  className=\"w-full border rounded-md p-2\"\n                  value={formData.icon_name}\n                  onChange={(e) => setFormData({ ...formData, icon_name: e.target.value })}\n                >\n                  {iconOptions.map(icon => (\n                    <option key={icon} value={icon}>{icon}</option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <Label>Color (HSL)</Label>\n                <Input\n                  value={formData.color}\n                  onChange={(e) => setFormData({ ...formData, color: e.target.value })}\n                  placeholder=\"hsl(var(--chart-1))\"\n                />\n              </div>\n              <div>\n                <Label>Display Order</Label>\n                <Input\n                  type=\"number\"\n                  value={formData.display_order}\n                  onChange={(e) => setFormData({ ...formData, display_order: parseInt(e.target.value) })}\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  checked={formData.is_active}\n                  onCheckedChange={(checked) => setFormData({ ...formData, is_active: checked })}\n                />\n                <Label>Active</Label>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setIsCreateOpen(false)}>\n                Cancel\n              </Button>\n              <Button onClick={handleCreate}>Create</Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Edit Dialog */}\n        <Dialog open={isEditOpen} onOpenChange={setIsEditOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Edit Transport Mode</DialogTitle>\n              <DialogDescription>\n                Update transport mode properties\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label>Name *</Label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                />\n              </div>\n              <div>\n                <Label>Code *</Label>\n                <Input\n                  value={formData.code}\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value })}\n                />\n              </div>\n              <div>\n                <Label>Icon *</Label>\n                <select\n                  className=\"w-full border rounded-md p-2\"\n                  value={formData.icon_name}\n                  onChange={(e) => setFormData({ ...formData, icon_name: e.target.value })}\n                >\n                  {iconOptions.map(icon => (\n                    <option key={icon} value={icon}>{icon}</option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <Label>Color (HSL)</Label>\n                <Input\n                  value={formData.color}\n                  onChange={(e) => setFormData({ ...formData, color: e.target.value })}\n                />\n              </div>\n              <div>\n                <Label>Display Order</Label>\n                <Input\n                  type=\"number\"\n                  value={formData.display_order}\n                  onChange={(e) => setFormData({ ...formData, display_order: parseInt(e.target.value) })}\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  checked={formData.is_active}\n                  onCheckedChange={(checked) => setFormData({ ...formData, is_active: checked })}\n                />\n                <Label>Active</Label>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setIsEditOpen(false)}>\n                Cancel\n              </Button>\n              <Button onClick={handleUpdate}>Update</Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/UIDemoAdvanced.tsx","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":121,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":122,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2525,2526],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2525,2525],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":135,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":136,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2539,2540],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2539,2539],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":144,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":145,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2548,2549],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2548,2548],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":159,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":160,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2563,2564],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2563,2563],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":207,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":208,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2611,2612],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2611,2611],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":221,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":222,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2625,2626],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2625,2625],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":230,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":231,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2634,2635],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2634,2634],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":245,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":246,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2649,2650],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2649,2649],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":297,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":298,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2701,2702],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2701,2701],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":305,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":306,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2709,2710],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2709,2709],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":314,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":315,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2718,2719],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2718,2718],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":322,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":323,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2726,2727],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2726,2726],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":372,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":373,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2776,2777],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2776,2776],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":382,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":383,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2786,2787],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2786,2786],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":391,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":392,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2795,2796],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2795,2795],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":401,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":402,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2805,2806],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2805,2805],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":501,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":502,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2905,2906],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2905,2905],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":512,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":513,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2916,2917],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2916,2916],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":521,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":522,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2925,2926],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2925,2925],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":530,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":531,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2934,2935],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2934,2934],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":545,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":546,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2949,2950],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2949,2949],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":565,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":566,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2969,2970],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2969,2969],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":617,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":618,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3021,3022],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3021,3021],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":637,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":638,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3041,3042],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3041,3041],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":646,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":647,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3050,3051],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3050,3050],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":667,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":668,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3071,3072],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3071,3071],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":742,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":743,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3146,3147],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3146,3146],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":755,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":756,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3159,3160],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3159,3159],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":764,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":765,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3168,3169],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3168,3168],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":67,"column":781,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":67,"endColumn":782,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3185,3186],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3185,3185],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3984,3987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3984,3987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":30,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Form } from \"@/components/ui/form\";\nimport { FormSection, FormGrid } from \"@/components/forms/FormLayout\";\nimport { FormPage, FormPageSection } from \"@/components/forms/FormPage\";\nimport { DateField, CurrencyField, ComboboxField, FileUploadField, AsyncComboboxField } from \"@/components/forms/AdvancedFields\";\nimport { TextField, SelectField, SwitchField } from \"@/components/forms/fields\";\nimport { Switch } from \"@/components/ui/switch\";\nimport * as React from \"react\";\nimport * as z from \"zod\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { toast } from \"sonner\";\n\nconst schema = z.object({\n  shipmentName: z.string().min(1, \"Required\"),\n  shipmentDate: z.date({ required_error: \"Pick a date\" }),\n  amount: z.coerce.number().min(0, \"Must be positive\"),\n  currency: z.enum([\"USD\", \"EUR\", \"GBP\", \"JPY\", \"CNY\"]).default(\"USD\"),\n  destinationCountry: z.string().min(1, \"Choose a country\"),\n  isHazardous: z.boolean().optional(),\n  attachments: z.array(z.any()).default([]),\n  serviceId: z.string().optional(),\n});\n\ntype Schema = z.infer<typeof schema>;\n\nexport default function UIDemoAdvanced() {\n  const form = useForm<Schema>({\n    resolver: zodResolver(schema),\n    defaultValues: {\n      shipmentName: \"\",\n      shipmentDate: new Date(),\n      amount: 0,\n      currency: \"USD\",\n      destinationCountry: \"\",\n      isHazardous: false,\n      attachments: [],\n      serviceId: undefined,\n    },\n  });\n\n  const countryOptions = [\n    { label: \"United States\", value: \"US\" },\n    { label: \"United Kingdom\", value: \"GB\" },\n    { label: \"Germany\", value: \"DE\" },\n    { label: \"Japan\", value: \"JP\" },\n    { label: \"China\", value: \"CN\" },\n    { label: \"France\", value: \"FR\" },\n    { label: \"Canada\", value: \"CA\" },\n  ];\n\n  const attachments = form.watch(\"attachments\");\n  const [signedUrlEnabled, setSignedUrlEnabled] = React.useState(false);\n\n  const copySnippet = async (snippet: string) => {\n    try {\n      await navigator.clipboard.writeText(snippet);\n      toast.success(\"Snippet copied to clipboard\");\n    } catch (e) {\n      toast.error(\"Failed to copy snippet\");\n    }\n  };\n\n  const shipmentSnippet = `// Advanced fields example\\n<FormGrid columns={2}>\\n  <TextField control={form.control} name=\\\"shipmentName\\\" label=\\\"Shipment Name\\\" />\\n  <DateField control={form.control} name=\\\"shipmentDate\\\" label=\\\"Shipment Date\\\" />\\n  <CurrencyField control={form.control} name=\\\"amount\\\" label=\\\"Amount\\\" />\\n  <SelectField control={form.control} name=\\\"currency\\\" label=\\\"Currency\\\" options={[{ label: 'USD', value: 'USD' }]} />\\n  <AsyncComboboxField control={form.control} name=\\\"serviceId\\\" label=\\\"Service\\\" placeholder=\\\"Search services...\\\" />\\n  <ComboboxField control={form.control} name=\\\"destinationCountry\\\" label=\\\"Destination Country\\\" options={countryOptions} />\\n  <SwitchField control={form.control} name=\\\"isHazardous\\\" label=\\\"Hazardous Cargo\\\" />\\n</FormGrid>`;\n\n  const attachmentsSnippet = `// Signed URL toggle demo (Supabase Storage)\\n// Assume files are uploaded to a \\`documents\\` bucket under paths derived from file names\\nconst enableSignedUrl = true;\\nif (enableSignedUrl) {\\n  // Example: create a 60-minute signed URL for a stored file\\n  const { data, error } = await supabase.storage.from('documents').createSignedUrl('invoices/INV-123.pdf', 3600);\\n  if (!error) {\\n    console.log('Signed URL:', data.signedUrl);\\n  }\\n}`;\n\n  const onSubmit = (values: Schema) => {\n    toast.success(\"Advanced form submitted\", {\n      description: JSON.stringify(\n        {\n          ...values,\n          shipmentDate: values.shipmentDate?.toISOString(),\n          attachments: Array.isArray(values.attachments) ? values.attachments.map((f: any) => f?.name) : [],\n        },\n        null,\n        2,\n      ),\n    });\n  };\n\n  return (\n    <DashboardLayout>\n      <FormPage\n        title=\"UI Demo  Advanced Fields\"\n        description=\"Phase 35: Date, currency, combobox, and attachments\"\n        actions={\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={() => form.reset()}>Reset</Button>\n            <Button onClick={form.handleSubmit(onSubmit)}>Save</Button>\n          </div>\n        }\n      >\n        <Form {...form}>\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <div className=\"lg:col-span-2 space-y-6\">\n              <FormSection\n                title=\"Shipment Overview\"\n                description=\"Key shipment details and preferences\"\n                actions={\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => copySnippet(shipmentSnippet)}>\n                    Copy snippet\n                  </Button>\n                }\n              >\n                <FormGrid columns={2}>\n                  <TextField control={form.control} name=\"shipmentName\" label=\"Shipment Name\" placeholder=\"e.g. Ocean Import #123\" />\n                  <DateField control={form.control} name=\"shipmentDate\" label=\"Shipment Date\" />\n                  <CurrencyField control={form.control} name=\"amount\" label=\"Amount\" placeholder=\"0.00\" />\n                  <SelectField\n                    control={form.control}\n                    name=\"currency\"\n                    label=\"Currency\"\n                    placeholder=\"Select currency\"\n                    options={[\n                      { label: \"USD\", value: \"USD\" },\n                      { label: \"EUR\", value: \"EUR\" },\n                      { label: \"GBP\", value: \"GBP\" },\n                      { label: \"JPY\", value: \"JPY\" },\n                      { label: \"CNY\", value: \"CNY\" },\n                    ]}\n                  />\n                  <AsyncComboboxField\n                    control={form.control}\n                    name=\"serviceId\"\n                    label=\"Service\"\n                    placeholder=\"Search services...\"\n                  />\n                  <ComboboxField\n                    control={form.control}\n                    name=\"destinationCountry\"\n                    label=\"Destination Country\"\n                    placeholder=\"Select country\"\n                    options={countryOptions}\n                  />\n                  <SwitchField control={form.control} name=\"isHazardous\" label=\"Hazardous Cargo\" />\n                </FormGrid>\n              </FormSection>\n\n              <FormSection\n                title=\"Attachments\"\n                description=\"Upload related documents (invoices, BOLs, etc.)\"\n                actions={\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <Switch checked={signedUrlEnabled} onCheckedChange={setSignedUrlEnabled} id=\"signed-url\" />\n                      <label htmlFor=\"signed-url\" className=\"text-sm\">Signed URL</label>\n                    </div>\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => copySnippet(attachmentsSnippet)}>\n                      Copy snippet\n                    </Button>\n                  </div>\n                }\n              >\n                <FormGrid columns={1}>\n                  <FileUploadField control={form.control} name=\"attachments\" label=\"Attachments\" />\n                </FormGrid>\n              </FormSection>\n\n              {/* Phase 45 demo: preview selected files and metadata */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Attachments Preview</CardTitle>\n                  <CardDescription>Shows selected files, type, and size</CardDescription>\n                </CardHeader>\n                <CardContent className=\"pt-6\">\n                  {attachments && attachments.length > 0 ? (\n                    <div className=\"space-y-2\">\n                      {attachments.map((f: File, idx: number) => (\n                        <div key={`${f.name}-${idx}`} className=\"flex items-center justify-between text-sm\">\n                          <div className=\"truncate\">\n                            <span className=\"font-medium\">{f.name}</span>\n                            <span className=\"text-muted-foreground\">  {f.type || 'unknown'}</span>\n                          </div>\n                          <div className=\"text-muted-foreground\">\n                            {(f.size / 1024).toFixed(1)} KB\n                          </div>\n                        </div>\n                      ))}\n                      {signedUrlEnabled && (\n                        <p className=\"text-xs text-muted-foreground\">\n                          Signed URL enabled: in production, generate secure file links via Supabase Storage.\n                        </p>\n                      )}\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground\">No files selected yet</p>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n            <div className=\"space-y-6\">\n              <Card>\n                <CardContent className=\"pt-6 text-sm text-muted-foreground\">\n                  <p>This sidebar can summarize selections or show contextual help.</p>\n                  <ul className=\"mt-2 list-disc pl-4\">\n                    <li>Date picker supports keyboard focus</li>\n                    <li>Combobox allows quick searching</li>\n                    <li>Currency input keeps numeric value</li>\n                    <li>File upload lists selected file names</li>\n                  </ul>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </Form>\n      </FormPage>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/UIDemoForms.tsx","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":89,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":90,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1932,1933],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1932,1932],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":102,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":103,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1945,1946],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1945,1945],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":111,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":112,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1954,1955],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1954,1954],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":125,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":126,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1968,1969],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1968,1968],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":150,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":151,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1993,1994],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1993,1993],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":157,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":158,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2000,2001],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2000,2000],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":166,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":167,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2009,2010],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2009,2009],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":173,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":174,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2016,2017],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2016,2016],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":198,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":199,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2041,2042],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2041,2041],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":205,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":206,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2048,2049],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2048,2048],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":214,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":215,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2057,2058],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2057,2057],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":221,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":222,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2064,2065],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2064,2064],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":248,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":249,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2091,2092],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2091,2091],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":261,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":262,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2104,2105],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2104,2104],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":270,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":271,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2113,2114],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2113,2113],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":284,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":285,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2127,2128],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2127,2127],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":311,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":312,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2154,2155],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2154,2154],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":325,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":326,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2168,2169],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2168,2168],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":334,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":335,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2177,2178],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2177,2177],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":58,"column":349,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":58,"endColumn":350,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2192,2193],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2192,2192],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":89,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":90,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2302,2303],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2302,2302],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":100,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":101,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2313,2314],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2313,2313],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":109,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":110,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2322,2323],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2322,2322],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":121,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":122,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2334,2335],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2334,2334],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":148,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":149,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2361,2362],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2361,2361],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":161,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":162,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2374,2375],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2374,2374],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":170,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":171,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2383,2384],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2383,2383],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":184,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":185,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2397,2398],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2397,2397],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":211,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":212,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2424,2425],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2424,2424],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":222,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":223,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2435,2436],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2435,2435],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":231,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":232,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2444,2445],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2444,2444],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":249,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":250,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2462,2463],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2462,2462],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":278,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":279,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2491,2492],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2491,2491],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":297,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":298,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2510,2511],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2510,2510],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":306,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":307,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2519,2520],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2519,2519],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":60,"column":326,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":60,"endColumn":327,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2539,2540],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2539,2539],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":62,"column":63,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":62,"endColumn":64,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2623,2624],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2623,2623],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":62,"column":70,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":62,"endColumn":71,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2630,2631],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2630,2630],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":62,"column":79,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":62,"endColumn":80,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2639,2640],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2639,2639],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":62,"column":95,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":62,"endColumn":96,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2655,2656],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2655,2655],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":40,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Form } from \"@/components/ui/form\";\nimport { FormSection, FormGrid } from \"@/components/forms/FormLayout\";\nimport { TextField, NumberField, TextareaField, SelectField, SwitchField, CheckboxField } from \"@/components/forms/fields\";\nimport { toast } from \"sonner\";\n\nconst schema = z.object({\n  companyName: z.string().min(1, \"Company name is required\"),\n  email: z.string().email(\"Invalid email\"),\n  phone: z.string().optional(),\n  serviceType: z.enum([\"ocean\", \"air\", \"trucking\", \"courier\", \"moving\"]).optional(),\n  shipmentType: z.enum([\n    \"ocean_freight\",\n    \"air_freight\",\n    \"trucking_freight\",\n    \"courier_delivery\",\n    \"moving_service\",\n  ]).optional(),\n  basePrice: z.coerce.number().optional(),\n  pricingUnit: z.enum([\"per_shipment\", \"per_kg\", \"per_cbm\", \"flat_fee\"]).optional(),\n  isFragile: z.boolean().default(false),\n  insuranceRequired: z.boolean().default(false),\n  notes: z.string().optional(),\n});\n\ntype Schema = z.infer<typeof schema>;\n\nexport default function UIDemoForms() {\n  const form = useForm<Schema>({\n    resolver: zodResolver(schema),\n    defaultValues: {\n      companyName: \"\",\n      email: \"\",\n      phone: \"\",\n      serviceType: undefined,\n      shipmentType: undefined,\n      basePrice: undefined,\n      pricingUnit: undefined,\n      isFragile: false,\n      insuranceRequired: false,\n      notes: \"\",\n    },\n  });\n\n  const copySnippet = async (snippet: string) => {\n    try {\n      await navigator.clipboard.writeText(snippet);\n      toast.success(\"Snippet copied to clipboard\");\n    } catch (e) {\n      toast.error(\"Failed to copy snippet\");\n    }\n  };\n\n  const basicInfoSnippet = `// Basic Information section\\n<FormGrid>\\n  <TextField name=\\\"companyName\\\" label=\\\"Company Name\\\" />\\n  <TextField name=\\\"email\\\" label=\\\"Email\\\" />\\n  <TextField name=\\\"phone\\\" label=\\\"Phone\\\" />\\n  <SelectField name=\\\"serviceType\\\" label=\\\"Service Type\\\" />\\n  <SelectField name=\\\"shipmentType\\\" label=\\\"Shipment Type\\\" />\\n</FormGrid>`;\n\n  const pricingSnippet = `// Pricing & Options section\\n<FormGrid>\\n  <NumberField name=\\\"basePrice\\\" label=\\\"Base Price\\\" />\\n  <SelectField name=\\\"pricingUnit\\\" label=\\\"Pricing Unit\\\" />\\n  <SwitchField name=\\\"isFragile\\\" label=\\\"Fragile Handling\\\" />\\n  <CheckboxField name=\\\"insuranceRequired\\\" label=\\\"Insurance Required\\\" />\\n</FormGrid>`;\n\n  const notesSnippet = `// Notes section\\n<TextareaField name=\\\"notes\\\" label=\\\"Internal Notes\\\" />`;\n\n  const onSubmit = (values: Schema) => {\n    toast.success(\"Form submitted\", { description: JSON.stringify(values, null, 2) });\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">UI Templates: Forms</h1>\n          <p className=\"text-muted-foreground\">Phase 12: foundational fields, layout, and validation</p>\n        </div>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <FormSection\n              title=\"Basic Information\"\n              description=\"Core identifiers and contact details\"\n              actions={\n                <Button variant=\"outline\" size=\"sm\" onClick={() => copySnippet(basicInfoSnippet)}>\n                  Copy snippet\n                </Button>\n              }\n            >\n              <FormGrid>\n                <TextField control={form.control} name=\"companyName\" label=\"Company Name\" placeholder=\"Acme Logistics\" />\n                <TextField control={form.control} name=\"email\" label=\"Email\" placeholder=\"ops@acme.com\" />\n                <TextField control={form.control} name=\"phone\" label=\"Phone\" placeholder=\"+1 (555) 555-1234\" />\n                <SelectField\n                  control={form.control}\n                  name=\"serviceType\"\n                  label=\"Service Type\"\n                  placeholder=\"Select a service\"\n                  options={[\n                    { value: \"ocean\", label: \"Ocean\" },\n                    { value: \"air\", label: \"Air\" },\n                    { value: \"trucking\", label: \"Trucking\" },\n                    { value: \"courier\", label: \"Courier\" },\n                    { value: \"moving\", label: \"Moving\" },\n                  ]}\n                />\n                <SelectField\n                  control={form.control}\n                  name=\"shipmentType\"\n                  label=\"Shipment Type\"\n                  placeholder=\"Select a shipment type\"\n                  options={[\n                    { value: \"ocean_freight\", label: \"Ocean Freight\" },\n                    { value: \"air_freight\", label: \"Air Freight\" },\n                    { value: \"trucking_freight\", label: \"Trucking Freight\" },\n                    { value: \"courier_delivery\", label: \"Courier Delivery\" },\n                    { value: \"moving_service\", label: \"Moving Service\" },\n                  ]}\n                />\n              </FormGrid>\n            </FormSection>\n\n            <FormSection\n              title=\"Pricing & Options\"\n              description=\"Commercial terms and handling preferences\"\n              actions={\n                <Button variant=\"outline\" size=\"sm\" onClick={() => copySnippet(pricingSnippet)}>\n                  Copy snippet\n                </Button>\n              }\n            >\n              <FormGrid>\n                <NumberField control={form.control} name=\"basePrice\" label=\"Base Price\" placeholder=\"1000\" />\n                <SelectField\n                  control={form.control}\n                  name=\"pricingUnit\"\n                  label=\"Pricing Unit\"\n                  placeholder=\"Select unit\"\n                  options={[\n                    { value: \"per_shipment\", label: \"Per Shipment\" },\n                    { value: \"per_kg\", label: \"Per KG\" },\n                    { value: \"per_cbm\", label: \"Per CBM\" },\n                    { value: \"flat_fee\", label: \"Flat Fee\" },\n                  ]}\n                />\n                <SwitchField control={form.control} name=\"isFragile\" label=\"Fragile Handling\" description=\"Flag if cargo needs special care\" />\n                <CheckboxField control={form.control} name=\"insuranceRequired\" label=\"Insurance Required\" description=\"Require shipment insurance\" />\n              </FormGrid>\n            </FormSection>\n\n            <FormSection\n              title=\"Notes\"\n              description=\"Additional instructions or context\"\n              actions={\n                <Button variant=\"outline\" size=\"sm\" onClick={() => copySnippet(notesSnippet)}>\n                  Copy snippet\n                </Button>\n              }\n            >\n              <TextareaField control={form.control} name=\"notes\" label=\"Internal Notes\" placeholder=\"Anything relevant for operations\" />\n            </FormSection>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => form.reset()}>Reset</Button>\n              <Button type=\"submit\">Submit</Button>\n            </div>\n          </form>\n        </Form>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/UserDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1008,1011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1008,1011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchUser'. Either include it or remove the dependency array.","line":32,"column":6,"nodeType":"ArrayExpression","endLine":32,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUser, id]","fix":{"range":[1111,1115],"text":"[fetchUser, id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1449,1452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1449,1452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1966,1969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1966,1969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { UserForm } from '@/components/admin/UserForm';\nimport { UserRoleAssignment } from '@/components/roles/UserRoleAssignment';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Users2, Trash2, ArrowLeft } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog';\n\nexport default function UserDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [user, setUser] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchUser();\n  }, [id]);\n\n  const fetchUser = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select(`\n          *,\n          user_roles!user_id(role, tenant_id, franchise_id)\n        `)\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n      setUser(data);\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    try {\n      const { error } = await supabase\n        .from('profiles')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast({\n        title: 'Success',\n        description: 'User deleted successfully',\n      });\n      navigate('/dashboard/users');\n    } catch (error: any) {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    }\n  };\n\n  if (loading) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8\">Loading...</div>\n      </DashboardLayout>\n    );\n  }\n\n  if (!user) {\n    return (\n      <DashboardLayout>\n        <div className=\"text-center py-8\">User not found</div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"max-w-4xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard/users')}>\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">\n                {user.first_name} {user.last_name}\n              </h1>\n              <p className=\"text-muted-foreground\">Edit user details</p>\n            </div>\n          </div>\n          <AlertDialog>\n            <AlertDialogTrigger asChild>\n              <Button variant=\"destructive\" size=\"icon\">\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </AlertDialogTrigger>\n            <AlertDialogContent>\n              <AlertDialogHeader>\n                <AlertDialogTitle>Delete User</AlertDialogTitle>\n                <AlertDialogDescription>\n                  Are you sure you want to delete this user? This action cannot be undone.\n                </AlertDialogDescription>\n              </AlertDialogHeader>\n              <AlertDialogFooter>\n                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                <AlertDialogAction onClick={handleDelete}>Delete</AlertDialogAction>\n              </AlertDialogFooter>\n            </AlertDialogContent>\n          </AlertDialog>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users2 className=\"h-5 w-5\" />\n                User Information\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <UserForm user={user} onSuccess={fetchUser} />\n            </CardContent>\n          </Card>\n\n          <UserRoleAssignment userId={user.id} />\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/UserNew.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Users.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchUsers'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUsers]","fix":{"range":[1297,1299],"text":"[fetchUsers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Plus, Users2 } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCRM } from '@/hooks/useCRM';\n\nexport default function Users() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { context } = useCRM();\n  type UserRole = {\n    role: string;\n    tenant_id: string | null;\n    franchise_id: string | null;\n    tenant_name?: string | null;\n    franchise_name?: string | null;\n  };\n  type UserRow = {\n    id: string;\n    first_name: string;\n    last_name: string;\n    email: string;\n    phone: string | null;\n    is_active: boolean;\n    created_at: string;\n    user_roles?: UserRole[];\n  };\n  const [users, setUsers] = useState<UserRow[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchUsers();\n  }, []);\n\n  const fetchUsers = async () => {\n    try {\n      // First, get the user IDs based on role context\n      let userIds: string[] | null = null;\n\n      if (context.isTenantAdmin && context.tenantId) {\n        // Tenant admin can see all users in their tenant (including all franchises)\n        const { data: roles } = await supabase\n          .from('user_roles')\n          .select('user_id')\n          .eq('tenant_id', context.tenantId);\n        userIds = roles?.map(r => r.user_id) || [];\n      } else if (context.isFranchiseAdmin && context.franchiseId) {\n        // Franchise admin can only see users in their franchise\n        const { data: roles } = await supabase\n          .from('user_roles')\n          .select('user_id')\n          .eq('franchise_id', context.franchiseId);\n        userIds = roles?.map(r => r.user_id) || [];\n      }\n\n      // Build the main query\n      let query = supabase\n        .from('profiles')\n        .select(`\n          *,\n          user_roles!user_id(role, tenant_id, franchise_id)\n        `);\n\n      // Apply filter if we have specific user IDs\n      if (userIds !== null) {\n        query = query.in('id', userIds);\n      }\n      // Platform admin has no filters - can see all users\n\n      const { data: profilesData, error: profilesError } = await query.order('created_at', { ascending: false });\n\n      if (profilesError) throw profilesError;\n\n      // Fetch all tenants and franchises to map names\n      const { data: tenantsData } = await supabase.from('tenants').select('id, name');\n      const { data: franchisesData } = await supabase.from('franchises').select('id, name');\n\n      // Create lookup maps\n      const tenantsMap = new Map(tenantsData?.map(t => [t.id, t.name]) || []);\n      const franchisesMap = new Map(franchisesData?.map(f => [f.id, f.name]) || []);\n\n      // Enrich user data with tenant and franchise names\n      const enrichedUsers = profilesData?.map(user => ({\n        ...user,\n        user_roles: user.user_roles?.map((role: { role: string; tenant_id: string | null; franchise_id: string | null }) => ({\n          ...role,\n          tenant_name: role.tenant_id ? tenantsMap.get(role.tenant_id) : null,\n          franchise_name: role.franchise_id ? franchisesMap.get(role.franchise_id) : null,\n        }))\n      })) || [];\n\n      setUsers(enrichedUsers as UserRow[]);\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast({ title: 'Error', description: message, variant: 'destructive' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Users</h1>\n            <p className=\"text-muted-foreground\">Manage system users and permissions</p>\n          </div>\n          <Button onClick={() => navigate('/dashboard/users/new')}>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            New User\n          </Button>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users2 className=\"h-5 w-5\" />\n              All Users\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <div className=\"text-center py-8\">Loading...</div>\n            ) : users.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No users found. Create your first user to get started.\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Phone</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>Tenant</TableHead>\n                    <TableHead>Franchise</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Created</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {users.map((user) => (\n                    <TableRow\n                      key={user.id}\n                      className=\"cursor-pointer\"\n                      onClick={() => navigate(`/dashboard/users/${user.id}`)}\n                    >\n                      <TableCell className=\"font-medium\">\n                        {user.first_name} {user.last_name}\n                      </TableCell>\n                      <TableCell>{user.email}</TableCell>\n                      <TableCell>{user.phone || '-'}</TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-1 flex-wrap\">\n                          {user.user_roles?.map((role: UserRole, idx: number) => (\n                            <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                              {role.role.replace('_', ' ')}\n                            </Badge>\n                          ))}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {user.user_roles?.[0]?.tenant_name || '-'}\n                      </TableCell>\n                      <TableCell>\n                        {user.user_roles?.[0]?.franchise_name || '-'}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={user.is_active ? 'default' : 'secondary'}>\n                          {user.is_active ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {new Date(user.created_at).toLocaleDateString()}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/VehicleNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[600,603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[600,603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1189,1192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1189,1192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useNavigate } from 'react-router-dom';\nimport { ArrowLeft } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { VehicleForm } from '@/components/logistics/VehicleForm';\nimport { useCRM } from '@/hooks/useCRM';\nimport { toast } from 'sonner';\n\nexport default function VehicleNew() {\n  const navigate = useNavigate();\n  const { supabase, context } = useCRM();\n\n  const handleSubmit = async (data: any) => {\n    try {\n      const vehicleData = {\n        ...data,\n        tenant_id: context.tenantId,\n        franchise_id: context.franchiseId,\n        year: data.year ? parseInt(data.year) : null,\n        capacity_kg: data.capacity_kg ? parseFloat(data.capacity_kg) : null,\n        capacity_cbm: data.capacity_cbm ? parseFloat(data.capacity_cbm) : null,\n      };\n\n      const { error } = await supabase.from('vehicles').insert([vehicleData]);\n\n      if (error) throw error;\n\n      toast.success('Vehicle created successfully');\n      navigate('/dashboard/vehicles');\n    } catch (error: any) {\n      toast.error('Failed to create vehicle: ' + error.message);\n      console.error('Error:', error);\n    }\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => navigate('/dashboard/vehicles')}\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">New Vehicle</h1>\n            <p className=\"text-muted-foreground\">Add a new vehicle to your fleet</p>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Vehicle Details</CardTitle>\n            <CardDescription>\n              Enter the vehicle information below\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <VehicleForm\n              onSubmit={handleSubmit}\n              onCancel={() => navigate('/dashboard/vehicles')}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Vehicles.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/WarehouseNew.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/Warehouses.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchWarehouses'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchWarehouses]","fix":{"range":[2711,2713],"text":"[fetchWarehouses]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Plus, Search, Warehouse as WarehouseIcon } from 'lucide-react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHeader, TableRow, SortableHead } from '@/components/ui/table';\nimport { useSort } from '@/hooks/useSort';\nimport { Pagination, PaginationContent, PaginationItem, PaginationPrevious, PaginationNext, PaginationFirst, PaginationLast, PaginationLink } from '@/components/ui/pagination';\nimport { usePagination } from '@/hooks/usePagination';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ViewToggle, ViewMode } from '@/components/ui/view-toggle';\nimport { useCRM } from '@/hooks/useCRM';\nimport { DashboardLayout } from '@/components/layout/DashboardLayout';\nimport { toast } from 'sonner';\nimport { matchText, TextOp } from '@/lib/utils';\nimport type { Json } from '@/integrations/supabase/types';\n\ninterface Warehouse {\n  id: string;\n  name: string;\n  code: string;\n  warehouse_type: string | null;\n  address: Json | null;\n  contact_person: string | null;\n  contact_phone: string | null;\n  capacity_sqft: number | null;\n  current_utilization: number;\n  is_active: boolean;\n}\n\nexport default function Warehouses() {\n  const navigate = useNavigate();\n  const [warehouses, setWarehouses] = useState<Warehouse[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [viewMode, setViewMode] = useState<ViewMode>('card');\n  const { supabase } = useCRM();\n\n  // Advanced filters\n  const [filterName, setFilterName] = useState('');\n  const [filterNameOp, setFilterNameOp] = useState<TextOp>('contains');\n  const [filterCode, setFilterCode] = useState('');\n  const [filterCodeOp, setFilterCodeOp] = useState<TextOp>('contains');\n  const [filterType, setFilterType] = useState('');\n  const [filterTypeOp, setFilterTypeOp] = useState<TextOp>('contains');\n  const [filterContact, setFilterContact] = useState('');\n  const [filterContactOp, setFilterContactOp] = useState<TextOp>('contains');\n  const [capacityMin, setCapacityMin] = useState<string>('');\n  const [capacityMax, setCapacityMax] = useState<string>('');\n  const [utilMin, setUtilMin] = useState<string>('');\n  const [utilMax, setUtilMax] = useState<string>('');\n  const [statusActive, setStatusActive] = useState<string>('all');\n\n  useEffect(() => {\n    fetchWarehouses();\n  }, []);\n\n  const fetchWarehouses = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('warehouses')\n        .select('*')\n        .order('name');\n\n      if (error) throw error;\n      setWarehouses(data || []);\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      toast.error('Failed to load warehouses');\n      console.error('Error:', message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredWarehouses = warehouses.filter(warehouse => {\n    const globalQuery = searchQuery.trim().toLowerCase();\n    const matchesGlobal = !globalQuery || [\n      warehouse.name,\n      warehouse.code,\n      warehouse.warehouse_type || '',\n      warehouse.contact_person || ''\n    ].some(v => (v || '').toLowerCase().includes(globalQuery));\n\n    const matchesName = matchText(warehouse.name, filterName, filterNameOp);\n    const matchesCode = matchText(warehouse.code, filterCode, filterCodeOp);\n    const matchesType = matchText(warehouse.warehouse_type ?? '', filterType, filterTypeOp);\n    const matchesContact = matchText(warehouse.contact_person ?? '', filterContact, filterContactOp);\n\n    const capMin = capacityMin ? Number(capacityMin) : undefined;\n    const capMax = capacityMax ? Number(capacityMax) : undefined;\n    const cap = warehouse.capacity_sqft ?? undefined;\n    const matchesCapacity = (\n      (capMin === undefined || (cap !== undefined && cap >= capMin)) &&\n      (capMax === undefined || (cap !== undefined && cap <= capMax))\n    );\n\n    const uMin = utilMin ? Number(utilMin) : undefined;\n    const uMax = utilMax ? Number(utilMax) : undefined;\n    const util = warehouse.current_utilization ?? undefined;\n    const matchesUtil = (\n      (uMin === undefined || (util !== undefined && util >= uMin)) &&\n      (uMax === undefined || (util !== undefined && util <= uMax))\n    );\n\n    const matchesStatus = statusActive === 'all' || (statusActive === 'active' ? warehouse.is_active : !warehouse.is_active);\n\n    return matchesGlobal && matchesName && matchesCode && matchesType && matchesContact && matchesCapacity && matchesUtil && matchesStatus;\n  });\n\n  const { sorted: sortedWarehouses, sortField, sortDirection, onSort } = useSort<Warehouse>(filteredWarehouses, {\n    accessors: {\n      capacity_sqft: (w) => w.capacity_sqft ?? 0,\n      current_utilization: (w) => w.current_utilization,\n      is_active: (w) => (w.is_active ? 1 : 0),\n    },\n  });\n\n  const {\n    pageItems: pagedWarehouses,\n    pageSize,\n    setPageSize,\n    pageSizeOptions,\n    currentPage,\n    totalPages,\n    nextPage,\n    prevPage,\n    firstPage,\n    lastPage,\n    canPrev,\n    canNext,\n  } = usePagination(sortedWarehouses, { initialPageSize: 20 });\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Warehouses</h1>\n            <p className=\"text-muted-foreground\">Manage warehouse locations and inventory</p>\n          </div>\n          <div className=\"flex gap-2 items-center\">\n            <ViewToggle value={viewMode} onChange={setViewMode} />\n            <Button asChild>\n              <Link to=\"/dashboard/warehouses/new\">\n                <Plus className=\"mr-2 h-4 w-4\" />\n                New Warehouse\n              </Link>\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search warehouses...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n\n        {/* Advanced filters */}\n        <div className=\"flex flex-wrap gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <Select value={filterNameOp} onValueChange={(v) => setFilterNameOp(v as TextOp)}>\n              <SelectTrigger className=\"w-[140px]\"><SelectValue placeholder=\"Name op\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"contains\">Contains</SelectItem>\n                <SelectItem value=\"equals\">Equals</SelectItem>\n                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input className=\"w-[170px]\" placeholder=\"Name\" value={filterName} onChange={(e) => setFilterName(e.target.value)} />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Select value={filterCodeOp} onValueChange={(v) => setFilterCodeOp(v as TextOp)}>\n              <SelectTrigger className=\"w-[140px]\"><SelectValue placeholder=\"Code op\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"contains\">Contains</SelectItem>\n                <SelectItem value=\"equals\">Equals</SelectItem>\n                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input className=\"w-[150px]\" placeholder=\"Code\" value={filterCode} onChange={(e) => setFilterCode(e.target.value)} />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Select value={filterTypeOp} onValueChange={(v) => setFilterTypeOp(v as TextOp)}>\n              <SelectTrigger className=\"w-[140px]\"><SelectValue placeholder=\"Type op\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"contains\">Contains</SelectItem>\n                <SelectItem value=\"equals\">Equals</SelectItem>\n                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input className=\"w-[170px]\" placeholder=\"Type\" value={filterType} onChange={(e) => setFilterType(e.target.value)} />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Select value={filterContactOp} onValueChange={(v) => setFilterContactOp(v as TextOp)}>\n              <SelectTrigger className=\"w-[150px]\"><SelectValue placeholder=\"Contact op\" /></SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"contains\">Contains</SelectItem>\n                <SelectItem value=\"equals\">Equals</SelectItem>\n                <SelectItem value=\"startsWith\">Starts With</SelectItem>\n                <SelectItem value=\"endsWith\">Ends With</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input className=\"w-[170px]\" placeholder=\"Contact\" value={filterContact} onChange={(e) => setFilterContact(e.target.value)} />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Input type=\"number\" className=\"w-[140px]\" placeholder=\"Capacity min\" value={capacityMin} onChange={(e) => setCapacityMin(e.target.value)} />\n            <Input type=\"number\" className=\"w-[140px]\" placeholder=\"Capacity max\" value={capacityMax} onChange={(e) => setCapacityMax(e.target.value)} />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Input type=\"number\" className=\"w-[140px]\" placeholder=\"Utilization min\" value={utilMin} onChange={(e) => setUtilMin(e.target.value)} />\n            <Input type=\"number\" className=\"w-[140px]\" placeholder=\"Utilization max\" value={utilMax} onChange={(e) => setUtilMax(e.target.value)} />\n          </div>\n\n          <Select value={statusActive} onValueChange={setStatusActive}>\n            <SelectTrigger className=\"w-[160px]\"><SelectValue placeholder=\"Status\" /></SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Status</SelectItem>\n              <SelectItem value=\"active\">Active</SelectItem>\n              <SelectItem value=\"inactive\">Inactive</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {loading ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">Loading warehouses...</p>\n          </div>\n        ) : filteredWarehouses.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <WarehouseIcon className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">No warehouses found</h3>\n              <p className=\"text-muted-foreground mb-4\">\n                {searchQuery ? 'Try adjusting your search' : 'Start by adding your first warehouse'}\n              </p>\n              {!searchQuery && (\n                <Button asChild>\n                  <Link to=\"/dashboard/warehouses/new\">\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Add Warehouse\n                  </Link>\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        ) : viewMode === 'list' ? (\n          <Card>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <SortableHead field=\"name\" activeField={sortField} direction={sortDirection} onSort={onSort}>Name</SortableHead>\n                  <SortableHead field=\"code\" activeField={sortField} direction={sortDirection} onSort={onSort}>Code</SortableHead>\n                  <SortableHead field=\"warehouse_type\" activeField={sortField} direction={sortDirection} onSort={onSort}>Type</SortableHead>\n                  <SortableHead field=\"contact_person\" activeField={sortField} direction={sortDirection} onSort={onSort}>Contact</SortableHead>\n                  <SortableHead field=\"capacity_sqft\" activeField={sortField} direction={sortDirection} onSort={onSort}>Capacity</SortableHead>\n                  <SortableHead field=\"current_utilization\" activeField={sortField} direction={sortDirection} onSort={onSort}>Utilization</SortableHead>\n                  <SortableHead field=\"is_active\" activeField={sortField} direction={sortDirection} onSort={onSort}>Status</SortableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {pagedWarehouses.map((warehouse) => (\n                  <TableRow \n                    key={warehouse.id} \n                    className=\"cursor-pointer hover:bg-muted/50\"\n                    onClick={() => navigate(`/dashboard/warehouses/${warehouse.id}`)}\n                  >\n                    <TableCell className=\"font-medium\">{warehouse.name}</TableCell>\n                    <TableCell>{warehouse.code}</TableCell>\n                    <TableCell>{warehouse.warehouse_type || '-'}</TableCell>\n                    <TableCell>{warehouse.contact_person || '-'}</TableCell>\n                    <TableCell>\n                      {warehouse.capacity_sqft ? `${warehouse.capacity_sqft.toLocaleString()} sq ft` : '-'}\n                    </TableCell>\n                    <TableCell>{warehouse.current_utilization}%</TableCell>\n                    <TableCell>\n                      <Badge variant={warehouse.is_active ? 'default' : 'secondary'}>\n                        {warehouse.is_active ? 'Active' : 'Inactive'}\n                      </Badge>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n            <div className=\"p-3 flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"text-xs text-muted-foreground\">Rows per page</div>\n                <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                  <SelectTrigger className=\"w-[140px]\">\n                    <SelectValue placeholder=\"Rows\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {pageSizeOptions.map((opt) => (\n                      <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <Pagination className=\"justify-end\">\n                <PaginationContent>\n                  <PaginationItem>\n                    <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                  <PaginationItem>\n                    <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                  </PaginationItem>\n                </PaginationContent>\n              </Pagination>\n            </div>\n          </Card>\n        ) : (\n          <>\n          <div className={viewMode === 'grid' ? 'grid gap-4 md:grid-cols-2 lg:grid-cols-4' : 'grid gap-4 md:grid-cols-2 lg:grid-cols-3'}>\n            {pagedWarehouses.map((warehouse) => (\n              <Link key={warehouse.id} to={`/dashboard/warehouses/${warehouse.id}`}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <WarehouseIcon className=\"h-10 w-10 text-primary\" />\n                      <Badge variant={warehouse.is_active ? 'default' : 'secondary'}>\n                        {warehouse.is_active ? 'Active' : 'Inactive'}\n                      </Badge>\n                    </div>\n                    <CardTitle className=\"mt-4\">{warehouse.name}</CardTitle>\n                    <CardDescription>{warehouse.code}</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    {warehouse.warehouse_type && (\n                      <div className=\"text-sm\">\n                        <span className=\"text-muted-foreground\">Type: </span>\n                        <span className=\"font-medium\">{warehouse.warehouse_type}</span>\n                      </div>\n                    )}\n                    {warehouse.capacity_sqft && (\n                      <div className=\"text-sm\">\n                        <span className=\"text-muted-foreground\">Capacity: </span>\n                        <span className=\"font-medium\">{warehouse.capacity_sqft.toLocaleString()} sq ft</span>\n                      </div>\n                    )}\n                    <div className=\"text-sm\">\n                      <span className=\"text-muted-foreground\">Utilization: </span>\n                      <span className=\"font-medium\">{warehouse.current_utilization}%</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              </Link>\n            ))}\n          </div>\n          <div className=\"mt-3 flex items-center justify-between gap-3\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"text-xs text-muted-foreground\">Cards per page</div>\n              <Select value={String(pageSize)} onValueChange={(v) => setPageSize(v === 'ALL' ? 'ALL' : Number(v))}>\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Cards\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {pageSizeOptions.map((opt) => (\n                    <SelectItem key={String(opt)} value={String(opt)}>{String(opt)}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <Pagination className=\"justify-end\">\n              <PaginationContent>\n                <PaginationItem>\n                  <PaginationFirst onClick={firstPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationPrevious onClick={prevPage} className={!canPrev ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationLink isActive size=\"default\">Page {currentPage} of {totalPages}</PaginationLink>\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationNext onClick={nextPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n                <PaginationItem>\n                  <PaginationLast onClick={lastPage} className={!canNext ? 'pointer-events-none opacity-50' : ''} />\n                </PaginationItem>\n              </PaginationContent>\n            </Pagination>\n          </div>\n          </>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/data-management/DatabaseExport.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Do not use \"@ts-nocheck\" because it alters compilation errors.","line":1,"column":1,"nodeType":"Line","messageId":"tsDirectiveComment","endLine":1,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1317,1320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1317,1320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":59,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":59,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2489,2489],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3914,3917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3914,3917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4272,4275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4272,4275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5580,5583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5580,5583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7694,7697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7694,7697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'i' is never reassigned. Use 'const' instead.","line":213,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":213,"endColumn":22,"fix":{"range":[8405,8415],"text":"const i = 1;"}},{"ruleId":"prefer-const","severity":2,"message":"'i' is never reassigned. Use 'const' instead.","line":220,"column":19,"nodeType":"Identifier","messageId":"useConst","endLine":220,"endColumn":20,"fix":{"range":[8687,8697],"text":"const i = 1;"}},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":223,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":223,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8776,8776],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9100,9103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9100,9103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10248,10251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10248,10251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":295,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11121,11124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11121,11124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12264,12267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12264,12267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":378,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14072,14075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14072,14075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":403,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":403,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14968,14971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14968,14971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":403,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":403,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14978,14981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14978,14981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":411,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":411,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15210,15213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15210,15213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":430,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":430,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16069,16072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16069,16072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":434,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":434,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16305,16308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16305,16308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":440,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":440,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16547,16550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16547,16550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":462,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":462,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17339,17342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17339,17342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":479,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18067,18070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18067,18070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":492,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":492,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18530,18533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18530,18533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":508,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":508,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19184,19187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19184,19187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":536,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":536,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20464,20467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20464,20467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":536,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":536,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20477,20480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20477,20480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":544,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":544,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20758,20761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20758,20761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":548,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":548,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20968,20971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20968,20971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":592,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":592,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22897,22900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22897,22900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":615,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":615,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23892,23895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23892,23895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":628,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":628,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24463,24466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24463,24466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":641,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":641,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24862,24865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24862,24865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":666,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":666,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25766,25769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25766,25769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":710,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":710,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27570,27573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27570,27573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":728,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":728,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28207,28210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28207,28210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":740,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":740,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28567,28570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28567,28570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":743,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":743,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28686,28689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28686,28689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":763,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":763,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29263,29266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29263,29266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":788,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":788,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30098,30101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30098,30101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":806,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":806,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30556,30559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30556,30559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":850,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":850,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31958,31961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31958,31961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":876,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":876,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32703,32706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32703,32706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":916,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":916,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33897,33900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33897,33900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1112,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1112,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42019,42022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42019,42022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1120,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1120,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42388,42391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42388,42391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1128,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1128,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42801,42804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42801,42804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1136,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1136,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43204,43207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43204,43207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1144,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1144,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43603,43606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43603,43606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1152,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1152,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44007,44010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44007,44010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1160,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1160,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44399,44402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44399,44402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1168,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1168,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44787,44790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44787,44790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1176,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1176,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45188,45191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45188,45191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1184,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1184,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45596,45599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45596,45599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1196,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1196,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46288,46291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46288,46291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1217,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1217,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47375,47378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47375,47378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":51,"fixableErrorCount":2,"fixableWarningCount":0,"source":"// @ts-nocheck\nimport { useEffect, useMemo, useState } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport Papa from \"papaparse\";\nimport { toast } from \"sonner\";\n\ntype TableInfo = {\n  table_name: string;\n  table_type: string;\n  rls_enabled: boolean;\n  policy_count: number;\n  column_count: number;\n  index_count: number;\n  row_estimate: number;\n};\n\nexport default function DatabaseExport() {\n  const [tables, setTables] = useState<TableInfo[]>([]);\n  const [selected, setSelected] = useState<Record<string, boolean>>({});\n  const [loading, setLoading] = useState(false);\n  const [query, setQuery] = useState(\"SELECT table_name, table_type FROM information_schema.tables WHERE table_schema = 'public' ORDER BY table_name LIMIT 50;\");\n  const [queryResult, setQueryResult] = useState<any[]>([]);\n  const [restoreFile, setRestoreFile] = useState<File | null>(null);\n  const [restoreMode, setRestoreMode] = useState<'insert' | 'upsert'>('upsert');\n  const [lastBackupTime, setLastBackupTime] = useState<string | null>(null);\n  const [backupType, setBackupType] = useState<'full' | 'incremental'>('full');\n  \n  // Export component selection\n  const [exportOptions, setExportOptions] = useState({\n    schema: true,\n    constraints: true,\n    indexes: true,\n    dbFunctions: true,\n    rlsPolicies: true,\n    enums: true,\n    edgeFunctions: true,\n    secrets: true,\n    tableData: true,\n  });\n\n  // Storage settings\n  const [destination, setDestination] = useState<'device' | 'cloud'>('device');\n  const [conflictPolicy, setConflictPolicy] = useState<'ask' | 'overwrite' | 'rename'>('rename');\n  const [cloudBasePath, setCloudBasePath] = useState<string>('db-exports');\n\n  // Manual download queue for restricted iframes/browsers\n  const [pendingDownloads, setPendingDownloads] = useState<Array<{ name: string; url: string }>>([]);\n  const clearPendingDownloads = () => {\n    try {\n      pendingDownloads.forEach((d) => URL.revokeObjectURL(d.url));\n    } catch {}\n    setPendingDownloads([]);\n  };\n  useEffect(() => {\n    const loadTables = async () => {\n      const { data, error } = await supabase.rpc(\"get_database_tables\");\n      if (error) {\n        toast.error(\"Failed to load tables\", { description: error.message });\n        return;\n      }\n      setTables(data || []);\n      const sel: Record<string, boolean> = {};\n      (data || []).forEach((t: TableInfo) => (sel[t.table_name] = false));\n      setSelected(sel);\n    };\n    loadTables();\n    \n    // Load last backup timestamp from localStorage\n    const lastBackup = localStorage.getItem('last_database_backup');\n    if (lastBackup) {\n      setLastBackupTime(lastBackup);\n    }\n  }, []);\n\n  const allSelected = useMemo(() => tables.length > 0 && tables.every(t => selected[t.table_name]), [tables, selected]);\n\n  const toggleAll = (checked: boolean) => {\n    const next: Record<string, boolean> = {};\n    tables.forEach(t => (next[t.table_name] = checked));\n    setSelected(next);\n  };\n\n  const toggle = (name: string, checked: boolean) => {\n    setSelected(prev => ({ ...prev, [name]: checked }));\n  };\n\n  const downloadFile = async (filename: string, content: string, type = \"text/plain\") => {\n    try {\n      // Use File System Access API for better UX (save location dialog)\n      if ('showSaveFilePicker' in window) {\n        const extension = filename.split('.').pop() || 'txt';\n        const handle = await (window as any).showSaveFilePicker({\n          suggestedName: filename,\n          types: [{\n            description: 'File',\n            accept: { [type]: ['.' + extension] },\n          }],\n        });\n        const writable = await handle.createWritable();\n        await writable.write(content);\n        await writable.close();\n        return;\n      }\n    } catch (e: any) {\n      // User cancelled or API not available, fall back to standard download\n      if (e.name === 'AbortError') {\n        toast.message(\"Save cancelled\");\n        return;\n      }\n    }\n    \n    // Fallback for browsers without File System Access API or when blocked in iframes\n    const blob = new Blob([content], { type });\n    const url = URL.createObjectURL(blob);\n    // Keep a manual download link for the user to click if auto-download is blocked\n    setPendingDownloads((prev) => [...prev, { name: filename, url }]);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = filename;\n    a.rel = \"noopener\";\n    a.target = \"_blank\";\n    a.click();\n    // Do not revoke here; user can use Manual Downloads to save and then clear\n  };\n\n  // Cloud storage helpers and unified save functions\n  const splitPath = (path: string) => {\n    const normalized = path.replace(/^\\/+|\\/+$/g, '');\n    const parts = normalized.split('/');\n    const name = parts.pop() || '';\n    const folder = parts.join('/');\n    return { folder, name };\n  };\n\n  const fileExists = async (fullPath: string) => {\n    const { folder, name } = splitPath(fullPath);\n    const { data } = await supabase.storage.from('db-backups').list(folder || undefined, { search: name });\n    return (data || []).some((o: any) => o.name === name);\n  };\n\n  const resolveConflictPath = async (fullPath: string): Promise<string | null> => {\n    if (conflictPolicy === 'overwrite') return fullPath;\n    if (!(await fileExists(fullPath))) return fullPath;\n    if (conflictPolicy === 'ask') {\n      const ok = window.confirm(`File \"${fullPath}\" exists. Overwrite? Click Cancel to auto-rename.`);\n      if (ok) return fullPath;\n    }\n    const dot = fullPath.lastIndexOf('.');\n    const base = dot > -1 ? fullPath.slice(0, dot) : fullPath;\n    const ext = dot > -1 ? fullPath.slice(dot) : '';\n    let i = 1;\n    let candidate = `${base} (${i})${ext}`;\n    while (await fileExists(candidate)) {\n      i++;\n      candidate = `${base} (${i})${ext}`;\n    }\n    return candidate;\n  };\n\n  const saveToCloud = async (filename: string, content: string, type: string) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) throw new Error('User not authenticated');\n    \n    const userFolder = user.id;\n    const dir = (cloudBasePath || '').replace(/^\\/+|\\/+$/g, '');\n    const fullPath = dir ? `${userFolder}/${dir}/${filename}` : `${userFolder}/${filename}`;\n    const finalPath = await resolveConflictPath(fullPath);\n    if (!finalPath) return;\n    const blob = new Blob([content], { type });\n    const { error } = await supabase.storage.from('db-backups').upload(finalPath, blob, { upsert: conflictPolicy === 'overwrite' });\n    if (error) throw error;\n    toast.success('Saved to Cloud storage', { description: finalPath });\n  };\n\n  const saveFile = async (filename: string, content: string, type = 'text/plain') => {\n    if (destination === 'cloud') {\n      return await saveToCloud(filename, content, type);\n    }\n    await downloadFile(filename, content, type);\n  };\n\n  const saveMultipleFiles = async (files: Array<{ name: string; content: string; type: string }>) => {\n    if (destination === 'cloud') {\n      for (const f of files) {\n        await saveToCloud(f.name, f.content, f.type);\n      }\n      return;\n    }\n    if ('showDirectoryPicker' in window) {\n      try {\n        const dirHandle = await (window as any).showDirectoryPicker({ id: 'db-exports' });\n        for (const f of files) {\n          let name = f.name;\n          try {\n            // If exists, handle conflict according to policy\n            await dirHandle.getFileHandle(name, { create: false });\n            if (conflictPolicy === 'overwrite') {\n              // keep name\n            } else if (conflictPolicy === 'ask') {\n              const ok = window.confirm(`File \"${name}\" exists. Overwrite? Click Cancel to auto-rename.`);\n              if (!ok) {\n                const dot = name.lastIndexOf('.');\n                const base = dot > -1 ? name.slice(0, dot) : name;\n                const ext = dot > -1 ? name.slice(dot) : '';\n                let i = 1;\n                name = `${base} (${i})${ext}`;\n              }\n            } else {\n              const dot = name.lastIndexOf('.');\n              const base = dot > -1 ? name.slice(0, dot) : name;\n              const ext = dot > -1 ? name.slice(dot) : '';\n              let i = 1;\n              name = `${base} (${i})${ext}`;\n            }\n          } catch {}\n          const fileHandle = await dirHandle.getFileHandle(name, { create: true });\n          const writable = await fileHandle.createWritable();\n          await writable.write(f.content);\n          await writable.close();\n        }\n        toast.success('Saved files to chosen folder');\n        return;\n      } catch (e: any) {\n        if (e.name === 'AbortError') {\n          toast.message('Folder selection cancelled');\n          return;\n        }\n      }\n    }\n    for (const f of files) {\n      await downloadFile(f.name, f.content, f.type);\n    }\n  };\n\n  const exportSelectedCSV = async () => {\n    const chosen = tables.filter(t => selected[t.table_name]);\n    if (chosen.length === 0) {\n      toast.message(\"No tables selected\", { description: \"Select at least one table to export.\" });\n      return;\n    }\n    setLoading(true);\n    try {\n      const files: Array<{ name: string; content: string; type: string }> = [];\n      for (const t of chosen) {\n        const { data, error } = await supabase.from(t.table_name).select(\"*\");\n        if (error) {\n          toast.error(`Failed exporting ${t.table_name}`, { description: error.message });\n          continue;\n        }\n        const csv = Papa.unparse(data || []);\n        files.push({ name: `${t.table_name}.csv`, content: csv, type: \"text/csv\" });\n      }\n      await saveMultipleFiles(files);\n      toast.success(\"Export complete\", { description: \"Downloaded CSVs for selected tables.\" });\n    } catch (e: any) {\n      toast.error(\"Export failed\", { description: e.message || String(e) });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const allExportOptionsSelected = Object.values(exportOptions).every(v => v);\n  \n  const toggleAllExportOptions = (checked: boolean) => {\n    setExportOptions({\n      schema: checked,\n      constraints: checked,\n      indexes: checked,\n      dbFunctions: checked,\n      rlsPolicies: checked,\n      enums: checked,\n      edgeFunctions: checked,\n      secrets: checked,\n      tableData: checked,\n    });\n  };\n\n  const exportSchemaMetadata = async () => {\n    const hasAnySelected = Object.values(exportOptions).some(v => v);\n    if (!hasAnySelected) {\n      toast.message(\"No components selected\", { description: \"Select at least one export option.\" });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const promises: Promise<any>[] = [];\n      const keys: string[] = [];\n\n      if (exportOptions.schema) {\n        promises.push(supabase.rpc(\"get_database_schema\"));\n        keys.push(\"schema\");\n      }\n      if (exportOptions.constraints) {\n        promises.push(supabase.rpc(\"get_table_constraints\"));\n        keys.push(\"constraints\");\n      }\n      if (exportOptions.indexes) {\n        promises.push(supabase.rpc(\"get_table_indexes\"));\n        keys.push(\"indexes\");\n      }\n      if (exportOptions.dbFunctions) {\n        promises.push(supabase.rpc(\"get_database_functions\"));\n        keys.push(\"database_functions\");\n      }\n      if (exportOptions.rlsPolicies) {\n        promises.push(supabase.rpc(\"get_rls_policies\"));\n        keys.push(\"rls_policies\");\n      }\n      if (exportOptions.enums) {\n        promises.push(supabase.rpc(\"get_database_enums\"));\n        keys.push(\"enums\");\n      }\n      if (exportOptions.edgeFunctions || exportOptions.secrets) {\n        promises.push(supabase.functions.invoke(\"list-edge-functions\"));\n        keys.push(\"edge_functions_response\");\n      }\n\n      const results = await Promise.all(promises);\n      \n      const payload: any = {\n        exported_at: new Date().toISOString(),\n      };\n\n      if (exportOptions.schema || exportOptions.constraints || exportOptions.indexes) {\n        payload.tables = tables;\n      }\n\n      results.forEach((result, idx) => {\n        const key = keys[idx];\n        if (key === \"edge_functions_response\") {\n          const data = result.data || { edge_functions: [], secrets: [] };\n          if (exportOptions.edgeFunctions) {\n            payload.edge_functions = data.edge_functions;\n          }\n          if (exportOptions.secrets) {\n            payload.secrets = data.secrets;\n          }\n        } else {\n          if (result.error) {\n            throw new Error(result.error.message);\n          }\n          payload[key] = result.data;\n        }\n      });\n\n      // Export table data if selected\n      if (exportOptions.tableData) {\n        const chosen = tables.filter(t => selected[t.table_name]);\n        if (chosen.length > 0) {\n          const tableDataPromises = chosen.map(async (t) => {\n            const { data, error } = await supabase.from(t.table_name).select(\"*\");\n            if (error) {\n              console.error(`Failed exporting ${t.table_name}:`, error.message);\n              return { table_name: t.table_name, data: [], error: error.message };\n            }\n            return { table_name: t.table_name, data: data || [] };\n          });\n          payload.table_data = await Promise.all(tableDataPromises);\n        }\n      }\n\n      await saveFile(`schema-metadata.json`, JSON.stringify(payload, null, 2), \"application/json\");\n      \n      const exportedItems = Object.entries(exportOptions)\n        .filter(([_, v]) => v)\n        .map(([k]) => k)\n        .join(\", \");\n      toast.success(\"Export complete\", { description: `Exported: ${exportedItems}` });\n    } catch (e: any) {\n      toast.error(\"Export failed\", { description: e.message || String(e) });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const exportSchemaSQL = async () => {\n    const hasAnySelected = Object.values(exportOptions).some(v => v);\n    if (!hasAnySelected) {\n      toast.message(\"No components selected\", { description: \"Select at least one export option.\" });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      let sqlContent = `-- Database Schema Export\\n-- Generated on: ${new Date().toISOString()}\\n\\n`;\n\n      // Export schema (tables and columns)\n      if (exportOptions.schema) {\n        const { data: schemaData, error } = await supabase.rpc(\"get_database_schema\");\n        if (error) throw error;\n        \n        sqlContent += \"-- Tables and Columns\\n\";\n        if (schemaData && Array.isArray(schemaData)) {\n          const tableGroups = schemaData.reduce((acc: any, row: any) => {\n            if (!acc[row.table_name]) {\n              acc[row.table_name] = [];\n            }\n            acc[row.table_name].push(row);\n            return acc;\n          }, {});\n\n          const resolveColumnType = (col: any) => {\n            const dt = (col.data_type || '').toString();\n            const udt = (col.udt_name || '').toString();\n            // Resolve enums/domains\n            if (dt.toUpperCase() === 'USER-DEFINED' && udt) {\n              return `\"${udt}\"`;\n            }\n            // Resolve arrays from udt_name (e.g., _uuid -> uuid[])\n            if (dt.toUpperCase() === 'ARRAY' && udt) {\n              const base = udt.startsWith('_') ? udt.slice(1) : udt;\n              return `${base}[]`;\n            }\n            // Length only for character types\n            if ((dt === 'character varying' || dt === 'varchar') && col.character_maximum_length) {\n              return `${dt}(${col.character_maximum_length})`;\n            }\n            return dt || 'text';\n          };\n\n          Object.entries(tableGroups).forEach(([tableName, columns]: [string, any]) => {\n            sqlContent += `\\nCREATE TABLE IF NOT EXISTS \"${tableName}\" (\\n`;\n            // Deduplicate column definitions by column_name\n            const seen = new Set<string>();\n            const uniqueCols = (columns as any[]).filter((col) => {\n              const name = col.column_name;\n              if (seen.has(name)) return false;\n              seen.add(name);\n              return true;\n            });\n            const columnDefs = uniqueCols.map((col: any) => {\n              let def = `  \"${col.column_name}\" ${resolveColumnType(col)}`;\n              if (col.is_nullable === false) {\n                def += ' NOT NULL';\n              }\n              if (col.column_default) {\n                def += ` DEFAULT ${col.column_default}`;\n              }\n              return def;\n            });\n            sqlContent += columnDefs.join(',\\n') + '\\n);\\n';\n          });\n        }\n      }\n\n      // Export constraints\n      if (exportOptions.constraints) {\n        const { data: constraintsData, error } = await supabase.rpc(\"get_table_constraints\");\n        if (error) throw error;\n        \n        sqlContent += \"\\n-- Constraints\\n\";\n        if (constraintsData && Array.isArray(constraintsData)) {\n          constraintsData.forEach((constraint: any) => {\n            // Use constraint_details provided by RPC for accuracy across PK, FK, UNIQUE, CHECK\n            const details = (constraint.constraint_details || '').toString();\n            if (details.trim().length > 0) {\n              sqlContent += `ALTER TABLE \"${constraint.table_name}\" ADD CONSTRAINT \"${constraint.constraint_name}\" ${details};\\n`;\n            }\n          });\n        }\n      }\n\n      // Export indexes\n      if (exportOptions.indexes) {\n        const { data: indexesData, error } = await supabase.rpc(\"get_table_indexes\");\n        if (error) throw error;\n        \n        sqlContent += \"\\n-- Indexes\\n\";\n        if (indexesData && Array.isArray(indexesData)) {\n          indexesData.forEach((index: any) => {\n            // Use full index definition from pg_get_indexdef for correctness\n            const def = (index.index_definition || '').toString();\n            if (def.trim().length > 0) {\n              sqlContent += `${def};\\n`;\n            }\n          });\n        }\n      }\n\n      // Export database functions\n      if (exportOptions.dbFunctions) {\n        // Prefer RPC with full bodies; gracefully fall back to metadata-only\n        let functionsData: any[] | null = null;\n        try {\n          const { data: functionsWithBody } = await supabase.rpc(\"get_database_functions_with_body\");\n          functionsData = functionsWithBody || null;\n        } catch (e) {\n          functionsData = null;\n        }\n        if (!functionsData) {\n          const { data: metaData, error } = await supabase.rpc(\"get_database_functions\");\n          if (error) throw error;\n          functionsData = metaData || [];\n        }\n        \n        sqlContent += \"\\n-- Database Functions\\n\";\n        if (functionsData && Array.isArray(functionsData)) {\n          let anyPrinted = false;\n          functionsData.forEach((func: any) => {\n            const name = func?.name || func?.function_name;\n            const schema = func?.schema || 'public';\n            const def = func?.function_definition;\n            if (def && name) {\n              const trimmed = String(def).trim();\n              sqlContent += `-- Function: ${schema}.${name}\\n`;\n              // pg_get_functiondef returns a full CREATE FUNCTION ... AS $$ ... $$; do not append another semicolon\n              sqlContent += `${trimmed}\\n\\n`;\n              anyPrinted = true;\n            } else if (name) {\n              sqlContent += `-- Function metadata only: ${schema}.${name} (${func?.argument_types ?? ''}) RETURNS ${func?.return_type ?? ''} [definition unavailable]\\n`;\n              anyPrinted = true;\n            }\n          });\n          if (!anyPrinted) {\n            sqlContent += \"-- No function definitions available from introspection.\\n\";\n          }\n        }\n      }\n\n      // Export RLS policies\n      if (exportOptions.rlsPolicies) {\n        const { data: policiesData, error } = await supabase.rpc(\"get_rls_policies\");\n        if (error) throw error;\n        \n        sqlContent += \"\\n-- RLS Policies\\n\";\n        if (policiesData && Array.isArray(policiesData)) {\n          const tableGroups = policiesData.reduce((acc: any, policy: any) => {\n            if (!acc[policy.table_name]) {\n              acc[policy.table_name] = [];\n            }\n            acc[policy.table_name].push(policy);\n            return acc;\n          }, {});\n\n          Object.entries(tableGroups).forEach(([tableName, policies]: [string, any]) => {\n            sqlContent += `\\n-- Enable RLS on ${tableName}\\n`;\n            sqlContent += `ALTER TABLE \"${tableName}\" ENABLE ROW LEVEL SECURITY;\\n`;\n            \n            policies.forEach((policy: any) => {\n              sqlContent += `CREATE POLICY \"${policy.policy_name}\" ON \"${tableName}\"\\n`;\n              // 'command' comes from get_rls_policies; default to ALL if missing\n              sqlContent += `  FOR ${policy.command || 'ALL'}\\n`;\n              // 'roles' is returned as text (e.g., \"{authenticated,anon}\"). Parse safely.\n              const rolesText = (policy.roles ?? '').toString();\n              if (rolesText.trim() !== '') {\n                const parsedRoles = rolesText\n                  .replace(/^{|}$/g, '')\n                  .split(',')\n                  .map((r: string) => r.trim())\n                  .filter((r: string) => r.length > 0);\n                if (parsedRoles.length > 0) {\n                  const rolesSql = parsedRoles\n                    .map((r: string) => {\n                      const lower = r.toLowerCase();\n                      if (lower === 'public') return 'PUBLIC';\n                      if (lower === 'current_user') return 'CURRENT_USER';\n                      if (lower === 'session_user') return 'SESSION_USER';\n                      return `\"${r}\"`;\n                    })\n                    .join(', ');\n                  sqlContent += `  TO ${rolesSql}\\n`;\n                }\n              }\n              if (policy.using_expression) {\n                sqlContent += `  USING (${policy.using_expression})\\n`;\n              }\n              if (policy.with_check_expression) {\n                sqlContent += `  WITH CHECK (${policy.with_check_expression})\\n`;\n              }\n              sqlContent += ';\\n';\n            });\n          });\n        }\n      }\n\n      // Export enums\n      if (exportOptions.enums) {\n        const { data: enumsData, error } = await supabase.rpc(\"get_database_enums\");\n        if (error) throw error;\n        \n        sqlContent += \"\\n-- Enums\\n\";\n        if (enumsData && Array.isArray(enumsData)) {\n          enumsData.forEach((enumItem: any) => {\n            const enumType = enumItem?.enum_type;\n            const labelsText = (enumItem?.labels ?? '').toString();\n            if (!enumType || labelsText.trim() === '') return;\n            const labels = labelsText\n              .replace(/^{|}$/g, '')\n              .split(',')\n              .map((l: string) => l.trim())\n              .filter((l: string) => l.length > 0)\n              .map((l: string) => `'${l.replace(/'/g, \"''\")}'`)\n              .join(', ');\n            sqlContent += `CREATE TYPE \"${enumType}\" AS ENUM (${labels});\\n`;\n          });\n        }\n      }\n\n      // Export table data as INSERT statements\n      if (exportOptions.tableData) {\n        const chosen = tables.filter(t => selected[t.table_name]);\n\n        // Build a table->column->data_type map for formatting\n        const { data: schemaData, error: schemaError } = await supabase.rpc(\"get_database_schema\");\n        if (schemaError) throw schemaError;\n        const resolveDataTypeForValue = (col: any) => {\n          const dt = (col.data_type || '').toString();\n          const udt = (col.udt_name || '').toString();\n          if (dt.toUpperCase() === 'ARRAY' && udt) {\n            const base = udt.startsWith('_') ? udt.slice(1) : udt;\n            return `${base}[]`;\n          }\n          if (dt.toUpperCase() === 'USER-DEFINED' && udt) {\n            return udt;\n          }\n          return dt;\n        };\n        const typeMapByTable: Record<string, Record<string, string>> = (schemaData || []).reduce(\n          (acc: Record<string, Record<string, string>>, col: any) => {\n            if (!acc[col.table_name]) acc[col.table_name] = {};\n            acc[col.table_name][col.column_name] = resolveDataTypeForValue(col);\n            return acc;\n          },\n          {}\n        );\n\n        if (chosen.length > 0) {\n          sqlContent += \"\\n-- Table Data\\n\";\n\n          const escapeStr = (s: string) => s.replace(/'/g, \"''\");\n\n          const formatArray = (arr: any[], baseType?: string) => {\n            const numericTypes = [\n              \"integer\",\n              \"bigint\",\n              \"smallint\",\n              \"numeric\",\n              \"real\",\n              \"double precision\",\n            ];\n            const items = arr\n              .map((v) => {\n                if (v === null) return \"NULL\";\n                if (baseType && numericTypes.includes(baseType)) return String(v);\n                if (baseType === \"boolean\") return v ? \"true\" : \"false\";\n                const s = String(v)\n                  .replace(/\"/g, '\\\\\"')\n                  .replace(/\\\\/g, \"\\\\\\\\\")\n                  .replace(/'/g, \"''\");\n                return `\"${s}\"`;\n              })\n              .join(\",\");\n            const literal = `{${items}}`;\n            return baseType ? `'${literal}'::${baseType}[]` : `'${literal}'`;\n          };\n\n          const formatValue = (value: any, dataType?: string) => {\n            if (value === undefined) return \"NULL\";\n            if (value === null) return \"NULL\";\n\n            if (dataType === \"json\" || dataType === \"jsonb\") {\n              const json = JSON.stringify(value);\n              return `'${escapeStr(json)}'::${dataType}`;\n            }\n\n            if (dataType && dataType.endsWith(\"[]\") && Array.isArray(value)) {\n              const baseType = dataType.slice(0, -2);\n              return formatArray(value, baseType);\n            }\n\n            if (typeof value === \"string\") return `'${escapeStr(value)}'`;\n            if (typeof value === \"number\") {\n              if (!Number.isFinite(value)) return \"NULL\";\n              return String(value);\n            }\n            if (typeof value === \"boolean\") return value ? \"TRUE\" : \"FALSE\";\n            if (value instanceof Date) return `'${value.toISOString()}'`;\n\n            if (typeof value === \"object\") {\n              const json = JSON.stringify(value);\n              return `'${escapeStr(json)}'`;\n            }\n\n            return `'${escapeStr(String(value))}'`;\n          };\n\n          for (const table of chosen) {\n            const { data, error } = await supabase.from(table.table_name).select(\"*\");\n            if (error) {\n              console.error(`Failed exporting ${table.table_name}:`, error.message);\n              continue;\n            }\n\n            if (data && data.length > 0) {\n              sqlContent += `\\n-- Data for table: ${table.table_name}\\n`;\n\n              const colTypes = typeMapByTable[table.table_name] || {};\n              const columns = Object.keys(colTypes).length > 0 ? Object.keys(colTypes) : Object.keys(data[0]);\n              const columnNames = columns.map((col) => `\"${col}\"`).join(\", \");\n\n              data.forEach((row: any) => {\n                const values = columns\n                  .map((col) => formatValue(row[col], colTypes[col]))\n                  .join(\", \");\n                sqlContent += `INSERT INTO \"${table.table_name}\" (${columnNames}) VALUES (${values});\\n`;\n              });\n            }\n          }\n        }\n      }\n\n      await saveFile(`schema-export.sql`, sqlContent, \"text/plain\");\n      \n      const exportedItems = Object.entries(exportOptions)\n        .filter(([_, v]) => v)\n        .map(([k]) => k)\n        .join(\", \");\n      toast.success(\"SQL Export complete\", { description: `Exported: ${exportedItems}` });\n    } catch (e: any) {\n      toast.error(\"SQL Export failed\", { description: e.message || String(e) });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const runQuery = async () => {\n    setLoading(true);\n    try {\n      const { data, error } = await supabase.rpc(\"execute_sql_query\", { query_text: query });\n      if (error) throw error;\n      const result = (data as any) || [];\n      setQueryResult(result);\n      toast.success(`Query returned ${result.length} rows`);\n    } catch (e: any) {\n      toast.error(\"Query failed\", { description: e.message || String(e) });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const exportQueryCSV = async () => {\n    if (!queryResult || queryResult.length === 0) {\n      toast.message(\"No data to export\", { description: \"Run a query first.\" });\n      return;\n    }\n    const csv = Papa.unparse(queryResult);\n    await saveFile(\"query-result.csv\", csv, \"text/csv\");\n  };\n\n  const exportFullBackup = async () => {\n    setLoading(true);\n    try {\n      const timestamp = new Date().toISOString();\n      const backup: any = {\n        backup_type: 'full',\n        timestamp,\n        tables: {},\n      };\n\n      // Export all table data\n      for (const table of tables) {\n        const { data, error } = await supabase.from(table.table_name).select(\"*\");\n        if (error) {\n          console.error(`Failed to backup ${table.table_name}:`, error.message);\n          continue;\n        }\n        backup.tables[table.table_name] = data || [];\n      }\n\n      await saveFile(`full-backup-${timestamp}.json`, JSON.stringify(backup, null, 2), \"application/json\");\n      \n      // Save backup timestamp\n      localStorage.setItem('last_database_backup', timestamp);\n      setLastBackupTime(timestamp);\n      \n      toast.success(\"Full backup completed\", { \n        description: `Backed up ${Object.keys(backup.tables).length} tables` \n      });\n    } catch (e: any) {\n      toast.error(\"Full backup failed\", { description: e.message || String(e) });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const exportIncrementalBackup = async () => {\n    if (!lastBackupTime) {\n      toast.error(\"No previous backup found\", { \n        description: \"Please create a full backup first.\" \n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const timestamp = new Date().toISOString();\n      const backup: any = {\n        backup_type: 'incremental',\n        timestamp,\n        since: lastBackupTime,\n        tables: {},\n      };\n\n      let totalChanges = 0;\n\n      // Export only changed records since last backup\n      for (const table of tables) {\n        const { data, error } = await supabase\n          .from(table.table_name)\n          .select(\"*\")\n          .or(`created_at.gte.${lastBackupTime},updated_at.gte.${lastBackupTime}`);\n        \n        if (error) {\n          console.error(`Failed to backup ${table.table_name}:`, error.message);\n          continue;\n        }\n        \n        if (data && data.length > 0) {\n          backup.tables[table.table_name] = data;\n          totalChanges += data.length;\n        }\n      }\n\n      if (totalChanges === 0) {\n        toast.message(\"No changes to backup\", { \n          description: \"Database has no changes since last backup.\" \n        });\n        setLoading(false);\n        return;\n      }\n\n      await saveFile(`incremental-backup-${timestamp}.json`, JSON.stringify(backup, null, 2), \"application/json\");\n      \n      // Update backup timestamp\n      localStorage.setItem('last_database_backup', timestamp);\n      setLastBackupTime(timestamp);\n      \n      toast.success(\"Incremental backup completed\", { \n        description: `Backed up ${totalChanges} changed records across ${Object.keys(backup.tables).length} tables` \n      });\n    } catch (e: any) {\n      toast.error(\"Incremental backup failed\", { description: e.message || String(e) });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const restoreDatabase = async () => {\n    if (!restoreFile) {\n      toast.error(\"No file selected\", { description: \"Please select a backup file to restore.\" });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const fileContent = await restoreFile.text();\n      const backup = JSON.parse(fileContent);\n\n      if (!backup.backup_type || !backup.tables) {\n        throw new Error(\"Invalid backup file format\");\n      }\n\n      let totalRestored = 0;\n      let errors = 0;\n\n      for (const [tableName, records] of Object.entries(backup.tables)) {\n        const recordsArray = records as any[];\n        \n        for (const record of recordsArray) {\n          if (restoreMode === 'upsert') {\n            const { error } = await supabase\n              .from(tableName)\n              .upsert(record, { onConflict: 'id' });\n            \n            if (error) {\n              console.error(`Error upserting to ${tableName}:`, error.message);\n              errors++;\n            } else {\n              totalRestored++;\n            }\n          } else {\n            const { error } = await supabase\n              .from(tableName)\n              .insert(record);\n            \n            if (error) {\n              console.error(`Error inserting to ${tableName}:`, error.message);\n              errors++;\n            } else {\n              totalRestored++;\n            }\n          }\n        }\n      }\n\n      if (errors > 0) {\n        toast.warning(\"Restore completed with errors\", { \n          description: `Restored ${totalRestored} records, ${errors} failed` \n        });\n      } else {\n        toast.success(\"Database restored successfully\", { \n          description: `Restored ${totalRestored} records from backup` \n        });\n      }\n      \n      setRestoreFile(null);\n    } catch (e: any) {\n      toast.error(\"Restore failed\", { description: e.message || String(e) });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Save Settings */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Save Settings</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <div>\n              <Label htmlFor=\"destination\" className=\"text-sm font-medium mb-2 block\">Save Destination</Label>\n              <RadioGroup value={destination} onValueChange={(v) => setDestination(v as 'device' | 'cloud')}>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"device\" id=\"device\" />\n                  <Label htmlFor=\"device\" className=\"font-normal cursor-pointer\">Device (Local Download)</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"cloud\" id=\"cloud\" />\n                  <Label htmlFor=\"cloud\" className=\"font-normal cursor-pointer\">Cloud Storage (Supabase)</Label>\n                </div>\n              </RadioGroup>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"conflict\" className=\"text-sm font-medium mb-2 block\">If File Exists</Label>\n              <RadioGroup value={conflictPolicy} onValueChange={(v) => setConflictPolicy(v as 'ask' | 'overwrite' | 'rename')}>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"rename\" id=\"rename\" />\n                  <Label htmlFor=\"rename\" className=\"font-normal cursor-pointer\">Auto-rename (file-1, file-2...)</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"ask\" id=\"ask\" />\n                  <Label htmlFor=\"ask\" className=\"font-normal cursor-pointer\">Ask me</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"overwrite\" id=\"overwrite\" />\n                  <Label htmlFor=\"overwrite\" className=\"font-normal cursor-pointer\">Overwrite</Label>\n                </div>\n              </RadioGroup>\n            </div>\n          </div>\n          \n          {destination === 'cloud' && (\n            <div>\n              <Label htmlFor=\"cloudPath\" className=\"text-sm font-medium mb-2 block\">Cloud Storage Path (optional)</Label>\n              <Input\n                id=\"cloudPath\"\n                value={cloudBasePath}\n                onChange={(e) => setCloudBasePath(e.target.value)}\n                placeholder=\"e.g., backups/2024\"\n                className=\"max-w-md\"\n              />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Files will be saved to: db-backups/{cloudBasePath || '(root)'}\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {pendingDownloads.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Manual Downloads</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <p className=\"text-sm text-muted-foreground\">Your browser blocked automatic downloads. Click the links below to save files, or clear when done.</p>\n            <div className=\"space-y-2\">\n              {pendingDownloads.map((d, i) => (\n                <div key={`${d.name}-${i}`} className=\"flex items-center justify-between gap-2\">\n                  <a href={d.url} download={d.name} className=\"text-primary underline break-all\">{d.name}</a>\n                </div>\n              ))}\n            </div>\n            <div className=\"flex justify-end\">\n              <Button variant=\"outline\" size=\"sm\" onClick={clearPendingDownloads}>Clear</Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Database Backup</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium\">Full Backup</h3>\n                <p className=\"text-sm text-muted-foreground\">Export complete database with all records</p>\n              </div>\n              <Button onClick={exportFullBackup} disabled={loading}>\n                Create Full Backup\n              </Button>\n            </div>\n            \n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium\">Incremental Backup</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Export only changes since last backup\n                  {lastBackupTime && (\n                    <span className=\"block text-xs mt-1\">\n                      Last backup: {new Date(lastBackupTime).toLocaleString()}\n                    </span>\n                  )}\n                </p>\n              </div>\n              <Button \n                variant=\"outline\" \n                onClick={exportIncrementalBackup} \n                disabled={loading || !lastBackupTime}\n              >\n                Create Incremental Backup\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Database Restore</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-3\">\n            <div>\n              <label className=\"text-sm font-medium\">Select Backup File</label>\n              <input\n                type=\"file\"\n                accept=\".json\"\n                onChange={(e) => setRestoreFile(e.target.files?.[0] || null)}\n                className=\"mt-2 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90\"\n              />\n              {restoreFile && (\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Selected: {restoreFile.name}\n                </p>\n              )}\n            </div>\n            \n            <div>\n              <label className=\"text-sm font-medium\">Restore Mode</label>\n              <div className=\"flex gap-4 mt-2\">\n                <label className=\"flex items-center gap-2\">\n                  <input\n                    type=\"radio\"\n                    value=\"upsert\"\n                    checked={restoreMode === 'upsert'}\n                    onChange={(e) => setRestoreMode(e.target.value as 'upsert')}\n                  />\n                  <span className=\"text-sm\">Upsert (Update or Insert)</span>\n                </label>\n                <label className=\"flex items-center gap-2\">\n                  <input\n                    type=\"radio\"\n                    value=\"insert\"\n                    checked={restoreMode === 'insert'}\n                    onChange={(e) => setRestoreMode(e.target.value as 'insert')}\n                  />\n                  <span className=\"text-sm\">Insert Only</span>\n                </label>\n              </div>\n            </div>\n\n            <Button \n              onClick={restoreDatabase} \n              disabled={loading || !restoreFile}\n              className=\"w-full\"\n            >\n              Restore Database\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Advanced Export</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"text-sm text-muted-foreground mb-3\">Select components to export</div>\n          \n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 p-4 border rounded-lg bg-muted/30\">\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-all\" \n                checked={allExportOptionsSelected} \n                onCheckedChange={(v: any) => toggleAllExportOptions(Boolean(v))} \n              />\n              <label htmlFor=\"export-all\" className=\"text-sm font-semibold\">ALL</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-schema\" \n                checked={exportOptions.schema} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, schema: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-schema\" className=\"text-sm\">Schema (Tables/Columns)</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-constraints\" \n                checked={exportOptions.constraints} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, constraints: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-constraints\" className=\"text-sm\">Constraints</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-indexes\" \n                checked={exportOptions.indexes} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, indexes: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-indexes\" className=\"text-sm\">Indexes</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-dbfunctions\" \n                checked={exportOptions.dbFunctions} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, dbFunctions: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-dbfunctions\" className=\"text-sm\">DB Functions</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-rls\" \n                checked={exportOptions.rlsPolicies} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, rlsPolicies: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-rls\" className=\"text-sm\">RLS Policies</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-enums\" \n                checked={exportOptions.enums} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, enums: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-enums\" className=\"text-sm\">Enums</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-edge\" \n                checked={exportOptions.edgeFunctions} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, edgeFunctions: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-edge\" className=\"text-sm\">Edge Functions</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-secrets\" \n                checked={exportOptions.secrets} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, secrets: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-secrets\" className=\"text-sm\">Secrets (names only)</label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox \n                id=\"export-tabledata\" \n                checked={exportOptions.tableData} \n                onCheckedChange={(v: any) => setExportOptions(prev => ({ ...prev, tableData: Boolean(v) }))} \n              />\n              <label htmlFor=\"export-tabledata\" className=\"text-sm\">Table Data</label>\n            </div>\n          </div>\n\n          {exportOptions.tableData && (\n            <div className=\"mt-4 p-4 border rounded-lg bg-muted/20\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <div className=\"text-sm font-medium\">Select tables to export:</div>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Checkbox id=\"select-all-tables\" checked={allSelected} onCheckedChange={(v: any) => toggleAll(Boolean(v))} />\n                    <label htmlFor=\"select-all-tables\" className=\"text-sm\">Select all tables</label>\n                  </div>\n                  <Button size=\"sm\" variant=\"outline\" onClick={exportSelectedCSV} disabled={loading}>Export as CSV</Button>\n                </div>\n              </div>\n              <div className=\"border rounded-md max-h-[300px] overflow-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"w-[50px]\"></TableHead>\n                      <TableHead>Table</TableHead>\n                      <TableHead>Rows (est.)</TableHead>\n                      <TableHead>RLS</TableHead>\n                      <TableHead>Policies</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {tables.map((t) => (\n                      <TableRow key={t.table_name}>\n                        <TableCell>\n                          <Checkbox checked={!!selected[t.table_name]} onCheckedChange={(v: any) => toggle(t.table_name, Boolean(v))} />\n                        </TableCell>\n                        <TableCell>{t.table_name}</TableCell>\n                        <TableCell>{t.row_estimate}</TableCell>\n                        <TableCell>{t.rls_enabled ? \"On\" : \"Off\"}</TableCell>\n                        <TableCell>{t.policy_count}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex justify-end gap-3\">\n            <Button onClick={exportSchemaSQL} disabled={loading}>\n              Export as SQL File\n            </Button>\n            <Button onClick={exportSchemaMetadata} disabled={loading}>\n              Export Selected Components\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Read-only SQL Runner</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          <Textarea value={query} onChange={(e) => setQuery(e.target.value)} rows={6} />\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={runQuery} disabled={loading}>Run</Button>\n            <Button onClick={exportQueryCSV} disabled={loading || queryResult.length === 0}>Export Result CSV</Button>\n          </div>\n          <div className=\"text-sm text-muted-foreground\">Rows: {queryResult.length}</div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/data-management/FranchiseConfigForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/data-management/SequencesAndPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/data-management/TenantConfigForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/leads-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/opportunities-data.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/opportunities-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/quotes-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/dashboard/shipments-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/pages/testing/QuotationTests.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/theme/themes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/theme/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/_shared/cors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/_shared/logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/cleanup-logs/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/create-user/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/exchange-oauth-token/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/export-data/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/get-account-label/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/get-contact-label/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/get-opportunity-full/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/get-opportunity-label/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/get-service-label/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/list-edge-functions/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/process-lead-assignments/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/salesforce-sync-opportunity/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/search-emails/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/seed-platform-admin/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/send-email/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/sync-all-mailboxes/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/functions/sync-emails/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/migration-package/helpers/clear-quotation-versions.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/migration-package/helpers/dedupe-quote-charges.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/migration-package/helpers/export-authenticated.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/migration-package/helpers/export-rest.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/migration-package/helpers/export-with-service-role.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/migration-package/helpers/sync-legs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/supabase/migration-package/helpers/test-connection.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/test/setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/tests/e2e/auth.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/tests/e2e/landing.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/tests/performance/k6-script.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/vims/Downloads/Development Projects/Trae/SOS Logistics Pro/logic-nexus-ai/vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]