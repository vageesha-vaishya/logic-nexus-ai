import{j as e}from"./jsx-runtime-DF2Pcvd1.js";import{r as l}from"./index-B2-qRKKC.js";import{C as x,a as h,b as g,c as f,d as j}from"./card-DDgMyP-I.js";import{d as L}from"./differenceInCalendarDays-Doit9xz1.js";import{t as v}from"./subDays-CJp_3fXz.js";import{R as y,B as D,b as C,X as w,Y as A,T as b,c as d,C as N,P as I,a as B,L as M}from"./PieChart-Z7NiK8FN.js";import{m as R}from"./mock-data-DBb6LiQI.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./utils-CytzSlOG.js";import"./tiny-invariant-CopsF_GD.js";function Y(r,n){const o=v(r),c=v(n),a=S(o,c),s=Math.abs(L(o,c));o.setDate(o.getDate()-a*s);const t=+(S(o,c)===-a),i=a*(s-t);return i===0?0:i}function S(r,n){const o=r.getFullYear()-n.getFullYear()||r.getMonth()-n.getMonth()||r.getDate()-n.getDate()||r.getHours()-n.getHours()||r.getMinutes()-n.getMinutes()||r.getSeconds()-n.getSeconds()||r.getMilliseconds()-n.getMilliseconds();return o<0?-1:o>0?1:o}const P=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658"];function u({leads:r}){const n=l.useMemo(()=>{const a={};return r.forEach(s=>{const t=Y(new Date,new Date(s.created_at));a[s.status]||(a[s.status]={totalDays:0,count:0}),a[s.status].totalDays+=t,a[s.status].count+=1}),Object.entries(a).map(([s,t])=>({stage:s.charAt(0).toUpperCase()+s.slice(1),avgDays:Math.round(t.totalDays/t.count)||0,count:t.count})).sort((s,t)=>t.avgDays-s.avgDays)},[r]),o=l.useMemo(()=>{const a={};return r.forEach(s=>{const t=s.source||"Unknown";a[t]||(a[t]={won:0,lost:0,active:0,total:0}),a[t].total+=1,s.status==="won"?a[t].won+=1:s.status==="lost"?a[t].lost+=1:a[t].active+=1}),Object.entries(a).map(([s,t])=>({source:s,...t,winRate:t.total>0?Math.round(t.won/t.total*100):0})).sort((s,t)=>t.total-s.total).slice(0,10)},[r]),c=l.useMemo(()=>{let a=0,s=0,t=0;return r.forEach(i=>{i.status==="won"?a++:i.status==="lost"?s++:t++}),[{name:"Won",value:a,color:"#10b981"},{name:"Lost",value:s,color:"#ef4444"},{name:"Open",value:t,color:"#3b82f6"}]},[r]);return l.useMemo(()=>{const a={};return r.forEach(s=>{const t=new Date(s.created_at),i=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;a[i]=(a[i]||0)+1}),Object.entries(a).sort((s,t)=>s[0].localeCompare(t[0])).map(([s,t])=>({date:s,count:t}))},[r]),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs(x,{className:"col-span-4",children:[e.jsxs(h,{children:[e.jsx(g,{children:"Pipeline Velocity"}),e.jsx(f,{children:"Average age of leads in each stage (Days)"})]}),e.jsx(j,{className:"h-[300px]",children:e.jsx(y,{width:"100%",height:"100%",children:e.jsxs(D,{data:n,layout:"vertical",margin:{left:20},children:[e.jsx(C,{strokeDasharray:"3 3",horizontal:!0,vertical:!1}),e.jsx(w,{type:"number",hide:!0}),e.jsx(A,{dataKey:"stage",type:"category",width:100,tick:{fontSize:12}}),e.jsx(b,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(d,{dataKey:"avgDays",fill:"#8884d8",radius:[0,4,4,0],name:"Avg Days",children:n.map((a,s)=>e.jsx(N,{fill:P[s%P.length]},`cell-${s}`))})]})})})]}),e.jsxs(x,{className:"col-span-3",children:[e.jsxs(h,{children:[e.jsx(g,{children:"Conversion Overview"}),e.jsx(f,{children:"Current distribution of lead outcomes"})]}),e.jsx(j,{className:"h-[300px]",children:e.jsx(y,{width:"100%",height:"100%",children:e.jsxs(I,{children:[e.jsx(B,{data:c,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:c.map((a,s)=>e.jsx(N,{fill:a.color},`cell-${s}`))}),e.jsx(b,{}),e.jsx(M,{verticalAlign:"bottom",height:36})]})})})]}),e.jsxs(x,{className:"col-span-7",children:[e.jsxs(h,{children:[e.jsx(g,{children:"Source Performance"}),e.jsx(f,{children:"Win/Loss ratio by lead source"})]}),e.jsx(j,{className:"h-[300px]",children:e.jsx(y,{width:"100%",height:"100%",children:e.jsxs(D,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(C,{strokeDasharray:"3 3",vertical:!1}),e.jsx(w,{dataKey:"source"}),e.jsx(A,{}),e.jsx(b,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(M,{}),e.jsx(d,{dataKey:"won",stackId:"a",fill:"#10b981",name:"Won",radius:[0,0,4,4]}),e.jsx(d,{dataKey:"active",stackId:"a",fill:"#3b82f6",name:"Open"}),e.jsx(d,{dataKey:"lost",stackId:"a",fill:"#ef4444",name:"Lost",radius:[4,4,0,0]})]})})})]})]})}u.__docgenInfo={description:"",methods:[],displayName:"PipelineAnalytics",props:{leads:{required:!0,tsType:{name:"Array",elements:[{name:"Lead"}],raw:"Lead[]"},description:""}}};const J={title:"CRM/Analytics Dashboard",component:u,parameters:{layout:"padded"},tags:["autodocs"]},m={args:{leads:R},render:r=>e.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Pipeline Analytics"}),e.jsx(u,{...r})]})},p={args:{leads:[]},render:r=>e.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Pipeline Analytics (Empty)"}),e.jsx(u,{...r})]})};var E,k,F;m.parameters={...m.parameters,docs:{...(E=m.parameters)==null?void 0:E.docs,source:{originalSource:`{
  args: {
    leads: mockLeads
  },
  render: args => <div className="p-6 bg-slate-50 min-h-screen">
      <h1 className="text-2xl font-bold mb-6">Pipeline Analytics</h1>
      <PipelineAnalytics {...args} />
    </div>
}`,...(F=(k=m.parameters)==null?void 0:k.docs)==null?void 0:F.source}}};var O,_,K;p.parameters={...p.parameters,docs:{...(O=p.parameters)==null?void 0:O.docs,source:{originalSource:`{
  args: {
    leads: []
  },
  render: args => <div className="p-6 bg-slate-50 min-h-screen">
      <h1 className="text-2xl font-bold mb-6">Pipeline Analytics (Empty)</h1>
      <PipelineAnalytics {...args} />
    </div>
}`,...(K=(_=p.parameters)==null?void 0:_.docs)==null?void 0:K.source}}};const Q=["Default","EmptyState"];export{m as Default,p as EmptyState,Q as __namedExportsOrder,J as default};
